"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4176],{63606:(y,P,n)=>{n.r(P),n.d(P,{ServiceAccountCreatePage:()=>g,default:()=>f});var o=n(74848),r=n(96540),E=n(17172),v=n(39601),C=n(84167),A=n(88575),m=n(10354),I=n(55852),M=n(72235),u=n(69444),p=n(89062),O=n(85927),a=n(10096),c=n(31678),T=n(5133);const h=async i=>{const l=await(0,E.AI)().post("/api/serviceaccounts/",i);return await a.TP.fetchUserPermissions(),l},U=async(i,l)=>(0,E.AI)().patch(`/api/serviceaccounts/${i}`,l),g=({})=>{const[i,l]=(0,r.useState)([]),[d,L]=(0,r.useState)([]),D=a.TP.user.orgId,[t,B]=(0,r.useState)({id:0,orgId:a.TP.user.orgId,role:a.TP.licensedAccessControlEnabled()?c.OrgRole.None:c.OrgRole.Viewer,tokens:0,name:"",login:"",isDisabled:!1,createdAt:"",teams:[]});(0,r.useEffect)(()=>{async function s(){try{if(a.TP.hasPermission(c.AccessControlAction.ActionRolesList)){let e=await(0,O.RL)(D);l(e)}}catch(e){console.error("Error loading options",e)}}a.TP.licensedAccessControlEnabled()&&s()},[D]);const W=(0,r.useCallback)(async s=>{s.role=t.role;const e=await h(s);try{const _={avatarUrl:e.avatarUrl,id:e.id,isDisabled:e.isDisabled,login:e.login,name:e.name,orgId:e.orgId,role:e.role,tokens:e.tokens};await U(e.id,s),a.TP.licensedAccessControlEnabled()&&a.TP.hasPermission(c.AccessControlAction.ActionUserRolesAdd)&&a.TP.hasPermission(c.AccessControlAction.ActionUserRolesRemove)&&await(0,O.eA)(d,_.id,_.orgId)}catch(_){console.error(_)}v.Ny.push(`/org/serviceaccounts/${e.id}`)},[t.role,d]),R=s=>{B({...t,role:s})},K=(s,e,_)=>{L(s)};return(0,o.jsx)(u.Y,{navId:"serviceaccounts",pageNav:{text:"Create service account"},children:(0,o.jsx)(u.Y.Contents,{children:(0,o.jsx)(M.l,{onSubmit:W,validateOn:"onSubmit",children:({register:s,errors:e})=>(0,o.jsxs)(o.Fragment,{children:[(0,o.jsxs)(C.n,{children:[(0,o.jsx)(A.D,{label:"Display name",required:!0,invalid:!!e.name,error:e.name?"Display name is required":void 0,children:(0,o.jsx)(m.p,{id:"display-name-input",...s("name",{required:!0}),autoFocus:!0})}),(0,o.jsx)(A.D,{label:"Role",children:a.TP.licensedAccessControlEnabled()?(0,o.jsx)(p.y,{apply:!0,userId:t.id||0,orgId:t.orgId,basicRole:t.role,onBasicRoleChange:R,roleOptions:i,onApplyRoles:K,pendingRoles:d,maxWidth:"100%"}):(0,o.jsx)(T.r,{"aria-label":"Role",value:t.role,onChange:R})})]}),(0,o.jsx)(I.$n,{type:"submit",children:"Create"})]})})})})},f=g}}]);

//# sourceMappingURL=ServiceAccountCreatePage.d86c9bbffd7ddc6089e8.js.map