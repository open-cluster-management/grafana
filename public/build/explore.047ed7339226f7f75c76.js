"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9604],{2864:(Hs,Je,h)=>{h.d(Je,{h:()=>p,j:()=>me});var t=h(91890),g=h(8484);function p(Q){switch(Q){case t.CC.Logfmt:return{label:(0,g.t)("correlations.trans-details.logfmt-label","Logfmt"),value:t.CC.Logfmt,description:(0,g.t)("correlations.trans-details.logfmt-description","Parse provided field with logfmt to get variables"),expressionDetails:{show:!1},mapValueDetails:{show:!1}};case t.CC.Regex:return{label:(0,g.t)("correlations.trans-details.regex-label","Regular expression"),value:t.CC.Regex,description:(0,g.t)("correlations.trans-details.regex-description","Field will be parsed with regex. Use named capture groups to return multiple variables, or a single unnamed capture group to add variable to named map value. Regex is case insensitive."),expressionDetails:{show:!0,required:!0,helpText:(0,g.t)("correlations.trans-details.regex-expression","Use capture groups to extract a portion of the field.")},mapValueDetails:{show:!0,required:!1,helpText:(0,g.t)("correlations.trans-details.regex-map-values","Defines the name of the variable if the capture group is not named.")}};default:return{label:Q,value:Q,expressionDetails:{show:!1},mapValueDetails:{show:!1}}}}const me=()=>Object.values(t.CC).map(Q=>{const N=p(Q);return{label:N.label,value:N.value,description:N.description}})},46277:(Hs,Je,h)=>{h.r(Je),h.d(Je,{default:()=>wc});var t=h(74848),g=h(32196),p=h(96540),me=h(41987),Q=h(32264),N=h(40845),ue=h(66602),Qe=h(37390),So=h(10343),Co=h(58720),St=h(76888),$s=h(25249),j=h(8484),D=h(31678),jo=h(64152),Ro=h(24180),Ct=h(2739),wo=function(e,s){e===void 0&&(e=!0);var n=(0,p.useCallback)(function(o){var r=typeof e=="function"?e():!0;if(r)return o.preventDefault(),s&&(o.returnValue=s),s},[e,s]);(0,p.useEffect)(function(){if(e)return(0,Ct.on)(window,"beforeunload",n),function(){return(0,Ct.AU)(window,"beforeunload",n)}},[e,n])};const Bs=wo;var es=h(64305),ts=h(23596),P=h(14110),Xe=h(67061),Se=h(56034),he=h(14578),q=h(55852);const To=({onSave:e,onDiscard:s,onCancel:n,message:o})=>(0,t.jsxs)(Qe.a,{isOpen:!0,title:"Unsaved changes to correlation",onDismiss:n,icon:"exclamation-triangle",className:(0,g.css)({width:"600px"}),children:[(0,t.jsx)("h5",{children:o}),(0,t.jsxs)(Qe.a.ButtonRow,{children:[(0,t.jsx)(q.$n,{variant:"secondary",onClick:n,fill:"outline",children:"Cancel"}),(0,t.jsx)(q.$n,{variant:"destructive",onClick:s,children:"Continue without saving"}),(0,t.jsx)(q.$n,{variant:"primary",onClick:e,children:"Save correlation"})]})]});var oe=h(2543),Lo=(e=>(e.SOURCE_TARGET_CHANGE="cause the query in the right pane to be re-ran and links added to that data",e.FULL_QUERY_LOSS="lose the changed query",e.FULL_CORR_LOSS="cause the correlation in progress to be lost",e.INVALID_VAR="remove the variables, and your changed query may no longer be valid",e))(Lo||{});const Io=(e,s,n,o)=>{const r=(0,oe.template)("<%= actionStr %> will <%= consequenceStr %>. Would you like to save before continuing?");let i="",a="";if(e===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE)if(i="Closing the pane",s)if(n)a="cause the correlation in progress to be lost";else if(o)a="cause the query in the right pane to be re-ran and links added to that data";else return;else if(n)a="cause the correlation in progress to be lost";else if(o)a="lose the changed query";else return;else if(e===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE)if(i="Changing the datasource",s)if(n)a="cause the correlation in progress to be lost";else return;else if(o)a="lose the changed query";else return;else if(e===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR)if(i="Closing the editor",n)a="cause the correlation in progress to be lost";else if(o)a="remove the variables, and your changed query may no longer be valid";else return;return r({actionStr:i,consequenceStr:a})};var Eo=h(324),We=h(62860),De=h(62256),Z=h(29436),Y=h(23994),J=h(9955);const Oo=({panes:e})=>{const s=(0,D.useDispatch)(),n=(0,N.of)(Fo),o=(0,D.useSelector)(J.vC),r=(0,D.useSelector)(J.st),[i,a]=(0,p.useState)(void 0);Bs(o?.correlationDirty||!1,"Save correlation?"),Bs(!o?.correlationDirty&&o?.queryEditorDirty||!1,"The query editor was changed. Save correlation before continuing?"),(0,p.useEffect)(()=>{if(o?.isExiting){const{correlationDirty:u,queryEditorDirty:x}=o;let m,C;o.postConfirmAction?(m=o.postConfirmAction.isActionLeft,C=o.postConfirmAction.action):(C=D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR,m=!1);const y=Io(C,m,u,x);if(y!==void 0)a(y);else if(C===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&o.postConfirmAction){const{exploreId:b,changeDatasourceUid:S}=o?.postConfirmAction;b&&S&&(s((0,We.wh)({exploreId:b,datasource:S,options:{importQueries:!0}})),s((0,Z.am)({isExiting:!1})))}else if(C===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE&&o.postConfirmAction){const{exploreId:b}=o?.postConfirmAction;b!==void 0&&(s((0,Z.J8)(b)),s((0,Z.am)({isExiting:!1})))}else C===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_EDITOR&&s((0,Z.am)({editorMode:!1}))}},[o,s,r]),(0,es.A)(()=>{s((0,Z.am)({editorMode:!1,isExiting:!1,correlationDirty:!1,label:void 0,description:void 0,canSave:!1})),e.forEach(u=>{s((0,De.nE)({exploreId:u[0],correlationEditorHelperData:void 0})),s((0,Y.Od)({exploreId:u[0]}))})});const l=()=>{s((0,Z.am)({editorMode:!0,isExiting:!1,correlationDirty:!1,label:void 0,description:void 0,canSave:!1})),e.forEach(u=>{s((0,De.nE)({exploreId:u[0],correlationEditorHelperData:void 0})),s((0,Y.Od)({exploreId:u[0]}))})},d=u=>{a(void 0),s((0,Z.J8)(u)),(0,P.rR)("grafana_explore_split_view_closed")},f=(u,x)=>{a(void 0),s((0,We.wh)({exploreId:u,datasource:x,options:{importQueries:!0}}))},c=u=>{if(s((0,Eo.v)(o?.label,o?.description,o?.transformations)),!u&&o?.postConfirmAction!==void 0){const{exploreId:x,action:m,changeDatasourceUid:C}=o?.postConfirmAction;m===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE?(d(x),l()):m===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&C!==void 0&&((0,We.wh)({exploreId:x,datasource:C}),l())}else s((0,Z.am)({editorMode:!1,correlationDirty:!1,isExiting:!1}))};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Ro.XG,{message:u=>u.pathname!=="/explore"&&o?.editorMode&&o?.correlationDirty?"You have unsaved correlation data. Continue?":!0}),i!==void 0&&(0,t.jsx)(To,{onDiscard:()=>{if(o?.postConfirmAction!==void 0){const{exploreId:u,action:x,changeDatasourceUid:m}=o?.postConfirmAction;x===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CLOSE_PANE?d(u):x===D.CORRELATION_EDITOR_POST_CONFIRM_ACTION.CHANGE_DATASOURCE&&m!==void 0&&f(u,m),s((0,Z.am)({isExiting:!1}))}else s((0,Z.am)({editorMode:!1,correlationDirty:!1,isExiting:!1}))},onCancel:()=>{s((0,Z.am)({isExiting:!1})),a(void 0)},onSave:()=>{c(!1)},message:i}),(0,t.jsx)("div",{className:n.correlationEditorTop,children:(0,t.jsxs)(Xe.B,{gap:2,justifyContent:"flex-end",alignItems:"center",children:[(0,t.jsx)(Se.m,{content:"Correlations editor in Explore is an experimental feature.",children:(0,t.jsx)(he.I,{className:n.iconColor,name:"info-circle",size:"xl"})}),(0,t.jsx)(q.$n,{variant:"secondary",disabled:!o?.canSave,fill:"outline",className:o?.canSave?n.buttonColor:n.disabledButtonColor,onClick:()=>{c(!0)},children:"Save"}),(0,t.jsx)(q.$n,{variant:"secondary",fill:"outline",className:n.buttonColor,icon:"times",onClick:()=>{s((0,Z.am)({isExiting:!0})),(0,P.rR)("grafana_explore_correlation_editor_exit_pressed")},children:"Exit correlation editor"})]})})]})},Fo=e=>{const s=e.colors.getContrastText(e.colors.primary.main),n=ts.MV.lighten(e.colors.primary.main,.1),o=ts.MV.darken(e.colors.primary.main,.2),r=ts.MV.darken(s,.2);return{correlationEditorTop:(0,g.css)({backgroundColor:e.colors.primary.main,marginTop:"3px",padding:e.spacing(1)}),iconColor:(0,g.css)({color:s}),buttonColor:(0,g.css)({color:s,borderColor:s,"&:hover":{color:s,borderColor:s,backgroundColor:n}}),disabledButtonColor:(0,g.css)({color:`${r} !important`,backgroundColor:`${o} !important`})}};var ss=h(1503),jt=h(16233),Rt=h(14678);const Do=()=>{const[e,s]=(0,p.useState)([]),{query:n}=(0,ss.useKBar)(),o=(0,D.useDispatch)(),r=(0,D.useSelector)(J.Qb),i=(0,D.useSelector)(J.pF),a=jt.TP.hasPermission(D.AccessControlAction.DataSourcesWrite);return(0,p.useEffect)(()=>{const l=Object.keys(r),d={name:"Explore",priority:ss.Priority.HIGH+1},f=[];if(i)f.push({id:"explore/run-query-left",name:"Run query (left)",keywords:"query left",perform:()=>{o((0,Y.Od)({exploreId:l[0]}))},section:d}),r[1],f.push({id:"explore/run-query-right",name:"Run query (right)",keywords:"query right",perform:()=>{o((0,Y.Od)({exploreId:l[1]}))},section:d}),f.push({id:"explore/split-view-close-left",name:"Close split view left",keywords:"split",perform:()=>{o((0,Z.J8)(l[0]))},section:d}),f.push({id:"explore/split-view-close-right",name:"Close split view right",keywords:"split",perform:()=>{o((0,Z.J8)(l[1]))},section:d});else{const c=Object.values(r).some(u=>u?.datasourceInstance?.uid===Rt.uv);Q.$.featureToggles.correlations&&a&&!c&&f.push({id:"explore/correlations-editor",name:"Correlations editor",perform:()=>{o((0,Z.am)({editorMode:!0})),o((0,Y.Od)({exploreId:l[0]}))},section:d}),f.push({id:"explore/run-query",name:"Run query",keywords:"query",perform:()=>{o((0,Y.Od)({exploreId:l[0]}))},section:d}),f.push({id:"explore/split-view-open",name:"Open split view",keywords:"split",perform:()=>{o((0,Z.ve)())},section:d})}s(f)},[r,i,n,o,a]),(0,ss.useRegisterActions)(n?e:[],[e,n]),null};var Ao=h(40961),No=function(){var e=function(s,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,r){o.__proto__=r}||function(o,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(o[i]=r[i])},e(s,n)};return function(s,n){e(s,n);function o(){this.constructor=s}s.prototype=n===null?Object.create(n):(o.prototype=n.prototype,new o)}}(),ne=function(){return ne=Object.assign||function(e){for(var s,n=1,o=arguments.length;n<o;n++){s=arguments[n];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},ne.apply(this,arguments)},Qs={width:"100%",height:"10px",top:"0px",left:"0px",cursor:"row-resize"},Ws={width:"10px",height:"100%",top:"0px",left:"0px",cursor:"col-resize"},wt={width:"20px",height:"20px",position:"absolute"},Po={top:ne(ne({},Qs),{top:"-5px"}),right:ne(ne({},Ws),{left:void 0,right:"-5px"}),bottom:ne(ne({},Qs),{top:void 0,bottom:"-5px"}),left:ne(ne({},Ws),{left:"-5px"}),topRight:ne(ne({},wt),{right:"-10px",top:"-10px",cursor:"ne-resize"}),bottomRight:ne(ne({},wt),{right:"-10px",bottom:"-10px",cursor:"se-resize"}),bottomLeft:ne(ne({},wt),{left:"-10px",bottom:"-10px",cursor:"sw-resize"}),topLeft:ne(ne({},wt),{left:"-10px",top:"-10px",cursor:"nw-resize"})},ko=function(e){No(s,e);function s(){var n=e!==null&&e.apply(this,arguments)||this;return n.onMouseDown=function(o){n.props.onResizeStart(o,n.props.direction)},n.onTouchStart=function(o){n.props.onResizeStart(o,n.props.direction)},n}return s.prototype.render=function(){return p.createElement("div",{className:this.props.className||"",style:ne(ne({position:"absolute",userSelect:"none"},Po[this.props.direction]),this.props.replaceStyles||{}),onMouseDown:this.onMouseDown,onTouchStart:this.onTouchStart},this.props.children)},s}(p.PureComponent),Mo=function(){var e=function(s,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(o,r){o.__proto__=r}||function(o,r){for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(o[i]=r[i])},e(s,n)};return function(s,n){e(s,n);function o(){this.constructor=s}s.prototype=n===null?Object.create(n):(o.prototype=n.prototype,new o)}}(),we=function(){return we=Object.assign||function(e){for(var s,n=1,o=arguments.length;n<o;n++){s=arguments[n];for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r])}return e},we.apply(this,arguments)},zo={width:"auto",height:"auto"},Tt=function(e,s,n){return Math.max(Math.min(e,n),s)},Vs=function(e,s){return Math.round(e/s)*s},_e=function(e,s){return new RegExp(e,"i").test(s)},Lt=function(e){return!!(e.touches&&e.touches.length)},Ho=function(e){return!!((e.clientX||e.clientX===0)&&(e.clientY||e.clientY===0))},qs=function(e,s,n){n===void 0&&(n=0);var o=s.reduce(function(i,a,l){return Math.abs(a-e)<Math.abs(s[i]-e)?l:i},0),r=Math.abs(s[o]-e);return n===0||r<n?s[o]:e},ns=function(e){return e=e.toString(),e==="auto"||e.endsWith("px")||e.endsWith("%")||e.endsWith("vh")||e.endsWith("vw")||e.endsWith("vmax")||e.endsWith("vmin")?e:e+"px"},It=function(e,s,n,o){if(e&&typeof e=="string"){if(e.endsWith("px"))return Number(e.replace("px",""));if(e.endsWith("%")){var r=Number(e.replace("%",""))/100;return s*r}if(e.endsWith("vw")){var r=Number(e.replace("vw",""))/100;return n*r}if(e.endsWith("vh")){var r=Number(e.replace("vh",""))/100;return o*r}}return e},$o=function(e,s,n,o,r,i,a){return o=It(o,e.width,s,n),r=It(r,e.height,s,n),i=It(i,e.width,s,n),a=It(a,e.height,s,n),{maxWidth:typeof o>"u"?void 0:Number(o),maxHeight:typeof r>"u"?void 0:Number(r),minWidth:typeof i>"u"?void 0:Number(i),minHeight:typeof a>"u"?void 0:Number(a)}},Bo=function(e){return Array.isArray(e)?e:[e,e]},Qo=["as","ref","style","className","grid","snap","bounds","boundsByDirection","size","defaultSize","minWidth","minHeight","maxWidth","maxHeight","lockAspectRatio","lockAspectRatioExtraWidth","lockAspectRatioExtraHeight","enable","handleStyles","handleClasses","handleWrapperStyle","handleWrapperClass","children","onResizeStart","onResize","onResizeStop","handleComponent","scale","resizeRatio","snapGap"],Us="__resizable_base__",Gs=function(e){Mo(s,e);function s(n){var o,r,i,a,l=e.call(this,n)||this;return l.ratio=1,l.resizable=null,l.parentLeft=0,l.parentTop=0,l.resizableLeft=0,l.resizableRight=0,l.resizableTop=0,l.resizableBottom=0,l.targetLeft=0,l.targetTop=0,l.appendBase=function(){if(!l.resizable||!l.window)return null;var d=l.parentNode;if(!d)return null;var f=l.window.document.createElement("div");return f.style.width="100%",f.style.height="100%",f.style.position="absolute",f.style.transform="scale(0, 0)",f.style.left="0",f.style.flex="0 0 100%",f.classList?f.classList.add(Us):f.className+=Us,d.appendChild(f),f},l.removeBase=function(d){var f=l.parentNode;f&&f.removeChild(d)},l.state={isResizing:!1,width:(r=(o=l.propsSize)===null||o===void 0?void 0:o.width)!==null&&r!==void 0?r:"auto",height:(a=(i=l.propsSize)===null||i===void 0?void 0:i.height)!==null&&a!==void 0?a:"auto",direction:"right",original:{x:0,y:0,width:0,height:0},backgroundStyle:{height:"100%",width:"100%",backgroundColor:"rgba(0,0,0,0)",cursor:"auto",opacity:0,position:"fixed",zIndex:9999,top:"0",left:"0",bottom:"0",right:"0"},flexBasis:void 0},l.onResizeStart=l.onResizeStart.bind(l),l.onMouseMove=l.onMouseMove.bind(l),l.onMouseUp=l.onMouseUp.bind(l),l}return Object.defineProperty(s.prototype,"parentNode",{get:function(){return this.resizable?this.resizable.parentNode:null},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"window",{get:function(){return!this.resizable||!this.resizable.ownerDocument?null:this.resizable.ownerDocument.defaultView},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"propsSize",{get:function(){return this.props.size||this.props.defaultSize||zo},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"size",{get:function(){var n=0,o=0;if(this.resizable&&this.window){var r=this.resizable.offsetWidth,i=this.resizable.offsetHeight,a=this.resizable.style.position;a!=="relative"&&(this.resizable.style.position="relative"),n=this.resizable.style.width!=="auto"?this.resizable.offsetWidth:r,o=this.resizable.style.height!=="auto"?this.resizable.offsetHeight:i,this.resizable.style.position=a}return{width:n,height:o}},enumerable:!1,configurable:!0}),Object.defineProperty(s.prototype,"sizeStyle",{get:function(){var n=this,o=this.props.size,r=function(l){var d;if(typeof n.state[l]>"u"||n.state[l]==="auto")return"auto";if(n.propsSize&&n.propsSize[l]&&(!((d=n.propsSize[l])===null||d===void 0)&&d.toString().endsWith("%"))){if(n.state[l].toString().endsWith("%"))return n.state[l].toString();var f=n.getParentSize(),c=Number(n.state[l].toString().replace("px","")),u=c/f[l]*100;return u+"%"}return ns(n.state[l])},i=o&&typeof o.width<"u"&&!this.state.isResizing?ns(o.width):r("width"),a=o&&typeof o.height<"u"&&!this.state.isResizing?ns(o.height):r("height");return{width:i,height:a}},enumerable:!1,configurable:!0}),s.prototype.getParentSize=function(){if(!this.parentNode)return this.window?{width:this.window.innerWidth,height:this.window.innerHeight}:{width:0,height:0};var n=this.appendBase();if(!n)return{width:0,height:0};var o=!1,r=this.parentNode.style.flexWrap;r!=="wrap"&&(o=!0,this.parentNode.style.flexWrap="wrap"),n.style.position="relative",n.style.minWidth="100%",n.style.minHeight="100%";var i={width:n.offsetWidth,height:n.offsetHeight};return o&&(this.parentNode.style.flexWrap=r),this.removeBase(n),i},s.prototype.bindEvents=function(){this.window&&(this.window.addEventListener("mouseup",this.onMouseUp),this.window.addEventListener("mousemove",this.onMouseMove),this.window.addEventListener("mouseleave",this.onMouseUp),this.window.addEventListener("touchmove",this.onMouseMove,{capture:!0,passive:!1}),this.window.addEventListener("touchend",this.onMouseUp))},s.prototype.unbindEvents=function(){this.window&&(this.window.removeEventListener("mouseup",this.onMouseUp),this.window.removeEventListener("mousemove",this.onMouseMove),this.window.removeEventListener("mouseleave",this.onMouseUp),this.window.removeEventListener("touchmove",this.onMouseMove,!0),this.window.removeEventListener("touchend",this.onMouseUp))},s.prototype.componentDidMount=function(){if(!(!this.resizable||!this.window)){var n=this.window.getComputedStyle(this.resizable);this.setState({width:this.state.width||this.size.width,height:this.state.height||this.size.height,flexBasis:n.flexBasis!=="auto"?n.flexBasis:void 0})}},s.prototype.componentWillUnmount=function(){this.window&&this.unbindEvents()},s.prototype.createSizeForCssProperty=function(n,o){var r=this.propsSize&&this.propsSize[o];return this.state[o]==="auto"&&this.state.original[o]===n&&(typeof r>"u"||r==="auto")?"auto":n},s.prototype.calculateNewMaxFromBoundary=function(n,o){var r=this.props.boundsByDirection,i=this.state.direction,a=r&&_e("left",i),l=r&&_e("top",i),d,f;if(this.props.bounds==="parent"){var c=this.parentNode;c&&(d=a?this.resizableRight-this.parentLeft:c.offsetWidth+(this.parentLeft-this.resizableLeft),f=l?this.resizableBottom-this.parentTop:c.offsetHeight+(this.parentTop-this.resizableTop))}else this.props.bounds==="window"?this.window&&(d=a?this.resizableRight:this.window.innerWidth-this.resizableLeft,f=l?this.resizableBottom:this.window.innerHeight-this.resizableTop):this.props.bounds&&(d=a?this.resizableRight-this.targetLeft:this.props.bounds.offsetWidth+(this.targetLeft-this.resizableLeft),f=l?this.resizableBottom-this.targetTop:this.props.bounds.offsetHeight+(this.targetTop-this.resizableTop));return d&&Number.isFinite(d)&&(n=n&&n<d?n:d),f&&Number.isFinite(f)&&(o=o&&o<f?o:f),{maxWidth:n,maxHeight:o}},s.prototype.calculateNewSizeFromDirection=function(n,o){var r=this.props.scale||1,i=Bo(this.props.resizeRatio||1),a=i[0],l=i[1],d=this.state,f=d.direction,c=d.original,u=this.props,x=u.lockAspectRatio,m=u.lockAspectRatioExtraHeight,C=u.lockAspectRatioExtraWidth,y=c.width,b=c.height,S=m||0,L=C||0;return _e("right",f)&&(y=c.width+(n-c.x)*a/r,x&&(b=(y-L)/this.ratio+S)),_e("left",f)&&(y=c.width-(n-c.x)*a/r,x&&(b=(y-L)/this.ratio+S)),_e("bottom",f)&&(b=c.height+(o-c.y)*l/r,x&&(y=(b-S)*this.ratio+L)),_e("top",f)&&(b=c.height-(o-c.y)*l/r,x&&(y=(b-S)*this.ratio+L)),{newWidth:y,newHeight:b}},s.prototype.calculateNewSizeFromAspectRatio=function(n,o,r,i){var a=this.props,l=a.lockAspectRatio,d=a.lockAspectRatioExtraHeight,f=a.lockAspectRatioExtraWidth,c=typeof i.width>"u"?10:i.width,u=typeof r.width>"u"||r.width<0?n:r.width,x=typeof i.height>"u"?10:i.height,m=typeof r.height>"u"||r.height<0?o:r.height,C=d||0,y=f||0;if(l){var b=(x-C)*this.ratio+y,S=(m-C)*this.ratio+y,L=(c-y)/this.ratio+C,w=(u-y)/this.ratio+C,v=Math.max(c,b),T=Math.min(u,S),R=Math.max(x,L),O=Math.min(m,w);n=Tt(n,v,T),o=Tt(o,R,O)}else n=Tt(n,c,u),o=Tt(o,x,m);return{newWidth:n,newHeight:o}},s.prototype.setBoundingClientRect=function(){if(this.props.bounds==="parent"){var n=this.parentNode;if(n){var o=n.getBoundingClientRect();this.parentLeft=o.left,this.parentTop=o.top}}if(this.props.bounds&&typeof this.props.bounds!="string"){var r=this.props.bounds.getBoundingClientRect();this.targetLeft=r.left,this.targetTop=r.top}if(this.resizable){var i=this.resizable.getBoundingClientRect(),a=i.left,l=i.top,d=i.right,f=i.bottom;this.resizableLeft=a,this.resizableRight=d,this.resizableTop=l,this.resizableBottom=f}},s.prototype.onResizeStart=function(n,o){if(!(!this.resizable||!this.window)){var r=0,i=0;if(n.nativeEvent&&Ho(n.nativeEvent)?(r=n.nativeEvent.clientX,i=n.nativeEvent.clientY):n.nativeEvent&&Lt(n.nativeEvent)&&(r=n.nativeEvent.touches[0].clientX,i=n.nativeEvent.touches[0].clientY),this.props.onResizeStart&&this.resizable){var a=this.props.onResizeStart(n,o,this.resizable);if(a===!1)return}this.props.size&&(typeof this.props.size.height<"u"&&this.props.size.height!==this.state.height&&this.setState({height:this.props.size.height}),typeof this.props.size.width<"u"&&this.props.size.width!==this.state.width&&this.setState({width:this.props.size.width})),this.ratio=typeof this.props.lockAspectRatio=="number"?this.props.lockAspectRatio:this.size.width/this.size.height;var l,d=this.window.getComputedStyle(this.resizable);if(d.flexBasis!=="auto"){var f=this.parentNode;if(f){var c=this.window.getComputedStyle(f).flexDirection;this.flexDir=c.startsWith("row")?"row":"column",l=d.flexBasis}}this.setBoundingClientRect(),this.bindEvents();var u={original:{x:r,y:i,width:this.size.width,height:this.size.height},isResizing:!0,backgroundStyle:we(we({},this.state.backgroundStyle),{cursor:this.window.getComputedStyle(n.target).cursor||"auto"}),direction:o,flexBasis:l};this.setState(u)}},s.prototype.onMouseMove=function(n){var o=this;if(!(!this.state.isResizing||!this.resizable||!this.window)){if(this.window.TouchEvent&&Lt(n))try{n.preventDefault(),n.stopPropagation()}catch{}var r=this.props,i=r.maxWidth,a=r.maxHeight,l=r.minWidth,d=r.minHeight,f=Lt(n)?n.touches[0].clientX:n.clientX,c=Lt(n)?n.touches[0].clientY:n.clientY,u=this.state,x=u.direction,m=u.original,C=u.width,y=u.height,b=this.getParentSize(),S=$o(b,this.window.innerWidth,this.window.innerHeight,i,a,l,d);i=S.maxWidth,a=S.maxHeight,l=S.minWidth,d=S.minHeight;var L=this.calculateNewSizeFromDirection(f,c),w=L.newHeight,v=L.newWidth,T=this.calculateNewMaxFromBoundary(i,a);this.props.snap&&this.props.snap.x&&(v=qs(v,this.props.snap.x,this.props.snapGap)),this.props.snap&&this.props.snap.y&&(w=qs(w,this.props.snap.y,this.props.snapGap));var R=this.calculateNewSizeFromAspectRatio(v,w,{width:T.maxWidth,height:T.maxHeight},{width:l,height:d});if(v=R.newWidth,w=R.newHeight,this.props.grid){var O=Vs(v,this.props.grid[0]),z=Vs(w,this.props.grid[1]),k=this.props.snapGap||0,H=k===0||Math.abs(O-v)<=k?O:v,A=k===0||Math.abs(z-w)<=k?z:w;v=H,w=A}var W={width:v-m.width,height:w-m.height};if(C&&typeof C=="string"){if(C.endsWith("%")){var te=v/b.width*100;v=te+"%"}else if(C.endsWith("vw")){var se=v/this.window.innerWidth*100;v=se+"vw"}else if(C.endsWith("vh")){var de=v/this.window.innerHeight*100;v=de+"vh"}}if(y&&typeof y=="string"){if(y.endsWith("%")){var te=w/b.height*100;w=te+"%"}else if(y.endsWith("vw")){var se=w/this.window.innerWidth*100;w=se+"vw"}else if(y.endsWith("vh")){var de=w/this.window.innerHeight*100;w=de+"vh"}}var E={width:this.createSizeForCssProperty(v,"width"),height:this.createSizeForCssProperty(w,"height")};this.flexDir==="row"?E.flexBasis=E.width:this.flexDir==="column"&&(E.flexBasis=E.height);var M=this.state.width!==E.width,$=this.state.height!==E.height,F=this.state.flexBasis!==E.flexBasis,U=M||$||F;U&&(0,Ao.flushSync)(function(){o.setState(E)}),this.props.onResize&&U&&this.props.onResize(n,x,this.resizable,W)}},s.prototype.onMouseUp=function(n){var o,r,i=this.state,a=i.isResizing,l=i.direction,d=i.original;if(!(!a||!this.resizable)){var f={width:this.size.width-d.width,height:this.size.height-d.height};this.props.onResizeStop&&this.props.onResizeStop(n,l,this.resizable,f),this.props.size&&this.setState({width:(o=this.props.size.width)!==null&&o!==void 0?o:"auto",height:(r=this.props.size.height)!==null&&r!==void 0?r:"auto"}),this.unbindEvents(),this.setState({isResizing:!1,backgroundStyle:we(we({},this.state.backgroundStyle),{cursor:"auto"})})}},s.prototype.updateSize=function(n){var o,r;this.setState({width:(o=n.width)!==null&&o!==void 0?o:"auto",height:(r=n.height)!==null&&r!==void 0?r:"auto"})},s.prototype.renderResizer=function(){var n=this,o=this.props,r=o.enable,i=o.handleStyles,a=o.handleClasses,l=o.handleWrapperStyle,d=o.handleWrapperClass,f=o.handleComponent;if(!r)return null;var c=Object.keys(r).map(function(u){return r[u]!==!1?p.createElement(ko,{key:u,direction:u,onResizeStart:n.onResizeStart,replaceStyles:i&&i[u],className:a&&a[u]},f&&f[u]?f[u]:null):null});return p.createElement("div",{className:d,style:l},c)},s.prototype.render=function(){var n=this,o=Object.keys(this.props).reduce(function(a,l){return Qo.indexOf(l)!==-1||(a[l]=n.props[l]),a},{}),r=we(we(we({position:"relative",userSelect:this.state.isResizing?"none":"auto"},this.props.style),this.sizeStyle),{maxWidth:this.props.maxWidth,maxHeight:this.props.maxHeight,minWidth:this.props.minWidth,minHeight:this.props.minHeight,boxSizing:"border-box",flexShrink:0});this.state.flexBasis&&(r.flexBasis=this.state.flexBasis);var i=this.props.as||"div";return p.createElement(i,we({style:r,className:this.props.className},o,{ref:function(a){a&&(n.resizable=a)}}),this.state.isResizing&&p.createElement("div",{style:this.state.backgroundStyle}),this.props.children,this.renderResizer())},s.defaultProps={as:"div",onResizeStart:function(){},onResize:function(){},onResizeStop:function(){},enable:{top:!0,right:!0,bottom:!0,left:!0,topRight:!0,bottomRight:!0,bottomLeft:!0,topLeft:!0},style:{},grid:[1,1],lockAspectRatio:!1,lockAspectRatioExtraWidth:0,lockAspectRatioExtraHeight:0,scale:1,resizeRatio:1,snapGap:0},s}(p.PureComponent),Wo=h(69144);function Ks(e){const{children:s,onResize:n,initialHeight:o}=e,r=(0,N.$j)(),i=(0,N.of)(qo),a=(0,Wo.l)(r),l=o||`${r.components.horizontalDrawer.defaultHeight}px`;return(0,t.jsx)(Gs,{className:(0,g.cx)(i.fixed,i.container,i.drawerActive),defaultSize:{width:"100%",height:l},handleClasses:{top:a.dragHandleHorizontal},enable:{top:!0,right:!1,bottom:!1,left:!1,topRight:!1,bottomRight:!1,bottomLeft:!1,topLeft:!1},maxHeight:"100vh",onResize:n,children:s})}const Vo=e=>(0,g.keyframes)`
  0% {
    transform: translateY(${e.components.horizontalDrawer.defaultHeight}px);
  }

  100% {
    transform: translateY(0px);
  }
`,qo=e=>({fixed:(0,g.css)({position:"absolute !important"}),container:(0,g.css)({bottom:0,background:e.colors.background.primary,borderTop:`1px solid ${e.colors.border.weak}`,boxShadow:e.shadows.z3,zIndex:e.zIndex.navbarFixed}),drawerActive:(0,g.css)({opacity:1,[e.transitions.handleMotion("no-preference")]:{animation:`0.5s ease-out ${Vo(e)}`}})});var Ce=h(71468),Uo=h(18226),Ys=h(1933),ot=h(13544),Et=h(40276),rt=h(87490),Go=h(70713),Ot=h(68941),_=h(9557),ye=h(39070),Pe=h(19347),os=h(52494),Ft=h(88407),it=h(11401),Dt=h(32901),Zs=h(42941),Ko=h(23535),Yo=function(e){var s=(0,Ko.A)({x:0,y:0}),n=s[0],o=s[1];return(0,p.useEffect)(function(){var r=function(){e.current&&o({x:e.current.scrollLeft,y:e.current.scrollTop})};return e.current&&(0,Ct.on)(e.current,"scroll",r,{capture:!1,passive:!0}),function(){e.current&&(0,Ct.AU)(e.current,"scroll",r)}},[e]),n};const Zo=Yo,Js=(0,p.createContext)(void 0);function Jo({children:e,refreshDependencies:s}){const[n,o]=(0,p.useState)([]),r=(0,p.useRef)({}),i=(0,p.useCallback)(c=>{const u=c.id?c.id:(0,oe.uniqueId)(`${c.panelId}-${c.title}-${c.icon}_`);return o(x=>{if(c.level==="root"){const m=r.current[c.panelId]||[];return m.length>0&&r.current[c.panelId].forEach(y=>{y.type==="filter"&&(y.ref=c.ref)}),r.current[c.panelId]=[],[...x,{...c,id:u,children:m}].sort(Xs)}if(c.level==="child"){let m=!1;if(Object.keys(r.current).forEach(v=>{if(r.current[v].find(R=>R.title===c.title&&c.type==="filter"&&c.panelId===R.panelId)){m=!0;return}}),m)return[...x];const C=x.findIndex(v=>v.panelId===c.panelId&&v.level==="root");if(C===-1)return Object.keys(r.current).find(T=>T===c.panelId)?r.current[c.panelId].push({...c,id:u}):r.current[c.panelId]=[{...c,id:u}],[...x];const y=[...x],b={...y[C]},S=b.children?.find(v=>v.title===c.title&&c.type==="filter"&&c.panelId===v.panelId);if(S&&S.highlight!==c.highlight)return b.children?.map(v=>{v.title===S?.title&&(v.highlight=c.highlight)}),[...x];if(S)return[...x];let L=c.ref;c.type==="filter"&&(L=b.ref);let w=[{...c,id:u,ref:L},...b.children||[]];return c.childOnTop||(w=_s(w)),y[C]={...b,children:w},y}return[...x]}),u},[]),a=(0,p.useCallback)(c=>{o(u=>u.filter(x=>x.id!==c).map(x=>(x.children&&(x.children=x.children.filter(m=>m.id!==c)),x)))},[]),l=(0,p.useCallback)(c=>{o(c)},[]),d=(0,p.useCallback)((c,u)=>{o(x=>x.map(m=>m.id===c?{...m,...u}:m))},[]),f=(0,p.useCallback)((c,u)=>{o(x=>{const m=c(x);return m?x.map(C=>(C.id===m&&(C.children=C.children?.filter(y=>y.type!==u)),C)):x})},[]);return(0,p.useEffect)(()=>{o(c=>{const u=[...c];for(const x of u){const m=_s(x.children||[]);x.children=m}return u})},[s]),(0,t.jsx)(Js.Provider,{value:{outlineItems:n,register:i,unregister:a,updateOutlineItems:l,unregisterAllChildren:f,updateItem:d},children:e})}function Xs(e,s){if(e.ref&&s.ref){const n=e.ref.compareDocumentPosition(s.ref);if(n===Node.DOCUMENT_POSITION_PRECEDING)return 1;if(n===Node.DOCUMENT_POSITION_FOLLOWING)return-1}return 0}function _s(e){const[s,n]=e.reduce((o,r)=>(r.childOnTop?o[0].push(r):o[1].push(r),o),[[],[]]);return n.sort(Xs),[...s,...n]}function rs(){return(0,p.useContext)(Js)}var Xo=h(8887);function is({contentOutlineExpanded:e,title:s,icon:n,tooltip:o,tooltipPlacement:r="bottom",className:i,indentStyle:a,collapsible:l,collapsed:d,isActive:f,extraHighlight:c,sectionId:u,toggleCollapsed:x,color:m,onRemove:C,...y}){const b=(0,N.$j)(),S=_o(b,m),L=(0,g.cx)(S.button,i),w=(0,p.useRef)(null),[v,T]=(0,p.useState)(!1);(0,p.useEffect)(()=>{w.current&&T(w.current?.scrollWidth>w.current?.clientWidth)},[s]);const R=(0,t.jsxs)("div",{className:(0,g.cx)(S.buttonContainer,a),children:[l&&(0,t.jsx)("button",{className:S.collapseButton,onClick:x,"aria-label":"Content outline item collapse button","aria-expanded":!d,"aria-controls":u,children:(0,t.jsx)(en,{icon:d?"angle-right":"angle-down"})}),(0,t.jsxs)("button",{className:(0,g.cx)(L,{[S.active]:f,[S.extraHighlight]:c}),"aria-label":o,...y,children:[(0,t.jsx)(en,{icon:n}),s&&(0,t.jsx)("span",{className:S.textContainer,ref:w,children:s})]}),C&&(0,t.jsx)(q.$n,{variant:"destructive",className:S.deleteButton,icon:"times",onClick:()=>C(),"data-testid":"content-outline-item-delete-button"})]});return o&&(!e||v)?(0,t.jsx)(Se.m,{content:o,placement:r,children:R}):R}function en({icon:e}){return e?(0,Xo.n6)(e)?(0,t.jsx)(he.I,{name:e,size:"lg",title:e}):e:null}const _o=(e,s)=>({buttonContainer:(0,g.css)({position:"relative",display:"flex",alignItems:"center",flexGrow:1,gap:e.spacing(.25),width:"100%",overflow:"hidden"}),button:(0,g.css)({label:"content-outline-item-button",display:"flex",alignItems:"center",height:e.spacing(e.components.height.md),gap:e.spacing(.5),color:e.colors.text.secondary,width:"100%",background:"transparent",overflow:"hidden",border:"none"}),collapseButton:(0,g.css)({display:"flex",alignItems:"center",justifyContent:"center",width:e.spacing(3),height:e.spacing(4),borderRadius:e.shape.radius.default,color:e.colors.text.secondary,background:"transparent",border:"none",overflow:"hidden","&:hover":{color:e.colors.text.primary,background:e.colors.secondary.shade}}),textContainer:(0,g.css)({whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis",fontSize:e.typography.bodySmall.fontSize,marginLeft:e.spacing(.5)}),active:(0,g.css)({backgroundColor:e.colors.background.secondary,borderTopRightRadius:e.shape.radius.default,borderBottomRightRadius:e.shape.radius.default,position:"relative",height:e.spacing(e.components.height.md),"&::before":{backgroundImage:s!==void 0?"none":e.colors.gradients.brandVertical,backgroundColor:s!==void 0?s:"none",borderRadius:e.shape.radius.default,content:'" "',display:"block",height:"100%",position:"absolute",transform:"translateX(-50%)",width:e.spacing(.5),left:"2px"}}),extraHighlight:(0,g.css)({backgroundColor:e.colors.background.secondary,borderTopRightRadius:e.shape.radius.default,borderBottomRightRadius:e.shape.radius.default,position:"relative","&::before":{backgroundImage:s!==void 0?"none":e.colors.gradients.brandVertical,backgroundColor:s!==void 0?s:"none",borderRadius:e.shape.radius.default,content:'" "',display:"block",height:"100%",position:"absolute",transform:"translateX(-50%)",width:e.spacing(.5),left:"2px"}}),deleteButton:(0,g.css)({width:e.spacing(1),height:e.spacing(1),padding:e.spacing(.75,.75),marginRight:e.spacing(.5)})});function tn(e){return e.children?.filter(s=>s.type!=="filter")||[]}function sn(e,s,n,o){const r=s===e.id,i=n===e.id,a=!o[e.id],l=tn(e).length>0,d=Pt(e,n)&&!o[e.id];return l?a&&(r||d):r||i}const At={visible:"grafana.explore.contentOutline.visible",expanded:"grafana.explore.contentOutline.expanded"};function er({scroller:e,panelId:s}){const[n,o]=(0,Zs.A)(Ot.M.getBool(At.expanded,!0)),r=(0,N.of)(tr,n),i=(0,p.useRef)(e||null),{y:a}=Zo(i),{outlineItems:l}=rs()??{outlineItems:[]},[d,f]=(0,p.useState)(l[0]?.id),[c,u]=(0,p.useState)(l[0]?.children?.[0]?.id),x=l.some(v=>v.children&&!(v.mergeSingleChild&&v.children?.length===1)&&v.children.length>0),m=l.some(v=>v.children?.some(T=>T.onRemove)),[C,y]=(0,p.useState)(()=>l.reduce((v,T)=>(v[T.id]=!!T.expanded,v),{})),b=(v,T=0)=>{let R=0,O=v;if(O){do R+=O?.offsetTop||0,O=O?.offsetParent instanceof HTMLElement?O.offsetParent:void 0;while(O&&O!==e);e?.scroll({top:R+T,behavior:"smooth"})}},S=v=>{if(v.level==="child"&&v.type==="filter"){const T=l.find(R=>R.children?.find(O=>O.id===v.id));T&&b(T.ref,T.customTopOffset)}else b(v.ref,v.customTopOffset),(0,P.rR)("explore_toolbar_contentoutline_clicked",{item:"select_section",type:v.panelId})},L=()=>{Ot.M.set(At.expanded,!n),o(),(0,P.rR)("explore_toolbar_contentoutline_clicked",{item:"outline",type:n?"minimize":"expand"})},w=v=>{y(T=>({...T,[v]:!T[v]})),(0,P.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:C[v]?"expand":"minimize"})};return(0,p.useEffect)(()=>{let v;for(const T of l){let R=T?.ref?.getBoundingClientRect().top;R&&R>=0&&(v=T);const O=tn(T).find(z=>{const k=z.customTopOffset||0;let H=z?.ref?.getBoundingClientRect().top;return H&&H>=k});if(O&&Nt(T)){u(O.id),f(T.id);break}if(v){f(v.id),u(void 0);break}}},[l,a]),(0,t.jsx)(os._,{className:r.wrapper,id:s,children:(0,t.jsx)(Et.E,{children:(0,t.jsxs)("div",{className:r.content,children:[(0,t.jsx)(is,{icon:"arrow-from-right",tooltip:n?"Collapse outline":"Expand outline",tooltipPlacement:n?"right":"bottom",onClick:L,className:(0,g.cx)(r.toggleContentOutlineButton,{[r.justifyCenter]:!n&&!x}),"aria-expanded":n}),l.map(v=>(0,t.jsxs)(p.Fragment,{children:[(0,t.jsx)(is,{title:n?v.title:void 0,contentOutlineExpanded:n,className:(0,g.cx)(r.buttonStyles,{[r.justifyCenter]:!n&&!m,[r.sectionHighlighter]:Pt(v,c)&&!n}),indentStyle:(0,g.cx)({[r.indentRoot]:!Nt(v)&&x,[r.sectionHighlighter]:Pt(v,c)&&!n&&C[v.id]}),icon:v.icon,onClick:()=>S(v),tooltip:v.title,collapsible:Nt(v),collapsed:!C[v.id],toggleCollapsed:()=>w(v.id),isActive:sn(v,d,c,C),sectionId:v.id,color:v.color},v.id),(0,t.jsx)("div",{id:v.id,"data-testid":`section-wrapper-${v.id}`,children:v.children&&Nt(v)&&C[v.id]&&v.children.map((T,R)=>(0,t.jsxs)("div",{className:r.itemWrapper,children:[n&&(0,t.jsx)("div",{className:(0,g.cx)(r.itemConnector,{[r.firstItemConnector]:R===0,[r.lastItemConnector]:R===(v.children?.length||0)-1})}),(0,t.jsx)(is,{title:n?T.title:void 0,contentOutlineExpanded:n,icon:n?void 0:v.icon,className:(0,g.cx)(r.buttonStyles,{[r.justifyCenter]:!n&&!m,[r.sectionHighlighter]:Pt(v,c)&&!n}),indentStyle:r.indentChild,onClick:O=>{S(T),T.onClick?.(O)},tooltip:T.title,isActive:sn(T,d,c,C),extraHighlight:T.highlight,color:T.color,onRemove:T.onRemove?()=>T.onRemove?.(T.id):void 0},T.id)]},T.id))})]},v.id))]})})})}const tr=(e,s)=>({wrapper:(0,g.css)({label:"wrapper",position:"relative",display:"flex",justifyContent:"center",marginRight:e.spacing(1),height:"100%",backgroundColor:e.colors.background.primary,width:s?"160px":void 0,minWidth:s?"160px":void 0}),content:(0,g.css)({label:"content",marginLeft:e.spacing(.5),top:0}),buttonStyles:(0,g.css)({display:"flex","&:hover":{color:e.colors.text.primary,textDecoration:"underline"}}),toggleContentOutlineButton:(0,g.css)({"&:hover":{color:e.colors.text.primary},transform:s?"rotate(180deg)":"",marginRight:s?e.spacing(.5):void 0}),indentRoot:(0,g.css)({paddingLeft:e.spacing(3)}),indentChild:(0,g.css)({paddingLeft:s?e.spacing(5):e.spacing(2.75)}),itemWrapper:(0,g.css)({display:"flex",height:e.spacing(4),alignItems:"center"}),itemConnector:(0,g.css)({position:"relative",height:"100%",width:e.spacing(1.5),"&::before":{borderRight:`1px solid ${e.colors.border.medium}`,content:'""',height:"100%",left:e.spacing(4.75),position:"absolute",transform:"translateX(50%)"}}),firstItemConnector:(0,g.css)({"&::before":{top:e.spacing(1),height:`calc(100% - ${e.spacing(1)})`}}),lastItemConnector:(0,g.css)({"&::before":{height:`calc(100% - ${e.spacing(1)})`}}),justifyCenter:(0,g.css)({justifyContent:"center"}),sectionHighlighter:(0,g.css)({backgroundColor:e.colors.background.secondary})});function Nt(e){return!!(e.children&&e.children.length>0&&(!e.mergeSingleChild||e.children.length!==1))}function Pt(e,s){return e.children?.some(n=>n.id===s)}function je({panelId:e,title:s,icon:n,customTopOffset:o,children:r,className:i,level:a="root",mergeSingleChild:l,type:d="scrollIntoView",onClick:f}){const{register:c,unregister:u}=rs()??{},x=(0,p.useRef)(null);return(0,p.useEffect)(()=>{if(!c||!u)return;const m=c({panelId:e,title:s,icon:n,ref:x.current,customTopOffset:o,level:a,mergeSingleChild:l,type:d});return()=>u(m)},[e,s,n,o,a,l,c,u,d,f]),(0,t.jsx)("div",{className:i,ref:x,children:r})}var at=h(49785),kt=h(16817),lt=h(42418),Mt=h(82762),pe=h(88575),Ve=h(10354),zt=h(10860),qe=h(29158),sr=h(91605),as=h(67023),nr=h(18380),or=h(23257),rr=h.n(or),ir=h(60029),ke=h(90182),ls=h(2864);const nn=({label:e,tooltipText:s})=>(0,t.jsxs)(Xe.B,{gap:1,direction:"row",wrap:"wrap",alignItems:"flex-start",children:[(0,t.jsx)(ir.J,{children:e}),(0,t.jsx)(Se.m,{content:s,children:(0,t.jsx)(he.I,{name:"info-circle",size:"sm"})})]}),ar=({onSave:e,onCancel:s,fieldList:n,transformationToEdit:o})=>{const[r,i]=(0,p.useState)(void 0),[a,l]=(0,p.useState)({}),[d,f]=(0,p.useState)({mapValueDetails:{show:!1},expressionDetails:{show:!1}}),[c,u]=(0,p.useState)(!1),[x,m]=(0,p.useState)(!1),{getValues:C,control:y,register:b,watch:S}=(0,at.mN)({defaultValues:(0,p.useMemo)(()=>{if(o){const w=n[o?.field];i(w),o?.expression&&u(!0);const v=(0,ls.h)(o?.type);f({mapValueDetails:v.mapValueDetails,expressionDetails:v.expressionDetails});const T=(0,as.k)({type:o?.type,expression:o?.expression,mapValue:o?.mapValue},w||"",o?.field);return l({...T}),m(!0),{type:o?.type,field:o?.field,mapValue:o?.mapValue,expression:o?.expression}}else return},[n,o])}),L=(0,p.useId)();return(0,p.useEffect)(()=>{const w=S(v=>{const T=v.expression;let R=!1;if(T!==void 0){R=!0;try{new RegExp(T)}catch{R=!1}}else R=!d.expressionDetails.show;u(R);let O=[];if(v.type){const z=(0,as.k)({type:v.type,expression:R?T:"",mapValue:v.mapValue},n[v.field]||"",v.field);O=Object.keys(z),l(O.length>0?{...z}:{})}O.length===0||!R?m(!1):m(!0)});return()=>w.unsubscribe()},[n,d.expressionDetails.show,S]),(0,t.jsxs)(Qe.a,{isOpen:!0,title:`${o?"Edit":"Add"} transformation`,onDismiss:s,className:(0,g.css)({width:"700px"}),children:[(0,t.jsx)("p",{children:"A transformation extracts variables out of a single field. These variables will be available along with your field variables."}),(0,t.jsx)(pe.D,{label:"Field",children:(0,t.jsx)(at.xI,{control:y,render:({field:{onChange:w,ref:v,...T}})=>(0,t.jsx)(ke.l6,{...T,onChange:R=>{R.value&&(w(R.value),i(n[R.value]))},options:Object.entries(n).map(R=>({label:R[0],value:R[0]})),"aria-label":"field"}),name:"field"})}),r&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("pre",{children:(0,t.jsx)(rr(),{textToHighlight:r,searchWords:[c?C("expression")??"":""],autoEscape:!1})}),(0,t.jsx)(pe.D,{label:"Type",children:(0,t.jsx)(at.xI,{control:y,render:({field:{onChange:w,ref:v,...T}})=>(0,t.jsx)(ke.l6,{...T,onChange:R=>{w(R.value);const O=(0,ls.h)(R.value);f({mapValueDetails:O.mapValueDetails,expressionDetails:O.expressionDetails})},options:(0,ls.j)(),"aria-label":"type"}),name:"type"})}),d.expressionDetails.show&&(0,t.jsx)(pe.D,{label:d.expressionDetails.helpText?(0,t.jsx)(nn,{label:"Expression",tooltipText:d.expressionDetails.helpText}):"Expression",htmlFor:`${L}-expression`,required:d.expressionDetails.required,children:(0,t.jsx)(Ve.p,{...b("expression"),id:`${L}-expression`})}),d.mapValueDetails.show&&(0,t.jsx)(pe.D,{label:d.mapValueDetails.helpText?(0,t.jsx)(nn,{label:"Variable Name",tooltipText:d.mapValueDetails.helpText}):"Variable Name",htmlFor:`${L}-mapValue`,children:(0,t.jsx)(Ve.p,{...b("mapValue"),id:`${L}-mapValue`})}),Object.entries(a).length>0&&(0,t.jsxs)(t.Fragment,{children:["This transformation will add the following variables:",(0,t.jsx)("pre",{children:Object.entries(a).map(w=>`\${${w[0]}} = ${w[1]?.value}
`)})]})]}),(0,t.jsxs)(Qe.a.ButtonRow,{children:[(0,t.jsx)(q.$n,{variant:"secondary",onClick:s,fill:"outline",children:"Cancel"}),(0,t.jsx)(q.$n,{variant:"primary",onClick:()=>e(C()),disabled:!x,children:o?"Edit transformation":"Add transformation to correlation"})]})]})},lr=({exploreId:e,correlations:s})=>{const n=(0,D.useDispatch)(),o=(0,N.of)(cr),r=(0,D.useSelector)(J.Qb),i=Object.values(r),{value:a,loading:l}=(0,kt.A)(async()=>await(0,nr.tZ)(i[0],i[1]),[i[0]?.datasourceInstance,i[0]?.queries[0].datasource,i[1]?.datasourceInstance,i[1]?.queries[0].datasource]),{register:d,watch:f,getValues:c,setValue:u}=(0,at.mN)(),[x,m]=(0,p.useState)(!1),[C,y]=(0,p.useState)(!1),[b,S]=(0,p.useState)(!1),[L,w]=(0,p.useState)([]),[v,T]=(0,p.useState)(void 0),R=(0,D.useSelector)(J.vC),O=(0,p.useId)();return(0,p.useEffect)(()=>(n((0,Z.am)({canSave:!0})),()=>{n((0,Z.am)({canSave:!1}))}),[n]),(0,p.useEffect)(()=>{!l&&a!==void 0&&!R?.correlationDirty&&c("label")!==""&&u("label",a)},[R?.correlationDirty,a,c,l,u]),(0,p.useEffect)(()=>{const z=f(k=>{let H=R?.correlationDirty||!1,A=k.description||"";!H&&(k.label!==a||A!=="")?H=!0:H&&k.label===a&&A.trim()===""&&(H=!1),n((0,Z.am)({label:k.label,description:k.description,correlationDirty:H}))});return()=>z.unsubscribe()},[R?.correlationDirty,a,n,f]),(0,p.useEffect)(()=>{const z=!R?.correlationDirty&&L.length>0?!0:R?.correlationDirty;n((0,Z.am)({transformations:L,correlationDirty:z}));let k={};L.forEach(H=>{const A=(0,as.k)({type:H.type,expression:H.expression,mapValue:H.mapValue},s.vars[H.field],H.field);Object.keys(A).forEach(W=>{k[W]=A[W]?.value})}),n((0,De.nE)({exploreId:e,correlationEditorHelperData:{resultField:s.resultField,origVars:s.origVars,vars:{...s.origVars,...k}}}))},[n,L]),(0,t.jsxs)(t.Fragment,{children:[b&&(0,t.jsx)(ar,{onCancel:()=>{T(void 0),S(!1)},onSave:z=>{if(v!==void 0){const k=[...L];k[v]=z,w(k),T(void 0)}else w([...L,z]);S(!1)},fieldList:s.origVars,transformationToEdit:v!==void 0?L[v]:void 0}),(0,t.jsxs)(lt.F,{title:"Correlation details",severity:"info",children:["The correlation link will appear by the ",(0,t.jsx)("code",{children:s.resultField})," field. You can use the following variables to set up your correlations:",(0,t.jsx)("pre",{children:Object.entries(s.vars).map(z=>`\${${z[0]}} = ${z[1]}
`)}),(0,t.jsxs)(Mt.S,{collapsible:!0,isOpen:x,onToggle:()=>{m(!x)},label:(0,t.jsxs)(Xe.B,{gap:1,direction:"row",wrap:"wrap",alignItems:"center",children:["Label / Description",!x&&!l&&(0,t.jsx)("span",{className:o.labelCollapseDetails,children:`Label: ${c("label")||a}`})]}),children:[(0,t.jsx)(pe.D,{label:"Label",htmlFor:`${O}-label`,children:(0,t.jsx)(Ve.p,{...d("label"),id:`${O}-label`,onBlur:()=>{c("label")===""&&a!==void 0&&u("label",a)}})}),(0,t.jsx)(pe.D,{label:"Description",htmlFor:`${O}-description`,children:(0,t.jsx)(Ve.p,{...d("description"),id:`${O}-description`})})]}),(0,t.jsxs)(Mt.S,{collapsible:!0,isOpen:C,onToggle:()=>{y(!C)},label:(0,t.jsxs)(Xe.B,{gap:1,direction:"row",wrap:"wrap",alignItems:"center",children:["Transformations",(0,t.jsx)(Se.m,{content:"A transformation extracts one or more variables out of a single field.",children:(0,t.jsx)(he.I,{name:"info-circle",size:"sm"})})]}),children:[(0,t.jsx)(q.$n,{variant:"secondary",fill:"outline",onClick:()=>{S(!0)},className:o.transformationAction,children:"Add transformation"}),L.map((z,k)=>{const{type:H,field:A,expression:W,mapValue:te}=z,se=[(te??"").length>0?`Variable name: ${te}`:void 0,(W??"").length>0?(0,t.jsxs)(t.Fragment,{children:["Expression: ",(0,t.jsx)("code",{children:W})]}):void 0].filter(de=>de);return(0,t.jsxs)(zt.Z,{children:[(0,t.jsxs)(zt.Z.Heading,{children:[A,": ",H]}),se.length>0&&(0,t.jsx)(zt.Z.Meta,{className:o.transformationMeta,children:se}),(0,t.jsxs)(zt.Z.SecondaryActions,{children:[(0,t.jsx)(qe.K,{name:"edit","aria-label":"edit transformation",onClick:()=>{T(k),S(!0)}},"edit"),(0,t.jsx)(sr.e,{"aria-label":"delete transformation",onConfirm:()=>w(L.filter((de,E)=>k!==E)),closeOnConfirm:!0})]})]},`trans-${k}`)})]})]})]})},cr=e=>({labelCollapseDetails:(0,g.css)({marginLeft:e.spacing(2),...e.typography.bodySmall,fontStyle:"italic"}),transformationAction:(0,g.css)({marginBottom:e.spacing(2)}),transformationMeta:(0,g.css)({alignItems:"baseline"})});var dr=h(24308),ur=h(79041),Ae=h(91052),pr=h(15162),hr=h(33368);function gr({width:e,height:s,timeZone:n,state:o,pluginId:r,frames:i,timeRange:a,splitOpenFn:l,eventBus:d}){const f=(0,pr.d4)(r),u={dataLinkPostProcessor:(0,hr.h)(l,a),eventBus:d,eventsScope:"explore"};return(0,t.jsx)(ur.XF,{value:u,children:(0,t.jsx)(Ae.NR,{title:f.name,width:e,height:s,loadingState:o,children:(x,m)=>(0,t.jsx)(dr.m,{data:{series:i,state:o,timeRange:a},pluginId:r,title:"",width:x,height:m,timeZone:n})})})}var fr=h(67570),mr=h(95247),re=h(27746),cs=h(19727),Ht=h(11134),yr=h(75269),xr=h(51612),ds=h(76698),xe=h(64756),us=h(10096),on=h(81862),Me=h(47232),rn=h(85858),vr=h(15648),br=h(25573),an=h(80582);function Sr(e){const{onClick:s,isSynced:n}=e,o=()=>{const{isSynced:r}=e,i=r?"Unsync all views":"Sync all views to this time range";return(0,t.jsx)(t.Fragment,{children:i})};return(0,t.jsx)(Se.m,{content:o,placement:"bottom",children:(0,t.jsx)(re.I,{icon:"link",variant:n?"active":"canvas","aria-label":n?"Synced times":"Unsynced times",onClick:s})})}class Cr extends p.Component{constructor(){super(...arguments),this.onMoveTimePicker=s=>{const{range:n,onChangeTime:o,timeZone:r}=this.props,{from:i,to:a}=(0,an.Wb)(s,n),l={from:(0,Me.oZ)(r,i),to:(0,Me.oZ)(r,a)};o(l)},this.onMoveForward=()=>this.onMoveTimePicker(1),this.onMoveBack=()=>this.onMoveTimePicker(-1),this.onChangeTimePicker=s=>{const n=rn.isMathString(s.raw.from)?s.raw.from:s.from,o=rn.isMathString(s.raw.to)?s.raw.to:s.to;this.props.onChangeTime({from:n,to:o}),(0,P.rR)("grafana_explore_time_picker_time_range_changed",{timeRangeFrom:n,timeRangeTo:o})},this.onZoom=()=>{const{range:s,onChangeTime:n,timeZone:o}=this.props,{from:r,to:i}=(0,an.Zk)(s,2),a={from:(0,Me.oZ)(o,r),to:(0,Me.oZ)(o,i)};n(a)}}render(){const{range:s,timeZone:n,fiscalYearStartMonth:o,splitted:r,syncedTimes:i,onChangeTimeSync:a,hideText:l,onChangeTimeZone:d,onChangeFiscalYearStartMonth:f}=this.props,c=r?(0,t.jsx)(Sr,{onClick:a,isSynced:i}):void 0,u={value:s,timeZone:n,fiscalYearStartMonth:o,onMoveBackward:this.onMoveBack,onMoveForward:this.onMoveForward,onZoom:this.onZoom,hideText:l},x=(0,vr.r)(Q.$.bootData.user.weekStart);return(0,t.jsx)(br.m,{isOnCanvas:!0,...u,timeSyncButton:c,isSynced:i,widthOverride:r?window.innerWidth/2:void 0,onChange:this.onChangeTimePicker,onChangeTimeZone:d,onChangeFiscalYearStartMonth:f,weekStart:x})}}var ln=h(86634);function jr(e){const s=(0,p.useRef)(null),{start:n,pause:o,resume:r,isLive:i,isPaused:a,stop:l,splitted:d}=e,f=i&&!a?"active":"canvas",c=i?a?r:o:n;return(0,t.jsxs)(cs.e,{children:[(0,t.jsx)(Se.m,{content:i&&!a?(0,t.jsx)(t.Fragment,{children:"Pause the live stream"}):(0,t.jsx)(t.Fragment,{children:"Start live stream your logs"}),placement:"bottom",children:(0,t.jsx)(re.I,{iconOnly:d,variant:f,icon:!i||a?"play":"pause",onClick:c,children:i&&a?"Paused":"Live"})}),(0,t.jsx)(ln.A,{mountOnEnter:!0,unmountOnExit:!0,timeout:100,in:i,classNames:{enter:$t.stopButtonEnter,enterActive:$t.stopButtonEnterActive,exit:$t.stopButtonExit,exitActive:$t.stopButtonExitActive},nodeRef:s,children:(0,t.jsx)(Se.m,{content:(0,t.jsx)(t.Fragment,{children:"Stop and exit the live stream"}),placement:"bottom",children:(0,t.jsx)(re.I,{ref:s,variant:f,onClick:l,icon:"square-shape"})})})]})}const $t={stopButtonEnter:(0,g.css)({label:"stopButtonEnter",width:0,opacity:0,overflow:"hidden"}),stopButtonEnterActive:(0,g.css)({label:"stopButtonEnterActive",opacity:1,width:"32px"}),stopButtonExit:(0,g.css)({label:"stopButtonExit",width:"32px",opacity:1,overflow:"hidden"}),stopButtonExitActive:(0,g.css)({label:"stopButtonExitActive",opacity:0,width:0})};var Re=h(38138),ct=h(83122),Ue=(e=>(e.QueryLibrary="Query library",e.RichHistory="Query history",e.Starred="Starred",e.Settings="Settings",e))(Ue||{});const cn=(0,p.createContext)({selectedTab:void 0,setSelectedTab:()=>{},queryLibraryAvailable:!1,drawerOpened:!1,setDrawerOpened:()=>{}});function et(){return(0,p.useContext)(cn)}function Rr({children:e}){const s=Q.$.featureToggles.queryLibrary===!0,[n,o]=(0,p.useState)(s?"Query library":void 0),[r,i]=(0,p.useState)(!1),a=(0,D.useSelector)(J.i6);return(0,p.useEffect)(()=>{a&&!s&&o(a.starredTabAsFirstTab?"Starred":"Query history")},[a,o,s]),(0,t.jsx)(cn.Provider,{value:{queryLibraryAvailable:s,selectedTab:n,setSelectedTab:o,drawerOpened:r,setDrawerOpened:i},children:e})}const Bt={queryLibrary:(0,j.t)("explore.rich-history.query-library","Query library"),queryHistory:(0,j.t)("explore.rich-history.query-history","Query history")};function wr({variant:e}){const{selectedTab:s,setSelectedTab:n,queryLibraryAvailable:o,drawerOpened:r,setDrawerOpened:i}=et(),a=(0,N.of)(Tr);if(!o)return;function l(f){n(f),i(!1),i(!0)}const d=(0,t.jsxs)(Re.W,{children:[(0,t.jsx)(Re.W.Item,{label:Bt.queryLibrary,onClick:()=>l(Ue.QueryLibrary)}),(0,t.jsx)(Re.W.Item,{label:Bt.queryHistory,onClick:()=>l(Ue.RichHistory)})]});return(0,t.jsxs)(cs.e,{children:[(0,t.jsx)(re.I,{icon:"book",variant:r?"active":"canvas",onClick:()=>i(!r),"aria-label":s,children:e==="full"?s:void 0}),r?(0,t.jsx)(q.$n,{className:a.close,variant:"secondary",icon:"times",onClick:()=>i(!1)}):(0,t.jsx)(ct.m,{overlay:d,children:(0,t.jsx)(re.I,{className:a.toggle,variant:"canvas",icon:"angle-down"})})]})}const Tr=()=>({toggle:(0,g.css)({width:"36px"}),close:(0,g.css)({width:"36px","> svg":{position:"relative",left:2}})});var Lr=h(59093),Ir=h(15068),ps=h(7030),Ge=h(96192);const Er={key:"copy-link",label:(0,j.t)("explore.toolbar.copy-shortened-link","Copy shortened URL"),icon:"share-alt",getUrl:()=>{},shorten:!0,absTime:!1};function Or(){const e=(0,D.useSelector)(J.Qb),[s,n]=(0,p.useState)(!1),[o,r]=(0,p.useState)(Er),i=(d,f,c)=>{d?((0,ps.VP)(c||h.g.location.href),(0,P.rR)("grafana_explore_shortened_link_clicked",{isAbsoluteTime:f})):((0,rt.uJ)(c!==void 0?`${window.location.protocol}//${window.location.host}${Q.$.appSubUrl}${c}`:h.g.location.href),(0,P.rR)("grafana_explore_copy_link_clicked",{isAbsoluteTime:f}))},a=[{key:"normal",label:(0,j.t)("explore.toolbar.copy-links-normal-category","Normal URL links"),items:[{key:"copy-shortened-link",icon:"link",label:(0,j.t)("explore.toolbar.copy-shortened-link","Copy shortened URL"),getUrl:()=>{},shorten:!0,absTime:!1},{key:"copy-link",icon:"link",label:(0,j.t)("explore.toolbar.copy-link","Copy URL"),getUrl:()=>{},shorten:!1,absTime:!1}]},{key:"timesync",label:(0,j.t)("explore.toolbar.copy-links-absolute-category","Time-sync URL links (share with time range intact)"),items:[{key:"copy-short-link-abs-time",icon:"clock-nine",label:(0,j.t)("explore.toolbar.copy-shortened-link-abs-time","Copy absolute shortened URL"),shorten:!0,getUrl:()=>(0,Ge._O)(e),absTime:!0},{key:"copy-link-abs-time",icon:"clock-nine",label:(0,j.t)("explore.toolbar.copy-link-abs-time","Copy absolute URL"),shorten:!1,getUrl:()=>(0,Ge._O)(e),absTime:!0}]}],l=(0,t.jsx)(Re.W,{children:a.map(d=>(0,t.jsx)(Lr.r,{label:d.label,children:d.items.map(f=>(0,t.jsx)(Re.W.Item,{label:f.label,icon:f.icon,onClick:()=>{const c=f.getUrl();i(f.shorten,f.absTime,c),r(f)}},f.key))},d.key))});return(0,t.jsx)(Ir.U,{children:(0,t.jsxs)(Xe.B,{gap:0,direction:"row",alignItems:"center",wrap:"nowrap",children:[(0,t.jsx)(re.I,{tooltip:o.label,icon:o.icon,iconOnly:!0,narrow:!0,onClick:()=>{const d=o.getUrl();i(o.shorten,o.absTime,d)},"aria-label":(0,j.t)("explore.toolbar.copy-shortened-link","Copy shortened URL")}),(0,t.jsx)(ct.m,{overlay:l,placement:"bottom-end",onVisibleChange:n,children:(0,t.jsx)(re.I,{narrow:!0,isOpen:s,"aria-label":(0,j.t)("explore.toolbar.copy-shortened-link-menu","Open copy link options")})})]})})}var Fr=h(74135),Dr=h(3197),Ar=h(24401),Nr=h(30973);const Pr=(0,p.lazy)(()=>h.e(4787).then(h.bind(h,74787)).then(({AddToDashboard:e})=>({default:e})));function kr(e){const{exploreId:s}=e,[n,o]=(0,p.useState)(),[r,i]=(0,p.useState)(!1),a=Mr(e),{extensions:l}=(0,Dr.vl)({extensionPointId:Fr.S.ExploreToolbarAction,context:a,limitPerPlugin:3}),d=(0,J.qq)(s),f=(0,D.useSelector)(d)?.queries?.length;if(l.length<=1)return jt.TP.hasPermission(D.AccessControlAction.DashboardsCreate)||jt.TP.hasPermission(D.AccessControlAction.DashboardsWrite)?(0,t.jsx)(p.Suspense,{fallback:null,children:(0,t.jsx)(Pr,{exploreId:s})}):null;const c=(0,t.jsx)(Nr.w,{extensions:l,onSelect:o});return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(ct.m,{onVisibleChange:i,placement:"bottom-start",overlay:c,children:(0,t.jsx)(re.I,{"aria-label":"Add",disabled:!f,variant:"canvas",isOpen:r,children:"Add"})}),!!n&&!!n.path&&(0,t.jsx)(Ar.s,{path:n.path,title:n.title,onDismiss:()=>o(void 0)})]})}function Mr(e){const{exploreId:s,timeZone:n}=e,r=(0,D.useSelector)(J.vC)?.editorMode||!1,{queries:i,queryResponse:a,range:l}=(0,D.useSelector)((0,J.qq)(s)),d=(0,D.useSelector)((0,J.Jr)(s)),f=i.map(x=>x?.datasource?.uid).filter(x=>x!==void 0),c=[...new Set(f)].length,u=jt.TP.hasPermission(D.AccessControlAction.DataSourcesWrite);return(0,p.useMemo)(()=>({exploreId:s,targets:i,data:a,timeRange:l.raw,timeZone:(0,Ys.O)({timeZone:n}),shouldShowAddCorrelation:Q.$.featureToggles.correlations===!0&&u&&!r&&d&&c===1}),[s,i,a,l.raw,n,u,r,d,c])}var ve=h(89224);function zr(e){const s=(0,D.useDispatch)(),n=(0,p.useCallback)(()=>{s((0,Y.qk)({exploreId:e,isPaused:!0}))},[e,s]),o=(0,p.useCallback)(()=>{s((0,Y.qk)({exploreId:e,isPaused:!1}))},[e,s]),r=(0,p.useCallback)(()=>{n(),s((0,ve.hO)({exploreId:e,refreshInterval:Ht.cC.offOption.value})),s((0,Y.Od)({exploreId:e}))},[e,s,n]),i=(0,p.useCallback)(()=>{s((0,ve.hO)({exploreId:e,refreshInterval:Ht.cC.liveOption.value}))},[e,s]),a=(0,p.useCallback)(()=>{s((0,Y.rR)({exploreId:e}))},[e,s]);return{pause:n,resume:o,stop:r,start:i,clear:a}}function dn(e){const s=zr(e.exploreId);return e.children(s)}const Hr=(e,s)=>({rotateIcon:(0,g.css)({"> div > svg":{transform:"rotate(180deg)"}}),toolbarButton:(0,g.css)({display:"flex",justifyContent:"center",marginRight:e.spacing(.5),width:s&&e.spacing(6)})});function $r({exploreId:e,onChangeTime:s,onContentOutlineToogle:n,isContentOutlineOpen:o}){const r=(0,xe.wA)(),i=(0,xe.d4)(J.pF),a=(0,N.of)(Hr,i),l=(0,xe.d4)(F=>(0,Dt.O)(F.user)),d=(0,xe.d4)(F=>(0,Dt.q)(F.user)),{refreshInterval:f,datasourceInstance:c,range:u,isLive:x,isPaused:m,syncedTimes:C}=(0,xe.d4)(F=>({...(0,oe.pick)(F.explore.panes[e],"refreshInterval","datasourceInstance","range","isLive","isPaused"),syncedTimes:F.explore.syncedTimes}),Ce.shallowEqual),y=(0,xe.d4)((0,Y.h1)(e)),b=(0,xe.d4)(F=>F.explore.largerExploreId===e),S=(0,xe.d4)(F=>i||F.explore.panes[e].containerWidth<1210),L=(0,xe.d4)(F=>F.explore.panes[e].containerWidth<(i?700:800)),w=(0,xe.d4)(J.K6),v=(0,xe.d4)(J.vC),T=v?.editorMode||!1,R=(0,xe.d4)((0,J.Jr)(e)),O=(0,p.useMemo)(()=>R&&b||!R&&!b,[R,b]),z=y?(0,j.t)("explore.toolbar.refresh-picker-cancel","Cancel"):(0,j.t)("explore.toolbar.refresh-picker-run","Run query"),k=async F=>{T?v?.correlationDirty||v?.queryEditorDirty?r((0,Z.am)({isExiting:!0,postConfirmAction:{exploreId:e,action:ds.IW.CHANGE_DATASOURCE,changeDatasourceUid:F.uid,isActionLeft:R}})):(R&&w.forEach(U=>{r((0,De.nE)({exploreId:U[0],correlationEditorHelperData:void 0}))}),r((0,We.wh)({exploreId:e,datasource:F.uid,options:{importQueries:!0}}))):r((0,We.wh)({exploreId:e,datasource:F.uid,options:{importQueries:!0}}))},H=(F=!1)=>r(F?(0,Y.hS)(e):(0,Y.Od)({exploreId:e})),A=F=>r((0,on.Cj)(F)),W=()=>{r((0,Z.ve)()),(0,P.rR)("grafana_explore_split_view_opened",{origin:"menu"})},te=()=>{T?v?.correlationDirty||v?.queryEditorDirty?r((0,Z.am)({isExiting:!0,postConfirmAction:{exploreId:e,action:ds.IW.CLOSE_PANE,isActionLeft:R}})):(w.forEach(F=>{r((0,De.nE)({exploreId:F[0],correlationEditorHelperData:void 0}))}),r((0,Z.J8)(e)),(0,P.rR)("grafana_explore_split_view_closed")):(r((0,Z.J8)(e)),(0,P.rR)("grafana_explore_split_view_closed"))},se=()=>{r(b?(0,Z.JA)():(0,Z.tP)({exploreId:e}))},de=()=>{r((0,ve.iO)(e))},E=F=>r((0,on.c1)(F)),M=F=>{r((0,ve.hO)({exploreId:e,refreshInterval:F}))},$=[(0,t.jsx)(Or,{},"share"),(0,t.jsx)("div",{style:{flex:1}},"spacer0")];return(0,t.jsxs)("div",{children:[f&&(0,t.jsx)(fr.u,{func:H,interval:f,loading:y}),(0,t.jsx)("div",{children:(0,t.jsx)(yr.H,{actions:$})}),(0,t.jsx)(mr.d,{"aria-label":(0,j.t)("explore.toolbar.aria-label","Explore toolbar"),leftItems:[(0,t.jsx)(re.I,{variant:"canvas",tooltip:"Content outline",icon:"list-ui-alt",iconOnly:i,onClick:n,"aria-expanded":o,"aria-controls":o?"content-outline-container":void 0,className:a.toolbarButton,children:"Outline"},"content-outline"),(0,t.jsx)(xr.s,{mixed:!T,onChange:k,current:c?.getRef(),hideTextValue:L,width:L?8:void 0},`${e}-ds-picker`)].filter(Boolean),forceShowLeftItems:!0,children:[(0,t.jsx)(wr,{variant:i?"compact":"full"},"queryLibrary"),i?(0,t.jsxs)(cs.e,{children:[(0,t.jsx)(re.I,{variant:"canvas",tooltip:b?(0,j.t)("explore.toolbar.split-narrow","Narrow pane"):(0,j.t)("explore.toolbar.split-widen","Widen pane"),onClick:se,icon:b?"gf-movepane-left":"gf-movepane-right",iconOnly:!0,className:(0,g.cx)(O&&a.rotateIcon)}),(0,t.jsx)(re.I,{tooltip:(0,j.t)("explore.toolbar.split-close-tooltip","Close split pane"),onClick:te,icon:"times",variant:"canvas",children:(0,t.jsx)(j.x6,{i18nKey:"explore.toolbar.split-close",children:" Close "})})]},"split-controls"):(0,t.jsx)(re.I,{variant:"canvas",tooltip:(0,j.t)("explore.toolbar.split-tooltip","Split the pane"),onClick:W,icon:"columns",disabled:x,children:(0,t.jsx)(j.x6,{i18nKey:"explore.toolbar.split-title",children:"Split"})},"split"),(0,t.jsx)(kr,{exploreId:e,timeZone:l},"toolbar-extension-point"),!x&&(0,t.jsx)(Cr,{exploreId:e,range:u,timeZone:l,fiscalYearStartMonth:d,onChangeTime:s,splitted:i,syncedTimes:C,onChangeTimeSync:de,hideText:S,onChangeTimeZone:A,onChangeFiscalYearStartMonth:E},"timeControls"),(0,t.jsx)(Ht.cC,{onIntervalChanged:M,value:f,isLoading:y,text:S?void 0:z,tooltip:S?z:void 0,intervals:us.TP.getValidIntervals(Ht.cb),isLive:x,onRefresh:()=>H(y),noIntervalPicker:x,primary:!0,width:(S?35:108)+"px"},"refreshPicker"),c?.meta.streaming&&(0,t.jsx)(dn,{exploreId:e,children:F=>{const U={...F,start:()=>{(0,P.rR)("grafana_explore_logs_live_tailing_clicked",{datasourceType:c?.type}),F.start()}};return(0,t.jsx)(jr,{splitted:i,isLive:x,isPaused:m,start:U.start,pause:U.pause,resume:U.resume,stop:U.stop})}},"liveControls")].filter(Boolean)})]})}var Br=h(85194);function Qt(e,s={}){(0,P.rR)(`grafana_flamegraph_${e}`,{app:me.Jk.Unknown,grafana_version:Q.$.buildInfo.version,...s})}const Qr=e=>{const s=(0,N.of)(n=>Wr(n));return(0,t.jsx)("div",{className:s.container,children:(0,t.jsx)(Br.A,{data:e.dataFrames[0],stickyHeader:!0,getTheme:()=>Q.$.theme2,onTableSymbolClick:()=>Qt("table_item_selected"),onViewSelected:n=>Qt("view_selected",{view:n}),onTextAlignSelected:n=>Qt("text_align_selected",{align:n}),onTableSort:n=>Qt("table_sort_selected",{sort:n})})})},Wr=e=>({container:(0,g.css)({background:e.colors.background.primary,display:"flow-root",padding:e.spacing(0,1,1,1),border:`1px solid ${e.components.panel.borderColor}`,borderRadius:e.shape.radius.default})});var Vr=h(72519),un=h(84140),K=h(52622),hs=h(72724),qr=h(85492),Ur=h(77020),Te=h(91002),Gr=h(10940),Kr=h(97814);const pn=150,Yr=({resetKey:e,humanize:s,className:n})=>{const[o,r]=(0,p.useState)(0);return(0,Gr.A)(()=>r(o+pn),pn),(0,p.useEffect)(()=>r(0),[e]),(0,t.jsx)(Kr.g,{timeInMs:o,className:n,humanize:s})};var Zr=h(34028);const Jr=e=>({logsRowsLive:(0,g.css)`
    label: logs-rows-live;
    font-family: ${e.typography.fontFamilyMonospace};
    font-size: ${e.typography.bodySmall.fontSize};
    display: flex;
    flex-flow: column nowrap;
    height: 60vh;
    overflow-y: scroll;
    :first-child {
      margin-top: auto !important;
    }
  `,logsRowFade:(0,g.css)`
    label: logs-row-fresh;
    color: ${e.colors.text};
    background-color: ${(0,un.A)(e.colors.info.transparent).setAlpha(.25).toString()};
    animation: fade 1s ease-out 1s 1 normal forwards;
    @keyframes fade {
      from {
        background-color: ${(0,un.A)(e.colors.info.transparent).setAlpha(.25).toString()};
      }
      to {
        background-color: transparent;
      }
    }
  `,logsRowsIndicator:(0,g.css)`
    font-size: ${e.typography.h6.fontSize};
    padding-top: ${e.spacing(1)};
    display: flex;
    align-items: center;
  `,button:(0,g.css)`
    margin-right: ${e.spacing(1)};
  `,fullWidth:(0,g.css)`
    width: 100%;
  `});class Xr extends p.PureComponent{constructor(s){super(s),this.liveEndDiv=null,this.scrollContainerRef=p.createRef(),this.onScroll=n=>{const{isPaused:o,onPause:r}=this.props,{scrollTop:i,clientHeight:a,scrollHeight:l}=n.currentTarget;l-(i+a)>=5&&!o&&r()},this.rowsToRender=()=>{const{isPaused:n}=this.props;let{logRowsToRender:o=[]}=this.state;return n||(o=(0,Te.oR)(o,K.uH.Ascending).slice(-100)),o},this.state={logRowsToRender:s.logRows}}static getDerivedStateFromProps(s,n){return s.isPaused&&s.clearedAtIndex?{logRowsToRender:(0,Zr.pg)(s.clearedAtIndex,n.logRowsToRender)}:s.isPaused?null:{logRowsToRender:s.logRows}}render(){const{theme:s,timeZone:n,onPause:o,onResume:r,onClear:i,isPaused:a}=this.props,l=Jr(s),{logsRow:d,logsRowLocalTime:f,logsRowMessage:c}=(0,Ur.D)(s);return(0,t.jsxs)("div",{children:[(0,t.jsx)("table",{className:l.fullWidth,children:(0,t.jsxs)("tbody",{onScroll:a?void 0:this.onScroll,className:l.logsRowsLive,ref:this.scrollContainerRef,children:[this.rowsToRender().map(u=>(0,t.jsxs)("tr",{className:(0,g.cx)(d,l.logsRowFade),children:[(0,t.jsx)("td",{className:f,children:(0,hs.LE)(u.timeEpochMs,{timeZone:n})}),(0,t.jsx)("td",{className:c,children:u.hasAnsi?(0,t.jsx)(qr.$,{value:u.raw}):u.entry})]},u.uid)),(0,t.jsx)("tr",{ref:u=>{this.liveEndDiv=u,this.liveEndDiv&&this.scrollContainerRef.current?.scrollTo&&!a&&this.scrollContainerRef.current?.scrollTo(0,this.scrollContainerRef.current.scrollHeight)}})]})}),(0,t.jsxs)("div",{className:l.logsRowsIndicator,children:[(0,t.jsx)(q.$n,{icon:a?"play":"pause",variant:"secondary",onClick:a?r:o,className:l.button,children:a?"Resume":"Pause"}),(0,t.jsx)(q.$n,{icon:"trash-alt",variant:"secondary",onClick:i,className:l.button,children:"Clear logs"}),(0,t.jsx)(q.$n,{icon:"square-shape",variant:"secondary",onClick:this.props.stopLive,className:l.button,children:"Exit live mode"}),a||this.rowsToRender().length>0&&(0,t.jsxs)("span",{children:["Last line received: ",(0,t.jsx)(Yr,{resetKey:this.props.logRows,humanize:!0})," ago"]})]})]})}}const _r=(0,N.cV)(Xr);var dt=h(41811),ei=h(84596),ut=h(65879),hn=h(69129),gn=h(76885),pt=h(94354),ti=h(39268),Le=h(14186),ze=h(15292),si=h(44895),ie=h(33390),fn=h(81073);const ni=({app:e,children:s,loading:n,loadMoreLogs:o,range:r,rows:i,scrollElement:a,sortOrder:l,timeZone:d,topScrollEnabled:f=!1})=>{const[c,u]=(0,p.useState)(!1),[x,m]=(0,p.useState)(!1),[C,y]=(0,p.useState)(!1),[b,S]=(0,p.useState)(!1),L=(0,p.useRef)(i),w=(0,p.useRef)(a?.scrollTop||0);(0,p.useEffect)(()=>{u(!1),m(!1)},[r,i,l]),(0,p.useEffect)(()=>{n||(y(!1),S(!1))},[n]),(0,p.useEffect)(()=>{b&&a&&a.scrollTo(0,a.scrollHeight-a.clientHeight)},[b,a]),(0,p.useEffect)(()=>{i!==L.current&&i.length===L.current.length&&(C||b)&&(l===K.uH.Descending&&b?m(!0):l===K.uH.Ascending&&C&&u(!0)),L.current=i},[b,i,l,C]),(0,p.useEffect)(()=>{if(!a||!o)return;function O(H){if(!a||!o||!i.length||n||!Q.$.featureToggles.logsInfiniteScrolling)return;H.stopImmediatePropagation();const A=ri(H,a,w.current);w.current=a.scrollTop,A!==0&&(A===-1&&f?z():A===1&&k())}function z(){const H=vn(fs(i),r,d,l);if(!H){u(!0);return}u(!1),o?.(H),y(!0),(0,P.rR)("grafana_logs_infinite_scrolling",{direction:"top",sort_order:l})}function k(){const H=ii(fs(i),r,d,l);if(!H){m(!0);return}m(!1),o?.(H),S(!0),(0,P.rR)("grafana_logs_infinite_scrolling",{direction:"bottom",sort_order:l})}return a.addEventListener("scroll",O),a.addEventListener("wheel",O),()=>{a.removeEventListener("scroll",O),a.removeEventListener("wheel",O)}},[o,n,r,i,a,l,d,f]);const v=l===K.uH.Descending&&(0,ut.isRelativeTime)(r.raw.to),T=l===K.uH.Ascending&&(0,ut.isRelativeTime)(r.raw.to),R=(0,p.useCallback)(()=>{(0,P.rR)("grafana_explore_logs_infinite_pagination_clicked",{pageType:"olderLogsButton"});const O=vn(fs(i),r,d,l);if(!O){u(!0);return}u(!1),o?.(O),y(!0),a?.scroll({behavior:"auto",top:0})},[o,r,i,a,l,d]);return(0,t.jsxs)(t.Fragment,{children:[C&&(0,t.jsx)(fn.I,{adjective:l===K.uH.Descending?"newer":"older"}),!v&&c&&mn,l===K.uH.Ascending&&e===me.Jk.Explore&&(0,t.jsx)(q.$n,{className:gs.navButton,variant:"secondary",onClick:R,disabled:n,children:(0,t.jsxs)("div",{className:gs.navButtonContent,children:[(0,t.jsx)(he.I,{name:"angle-up",size:"lg"}),(0,t.jsx)(j.x6,{i18nKey:"logs.infinite-scroll.older-logs",children:"Older logs"})]})}),s,!T&&x&&mn,b&&(0,t.jsx)(fn.I,{adjective:l===K.uH.Descending?"older":"newer"})]})},gs={messageContainer:(0,g.css)({textAlign:"center",padding:.25}),navButton:(0,g.css)({width:"58px",height:"68px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",lineHeight:"1",position:"absolute",top:0,right:-3,zIndex:1}),navButtonContent:(0,g.css)({display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",whiteSpace:"normal"})},mn=(0,t.jsx)("div",{className:gs.messageContainer,"data-testid":"end-of-range",children:"End of the selected time range."});var oi=(e=>(e[e.Top=-1]="Top",e[e.Bottom=1]="Bottom",e[e.NoScroll=0]="NoScroll",e))(oi||{});function ri(e,s,n){if(s.scrollHeight<=s.clientHeight)return 0;const o=e instanceof WheelEvent?e.deltaY:s.scrollTop-n;if(o===0)return 0;const r=o<0?-1:1;return(r===-1?s.scrollTop:s.scrollHeight-s.scrollTop-s.clientHeight)<=1?r:0}function fs(e){const s=e[0].timeEpochMs,n=e[e.length-1].timeEpochMs;return n<s?{from:n,to:s}:{from:s,to:n}}function yn(e,s){return{from:s.from.valueOf(),to:e.from}}function xn(e,s,n){return s=ms(s,n),{from:e.to,to:s.to.valueOf()}}const Wt=1e3;function vn(e,s,n,o){return o===K.uH.Descending?(s=ms(s,n),s.to.valueOf()-e.to>Wt?xn(e,s,n):void 0):Math.abs(s.from.valueOf()-e.from)>Wt?yn(e,s):void 0}function ii(e,s,n,o){return o===K.uH.Descending?Math.abs(s.from.valueOf()-e.from)>Wt?yn(e,s):void 0:(s=ms(s,n),s.to.valueOf()-e.to>Wt?xn(e,s,n):void 0)}function ms(e,s){return(0,ut.isRelativeTimeRange)(e.raw)?(0,ut.convertRawToRange)(e.raw,s):e}var bn=h(14647),ai=h(81166),tt=h(69147),st=h(99140);function li(){(0,P.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-added"})}function ci(){(0,P.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-deleted"})}function di(){(0,P.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-limit-reached"})}function ui(){(0,P.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-clicked"})}function pi(){(0,P.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:"Logs:pinned:pinned-log-deleted"})}function hi(e){(0,P.rR)("explore_toolbar_contentoutline_clicked",{item:"section",type:`Logs:filter:${e.levelStr}`})}var Sn=h(39590);function gi({feedbackUrl:e}){const s=(0,N.of)(fi);return(0,t.jsx)(Xe.B,{children:(0,t.jsxs)("a",{href:e,className:s.link,title:"The logs table is new, please let us know how we can improve it",target:"_blank",rel:"noreferrer noopener",children:[(0,t.jsx)(he.I,{name:"comment-alt-message"})," Give feedback"]})})}function fi(e){return{link:(0,g.css)({color:e.colors.text.secondary,fontSize:e.typography.bodySmall.fontSize,":hover":{color:e.colors.text.link}})}}var mi=h(4213),yi=h.n(mi),Cn=h(75505),jn=h(2514),Rn=h(18358),wn=h(93463),xi=h(40455);const Tn=e=>({metaContainer:(0,g.css)({flex:1,color:e.colors.text.secondary,marginBottom:e.spacing(2),minWidth:"30%",display:"flex",flexWrap:"wrap"}),metaItem:(0,g.css)({marginRight:e.spacing(2),marginTop:e.spacing(.5),display:"flex",alignItems:"center",".logs-meta-item__error":{color:e.colors.error.text}}),metaLabel:(0,g.css)({marginRight:`calc(${e.spacing(2)} / 2)`,fontSize:e.typography.bodySmall.fontSize,fontWeight:e.typography.fontWeightMedium}),metaValue:(0,g.css)({fontFamily:e.typography.fontFamilyMonospace,fontSize:e.typography.bodySmall.fontSize})}),vi=(0,p.memo)(function(s){const n=(0,N.of)(Tn),{label:o,value:r}=s;return(0,t.jsxs)("div",{"data-testid":"meta-info-text-item",className:n.metaItem,children:[o&&(0,t.jsxs)("span",{className:n.metaLabel,children:[o,":"]}),(0,t.jsx)("span",{className:n.metaValue,children:r})]})}),ys=(0,p.memo)(function(s){const n=(0,N.of)(Tn),{metaItems:o}=s;return(0,t.jsx)("div",{className:n.metaContainer,"data-testid":"meta-info-text",children:o.map((r,i)=>(0,t.jsx)(vi,{label:r.label,value:r.value},`${i}-${r.label}`))})});var Ln=h(14236),Vt=h(90708),ht=h(11261),In=h(41260),xs=h(77093);function bi(e){const{timeZone:s,splitOpen:n,range:o,logsSortOrder:r,width:i,dataFrame:a,columnsWithMeta:l,logsFrame:d}=e,[f,c]=(0,p.useState)(void 0),u=d?.timeField.index,x=(0,p.useCallback)(C=>{if(!C.length)return C;const y=(0,Ln.ES)(C,u,r===K.uH.Descending),[b]=(0,Vt.we)({data:[y],timeZone:s,theme:Q.$.theme2,replaceVariables:S=>S,fieldConfig:{defaults:{custom:{}},overrides:[]}});for(const S of b.fields)S.getLinks=L=>(0,Ge.QL)({field:S,rowIndex:L.valueRowIndex,splitOpenFn:n,range:o,dataFrame:y}),S.config={...S.config,custom:{inspect:!0,filterable:!0,width:Ri(S),...S.config.custom},filterable:Si(S,d?.bodyField.name??"",d?.timeField.name??"")},S.type=S.type===ht.PU.string?(0,Ln.dF)(S)??ht.PU.string:S.type;return b},[r,s,n,o,d?.bodyField.name,d?.timeField.name,u]);if((0,p.useEffect)(()=>{(async()=>{if(!d?.timeField.name||!d?.bodyField.name){c(void 0);return}const y=En(a);let b=Ci(l);const S=ji(b);if(S?y.push(S):y.push({id:"organize",options:{indexByName:{[d.bodyField.name]:0,[d.timeField.name]:1},includeByName:{[d.bodyField.name]:!0,[d.timeField.name]:!0}}}),y.length>0){const L=await(0,Cn.s)((0,jn.m)(y,[a])),w=x(L[0]);c(w)}else c(x(a))})()},[l,a,r,x,d?.bodyField.name,d?.timeField.name]),!f)return null;const m=C=>{const{value:y,key:b,operator:S}=C,{onClickFilterLabel:L,onClickFilterOutLabel:w}=e;!L||!w||(S===Ft.mc&&L(b,y,a),S===Ft.Zi&&w(b,y,a))};return(0,t.jsx)(xs.X,{data:f,width:i,onCellFilterAdded:e.onClickFilterLabel&&e.onClickFilterOutLabel?m:void 0,height:e.height,footerOptions:{show:!0,reducer:["count"],countRows:!0},initialSortBy:[{displayName:d?.timeField.name||"",desc:r===K.uH.Descending}]})}const Si=(e,s,n)=>!(!s||!n||s===e.name||n===e.name||e.config.links?.length);function En(e){return e.fields.filter(s=>{const n=s.typeInfo?.frame==="json.RawMessage"&&s.name==="labels"&&e?.meta?.type!==In.m.LogLines,o=s.name==="labels"&&s.type===ht.PU.other&&e?.meta?.type===In.m.LogLines;return n||o}).flatMap(s=>[{id:"extractFields",options:{format:"json",keepTime:!1,replace:!1,source:s.name}}])}function Ci(e){let s={};return Object.keys(e).filter(n=>e[n].active).forEach(n=>{const o=e[n].index;o!==void 0&&(s[n]=o)}),s}function ji(e){let s={};for(const n in e)s[n]=!0;return Object.keys(e).length>0?{id:"organize",options:{indexByName:e,includeByName:s}}:null}function Ri(e){if(e.type===ht.PU.time)return 200}const wi=()=>({metaContainer:(0,g.css)`
    flex: 1;
    display: flex;
    flex-wrap: wrap;
  `});var Ti=(e=>(e.Text="text",e.Json="json",e.CSV="csv",e))(Ti||{});const On=(0,p.memo)(({meta:e,dedupStrategy:s,dedupCount:n,displayedFields:o,clearDetectedFields:r,hasUnescapedContent:i,forceEscape:a,onEscapeNewlines:l,logRows:d})=>{const f=(0,N.of)(wi),c=async m=>{switch((0,P.rR)("grafana_logs_download_logs_clicked",{app:me.Jk.Explore,format:m,area:"logs-meta-row"}),m){case"text":(0,Rn.Zy)({meta:e,rows:d},"Explore");break;case"json":const C=(0,Te.Dg)(d),y=new Blob([JSON.stringify(C)],{type:"application/json;charset=utf-8"}),b=`Explore-logs-${(0,hs.LE)(new Date)}.json`;yi()(y,b);break;case"csv":const S=new Map;d.forEach(L=>{L.dataFrame?.refId&&!S.has(L.dataFrame?.refId)&&S.set(L.dataFrame?.refId,L.dataFrame)}),S.forEach(async L=>{const w=En(L);w.push({id:"organize",options:{excludeByName:{labels:!0,labelTypes:!0}}});const v=await(0,Cn.s)((0,jn.m)(w,[L]));(0,Rn.EM)(v[0],`Explore-logs-${L.refId}`)})}},u=[...e];s!==K.fY.none&&u.push({label:"Deduplication count",value:n,kind:_.tG.Number}),d.some(m=>m.entry.length>xi.S)&&u.push({label:"Info",value:"Logs with more than 100,000 characters could not be parsed and highlighted",kind:_.tG.String}),o?.length>0&&u.push({label:"Showing only selected fields",value:(0,t.jsx)(wn.A,{labels:o})},{label:"",value:(0,t.jsx)(q.$n,{variant:"secondary",size:"sm",onClick:r,children:"Show original line"})}),i&&u.push({label:"Your logs might have incorrectly escaped content",value:(0,t.jsx)(Se.m,{content:"Fix incorrectly escaped newline and tab sequences in log lines. Manually review the results to confirm that the replacements are correct.",placement:"right",children:(0,t.jsx)(q.$n,{variant:"secondary",size:"sm",onClick:l,children:a?"Remove escaping":"Escape newlines"})})});const x=(0,t.jsxs)(Re.W,{children:[(0,t.jsx)(Re.W.Item,{label:"txt",onClick:()=>c("text")}),(0,t.jsx)(Re.W.Item,{label:"json",onClick:()=>c("json")}),(0,t.jsx)(Re.W.Item,{label:"csv",onClick:()=>c("csv")})]});return(0,t.jsx)(t.Fragment,{children:u&&(0,t.jsxs)("div",{className:f.metaContainer,children:[(0,t.jsx)(ys,{metaItems:u.map(m=>({label:m.label,value:"kind"in m?Li(m.value,m.kind):m.value}))}),(0,t.jsx)(ct.m,{overlay:x,children:(0,t.jsx)(re.I,{isOpen:!1,variant:"canvas",icon:"download-alt",children:"Download"})})]})})});On.displayName="LogsMetaRow";function Li(e,s){return typeof e=="string"||typeof e=="number"?(0,t.jsx)(t.Fragment,{children:e}):s===_.tG.LabelsMap?(0,t.jsx)(wn.h,{labels:e}):s===_.tG.Error?(0,t.jsx)("span",{className:"logs-meta-item__error",children:e.toString()}):(console.error(`Meta type ${typeof e} ${e} not recognized.`),(0,t.jsx)(t.Fragment,{}))}var gt=h(62930),Ii=h(57571),Ei=h(42994);function Oi({pages:e,currentPageIndex:s,oldestLogsFirst:n,timeZone:o,loading:r,onClick:i}){const a=c=>`${(0,hs.LE)(c,{format:Ei.WC.interval.second,timeZone:o})}`,l=(c,u)=>{if(s===u&&r)return(0,t.jsx)(gt.y,{});const x=a(n?c.logsRange.from:c.logsRange.to),m=a(n?c.logsRange.to:c.logsRange.from);return`${x} \u2014 ${m}`},d=(0,N.$j)(),f=Fi(d,r);return(0,t.jsx)(Et.E,{autoHide:!0,children:(0,t.jsx)("div",{className:f.pagesWrapper,"data-testid":"logsNavigationPages",children:(0,t.jsx)("div",{className:f.pagesContainer,children:e.map((c,u)=>(0,t.jsxs)("button",{type:"button","data-testid":`page${u+1}`,className:(0,g.cx)((0,q.my)(d),f.page),onClick:()=>{i(c,u+1)},disabled:r,children:[(0,t.jsx)("div",{className:(0,g.cx)(f.line,{selectedBg:s===u})}),(0,t.jsx)("div",{className:(0,g.cx)(f.time,{selectedText:s===u}),children:l(c,u)})]},c.queryRange.to))})})})}const Fi=(e,s)=>({pagesWrapper:(0,g.css)`
      height: 100%;
      padding-left: ${e.spacing(.5)};
      display: flex;
      flex-direction: column;
      overflow-y: scroll;
      &::after {
        content: '';
        display: block;
        background: repeating-linear-gradient(
          135deg,
          ${e.colors.background.primary},
          ${e.colors.background.primary} 5px,
          ${e.colors.background.secondary} 5px,
          ${e.colors.background.secondary} 15px
        );
        width: 3px;
        height: inherit;
        margin-bottom: 8px;
      }
    `,pagesContainer:(0,g.css)`
      display: flex;
      padding: 0;
      flex-direction: column;
    `,page:(0,g.css)`
      display: flex;
      margin: ${e.spacing(2)} 0;
      cursor: ${s?"auto":"pointer"};
      white-space: normal;
      .selectedBg {
        background: ${e.colors.primary.main};
      }
      .selectedText {
        color: ${e.colors.primary.main};
      }
    `,line:(0,g.css)`
      width: 3px;
      height: 100%;
      align-items: center;
      background: ${e.colors.text.secondary};
    `,time:(0,g.css)`
      width: 60px;
      min-height: 80px;
      font-size: ${e.v1.typography.size.sm};
      padding-left: ${e.spacing(.5)};
      display: flex;
      align-items: center;
    `});function Di({absoluteRange:e,logsSortOrder:s,timeZone:n,loading:o,onChangeTime:r,scrollToTopLogs:i,visibleRange:a,queries:l,clearCache:d,addResultsToCache:f}){const[c,u]=(0,p.useState)([]),x=(0,p.useRef)(),m=(0,p.useRef)(),C=(0,p.useRef)(0),y=(0,p.useMemo)(()=>c.findIndex(A=>A.queryRange.to===e.to),[e.to,c]),b=s===K.uH.Ascending,S=b?y===c.length-1:y===0,L=b?y===0:y===c.length-1,w=(0,N.$j)(),v=Ni(w,b);(0,p.useEffect)(()=>{const A={logsRange:a,queryRange:e};let W=[];!(0,oe.isEqual)(m.current,e)||!(0,oe.isEqual)(x.current,l)?(d(),u([A]),x.current=l,C.current=e.to-e.from):u(te=>(W=te.filter(se=>!(0,oe.isEqual)(A.queryRange,se.queryRange)),W=[...W,A].sort((se,de)=>R(se,de,s)),W))},[a,e,s,l,d,f]);const T=(0,p.useCallback)(({from:A,to:W})=>{f(),m.current={from:A,to:W},r({from:A,to:W})},[r,f]),R=(A,W,te)=>te===K.uH.Ascending?A.queryRange.to>W.queryRange.to?1:-1:A.queryRange.to>W.queryRange.to?-1:1,O=(0,t.jsx)(q.$n,{"data-testid":"olderLogsButton",className:v.navButton,variant:"secondary",onClick:()=>{if((0,P.rR)("grafana_explore_logs_pagination_clicked",{pageType:"olderLogsButton"}),L)T({from:a.from-C.current,to:a.from});else{const A=b?-1:1;T({from:c[y+A].queryRange.from,to:c[y+A].queryRange.to})}i()},disabled:o,children:(0,t.jsxs)("div",{className:v.navButtonContent,children:[o?(0,t.jsx)(gt.y,{}):(0,t.jsx)(he.I,{name:b?"angle-up":"angle-down",size:"lg"}),"Older logs"]})}),z=(0,t.jsx)(q.$n,{"data-testid":"newerLogsButton",className:v.navButton,variant:"secondary",onClick:()=>{if((0,P.rR)("grafana_explore_logs_pagination_clicked",{pageType:"newerLogsButton"}),!S){const A=b?1:-1;T({from:c[y+A].queryRange.from,to:c[y+A].queryRange.to})}i()},disabled:o||S,children:(0,t.jsxs)("div",{className:v.navButtonContent,children:[o&&(0,t.jsx)(gt.y,{}),S||o?null:(0,t.jsx)(he.I,{name:b?"angle-down":"angle-up",size:"lg"}),S?"Start of range":"Newer logs"]})}),k=(0,p.useCallback)((A,W)=>{(0,P.rR)("grafana_explore_logs_pagination_clicked",{pageType:"page",pageNumber:W}),T({from:A.queryRange.from,to:A.queryRange.to}),i()},[T,i]),H=(0,p.useCallback)(()=>{(0,P.rR)("grafana_explore_logs_scroll_top_clicked"),i()},[i]);return(0,t.jsxs)("div",{className:v.navContainer,children:[!Q.$.featureToggles.logsInfiniteScrolling&&(0,t.jsxs)(t.Fragment,{children:[b?O:z,(0,t.jsx)(Oi,{pages:c,currentPageIndex:y,oldestLogsFirst:b,timeZone:n,loading:o,onClick:k}),b?z:O]}),(0,t.jsx)(q.$n,{"data-testid":"scrollToTop",className:v.scrollToTopButton,variant:"secondary",onClick:H,title:"Scroll to top",children:(0,t.jsx)(he.I,{name:"arrow-up",size:"lg"})})]})}const Ai=(0,p.memo)(Di),Ni=(e,s)=>{const n=`calc(100vh - 2*${e.spacing(2)} - 2*${Ii.l}px)`;return{navContainer:(0,g.css)`
      max-height: ${n};
      ${s?"width: 58px;":""}
      display: flex;
      flex-direction: column;
      ${Q.$.featureToggles.logsInfiniteScrolling?"justify-content: flex-end;":`justify-content: ${s?"flex-start":"space-between"};`}
      position: sticky;
      top: ${e.spacing(2)};
      right: 0;
    `,navButton:(0,g.css)`
      width: 58px;
      height: 68px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      line-height: 1;
    `,navButtonContent:(0,g.css)`
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      width: 100%;
      height: 100%;
      white-space: normal;
    `,scrollToTopButton:(0,g.css)`
      width: 40px;
      height: 40px;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      margin-top: ${e.spacing(1)};
    `}};var Fn=h(98101);function Pi(e){return{searchWrap:(0,g.css)({padding:`${e.spacing(.4)} 0 ${e.spacing(.4)} ${e.spacing(.4)}`})}}function ki(e){const s=(0,N.$j)(),n=Pi(s);return(0,t.jsx)(pe.D,{className:n.searchWrap,children:(0,t.jsx)(Ve.p,{value:e.value,type:"text",placeholder:"Search fields by name",onChange:e.onChange})})}var vs=h(91076);function Mi(e){return{empty:(0,g.css)({marginBottom:e.spacing(2),marginLeft:e.spacing(1.75),fontSize:e.typography.fontSize})}}function Dn(){const e=(0,N.$j)(),s=Mi(e);return(0,t.jsx)("div",{className:s.empty,children:"No fields"})}var zi=h(10880);function Hi(e){return{dragIcon:(0,g.css)({cursor:"drag",marginLeft:e.spacing(1),opacity:.4}),labelCount:(0,g.css)({marginLeft:e.spacing(.5),marginRight:e.spacing(.5),appearance:"none",background:"none",border:"none",fontSize:e.typography.pxToRem(11),opacity:.6}),contentWrap:(0,g.css)({display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"}),checkboxLabel:(0,g.css)({"> span":{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block",maxWidth:"100%"}})}}function An(e){const s=(0,N.$j)(),n=Hi(s);if(e.labels[e.label])return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:n.contentWrap,children:[(0,t.jsx)(zi.S,{className:n.checkboxLabel,label:e.label,onChange:e.onChange,checked:e.labels[e.label]?.active??!1}),e.showCount&&(0,t.jsxs)("button",{className:n.labelCount,onClick:e.onChange,children:[e.labels[e.label]?.percentOfLinesWithLabel,"%"]})]}),e.draggable&&(0,t.jsx)(he.I,{"aria-label":"Drag and drop icon",title:"Drag and drop to reorder",name:"draggabledots",size:"lg",className:n.dragIcon})]})}function Nn(e){return{wrap:(0,g.css)({marginTop:e.spacing(1),marginBottom:e.spacing(1),display:"flex",background:e.colors.background.primary}),dragging:(0,g.css)({background:e.colors.background.secondary}),columnWrapper:(0,g.css)({marginBottom:e.spacing(1.5),paddingLeft:e.spacing(.5)})}}function $i(e){return(s,n)=>{const o=e[s],r=e[n];return o.index!=null&&r.index!=null?o.index-r.index:0}}const Bi=e=>{const{reorderColumn:s,labels:n,valueFilter:o,toggleColumn:r}=e,i=(0,N.$j)(),a=Nn(i),l=Object.keys(n).filter(c=>o(c)),d=c=>{c.destination&&s(c.source.index,c.destination.index)},f=c=>{const u=n[c];if(u)return`${c} appears in ${u?.percentOfLinesWithLabel}% of log lines`};return l.length?(0,t.jsx)(vs.JY,{onDragEnd:d,children:(0,t.jsx)(vs.gL,{droppableId:"order-fields",direction:"vertical",children:c=>(0,t.jsxs)("div",{className:a.columnWrapper,...c.droppableProps,ref:c.innerRef,children:[l.sort($i(n)).map((u,x)=>(0,t.jsx)(vs.sx,{draggableId:u,index:x,children:(m,C)=>(0,t.jsx)("div",{className:(0,g.cx)(a.wrap,C.isDragging?a.dragging:void 0),ref:m.innerRef,...m.draggableProps,...m.dragHandleProps,title:f(u),children:(0,t.jsx)(An,{label:u,onChange:()=>r(u),labels:n,draggable:!0})})},u)),c.placeholder]})})}):(0,t.jsx)(Dn,{})},Qi=new Intl.Collator(void 0,{sensitivity:"base"});function Wi(e){return(s,n)=>{const o=e[s],r=e[n];return o!=null&&r!=null?+(r.type==="TIME_FIELD")-+(o.type==="TIME_FIELD")||+(r.type==="BODY_FIELD")-+(o.type==="BODY_FIELD")||Qi.compare(s,n):0}}const Vi=e=>{const{labels:s,valueFilter:n,toggleColumn:o}=e,r=(0,N.$j)(),i=Nn(r),a=Object.keys(s).filter(l=>n(l));return a.length?(0,t.jsx)("div",{className:i.columnWrapper,children:a.sort(Wi(s)).map((l,d)=>(0,t.jsx)("div",{className:i.wrap,title:`${l} appears in ${s[l]?.percentOfLinesWithLabel}% of log lines`,children:(0,t.jsx)(An,{showCount:!0,label:l,onChange:()=>o(l),labels:s})},l))}):(0,t.jsx)(Dn,{})};function qi(e){return{sidebarWrap:(0,g.css)({overflowY:"scroll",height:"calc(100% - 50px)","&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"}),columnHeaderButton:(0,g.css)({appearance:"none",background:"none",border:"none",fontSize:e.typography.pxToRem(11)}),columnHeader:(0,g.css)({display:"flex",justifyContent:"space-between",fontSize:e.typography.h6.fontSize,background:e.colors.background.secondary,position:"sticky",top:0,left:0,paddingTop:e.spacing(.75),paddingRight:e.spacing(.75),paddingBottom:e.spacing(.75),paddingLeft:e.spacing(1.5),zIndex:3,marginBottom:e.spacing(2)})}}const Ui=e=>{const s=(0,N.$j)(),n=qi(s);return(0,t.jsx)("div",{className:n.sidebarWrap,children:(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:n.columnHeader,children:["Selected fields",(0,t.jsx)("button",{onClick:e.clear,className:n.columnHeaderButton,children:"Reset"})]}),(0,t.jsx)(Bi,{reorderColumn:e.reorderColumn,toggleColumn:e.toggleColumn,labels:e.filteredColumnsWithMeta??e.columnsWithMeta,valueFilter:o=>e.columnsWithMeta[o]?.active??!1,id:"selected-fields"}),(0,t.jsx)("div",{className:n.columnHeader,children:"Fields"}),(0,t.jsx)(Vi,{toggleColumn:e.toggleColumn,labels:e.filteredColumnsWithMeta??e.columnsWithMeta,valueFilter:o=>!e.columnsWithMeta[o]?.active})]})})};var Pn=h(53076);const Gi=new Pn.A({intraMode:1,intraIns:1,intraSub:1,intraTrn:1,intraDel:1});function kn(e,s,n){const[o,r,i]=Gi.search(e,s,0,1e5);let a=[],l=new Set;if(o&&i){const d=(f,c)=>{c&&l.add(f)};for(let f=0;f<i.length;f++){let c=i[f];Pn.A.highlight(e[r.idx[c]],r.ranges[c],d),a.push(e[r.idx[c]])}n([a,[...l]])}else s||n([[],[]])}const cd=(0,oe.debounce)(kn,300);function Ki(e){const{logsFrames:s,updatePanelState:n,panelState:o}=e,r=o?.columns,[i,a]=(0,p.useState)(void 0),[l,d]=(0,p.useState)(void 0),[f,c]=(0,p.useState)(""),u=Mn(),x=e?.panelState?.refId,[m,C]=(0,p.useState)(s.find(E=>E.refId===x)??s[0]),y=(0,p.useCallback)(E=>{const M=e.panelState?.columns;return M&&Object.values(M).forEach(($,F)=>{E[$]&&(E[$].active=!0,E[$].index=F)}),E},[e.panelState?.columns]),b=(0,Fn.O)(m);(0,p.useEffect)(()=>{if(b?.timeField.name&&b?.bodyField.name&&!r){const E={0:b?.timeField.name??"",1:b?.bodyField.name??""};n({columns:Object.values(E),visualisationType:"table",labelFieldName:b?.getLabelFieldName()??void 0})}},[b,r,n]),(0,p.useEffect)(()=>{const E=s.find(M=>M.refId===x)??s[0];E&&C(E)},[s,x]),(0,p.useEffect)(()=>{if(!i||!l)return;let E={...l},M=!1;Object.keys(i).forEach($=>{E[$]&&E[$].active!==i[$].active&&(E[$]=i[$],M=!0)}),M&&d(E)},[i,l]),(0,p.useEffect)(()=>{if(!m.length)return;const E=m?m.length:0,M=(0,Fn.O)(m),$=M?.getLogFrameLabelsAsLabels(),F=[];M&&F.push(...M.extraFields.filter(ee=>!ee?.config?.custom?.hidden)),M?.severityField&&F.push(M?.severityField),M?.bodyField&&F.push(M?.bodyField),M?.timeField&&F.push(M?.timeField);const U=new Map;let V={};$?.length&&E&&($.forEach(ee=>{Object.keys(ee).forEach(ce=>{if(U.has(ce)){const ge=U.get(ce);ge&&(ge?.active?U.set(ce,{percentOfLinesWithLabel:ge.percentOfLinesWithLabel+1,active:!0,index:ge.index}):U.set(ce,{percentOfLinesWithLabel:ge.percentOfLinesWithLabel+1,active:!1,index:void 0}))}else U.set(ce,{percentOfLinesWithLabel:1,active:!1,index:void 0})})}),V=Object.fromEntries(U),Object.keys(V).forEach(ee=>{V[ee].percentOfLinesWithLabel=bs(V[ee].percentOfLinesWithLabel,E)})),F.forEach(ee=>{const Ke=V[ee.name]?.active,ce=V[ee.name]?.index;Ke&&ce!==void 0?V[ee.name]={percentOfLinesWithLabel:bs(ee.values.filter(ge=>ge!=null).length,E),active:!0,index:ce}:V[ee.name]={percentOfLinesWithLabel:bs(ee.values.filter(ge=>ge!=null).length,E),active:!1,index:void 0}}),V=y(V),Object.keys(V).filter(ee=>V[ee].active).length===0&&(M?.bodyField?.name&&(V[M.bodyField.name].active=!0),M?.timeField?.name&&(V[M.timeField.name].active=!0)),M?.bodyField?.name&&M?.timeField?.name&&(V[M.bodyField.name].type="BODY_FIELD",V[M.timeField.name].type="TIME_FIELD"),a(V)},[m,y]);const[S,L]=(0,p.useState)(220),w=e.width-S;if(!i)return null;function v(E){if(i){const M=!i[E]?.active,$=Object.keys(i).filter(U=>i[U]?.active)?.length,F={columnAction:M?"add":"remove",columnCount:M?$+1:$-1,datasourceType:e.datasourceType};(0,P.rR)("grafana_explore_logs_table_column_filter_clicked",F)}}function T(E){(0,P.rR)("grafana_explore_logs_table_text_search_result_count",{resultCount:E,datasourceType:e.datasourceType??"unknown"})}const R=()=>{const E={...i};let M=0;Object.keys(E).forEach($=>{const F=!!E[$].type;E[$].active=F,E[$].index=F?M++:void 0}),a(E)},O=(E,M)=>{if(E===M)return;const $={...i},F=Object.keys($).filter(V=>$[V].active).map(V=>({fieldName:V,index:$[V].index??0})).sort((V,$e)=>V.index-$e.index),[U]=F.splice(E,1);F.splice(M,0,U),F.forEach((V,$e)=>{$[V.fieldName].index=$e}),a($),z($)};function z(E){const M=Object.keys(E).filter(V=>E[V]?.active).sort((V,$e)=>{const ee=E[V],Ke=E[$e];return ee.index!==void 0&&Ke.index!==void 0?ee.index-Ke.index:0}),$=Object.assign({},M),F={0:b?.timeField.name??"",1:b?.bodyField.name??""},U={...e.panelState,columns:Object.keys($).length?$:F,refId:m.refId,visualisationType:"table",labelFieldName:b?.getLabelFieldName()??void 0};n(U)}const k=E=>{if(!i||!(E in i)){console.warn("failed to get column",i);return}const M=Object.keys(i).filter(U=>i[U].active).length,$=i[E].active?void 0:!0;let F;if($?F={...i,[E]:{...i[E],active:$,index:M}}:F={...i,[E]:{...i[E],active:!1,index:void 0}},v(E),a(F),l){const U=!l[E]?.active;let V;U?V={...l,[E]:{...l[E],active:U,index:M}}:V={...l,[E]:{...l[E],active:!1,index:void 0}},d(V)}z(F)},H=E=>{const M=E[0];let $={},F=0;M.forEach(U=>{U in i&&($[U]=i[U],F++)}),d($),T(F)},A=E=>{kn(Object.keys(i),E,H)},W=E=>{const M=E.currentTarget?.value;c(M),M?A(M):d(void 0)},te=E=>{s.find($=>$.refId===E.value)&&C(s.find($=>$.refId===E.value)??s[0]),e.updatePanelState({refId:E.value,labelFieldName:b?.getLabelFieldName()??void 0})},se=Yi(e.theme,u,S),de=(E,M,$)=>{const F=Number($.style.width.slice(0,-2));isNaN(F)||L(F)};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("div",{children:s.length>1&&(0,t.jsx)("div",{children:(0,t.jsx)(Le.I,{label:"Select query",htmlFor:"explore_logs_table_frame_selector",labelWidth:22,tooltip:"Select a query to visualize in the table.",children:(0,t.jsx)(ke.l6,{inputId:"explore_logs_table_frame_selector","aria-label":"Select query by name",value:m.refId,options:s.map(E=>({label:E.refId,value:E.refId})),onChange:te})})})}),(0,t.jsxs)("div",{className:se.wrapper,children:[(0,t.jsx)(Gs,{enable:{right:!0},handleClasses:{right:se.rzHandle},onResize:de,children:(0,t.jsxs)("section",{className:se.sidebar,children:[(0,t.jsx)(ki,{value:f,onChange:W}),(0,t.jsx)(Ui,{reorderColumn:O,toggleColumn:k,filteredColumnsWithMeta:l,columnsWithMeta:i,clear:R})]})}),(0,t.jsx)(bi,{logsFrame:b,onClickFilterLabel:e.onClickFilterLabel,onClickFilterOutLabel:e.onClickFilterOutLabel,logsSortOrder:e.logsSortOrder,range:e.range,splitOpen:e.splitOpen,timeZone:e.timeZone,width:w,dataFrame:m,columnsWithMeta:i,height:u})]})]})}const bs=(e,s)=>Math.ceil(100*e/s);function Yi(e,s,n){return{wrapper:(0,g.css)({display:"flex"}),sidebar:(0,g.css)({height:s,fontSize:e.typography.pxToRem(11),overflowY:"hidden",width:n,paddingRight:e.spacing(3)}),rzHandle:(0,g.css)({background:e.colors.secondary.main,[e.transitions.handleMotion("no-preference","reduce")]:{transition:"0.3s background ease-in-out"},position:"relative",height:"50% !important",width:`${e.spacing(1)} !important`,top:"25% !important",right:`${e.spacing(1)} !important`,cursor:"grab",borderRadius:e.shape.radius.pill,"&:hover":{background:e.colors.secondary.shade}})}}const Mn=()=>Math.max(window.innerHeight-500,500);function Ss(e){const[s,n]=(0,p.useState)(!1),o=100,{error:r,title:i,suggestedAction:a,onSuggestedAction:l,onRemove:d,severity:f="warning"}=e,c=r?.message||r?.data?.message||"",u=!s&&c.length>o,x=(0,N.$j)(),m=Zi(x);return(0,t.jsx)("div",{className:m.supplementaryErrorContainer,children:(0,t.jsx)(lt.F,{title:i,severity:f,onRemove:d,children:(0,t.jsxs)("div",{className:m.suggestedActionWrapper,children:[u?(0,t.jsx)(q.$n,{variant:"secondary",size:"xs",onClick:()=>{n(!0)},children:"Show details"}):c,a&&l&&(0,t.jsx)("div",{className:m.suggestedActionWrapper,children:(0,t.jsx)(q.$n,{variant:"primary",size:"xs",onClick:l,children:a})})]})})})}const Zi=e=>({supplementaryErrorContainer:(0,g.css)({width:"50%",minWidth:`${e.breakpoints.values.sm}px`,margin:"0 auto"}),suggestedActionWrapper:(0,g.css)({height:e.spacing(6),button:{position:"absolute",right:e.spacing(2),top:e.spacing(7)}})});var Ji=h(9791);function Xi(e){const{width:s,timeZone:n,splitOpen:o,onUpdateTimeRange:r,onHiddenSeriesChanged:i,allLogsVolumeMaximum:a,toggleLegendRef:l}=e,d=(0,N.$j)(),f=(0,N.of)(_i),c=parseInt(d.spacing(2).slice(0,-2),10),u=150,x=e.logsVolumeData,m=(0,Te.Dm)(x?.data);let C=m?`${m.name}`:"";(0,Te.e3)(x.data)&&(C=[C,"This datasource does not support full-range histograms. The graph below is based on the logs seen in the response."].filter(oe.identity).join(". "));let y=(0,t.jsx)("span",{children:C});return x.state===ye.Gu.Streaming&&(y=(0,t.jsxs)(t.Fragment,{children:[y,(0,t.jsx)(Se.m,{content:"Streaming",children:(0,t.jsx)(he.I,{name:"circle-mono",size:"md",className:f.streaming,"data-testid":"logs-volume-streaming"})})]})),(0,t.jsxs)("div",{style:{height:u},className:f.contentContainer,children:[(0,t.jsx)(Ji.k,{toggleLegendRef:l,vizLegendOverrides:{calcs:["sum"]},graphStyle:"lines",loadingState:x.state??ye.Gu.Done,data:x.data,height:u,width:s-c*2,timeRange:e.timeRange,onChangeTime:r,timeZone:n,splitOpenFn:o,tooltipDisplayMode:K.$N.Multi,onHiddenSeriesChanged:i,anchorToZero:!0,yAxisMaximum:a,eventBus:e.eventBus,annotations:e.annotations}),y&&(0,t.jsx)("div",{className:f.extraInfoContainer,children:y})]})}const _i=e=>({extraInfoContainer:(0,g.css)`
      display: flex;
      justify-content: end;
      position: absolute;
      right: 5px;
      top: -10px;
      font-size: ${e.typography.bodySmall.fontSize};
      color: ${e.colors.text.secondary};
    `,contentContainer:(0,g.css)`
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    `,streaming:(0,g.css)`
      color: ${e.colors.success.text};
    `});function ea(e){return!e||!e.error&&!e.errors?!1:(e.error?[e.error]:e.errors||[]).some(n=>(`${n.message||n.data?.message}`?.toLowerCase()).includes("timeout"))}const ta=({logsVolumeData:e,absoluteRange:s,onUpdateTimeRange:n,width:o,onLoadLogsVolume:r,onHiddenSeriesChanged:i,eventBus:a,splitOpen:l,timeZone:d,onClose:f,toggleLegendRef:c})=>{const{logVolumes:u,maximumValue:x,maximumRange:m,annotations:C}=(0,p.useMemo)(()=>{let R=-1/0;const O=e?.data.filter(te=>te.meta?.dataTopic!==K.QR.Annotations),z=e?.data.filter(te=>te.meta?.dataTopic===K.QR.Annotations)||[],k=(0,oe.sortBy)(O||[],"meta.custom.datasourceName"),H=(0,oe.groupBy)(k,"meta.custom.datasourceName"),A=(0,oe.mapValues)(H,te=>{const se=(0,Te.oT)(te);return R=Math.max(R,se.maximum),se.dataFrames}),W=(0,Te.Dx)((0,oe.flatten)(Object.values(A)));return{maximumValue:R,maximumRange:W,logVolumes:A,annotations:z}},[e]),y=(0,N.of)(sa),b=Object.keys(u).length,S=Object.values(u).some(R=>{const O=na(R,s);return!(0,Te.e3)(R)&&O&&O<1}),L=ea(e),w=(0,Me.KQ)(Math.max(s.from,m.from)),v=(0,Me.KQ)(Math.min(s.to,m.to)),T={from:w,to:v,raw:{from:w,to:v}};return e?.state===ye.Gu.Loading?(0,t.jsx)("span",{children:"Loading..."}):L?(0,t.jsx)(Ss,{title:"The logs volume query has timed out",severity:"info",suggestedAction:"Retry",onSuggestedAction:r,onRemove:f}):e?.error!==void 0?(0,t.jsx)(Ss,{error:e.error,title:"Failed to load log volume for this query"}):b===0?(0,t.jsx)("div",{className:y.alertContainer,children:(0,t.jsx)(lt.F,{severity:"info",title:"No logs volume available",children:"No volume information available for the current queries and time range."})}):(0,t.jsxs)("div",{className:y.listContainer,children:[Object.keys(u).map((R,O)=>{const z={data:u[R]};return(0,t.jsx)(Xi,{toggleLegendRef:c,timeRange:T,allLogsVolumeMaximum:x,width:o,logsVolumeData:z,onUpdateTimeRange:n,timeZone:d,splitOpen:l,onLoadLogsVolume:r,onHiddenSeriesChanged:b>1?()=>{}:i,eventBus:a,annotations:C},O)}),S&&(0,t.jsx)("div",{className:y.extraInfoContainer,children:(0,t.jsx)(Le.I,{label:"Reload log volume",transparent:!0,children:(0,t.jsx)(q.$n,{size:"xs",icon:"sync",variant:"secondary",onClick:r,id:"reload-volume"})})})]})},sa=e=>({listContainer:(0,g.css)`
      padding-top: 10px;
    `,extraInfoContainer:(0,g.css)`
      display: flex;
      justify-content: end;
      position: absolute;
      right: 5px;
      top: 5px;
    `,oldInfoText:(0,g.css)`
      font-size: ${e.typography.bodySmall.fontSize};
      color: ${e.colors.text.secondary};
    `,alertContainer:(0,g.css)`
      width: 50%;
      min-width: ${e.breakpoints.values.sm}px;
      margin: 0 auto;
    `});function na(e,s){const n=e&&e[0]&&e[0].meta?.custom?.absoluteRange;return n?(s.from-s.to)/(n.from-n.to):void 0}var ae=h(97186);const oa=[K.fY.none,K.fY.exact,K.fY.numbers,K.fY.signature],Cs=()=>{const e=ie.A.get(ae.r);return e==="table"?"table":e==="logs"?"logs":Q.$.featureToggles.logsExploreTableDefaultVisualization?"table":"logs"},qt=10,js="Pinned log",zn="Pin to content outline",nt="Logs",ra=e=>{const{width:s,splitOpen:n,logRows:o,logsMeta:r,logsVolumeEnabled:i,logsVolumeData:a,loadLogsVolumeData:l,loading:d=!1,onClickFilterLabel:f,onClickFilterOutLabel:c,timeZone:u,scanning:x,scanRange:m,showContextToggle:C,absoluteRange:y,onChangeTime:b,getFieldLinks:S,theme:L,logsQueries:w,clearCache:v,addResultsToCache:T,exploreId:R,getRowContext:O,getLogRowContextUi:z,getRowContextQuery:k,loadMoreLogs:H,panelState:A,eventBus:W}=e,[te,se]=(0,p.useState)(ie.A.getBool(ae.$.showLabels,!1)),[de,E]=(0,p.useState)(ie.A.getBool(ae.$.showTime,!0)),[M,$]=(0,p.useState)(ie.A.getBool(ae.$.wrapLogMessage,!0)),[F,U]=(0,p.useState)(ie.A.getBool(ae.$.prettifyLogMessage,!1)),[V,$e]=(0,p.useState)(K.fY.none),[ee,Ke]=(0,p.useState)([]),[ce,ge]=(0,p.useState)(ie.A.get(ae.$.logsSortOrder)||K.uH.Descending),[Ic,oo]=(0,p.useState)(!1),[Be,Os]=(0,p.useState)([]),[Yt,Ec]=(0,p.useState)(!1),[Oc,ro]=(0,p.useState)(!1),[Ye,io]=(0,p.useState)(void 0),[Fc,ao]=(0,p.useState)(zn),[Oe,lo]=(0,p.useState)(A?.logs?.visualisationType??Cs()),[Dc,Ac]=(0,p.useState)(void 0),Ne=(0,p.useRef)(void 0),vt=(0,D.useDispatch)(),co=(0,ei.A)(d),Nc=W.newScopedBus("logsvolume",{onlyLocal:!1}),{register:Zt,unregister:uo,outlineItems:bt,updateItem:po,unregisterAllChildren:Fs}=rs()??{},Ds=(0,p.useRef)(void 0),As=(0,p.useRef)(void 0),Ns=(0,p.useRef)(()=>{}),Jt=(0,p.useRef)(null),Pc=Mn(),X=aa(L,M,Pc),Ps=o&&o.length>0,kc=m?`Scanning ${ut.describeTimeRange(m)}`:"Scanning...",ho=bt?.find(I=>I.panelId===nt&&I.level==="root")?.children?.filter(I=>I.title===js).map(I=>I.id),Xt=(0,p.useCallback)(()=>bt?.find(B=>B.panelId===nt&&B.level==="root")?.children?.filter(B=>B.title===js).length??0,[bt]),go=(0,p.useCallback)(()=>{const I=Object.keys(tt.cZ),B=new Set(a?.data),G=a?.data.filter(fe=>fe.meta?.dataTopic!==K.QR.Annotations),Fe=(0,oe.groupBy)(G,"meta.custom.datasourceName"),be=Object.keys(Fe).length;Fs&&Fs(fe=>fe?.find(_t=>_t.panelId===nt&&_t.level==="root")?.id,"filter");const vo=[];B.forEach(fe=>{const{level:Ze}=(0,Te.tX)(fe);vo.push({levelStr:Ze,logLevel:(0,Te.XM)(Ze)})});const ld=vo.sort((fe,Ze)=>I.indexOf(fe.logLevel.toString())>I.indexOf(Ze.logLevel.toString())?1:-1),bo=new Set(ld);bo.size>1&&i&&be===1&&bo.forEach(fe=>{const Ze=ee.length===0,_t=!ee.find(zs=>zs===fe.levelStr);Zt&&Zt({title:fe.levelStr,icon:"gf-logs",panelId:nt,level:"child",type:"filter",highlight:_t&&!Ze,onClick:zs=>{Ns.current?.(fe.levelStr,(0,si.W)(zs)),hi(fe)},ref:null,color:tt.cZ[fe.logLevel]})})},[a?.data,Fs,i,ee,Zt,Ns]);(0,p.useEffect)(()=>{Xt()===qt?ao((0,t.jsxs)("span",{style:{display:"flex",textAlign:"center"},children:["\u2757\uFE0F",(0,t.jsxs)(j.x6,{i18nKey:"explore.logs.maximum-pinned-logs",children:["Maximum of ",{PINNED_LOGS_LIMIT:qt}," pinned logs reached. Unpin a log to add another."]})]})):ao(zn)},[bt,Xt]),(0,p.useEffect)(()=>{d&&!co&&A?.logs?.id&&(delete A.logs.id,vt((0,De.EA)(R,"logs",{...A})))},[vt,R,d,A,co]),(0,p.useEffect)(()=>{const I=A?.logs?.visualisationType??Cs();lo(I),ie.A.set(ae.r,I)},[A?.logs?.visualisationType]),(0,p.useEffect)(()=>{go()},[a?.data,ee,go]),(0,es.A)(()=>{Ds&&window.clearTimeout(Ds.current),As&&window.clearTimeout(As.current)}),(0,es.A)(()=>{(A?.logs?.columns||A?.logs?.refId||A?.logs?.labelFieldName)&&vt((0,De.EA)(R,"logs",{...A?.logs,columns:void 0,visualisationType:Oe,labelFieldName:void 0,refId:void 0}))});const ks=(0,p.useCallback)(I=>{const B=(0,st.Gu)().explore.panes[R];B?.panelsState&&vt((0,De.EA)(R,"logs",{...B.panelsState.logs,columns:I.columns??A?.logs?.columns,visualisationType:I.visualisationType??Oe,labelFieldName:I.labelFieldName,refId:I.refId??A?.logs?.refId}))},[vt,R,A?.logs?.columns,A?.logs?.refId,Oe]),Mc=(0,p.useCallback)(I=>{I?e.eventBus.publish(new hn.b_({point:{time:I.timeEpochMs}})):e.eventBus.publish(new hn.ql)},[e.eventBus]),zc=(0,p.useCallback)(I=>{Ne.current=I,Ac(()=>B=>{if(Q.$.featureToggles.logsInfiniteScrolling){Ne.current&&(Jt.current?.scrollIntoView(),Ne.current.scroll({behavior:"smooth",top:Ne.current.scrollTop+B.getBoundingClientRect().top-window.innerHeight/2}));return}const G=e.scrollElement;G&&G.scroll({behavior:"smooth",top:G.scrollTop+B.getBoundingClientRect().top-window.innerHeight/2})})},[e.scrollElement]),Hc=()=>{oo(!0),Ds.current=window.setTimeout(()=>{const I=ce===K.uH.Descending?K.uH.Ascending:K.uH.Descending;ie.A.set(ae.$.logsSortOrder,I),ge(I)},0),As.current=window.setTimeout(()=>oo(!1),1e3)},$c=(0,p.useCallback)(()=>{Ec(!Yt)},[Yt]),Bc=(0,p.useCallback)(I=>{lo(I);const B={...A?.logs,visualisationType:I};ks(B),(0,P.rR)("grafana_explore_logs_visualisation_changed",{newVisualizationType:I,datasourceType:e.datasourceType??"unknown",defaultVisualisationType:Q.$.featureToggles.logsExploreTableDefaultVisualization?"table":"logs"})},[A?.logs,e.datasourceType,ks]),Qc=(0,p.useCallback)(I=>{(0,P.rR)("grafana_explore_logs_deduplication_clicked",{deduplicationType:I,datasourceType:e.datasourceType}),$e(I)},[e.datasourceType]),Wc=(0,p.useCallback)(I=>{const{target:B}=I;if(B){const G=B.checked;se(G),ie.A.set(ae.$.showLabels,G)}},[]),Vc=(0,p.useCallback)(I=>{const{target:B}=I;if(B){const G=B.checked;E(G),ie.A.set(ae.$.showTime,G)}},[]),qc=(0,p.useCallback)(I=>{const{target:B}=I;if(B){const G=B.checked;$(G),ie.A.set(ae.$.wrapLogMessage,G)}},[]),Uc=(0,p.useCallback)(I=>{const{target:B}=I;if(B){const G=B.checked;U(G),ie.A.set(ae.$.prettifyLogMessage,G)}},[]),Gc=(0,p.useCallback)(I=>{const B=I.map(G=>(0,Te.EK)(G));Ke(B)},[]),fo=(0,p.useCallback)(I=>{e.onSetLogsVolumeEnabled(!I),(0,P.rR)("grafana_explore_logs_histogram_toggle_clicked",{datasourceType:e.datasourceType,type:I?"close":"open"})},[e]),Kc=(0,p.useCallback)(I=>{I.preventDefault(),e.onStartScanning&&(e.onStartScanning(),(0,P.rR)("grafana_explore_logs_scanning_button_clicked",{type:"start",datasourceType:e.datasourceType}))},[e]),Yc=(0,p.useCallback)(I=>{I.preventDefault(),e.onStopScanning&&e.onStopScanning()},[e]),Zc=(0,p.useCallback)(I=>{Be.indexOf(I)===-1&&Os(Be.concat(I))},[Be]),Jc=(0,p.useCallback)(I=>{Be.indexOf(I)>-1&&Os(Be.filter(G=>I!==G))},[Be]),Xc=(0,p.useCallback)(()=>{Os([])},[]),Ms=(0,p.useRef)(()=>{});let _c=(0,p.useCallback)(()=>{ro(!1),io(void 0),(0,P.rR)("grafana_explore_logs_log_context_closed",{datasourceType:Ye?.datasourceType,logRowUid:Ye?.uid}),Ms?.current()},[Ye?.datasourceType,Ye?.uid,Ms]);const mo=(I,B)=>{ro(!0),io(I),(0,P.rR)("grafana_explore_logs_log_context_opened",{datasourceType:I.datasourceType,logRowUid:I.uid}),Ms.current=B},yo=(0,p.useCallback)((I,B)=>{for(let G=B.indexOf(I)-1;G>=0;G--)if(B[G].timeEpochMs>I.timeEpochMs)return B[G];return null},[]),ed=(0,p.useCallback)(I=>{const B={from:new Date(y.from).toISOString(),to:new Date(y.to).toISOString()};if(!Q.$.featureToggles.logsInfiniteScrolling)return B;const G=o.filter(be=>be.dataFrame.refId===I.dataFrame.refId),Fe=yo(I,G);return I.timeEpochMs>y.to&&!Fe?{from:new Date(y.from).toISOString(),to:new Date(I.timeEpochMs+1).toISOString()}:{from:new Date(y.from).toISOString(),to:new Date(Fe?Fe.timeEpochMs:y.to).toISOString()}},[y.from,y.to,yo,o]),td=async I=>{if(I.rowId===void 0)return;const B=(0,Sn.m)((0,st.Gu)().explore.panes[R]);B.panelsState={...A,logs:{id:I.uid,visualisationType:Oe??Cs()}},B.range=ed(I);const G=(0,gn.Pp)(B),Fe=/.*(?=\/explore)/.exec(`${window.location.href}`)[0],be=gn.kM.renderUrl(`${Fe}/explore`,{left:G});await(0,ps.VP)(be),(0,P.rR)("grafana_explore_logs_permalink_clicked",{datasourceType:I.datasourceType??"unknown",logRowUid:I.uid,logRowLevel:I.logLevel})},sd=(0,p.useCallback)(()=>{Q.$.featureToggles.logsInfiniteScrolling&&Ne.current&&Ne.current.scroll({behavior:"auto",top:0}),Jt.current?.scrollIntoView()},[Ne,Jt]),xo=(I,B=!0)=>{if(Xt()===qt&&!B){di();return}const G=bt?.find(be=>be.panelId===nt&&be.level==="root");G&&po&&po(G.id,{expanded:!0});const Fe=ho?.find(be=>be===I.rowId);Fe&&I.rowId&&B?(uo?.(I.rowId),ci()):Xt()!==qt&&!Fe&&(Zt?.({id:I.rowId,icon:"gf-logs",title:js,panelId:nt,level:"child",ref:null,color:tt.cZ[I.logLevel],childOnTop:!0,onClick:()=>{mo(I,()=>{}),ui()},onRemove:be=>{uo?.(be),pi()}}),li()),e.onPinLineCallback?.()},nd=la(o),od=da(o,ee),{dedupedRows:rd,dedupCount:id}=ca(od,V),ad=ua(o);return(0,t.jsxs)(t.Fragment,{children:[O&&Ye&&(0,t.jsx)(ai.V,{open:Oc,row:Ye,onClose:_c,getRowContext:(I,B)=>O(I,Ye,B),getRowContextQuery:k,getLogRowContextUi:z,logsSortOrder:ce,timeZone:u}),(0,t.jsx)(Ae.NR,{title:"Logs volume",collapsible:!0,collapsed:!i,onToggleCollapse:fo,children:i&&(0,t.jsx)(ta,{toggleLegendRef:Ns,absoluteRange:y,width:s,logsVolumeData:a,onUpdateTimeRange:b,timeZone:u,splitOpen:n,onLoadLogsVolume:l,onHiddenSeriesChanged:Gc,eventBus:Nc,onClose:()=>fo(!0)})}),(0,t.jsxs)(Ae.NR,{titleItems:[Q.$.featureToggles.logsExploreTableVisualisation?Oe==="logs"?null:(0,t.jsx)(Ae.NR.TitleItem,{title:"Feedback",children:(0,t.jsx)(gi,{feedbackUrl:"https://forms.gle/5YyKdRQJ5hzq4c289"})},"A"):null],title:"Logs",actions:(0,t.jsx)(t.Fragment,{children:Q.$.featureToggles.logsExploreTableVisualisation&&(0,t.jsx)("div",{className:X.visualisationType,children:(0,t.jsx)(pt.z,{className:X.visualisationTypeRadio,options:[{label:"Logs",value:"logs",description:"Show results in logs visualisation"},{label:"Table",value:"table",description:"Show results in table visualisation"}],size:"sm",value:Oe,onChange:Bc})})}),loadingState:d?ye.Gu.Loading:ye.Gu.Done,children:[(0,t.jsxs)("div",{className:X.stickyNavigation,children:[Oe!=="table"&&(0,t.jsxs)("div",{className:X.logOptions,children:[(0,t.jsxs)(ti.C,{children:[(0,t.jsx)(Le.I,{label:"Time",className:X.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(ze.K,{value:de,onChange:Vc,className:X.horizontalInlineSwitch,transparent:!0,id:`show-time_${R}`})}),(0,t.jsx)(Le.I,{label:"Unique labels",className:X.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(ze.K,{value:te,onChange:Wc,className:X.horizontalInlineSwitch,transparent:!0,id:`unique-labels_${R}`})}),(0,t.jsx)(Le.I,{label:"Wrap lines",className:X.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(ze.K,{value:M,onChange:qc,className:X.horizontalInlineSwitch,transparent:!0,id:`wrap-lines_${R}`})}),(0,t.jsx)(Le.I,{label:"Prettify JSON",className:X.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(ze.K,{value:F,onChange:Uc,className:X.horizontalInlineSwitch,transparent:!0,id:`prettify_${R}`})}),(0,t.jsx)(Le.I,{label:"Deduplication",className:X.horizontalInlineLabel,transparent:!0,children:(0,t.jsx)(pt.z,{options:oa.map(I=>({label:(0,oe.capitalize)(I),value:I,description:_._C[I]})),value:V,onChange:Qc,className:X.radioButtons})})]}),(0,t.jsx)("div",{children:(0,t.jsx)(Le.I,{label:"Display results",className:X.horizontalInlineLabel,transparent:!0,disabled:Ic||d,children:(0,t.jsx)(pt.z,{options:[{label:"Newest first",value:K.uH.Descending,description:"Show results newest to oldest"},{label:"Oldest first",value:K.uH.Ascending,description:"Show results oldest to newest"}],value:ce,onChange:Hc,className:X.radioButtons})})})]}),(0,t.jsx)("div",{ref:Jt}),(0,t.jsx)(On,{logRows:o,meta:r||[],dedupStrategy:V,dedupCount:id,hasUnescapedContent:nd,forceEscape:Yt,displayedFields:Be,onEscapeNewlines:$c,clearDetectedFields:Xc})]}),(0,t.jsxs)("div",{className:(0,g.cx)(X.logsSection,Oe==="table"?X.logsTable:void 0),children:[Oe==="table"&&Ps&&(0,t.jsx)("div",{className:X.logRows,"data-testid":"logRowsTable",children:(0,t.jsx)(Ki,{logsSortOrder:ce,range:e.range,splitOpen:n,timeZone:u,width:s-80,logsFrames:e.logsFrames??[],onClickFilterLabel:f,onClickFilterOutLabel:c,panelState:A?.logs,theme:L,updatePanelState:ks,datasourceType:e.datasourceType})}),Oe==="logs"&&Ps&&(0,t.jsx)("div",{className:Q.$.featureToggles.logsInfiniteScrolling?X.scrollableLogRows:X.logRows,"data-testid":"logRows",ref:zc,children:(0,t.jsx)(ni,{loading:d,loadMoreLogs:H,range:e.range,timeZone:u,rows:o,scrollElement:Ne.current,sortOrder:ce,app:me.Jk.Explore,children:(0,t.jsx)(bn.k,{pinnedLogs:ho,logRows:o,deduplicatedRows:rd,dedupStrategy:V,onClickFilterLabel:f,onClickFilterOutLabel:c,showContextToggle:C,getRowContextQuery:k,showLabels:te,showTime:de,enableLogDetails:!0,forceEscape:Yt,wrapLogMessage:M,prettifyLogMessage:F,timeZone:u,getFieldLinks:S,logsSortOrder:ce,displayedFields:Be,onClickShowField:Zc,onClickHideField:Jc,app:me.Jk.Explore,onLogRowHover:Mc,onOpenContext:mo,onPermalinkClick:td,permalinkedRowId:A?.logs?.id,scrollIntoView:Dc,isFilterLabelActive:e.isFilterLabelActive,containerRendered:!!Ne,onClickFilterString:e.onClickFilterString,onClickFilterOutString:e.onClickFilterOutString,onUnpinLine:xo,onPinLine:xo,pinLineButtonTooltipTitle:Fc})})}),!d&&!Ps&&!x&&(0,t.jsx)("div",{className:X.logRows,children:(0,t.jsxs)("div",{className:X.noData,children:[(0,t.jsx)(j.x6,{i18nKey:"explore.logs.no-logs-found",children:"No logs found."}),(0,t.jsx)(q.$n,{size:"sm",variant:"secondary",onClick:Kc,children:(0,t.jsx)(j.x6,{i18nKey:"explore.logs.scan-for-older-logs",children:"Scan for older logs"})})]})}),x&&(0,t.jsx)("div",{className:X.logRows,children:(0,t.jsxs)("div",{className:X.noData,children:[(0,t.jsx)("span",{children:kc}),(0,t.jsx)(q.$n,{size:"sm",variant:"secondary",onClick:Yc,children:(0,t.jsx)(j.x6,{i18nKey:"explore.logs.stop-scan",children:"Stop scan"})})]})}),(0,t.jsx)(Ai,{logsSortOrder:ce,visibleRange:ad??y,absoluteRange:y,timeZone:u,onChangeTime:b,loading:d,queries:w??[],scrollToTopLogs:sd,addResultsToCache:T,clearCache:v})]})]})]})},ia=(0,N.cV)(ra),aa=(e,s,n)=>({noData:(0,g.css)({"& > *":{marginLeft:"0.5em"}}),logOptions:(0,g.css)({display:"flex",justifyContent:"space-between",alignItems:"baseline",flexWrap:"wrap",backgroundColor:e.colors.background.primary,padding:`${e.spacing(1)} ${e.spacing(2)}`,borderRadius:e.shape.radius.default,margin:`${e.spacing(0,0,1)}`,border:`1px solid ${e.colors.border.medium}`}),headerButton:(0,g.css)({margin:`${e.spacing(.5,0,0,1)}`}),horizontalInlineLabel:(0,g.css)({"& > label":{marginRight:"0"}}),horizontalInlineSwitch:(0,g.css)({padding:`0 ${e.spacing(1)} 0 0`}),radioButtons:(0,g.css)({margin:"0"}),logsSection:(0,g.css)({display:"flex",flexDirection:"row",justifyContent:"space-between",position:"relative"}),logsTable:(0,g.css)({maxHeight:`${n}px`}),scrollableLogRows:(0,g.css)({overflowY:"scroll",width:"100%",maxHeight:"75vh"}),logRows:(0,g.css)({overflowX:`${s?"unset":"scroll"}`,overflowY:"visible",width:"100%"}),visualisationType:(0,g.css)({display:"flex",flex:"1",justifyContent:"space-between"}),visualisationTypeRadio:(0,g.css)({margin:`0 0 0 ${e.spacing(1)}`}),stickyNavigation:(0,g.css)({overflow:"visible",...Q.$.featureToggles.logsInfiniteScrolling&&{marginBottom:"0px"}})}),la=(0,dt.A)(e=>e.some(s=>s.hasUnescapedContent)),ca=(0,dt.A)((e,s)=>{const n=(0,tt.M0)(e,s),o=n.reduce((r,i)=>i.duplicates?r+i.duplicates:r,0);return{dedupedRows:n,dedupCount:o}}),da=(0,dt.A)((e,s)=>(0,tt.ct)(e,new Set(s))),ua=(0,dt.A)(e=>{if(!e||e.length===0)return;const s=e[0].timeEpochMs,n=e[e.length-1].timeEpochMs;return n<s?{from:n,to:s}:{from:s,to:n}}),Rs=500,ws=100,pa=(0,dt.A)(()=>({logsEnter:(0,g.css)`
      label: logsEnter;
      position: absolute;
      opacity: 0;
      height: auto;
      width: 100%;
    `,logsEnterActive:(0,g.css)`
      label: logsEnterActive;
      opacity: 1;
      transition: opacity ${Rs}ms ease-out ${ws}ms;
    `,logsExit:(0,g.css)`
      label: logsExit;
      position: absolute;
      opacity: 1;
      height: auto;
      width: 100%;
    `,logsExitActive:(0,g.css)`
      label: logsExitActive;
      opacity: 0;
      transition: opacity ${Rs}ms ease-out ${ws}ms;
    `}));function Hn(e){const{visible:s,children:n}=e,o=(0,p.useRef)(null),r=pa();return(0,t.jsx)(ln.A,{in:s,mountOnEnter:!0,unmountOnExit:!0,timeout:Rs+ws,classNames:{enter:r.logsEnter,enterActive:r.logsEnterActive,exit:r.logsExit,exitActive:r.logsExitActive},nodeRef:o,children:(0,t.jsx)("div",{ref:o,children:n})})}class ha extends p.PureComponent{constructor(){super(...arguments),this.state={dsInstances:{}},this.onChangeTime=s=>{const{exploreId:n,updateTimeRange:o}=this.props;o({exploreId:n,absoluteRange:s})},this.loadMoreLogs=s=>{const{exploreId:n,loadMoreLogs:o}=this.props;o({exploreId:n,absoluteRange:s})},this.getLogRowContext=async(s,n,o)=>{const{logsQueries:r}=this.props;if(!n.dataFrame.refId||!this.state.dsInstances[n.dataFrame.refId])return Promise.resolve([]);const i=this.state.dsInstances[n.dataFrame.refId];if(!(0,_.Ol)(i))return Promise.resolve([]);const a=this.getQuery(r,n,i);return a?i.getLogRowContext(s,o,a):Promise.resolve([])},this.getLogRowContextQuery=async(s,n,o=!0)=>{const{logsQueries:r}=this.props;if(!s.dataFrame.refId||!this.state.dsInstances[s.dataFrame.refId])return Promise.resolve(null);const i=this.state.dsInstances[s.dataFrame.refId];if(!(0,_.Ol)(i))return Promise.resolve(null);const a=this.getQuery(r,s,i);return a&&i.getLogRowContextQuery?i.getLogRowContextQuery(s,n,a,o):Promise.resolve(null)},this.getLogRowContextUi=(s,n)=>{const{logsQueries:o}=this.props;if(!s.dataFrame.refId||!this.state.dsInstances[s.dataFrame.refId])return(0,t.jsx)(t.Fragment,{});const r=this.state.dsInstances[s.dataFrame.refId];if(!(0,_.Ol)(r))return(0,t.jsx)(t.Fragment,{});const i=this.getQuery(o,s,r);return i&&(0,_.wj)(r)&&r.getLogRowContextUi?r.getLogRowContextUi(s,n,i):(0,t.jsx)(t.Fragment,{})},this.showContextToggle=s=>!s?.dataFrame.refId||!this.state.dsInstances[s.dataFrame.refId]?!1:(0,_.Ol)(this.state.dsInstances[s.dataFrame.refId]),this.getFieldLinks=(s,n,o)=>{const{splitOpenFn:r,range:i}=this.props;return(0,Ge.QL)({field:s,rowIndex:n,splitOpenFn:r,range:i,dataFrame:o})},this.logDetailsFilterAvailable=()=>Object.values(this.state.dsInstances).some(s=>s?.modifyQuery||(0,_._0)(s)||(0,_.FP)(s)),this.filterValueAvailable=()=>Object.values(this.state.dsInstances).some(s=>(0,_._0)(s)&&s?.getSupportedQueryModifications().includes("ADD_STRING_FILTER")),this.filterOutValueAvailable=()=>Object.values(this.state.dsInstances).some(s=>(0,_._0)(s)&&s?.getSupportedQueryModifications().includes("ADD_STRING_FILTER_OUT")),this.addResultsToCache=()=>{this.props.addResultsToCache(this.props.exploreId)},this.clearCache=()=>{this.props.clearCache(this.props.exploreId)}}componentDidMount(){this.updateDataSourceInstances()}componentDidUpdate(s){s.logsQueries!==this.props.logsQueries&&this.updateDataSourceInstances()}updateDataSourceInstances(){const{logsQueries:s,datasourceInstance:n}=this.props;if(!s||!n)return;const o={};if(n.uid!==Rt.uv){s.forEach(({refId:i})=>{o[i]=n}),this.setState({dsInstances:o});return}const r=[];for(const i of s){if(!i.datasource)continue;(!o[i.refId]||o[i.refId].uid!==i.datasource.uid)&&r.push(new Promise(l=>{(0,Pe.l)().get(i.datasource).then(d=>{l({ds:d,refId:i.refId})})}))}r.length&&Promise.all(r).then(i=>{i.forEach(({ds:a,refId:l})=>{o[l]=a}),this.setState({dsInstances:o})})}getQuery(s,n,o){return(s??[]).find(r=>r.refId===n.dataFrame.refId&&r.datasource!=null&&r.datasource.type===o.type)}render(){const{loading:s,loadingState:n,logRows:o,logsMeta:r,logsSeries:i,logsQueries:a,loadSupplementaryQueryData:l,setSupplementaryQueryEnabled:d,onClickFilterLabel:f,onClickFilterOutLabel:c,onStartScanning:u,onStopScanning:x,absoluteRange:m,timeZone:C,visibleRange:y,scanning:b,range:S,width:L,splitOpenFn:w,isLive:v,exploreId:T,logsVolume:R,scrollElement:O,onPinLineCallback:z}=this.props;return o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(Hn,{visible:v,children:(0,t.jsx)(Mt.S,{label:"Logs",loading:!1,isOpen:!0,children:(0,t.jsx)(dn,{exploreId:T,children:k=>(0,t.jsx)(_r,{logRows:o,timeZone:C,stopLive:k.stop,isPaused:this.props.isPaused,onPause:k.pause,onResume:k.resume,onClear:k.clear,clearedAtIndex:this.props.clearedAtIndex})})})}),(0,t.jsx)(Hn,{visible:!v,children:(0,t.jsx)(ia,{exploreId:T,datasourceType:this.props.datasourceInstance?.type,logRows:o,logsMeta:r,logsSeries:i,logsVolumeEnabled:R.enabled,onSetLogsVolumeEnabled:k=>d(T,k,_.cF.LogsVolume),logsVolumeData:R.data,logsQueries:a,width:L,splitOpen:w,loading:s,loadingState:n,loadLogsVolumeData:()=>l(T,_.cF.LogsVolume),onChangeTime:this.onChangeTime,loadMoreLogs:this.loadMoreLogs,onClickFilterLabel:this.logDetailsFilterAvailable()?f:void 0,onClickFilterOutLabel:this.logDetailsFilterAvailable()?c:void 0,onStartScanning:u,onStopScanning:x,absoluteRange:m,visibleRange:y,timeZone:C,scanning:b,scanRange:S.raw,showContextToggle:this.showContextToggle,getRowContext:this.getLogRowContext,getRowContextQuery:this.getLogRowContextQuery,getLogRowContextUi:this.getLogRowContextUi,getFieldLinks:this.getFieldLinks,addResultsToCache:this.addResultsToCache,clearCache:this.clearCache,eventBus:this.props.eventBus,panelState:this.props.panelState,logsFrames:this.props.logsFrames,scrollElement:O,isFilterLabelActive:this.logDetailsFilterAvailable()?this.props.isFilterLabelActive:void 0,range:S,onPinLineCallback:z,onClickFilterString:this.filterValueAvailable()?this.props.onClickFilterString:void 0,onClickFilterOutString:this.filterOutValueAvailable()?this.props.onClickFilterOutString:void 0})})]}):null}}function ga(e,{exploreId:s}){const o=e.explore.panes[s],{logsResult:r,scanning:i,datasourceInstance:a,isLive:l,isPaused:d,clearedAtIndex:f,range:c,absoluteRange:u,supplementaryQueries:x}=o,m=(0,Y.h1)(s)(e),C=o.panelsState,y=(0,Dt.O)(e.user),b=x[_.cF.LogsVolume];return{loading:m,logRows:r?.rows,logsMeta:r?.meta,logsSeries:r?.series,logsQueries:r?.queries,visibleRange:r?.visibleRange,scanning:i,timeZone:y,datasourceInstance:a,isLive:l,isPaused:d,clearedAtIndex:f,range:c,absoluteRange:u,logsVolume:b,panelState:C,logsFrames:o.queryResponse.logsFrames}}const fa={updateTimeRange:ve.GH,loadMoreLogs:ve.zY,addResultsToCache:Y.He,clearCache:Y.IL,loadSupplementaryQueryData:Y.Az,setSupplementaryQueryEnabled:Y.TO},ma=(0,Ce.connect)(ga,fa)(ha);function ya(e){const{queryResponse:s,timeZone:n,enabled:o,setLogsSampleEnabled:r,datasourceInstance:i,queries:a,splitOpen:l}=e,d=(0,N.of)(xa),f=x=>{r(x),(0,P.rR)("grafana_explore_logs_sample_toggle_clicked",{datasourceType:i?.type??"unknown",type:x?"open":"close"})},c=()=>{if(!i||!(0,_.Nc)(i,_.cF.LogsSample))return null;const x=a.map(C=>i.getSupplementaryQuery({type:_.cF.LogsSample},C)).filter(C=>!!C);if(!x.length)return null;const m=()=>{l({queries:x,datasourceUid:i.uid}),(0,P.rR)("grafana_explore_logs_sample_split_button_clicked",{datasourceType:i?.type??"unknown",queriesCount:x.length})};return(0,t.jsx)(q.$n,{size:"sm",className:d.logSamplesButton,onClick:m,children:"Open logs in split view"})};let u;if(s===void 0)u=null;else if(s.error!==void 0)u=(0,t.jsx)(Ss,{error:s.error,title:"Failed to load logs sample for this query"});else if(s.state===ye.Gu.Loading)u=(0,t.jsx)("span",{children:"Logs sample is loading..."});else if(s.data.length===0||s.data.every(x=>x.length===0))u=(0,t.jsx)("span",{children:"No logs sample data."});else{const x=(0,tt.HT)(s.data);u=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(c,{}),(0,t.jsx)("div",{className:d.logContainer,children:(0,t.jsx)(bn.k,{logRows:x.rows,dedupStrategy:K.fY.none,showLabels:ie.A.getBool(ae.$.showLabels,!1),showTime:ie.A.getBool(ae.$.showTime,!0),wrapLogMessage:ie.A.getBool(ae.$.wrapLogMessage,!0),prettifyLogMessage:ie.A.getBool(ae.$.prettifyLogMessage,!1),timeZone:n,enableLogDetails:!0})})]})}return s?.state!==ye.Gu.NotStarted?(0,t.jsx)(Mt.S,{label:(0,t.jsxs)("div",{children:["Logs sample",(0,t.jsx)(Se.m,{content:"Show log lines that contributed to visualized metrics",children:(0,t.jsx)(he.I,{name:"info-circle",className:d.infoTooltip})})]}),isOpen:o,collapsible:!0,onToggle:f,children:u}):null}const xa=e=>({logSamplesButton:(0,g.css)`
      position: absolute;
      top: ${e.spacing(1)};
      right: ${e.spacing(1)};
    `,logContainer:(0,g.css)`
      overflow: scroll;
    `,infoTooltip:(0,g.css)`
      margin-left: ${e.spacing(1)};
    `}),va=()=>{const e=(0,N.of)(ba);return(0,t.jsx)(t.Fragment,{children:(0,t.jsx)(os._,{"data-testid":"explore-no-data",className:e.wrapper,children:(0,t.jsx)("span",{className:e.message,children:"No data"})})})},ba=e=>({wrapper:(0,g.css)({label:"no-data-card",padding:e.spacing(3),background:e.colors.background.primary,borderRadius:e.shape.radius.default,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",flexGrow:1}),message:(0,g.css)({fontSize:e.typography.h2.fontSize,padding:e.spacing(4),color:e.colors.text.disabled})});var Sa=h(76442);function Ca(e){return(0,g.css)({maxWidth:`${e.breakpoints.values.lg}px`,marginTop:e.spacing(2),alignSelf:"center"})}const ja=()=>{const e=(0,N.of)(Ca),s=us.TP.hasPermission(D.AccessControlAction.DataSourcesCreate)&&us.TP.hasPermission(D.AccessControlAction.DataSourcesWrite),n="Explore requires at least one data source. Once you have added a data source, you can query it here.",o=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(he.I,{name:"rocket"}),(0,t.jsx)(t.Fragment,{children:" ProTip: You can also define data sources through configuration files. "}),(0,t.jsx)("a",{href:"http://docs.grafana.org/administration/provisioning/?utm_source=explore#data-sources",target:"_blank",rel:"noreferrer",className:"text-link",children:"Learn more"})]}),r=(0,t.jsx)(q.z9,{size:"lg",href:"datasources/new",icon:"database",disabled:!s,children:"Add data source"});return(0,t.jsx)(Sa.c,{callToActionElement:r,className:e,footer:o,message:n})};var Ts=h(52908),Ra=h(95511),wa=h(94382);const Ta=e=>({warningText:(0,g.css)`
    label: warningText;
    display: flex;
    align-items: center;
    font-size: ${e.typography.bodySmall.fontSize};
    color: ${e.colors.text.secondary};
  `});function La(e){const{dataFrames:s,range:n,splitOpenFn:o,withTraceView:r,datasourceType:i}=e,a=(0,Ge.JQ)(n,o),l=(0,N.$j)(),d=(0,N.of)(Ta),f=(0,Vt.we)({fieldConfig:{defaults:{},overrides:[]},data:s,replaceVariables:v=>v,theme:l}),{nodes:c}=(0,wa.d)(f),[u,x]=(0,Zs.A)(!0),m=()=>{x(),(0,P.rR)("grafana_traces_node_graph_panel_clicked",{datasourceType:i,grafana_version:Q.$.buildInfo.version,isExpanded:!open})},{height:C}=(0,Ts.A)(),y=(0,p.useRef)(null),[b,S]=(0,p.useState)(250);(0,p.useEffect)(()=>{if(y.current){const{top:v}=y.current.getBoundingClientRect();S(v)}},[y]);const L=C-b-32,w=r&&c[0]?.length>1e3?(0,t.jsxs)("span",{className:d.warningText,children:[" (",c[0].length," nodes, can be slow to load)"]}):null;return(0,t.jsx)(Ae.NR,{title:"Node graph",titleItems:w,collapsible:!!r,collapsed:r?u:!1,onToggleCollapse:r?m:void 0,children:(0,t.jsx)("div",{ref:y,style:r?{height:500}:{minHeight:600,height:L},children:(0,t.jsx)(Ra.F,{dataFrames:f,getLinks:a})})})}function Ia(e,{exploreId:s}){return{range:e.explore.panes[s].range}}const Ea=(0,Ce.connect)(Ia,{})(La);var ft=h(25508),Oa=h(77789),$n=h(31193),Fa=h(44932);const Da=e=>{const s=(0,J.qq)(e);return{getQueries:(0,ft.Mz)(s,n=>n.queries),getQueryResponse:(0,ft.Mz)(s,n=>n.queryResponse),getHistory:(0,ft.Mz)(s,n=>n.history),getEventBridge:(0,ft.Mz)(s,n=>n.eventBridge),getDatasourceInstanceSettings:(0,ft.Mz)(s,n=>(0,$n.tR)().getInstanceSettings(n.datasourceInstance?.uid))}},Aa=({exploreId:e})=>{const s=(0,D.useDispatch)(),{getQueries:n,getDatasourceInstanceSettings:o,getQueryResponse:r,getHistory:i,getEventBridge:a}=(0,p.useMemo)(()=>Da(e),[e]),l=(0,D.useSelector)(n),d=(0,D.useSelector)(o),f=(0,D.useSelector)(r),c=(0,D.useSelector)(i),u=(0,D.useSelector)(a),x=(0,p.useCallback)(()=>{s((0,Y.Od)({exploreId:e}))},[s,e]),m=(0,p.useCallback)(L=>{s((0,Y.bO)({exploreId:e,queries:L}))},[s,e]),C=(0,p.useCallback)(L=>{m([...l,{...L,refId:(0,Oa.M)(l)}])},[m,l]),y=()=>{(0,P.rR)("grafana_explore_query_row_copy")},b=()=>{(0,P.rR)("grafana_explore_query_row_remove")},S=L=>{(0,P.rR)("grafana_query_row_toggle",L===void 0?{}:{queryEnabled:L})};return(0,t.jsx)(Fa.L,{dsSettings:d,queries:l,onQueriesChange:m,onAddQuery:C,onRunQueries:x,onQueryCopied:y,onQueryRemoved:b,onQueryToggled:S,data:f,app:me.Jk.Explore,history:c,eventBus:u,queryRowWrapper:(L,w)=>(0,t.jsx)(je,{title:w,icon:"arrow",panelId:"Queries",customTopOffset:-10,level:"child",children:L},w)})};var Ut=h(72574),Ls=h(2913),Na=h(15054),Pa=h(91793),ka=h(9651),Ma=h(9663),Bn=h(57408);const mt={wrapper:(0,g.css)`
    height: 100%;
    overflow: scroll;
  `,switchWrapper:(0,g.css)`
    display: flex;
    flex-direction: row;
    margin-bottom: 0;
  `,switchLabel:(0,g.css)`
    margin-left: 15px;
    margin-bottom: 0;
  `,switch:(0,g.css)`
    margin-left: 10px;
  `,resultCount:(0,g.css)`
    margin-bottom: 4px;
  `,header:(0,g.css)`
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 10px 0;
    font-size: 12px;
    line-height: 1.25;
  `},za=480,Ha=2,$a=e=>{const{tableResult:s}=e,n=(0,oe.cloneDeep)(s),o=(0,p.useRef)(null),r=n.fields.filter(m=>m.name.includes("Value")),i=(0,Bn.E)(n),{width:a}=(0,Ts.A)(),[l,d]=(0,p.useState)(a<=za||r.length>Ha),f=()=>{d(!l);const m={isExpanded:!l};(0,P.rR)("grafana_explore_prometheus_instant_query_ui_raw_toggle_expand",m)};(0,p.useEffect)(()=>{o.current?.resetAfterIndex(0,!0)},[l]);const c=m=>{if(m<10){let b=0;for(let S=0;S<m;S++)b+=u(S,!0);return Math.min(600,b)}return 600},u=(m,C)=>{if(!C)return 32;const S=i[m];return 1.5*32+(Object.keys(S).length-r.length)*22},x=`isExpandedView ${(0,p.useId)()}`;return(0,t.jsxs)("section",{children:[(0,t.jsxs)("header",{className:mt.header,children:[(0,t.jsx)(pe.D,{className:mt.switchWrapper,label:"Expand results",htmlFor:"isExpandedView",children:(0,t.jsx)("div",{className:mt.switch,children:(0,t.jsx)(ze.d,{onChange:f,id:x,value:l,label:"Expand results"})})}),(0,t.jsxs)("div",{className:mt.resultCount,children:["Result series: ",i.length]})]}),(0,t.jsx)("div",{role:"table",children:(0,t.jsxs)(t.Fragment,{children:[r.length>1&&!l&&(0,t.jsx)(ka.d,{valueLabels:r,expanded:l}),(0,t.jsx)(Pa._m,{ref:o,itemCount:i.length,className:mt.wrapper,itemSize:m=>u(m,l),height:c(i.length),width:"100%",children:({index:m,style:C})=>{let y;return l&&(y=r.filter(b=>{const S=i[m][b.name];return S&&S!==Bn.M})),(0,t.jsx)("div",{role:"row",style:{...C,overflow:"hidden"},children:(0,t.jsx)(Ma.Ay,{isExpandedView:l,valueLabels:y,totalNumberOfValues:r.length,listKey:i[m].__name__,listItemData:i[m]})})}})]})})]})};function Ba(e,{exploreId:s}){const o=e.explore.panes[s],{tableResult:r,rawPrometheusResult:i,range:a,queryResponse:l}=o,d=i?[i]:[],f=(r?.length??0)>0&&i?r:d;return{loading:l.state,tableResult:f,range:a}}const Qa=(0,Ce.connect)(Ba,{});class Wa extends p.PureComponent{constructor(s){super(s),this.onChangeResultsStyle=n=>{this.setState({resultsStyle:n})},this.renderLabel=()=>{const n=(0,g.css)({display:"flex",justifyContent:"space-between",flex:"1"}),o=ds.jH.map(r=>({value:r,label:r[0].toUpperCase()+r.slice(1).replace(/_/," ")}));return(0,t.jsx)("div",{className:n,children:(0,t.jsx)(pt.z,{onClick:()=>{const r={state:this.state.resultsStyle===D.TABLE_RESULTS_STYLE.table?D.TABLE_RESULTS_STYLE.raw:D.TABLE_RESULTS_STYLE.table};(0,P.rR)("grafana_explore_prometheus_instant_query_ui_toggle_clicked",r)},size:"sm",options:o,value:this.state?.resultsStyle,onChange:this.onChangeResultsStyle})})},s.showRawPrometheus&&(this.state={resultsStyle:D.TABLE_RESULTS_STYLE.raw})}getTableHeight(){const{tableResult:s}=this.props;return!s||s.length===0?200:Math.max(Math.min(600,s[0].length*35)+35)}render(){const{loading:s,onCellFilterAdded:n,tableResult:o,width:r,splitOpenFn:i,range:a,ariaLabel:l,timeZone:d}=this.props,f=this.getTableHeight(),c=r-Ls.config.theme.panelPadding*2-Na.IZ;let u=o;const x=(0,Ge.YV)(i,a);u?.length&&(u=(0,Vt.we)({data:u,timeZone:d,theme:Ls.config.theme2,replaceVariables:(0,Ut.w)().replace.bind((0,Ut.w)()),fieldConfig:{defaults:{},overrides:[]},dataLinkPostProcessor:x}));const m=u?.filter(S=>!!S&&S.length!==0),C=this.state.resultsStyle===D.TABLE_RESULTS_STYLE.raw?"Raw":"Table",y=this.state?.resultsStyle!==void 0?this.renderLabel():"Table",b=!this.state?.resultsStyle||this.state?.resultsStyle===D.TABLE_RESULTS_STYLE.table;return(0,t.jsxs)(Ae.NR,{title:C,actions:y,loadingState:s,children:[m?.length&&(0,t.jsxs)(t.Fragment,{children:[b&&(0,t.jsx)(xs.X,{ariaLabel:l,data:m[0],width:c,height:f,onCellFilterAdded:n}),this.state?.resultsStyle===D.TABLE_RESULTS_STYLE.raw&&(0,t.jsx)($a,{tableResult:m[0]})]}),!m?.length&&(0,t.jsx)(ys,{metaItems:[{value:"0 series returned"}]})]})}}const Va=Qa(Wa);var qa=h(22669);const Ua=e=>{const s=(0,p.useRef)(null),n={transition:`opacity ${e.duration}ms linear`,opacity:0},o={exited:{opacity:0,display:"none"},entering:{opacity:0},entered:{opacity:1},exiting:{opacity:0}};return(0,t.jsx)(qa.Ay,{in:e.in,timeout:e.duration,unmountOnExit:e.unmountOnExit||!1,onExited:e.onExited,nodeRef:s,children:r=>(0,t.jsx)("div",{ref:s,style:{...n,...o[r]},children:e.children})})},Ga=e=>{const{queryError:s}=e,n=!!s,o=n?100:10,r=s?"Query error":"Unknown error",i=s?.message||s?.data?.message||null;return(0,t.jsx)(Ua,{in:n,duration:o,children:(0,t.jsx)(lt.F,{severity:"error",title:r,topSpacing:2,children:i})})};function Ka(e){const s=(0,D.useSelector)(o=>o.explore.panes[e.exploreId].queryResponse),n=s?.state===ye.Gu.Error?s?.error:void 0;return n?.refId?null:(0,t.jsx)(Ga,{queryError:n})}var Ya=h(13390);const Za=e=>({containerMargin:(0,g.css)({display:"flex",flexWrap:"wrap",gap:e.spacing(1),marginTop:e.spacing(2)})});function Ja(e){const s=(0,N.$j)(),n=Za(s),{drawerOpened:o,setDrawerOpened:r,queryLibraryAvailable:i}=et(),a=!e.richHistoryRowButtonHidden&&!i;return(0,t.jsxs)("div",{className:n.containerMargin,children:[!e.addQueryRowButtonHidden&&(0,t.jsx)(re.I,{variant:"canvas","aria-label":(0,j.t)("explore.secondary-actions.query-add-button-aria-label","Add query"),onClick:e.onClickAddQueryRowButton,disabled:e.addQueryRowButtonDisabled,icon:"plus",children:(0,t.jsx)(j.x6,{i18nKey:"explore.secondary-actions.query-add-button",children:"Add query"})}),a&&(0,t.jsx)(re.I,{variant:o?"active":"canvas","aria-label":(0,j.t)("explore.secondary-actions.query-history-button-aria-label","Query history"),onClick:()=>r(!o),"data-testid":Ya.X.QueryTab.queryHistoryButton,icon:"history",children:(0,t.jsx)(j.x6,{i18nKey:"explore.secondary-actions.query-history-button",children:"Query history"})}),(0,t.jsx)(re.I,{variant:e.queryInspectorButtonActive?"active":"canvas","aria-label":(0,j.t)("explore.secondary-actions.query-inspector-button-aria-label","Query inspector"),onClick:e.onClickQueryInspectorButton,icon:"info-circle",children:(0,t.jsx)(j.x6,{i18nKey:"explore.secondary-actions.query-inspector-button",children:"Query inspector"})})]})}var Qn=h(65885);function Xa(e,{exploreId:s}){const o=e.explore.panes[s],{tableResult:r,range:i}=o,a=(0,Y.h1)(s);return{loading:r&&r.length>0?!1:a,tableResult:r,range:i}}const _a=(0,Ce.connect)(Xa,{});class Wn extends p.PureComponent{constructor(){super(...arguments),this.hasSubFrames=s=>s.fields.some(n=>n.type===ht.PU.nestedFrames)}getTableHeight(s,n){return s===0?200:Math.min(600,Math.max(s*36,n?300:0)+40+46)}getTableTitle(s,n,o){let r=n.name;return!r&&(s?.length??0)>1&&(r=n.refId||`${o}`),r?(0,j.t)("explore.table.title-with-name","Table - {{name}}",{name:r,interpolation:{escapeValue:!1}}):(0,j.t)("explore.table.title","Table")}render(){const{loading:s,onCellFilterAdded:n,tableResult:o,width:r,splitOpenFn:i,range:a,ariaLabel:l,timeZone:d,theme:f}=this.props;let c=(0,Qn.gy)(o)?(0,Qn.S5)(o):o;const u=(0,Ge.YV)(i,a);c?.length&&(c=(0,Vt.we)({data:c,timeZone:d,theme:Ls.config.theme2,replaceVariables:(0,Ut.w)().replace.bind((0,Ut.w)()),fieldConfig:{defaults:{},overrides:[]},dataLinkPostProcessor:u}));const x=c?.filter(m=>!!m&&m.length!==0);return(0,t.jsxs)(t.Fragment,{children:[x&&x.length===0&&(0,t.jsx)(Ae.NR,{title:(0,j.t)("explore.table.title","Table"),width:r,height:200,children:()=>(0,t.jsx)(ys,{metaItems:[{value:(0,j.t)("explore.table.no-data","0 series returned")}]})}),x&&x.length>0&&(0,t.jsx)("div",{className:(0,g.css)({display:"flex",flexDirection:"column",gap:f.spacing(1)}),children:x.map((m,C)=>(0,t.jsx)(Ae.NR,{title:this.getTableTitle(c,m,C),width:r,height:this.getTableHeight(m.length,this.hasSubFrames(m)),loadingState:s?ye.Gu.Loading:void 0,children:(y,b)=>(0,t.jsx)(xs.X,{ariaLabel:l,data:m,width:y,height:b,onCellFilterAdded:n})},m.refId||`table-${C}`))})]})}}const hd=(0,N.cV)(Wn),el=(0,N.cV)(_a(Wn));var tl=h(92599),sl=h(35090);function nl(e){const s=e.dataFrames[0],{dataFrames:n,splitOpenFn:o,exploreId:r,scrollElement:i}=e,a=(0,p.useMemo)(()=>(0,sl.L)(s),[s]),l=(0,D.useSelector)(d=>d.explore.panes[e.exploreId]?.datasourceInstance??void 0);return a?(0,t.jsx)(Ae.NR,{padding:"none",title:"Trace",children:(0,t.jsx)(tl.V,{exploreId:r,dataFrames:n,splitOpenFn:o,scrollElement:i,traceProp:a,datasource:l})}):null}const ol=e=>({exploreMain:(0,g.css)({label:"exploreMain",position:"relative",marginTop:"21px",display:"flex",flexDirection:"column",gap:e.spacing(1)}),queryContainer:(0,g.css)({label:"queryContainer",padding:e.spacing(1)}),exploreContainer:(0,g.css)({label:"exploreContainer",display:"flex",flexDirection:"column",paddingRight:e.spacing(2),marginBottom:e.spacing(2)}),wrapper:(0,g.css)({position:"absolute",top:0,left:e.spacing(2),right:0,bottom:0,display:"flex"})});class rl extends p.PureComponent{constructor(s){super(s),this.onChangeTime=n=>{const{updateTimeRange:o,exploreId:r}=this.props;o({exploreId:r,rawRange:n})},this.onClickExample=n=>{this.props.setQueries(this.props.exploreId,[n])},this.onCellFilterAdded=n=>{const{value:o,key:r,operator:i}=n;i===Ft.mc&&this.onClickFilterLabel(r,o),i===Ft.Zi&&this.onClickFilterOutLabel(r,o)},this.onContentOutlineToogle=()=>{Ot.M.set(At.visible,!this.state.contentOutlineVisible),this.setState(n=>((0,P.rR)("explore_toolbar_contentoutline_clicked",{item:"outline",type:n.contentOutlineVisible?"close":"open"}),{contentOutlineVisible:!n.contentOutlineVisible}))},this.isFilterLabelActive=async(n,o,r)=>{const i=this.props.queries.find(l=>l.refId===r);if(!i)return!1;const a=await(0,Pe.l)().get(i.datasource);return!!((0,_.FP)(a)&&a.queryHasFilter(i,{key:n,value:o.toString()}))},this.onClickFilterLabel=(n,o,r)=>{this.onModifyQueries({type:"ADD_FILTER",options:{key:n,value:o.toString()},frame:r},r?.refId)},this.onClickFilterOutLabel=(n,o,r)=>{this.onModifyQueries({type:"ADD_FILTER_OUT",options:{key:n,value:o.toString()},frame:r},r?.refId)},this.onClickFilterString=(n,o)=>{this.onModifyQueries({type:"ADD_STRING_FILTER",options:{value:n.toString()}},o)},this.onClickFilterOutString=(n,o)=>{this.onModifyQueries({type:"ADD_STRING_FILTER_OUT",options:{value:n.toString()}},o)},this.onClickAddQueryRowButton=()=>{const{exploreId:n,queryKeys:o}=this.props;this.props.addQueryRow(n,o.length)},this.onModifyQueries=(n,o)=>{const r=async(i,a)=>{if(o&&o!==i.refId)return i;const{datasource:l}=i;if(l==null)return i;const d=await(0,Pe.l)().get(l),f=["ADD_FILTER","ADD_FILTER_OUT"];return(0,_.FP)(d)&&f.includes(a.type)?d.toggleQueryFilter(i,{type:a.type==="ADD_FILTER"?"FILTER_FOR":"FILTER_OUT",options:a.options??{},frame:a.frame}):d.modifyQuery?d.modifyQuery(i,a):i};this.props.modifyQueries(this.props.exploreId,n,r)},this.onResize=n=>{this.props.changeSize(this.props.exploreId,n)},this.onStartScanning=()=>{this.props.scanStart(this.props.exploreId)},this.onStopScanning=()=>{this.props.scanStopAction({exploreId:this.props.exploreId})},this.onUpdateTimeRange=n=>{const{exploreId:o,updateTimeRange:r}=this.props;r({exploreId:o,absoluteRange:n})},this.onSplitOpen=n=>async o=>{if(this.props.splitOpen(o),o&&this.props.datasourceInstance){const r=(await(0,Pe.l)().get(o.datasourceUid)).type,i=this.props.datasourceInstance.uid===Rt.uv?(0,oe.get)(this.props.queries,"0.datasource.type"):this.props.datasourceInstance.type,a={origin:"panel",panelType:n,source:i,target:r,exploreId:this.props.exploreId};(0,P.rR)("grafana_explore_split_view_opened",a)}},this.state={contentOutlineVisible:Ot.M.getBool(At.visible,!0)},this.graphEventBus=s.eventBus.newScopedBus("graph",{onlyLocal:!1}),this.logsEventBus=s.eventBus.newScopedBus("logs",{onlyLocal:!1})}renderEmptyState(s){return(0,t.jsx)("div",{className:(0,g.cx)(s),children:(0,t.jsx)(ja,{})})}renderNoData(){return(0,t.jsx)(va,{})}renderCustom(s){const{timeZone:n,queryResponse:o,eventBus:r}=this.props,i=(0,oe.groupBy)(o?.customFrames,"meta.preferredVisualisationPluginId");return Object.entries(i).map(([a,l],d)=>(0,t.jsx)(je,{panelId:a,title:a,icon:"plug",children:(0,t.jsx)(gr,{timeZone:n,pluginId:a,frames:l,state:o.state,timeRange:o.timeRange,height:400,width:s,splitOpenFn:this.onSplitOpen(a),eventBus:r},d)},d))}renderGraphPanel(s){const{graphResult:n,timeZone:o,queryResponse:r,showFlameGraph:i}=this.props;return(0,t.jsx)(je,{panelId:"Graph",title:"Graph",icon:"graph-bar",children:(0,t.jsx)(Vr.y,{data:n,height:i?180:400,width:s,timeRange:r.timeRange,timeZone:o,onChangeTime:this.onUpdateTimeRange,annotations:r.annotations,splitOpenFn:this.onSplitOpen("graph"),loadingState:r.state,eventBus:this.graphEventBus})})}renderTablePanel(s){const{exploreId:n,timeZone:o}=this.props;return(0,t.jsx)(je,{panelId:"Table",title:"Table",icon:"table",children:(0,t.jsx)(el,{ariaLabel:ot.Tp.pages.Explore.General.table,width:s,exploreId:n,onCellFilterAdded:this.onCellFilterAdded,timeZone:o,splitOpenFn:this.onSplitOpen("table")})})}renderRawPrometheus(s){const{exploreId:n,datasourceInstance:o,timeZone:r}=this.props;return(0,t.jsx)(je,{panelId:"Raw Prometheus",title:"Raw Prometheus",icon:"gf-prometheus",children:(0,t.jsx)(Va,{showRawPrometheus:!0,ariaLabel:ot.Tp.pages.Explore.General.table,width:s,exploreId:n,onCellFilterAdded:o?.modifyQuery?this.onCellFilterAdded:void 0,timeZone:r,splitOpenFn:this.onSplitOpen("table")})})}renderLogsPanel(s){const{exploreId:n,syncedTimes:o,theme:r,queryResponse:i}=this.props,a=parseInt(r.spacing(2).slice(0,-2),10),l=(0,g.css)({display:"flex",flexDirection:"column",gap:r.spacing(1)});return(0,t.jsx)(je,{panelId:"Logs",title:"Logs",icon:"gf-logs",className:l,children:(0,t.jsx)(ma,{exploreId:n,loadingState:i.state,syncedTimes:o,width:s-a,onClickFilterLabel:this.onClickFilterLabel,onClickFilterOutLabel:this.onClickFilterOutLabel,onStartScanning:this.onStartScanning,onStopScanning:this.onStopScanning,eventBus:this.logsEventBus,splitOpenFn:this.onSplitOpen("logs"),scrollElement:this.scrollElement,isFilterLabelActive:this.isFilterLabelActive,onClickFilterString:this.onClickFilterString,onClickFilterOutString:this.onClickFilterOutString,onPinLineCallback:()=>{this.setState({contentOutlineVisible:!0})}})})}renderLogsSamplePanel(){const{logsSample:s,timeZone:n,setSupplementaryQueryEnabled:o,exploreId:r,datasourceInstance:i,queries:a}=this.props;return(0,t.jsx)(je,{panelId:"Logs Sample",title:"Logs Sample",icon:"gf-logs",children:(0,t.jsx)(ya,{queryResponse:s.data,timeZone:n,enabled:s.enabled,queries:a,datasourceInstance:i,splitOpen:this.onSplitOpen("logsSample"),setLogsSampleEnabled:l=>o(r,l,_.cF.LogsSample)})})}renderNodeGraphPanel(){const{exploreId:s,showTrace:n,queryResponse:o,datasourceInstance:r}=this.props,i=r?r?.type:"unknown";return(0,t.jsx)(je,{panelId:"Node Graph",title:"Node Graph",icon:"code-branch",children:(0,t.jsx)(Ea,{dataFrames:o.nodeGraphFrames,exploreId:s,withTraceView:n,datasourceType:i,splitOpenFn:this.onSplitOpen("nodeGraph")})})}renderFlameGraphPanel(){const{queryResponse:s}=this.props;return(0,t.jsx)(je,{panelId:"Flame Graph",title:"Flame Graph",icon:"fire",children:(0,t.jsx)(Qr,{dataFrames:s.flameGraphFrames})})}renderTraceViewPanel(){const{queryResponse:s,exploreId:n}=this.props,o=s.series.filter(r=>r.meta?.preferredVisualisationType==="trace");return o.length&&(0,t.jsx)(je,{panelId:"Traces",title:"Traces",icon:"file-alt",children:(0,t.jsx)(nl,{exploreId:n,dataFrames:o,splitOpenFn:this.onSplitOpen("traceView"),scrollElement:this.scrollElement})})}render(){const{datasourceInstance:s,exploreId:n,graphResult:o,queryResponse:r,isLive:i,theme:a,showMetrics:l,showTable:d,showRawPrometheus:f,showLogs:c,showTrace:u,showCustom:x,showNodeGraph:m,showFlameGraph:C,showLogsSample:y,correlationEditorDetails:b,correlationEditorHelperData:S,showQueryInspector:L,setShowQueryInspector:w}=this.props,{contentOutlineVisible:v}=this.state,T=ol(a),R=r&&r.state!==ye.Gu.NotStarted,O=!(0,it.gQ)().queryHistoryAvailable,z=r.state===ye.Gu.Done&&[r.logsFrames,r.graphFrames,r.nodeGraphFrames,r.flameGraphFrames,r.tableFrames,r.rawPrometheusFrames,r.traceFrames,r.customFrames].every(W=>W.length===0);let k;const H=b?.editorMode;return!!(H||b?.correlationDirty)&&S!==void 0&&(k=(0,t.jsx)(lr,{exploreId:n,correlations:S})),(0,t.jsxs)(Jo,{refreshDependencies:this.props.queries,children:[(0,t.jsx)($r,{exploreId:n,onChangeTime:this.onChangeTime,onContentOutlineToogle:this.onContentOutlineToogle,isContentOutlineOpen:v}),(0,t.jsx)("div",{style:{position:"relative",height:"100%",paddingLeft:a.spacing(2)},children:(0,t.jsxs)("div",{className:T.wrapper,children:[v&&(0,t.jsx)(er,{scroller:this.scrollElement,panelId:`content-outline-container-${n}`}),(0,t.jsx)(Et.E,{testId:ot.Tp.pages.Explore.General.scrollView,scrollRefCallback:W=>this.scrollElement=W||void 0,hideHorizontalTrack:!0,children:(0,t.jsx)("div",{className:T.exploreContainer,children:s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(je,{panelId:"Queries",title:"Queries",icon:"arrow",mergeSingleChild:!0,children:(0,t.jsxs)(os._,{className:T.queryContainer,children:[k,(0,t.jsx)(Aa,{exploreId:n}),(0,t.jsx)(Ja,{addQueryRowButtonDisabled:i||H&&s.meta.mixed,addQueryRowButtonHidden:!1,richHistoryRowButtonHidden:O,queryInspectorButtonActive:L,onClickAddQueryRowButton:this.onClickAddQueryRowButton,onClickQueryInspectorButton:()=>w(!L)}),(0,t.jsx)(Ka,{exploreId:n})]})}),(0,t.jsx)(Go.Ay,{onResize:this.onResize,disableHeight:!0,children:({width:W})=>W===0?null:(0,t.jsx)("main",{className:(0,g.cx)(T.exploreMain),style:{width:W},children:(0,t.jsx)(ue.Xw,{children:R&&(0,t.jsxs)(t.Fragment,{children:[l&&o&&(0,t.jsx)(ue.Xw,{children:this.renderGraphPanel(W)}),f&&(0,t.jsx)(ue.Xw,{children:this.renderRawPrometheus(W)}),d&&(0,t.jsx)(ue.Xw,{children:this.renderTablePanel(W)}),c&&(0,t.jsx)(ue.Xw,{children:this.renderLogsPanel(W)}),m&&(0,t.jsx)(ue.Xw,{children:this.renderNodeGraphPanel()}),C&&(0,t.jsx)(ue.Xw,{children:this.renderFlameGraphPanel()}),u&&(0,t.jsx)(ue.Xw,{children:this.renderTraceViewPanel()}),y&&(0,t.jsx)(ue.Xw,{children:this.renderLogsSamplePanel()}),x&&(0,t.jsx)(ue.Xw,{children:this.renderCustom(W)}),z&&(0,t.jsx)(ue.Xw,{children:this.renderNoData()})]})})})})]}):this.renderEmptyState(T.exploreContainer)})})]})})]})}}function il(e,{exploreId:s}){const n=e.explore,{syncedTimes:o}=n,r=n.panes[s],i=(0,Dt.O)(e.user),{datasourceInstance:a,queryKeys:l,queries:d,isLive:f,graphResult:c,tableResult:u,logsResult:x,showLogs:m,showMetrics:C,showTable:y,showTrace:b,showCustom:S,queryResponse:L,showNodeGraph:w,showFlameGraph:v,showRawPrometheus:T,supplementaryQueries:R,correlationEditorHelperData:O}=r,z=(0,Y.h1)(s)(e),k=R[_.cF.LogsSample],H=!!(k.dataProvider!==void 0&&!x&&(c||u));return{datasourceInstance:a,queryKeys:l,queries:d,isLive:f,graphResult:c,logsResult:x??void 0,queryResponse:L,syncedTimes:o,timeZone:i,showLogs:m,showMetrics:C,showTable:y,showTrace:b,showCustom:S,showNodeGraph:w,showRawPrometheus:T,showFlameGraph:v,splitted:(0,J.pF)(e),loading:z,logsSample:k,showLogsSample:H,correlationEditorHelperData:O,correlationEditorDetails:n.correlationEditorDetails}}const al={changeSize:De.QZ,modifyQueries:Y.PD,scanStart:Y.GI,scanStopAction:Y.q9,setQueries:Y.Rk,updateTimeRange:ve.GH,addQueryRow:Y._0,splitOpen:Z.ve,setSupplementaryQueryEnabled:Y.TO},ll=(0,Ce.connect)(il,al),cl=(0,N.cV)(ll(rl));var Vn=h(60734),dl=h(61453),ul=h(82344),pl=h(61396),hl=h(32067),gl=h(90820);function fl(e){const{onClose:s,queryResponse:n,timeZone:o,isMixed:r,exploreId:i}=e,[a,l]=(0,p.useState)({withTransforms:!1,withFieldConfig:!0}),d=n?.series||[];let f=n?.errors;!f?.length&&n?.error&&(f=[n.error]);const c=(0,N.of)(xl);(0,p.useEffect)(()=>{(0,P.rR)("grafana_explore_query_inspector_opened")},[]);const u={label:"Stats",value:"stats",icon:"chart-line",content:(0,t.jsx)(hl.N,{data:n,timeZone:n?.request?.timezone??K.vp})},x={label:"JSON",value:"json",icon:"brackets-curly",content:(0,t.jsx)(pl.w,{data:n,onClose:s})},m={label:"Data",value:"data",icon:"database",content:(0,t.jsx)(dl.q,{data:d,dataName:"Explore",isLoading:n.state===ye.Gu.Loading,options:a,timeZone:o,app:me.Jk.Explore,formattedDataDescription:"Matches the format in the panel",onOptionsChange:l})},C={label:"Query",value:"query",icon:"info-circle",content:(0,t.jsx)("div",{className:c.queryInspectorWrapper,children:(0,t.jsx)(gl.e,{instanceId:r?(0,Rt.qM)(0,(0,rt.uq)(i)):(0,rt.uq)(i),data:n,onRefreshQuery:()=>e.runQueries({exploreId:i})})})},y=[u,C,x,m];if(f?.length){const b={label:"Error",value:"error",icon:"exclamation-triangle",content:(0,t.jsx)(ul.y,{errors:f})};y.push(b)}return(0,t.jsx)(Ks,{children:(0,t.jsx)(Vn.q,{tabs:y,onClose:s,closeIconTooltip:"Close query inspector"})})}function ml(e,{exploreId:s}){const o=e.explore.panes[s],{queryResponse:r}=o;return{queryResponse:r,isMixed:o.datasourceInstance?.meta.mixed||!1}}const yl={runQueries:Y.Od},xl=e=>({queryInspectorWrapper:(0,g.css)({paddingBottom:e.spacing(3)})}),vl=(0,Ce.connect)(ml,yl)(fl),bl=(0,g.css)({label:"explorePaneContainer",display:"flex",flexDirection:"column",minWidth:"600px",height:"100%"});function Sl({exploreId:e}){Rl(e);const s=(0,p.useRef)(new Uo.o),n=(0,p.useRef)(null),[o,r]=(0,p.useState)(!1);return(0,p.useEffect)(()=>{const i=s.current;return()=>i.removeAllListeners()},[]),(0,t.jsx)(Et.E,{hideVerticalTrack:!0,children:(0,t.jsxs)("div",{className:bl,ref:n,"data-testid":ot.Tp.pages.Explore.General.container,children:[(0,t.jsx)(cl,{exploreId:e,eventBus:s.current,showQueryInspector:o,setShowQueryInspector:r}),o&&(0,t.jsx)(vl,{exploreId:e,onClose:()=>r(!1),timeZone:(0,Ys.O)()})]})})}function Cl(e,s){return{pane:e.explore.panes[s.exploreId]}}const jl=(0,Ce.connect)(Cl)(Sl);function Rl(e){const s=(0,p.useMemo)(()=>(0,J.qq)(e),[e]),n=(0,p.useRef)();n.current=(0,D.useSelector)(s),(0,p.useEffect)(()=>()=>{(0,rt._u)(n.current?.querySubscription)},[])}var qn=h(26272),Ie=h(3591),wl=h(55882),Un=h(21744),le=h(81523),Tl=h(2858),Ll=h(56389);const Il=()=>({kind:"QueryTemplateList",apiVersion:"peakq.grafana.app/v0alpha1",metadata:{resourceVersion:"1783293408052252672",remainingItemCount:0},items:[{kind:"QueryTemplate",apiVersion:"peakq.grafana.app/v0alpha1",metadata:{name:"AElastic2nkf9",generateName:"AElastic",namespace:"default",uid:"65327fce-c545-489d-ada5-16f909453d12",resourceVersion:"1783293341664808960",creationTimestamp:"2024-04-25T20:32:58Z",annotations:{"grafana.app/createdBy":"user:1:admin"}},spec:{title:"Elastic Query Template",targets:[{variables:{},properties:{refId:"A",datasource:{type:"elasticsearch",uid:"elastic-uid"},alias:"",metrics:[{id:"1",type:"count"}],bucketAggs:[{field:"@timestamp",id:"2",settings:{interval:"auto"},type:"date_histogram"}],timeField:"@timestamp",query:"test:test "}}]}},{kind:"QueryTemplate",apiVersion:"peakq.grafana.app/v0alpha1",metadata:{name:"ALoki296tj",generateName:"ALoki",namespace:"default",uid:"3e71de65-efa7-40e3-8f23-124212cca455",resourceVersion:"1783214217151647744",creationTimestamp:"2024-04-25T11:05:55Z",annotations:{"grafana.app/createdBy":"user:1:admin"}},spec:{title:"Loki Query Template",vars:[{key:"__value",defaultValues:[""],valueListDefinition:{customValues:""}}],targets:[{variables:{__value:[{path:"$.datasource.jsonData.derivedFields.0.url",position:{start:0,end:14},format:"raw"},{path:"$.datasource.jsonData.derivedFields.1.url",position:{start:0,end:14},format:"raw"},{path:"$.datasource.jsonData.derivedFields.2.url",position:{start:0,end:14},format:"raw"}]},properties:{refId:"A",datasource:{type:"loki",uid:"loki-uid"},queryType:"range",editorMode:"code",expr:'{test="test"}'}}]}}]}),El={all:{url:Ll.C1,response:Il()}},{useAllQueryTemplatesQuery:Ol,useAddQueryTemplateMutation:Fl,useDeleteQueryTemplateMutation:Dl}=Tl.g;function Al(){return Q.$.featureToggles.queryLibrary}const md={data:El};function Is(e){const{value:s}=(0,kt.A)(async()=>await(0,Pe.l)().get(e),[e]);return s}const Nl=[{value:"Public",label:(0,j.t)("explore.query-library.public","Public")},{value:"Private",label:(0,j.t)("explore.query-library.private","Private")}],Pl=(0,j.t)("explore.add-to-library-modal.info","You're about to save this query. Once saved, you can easily access it in the Query Library tab for future use and reference."),Gn=({onCancel:e,onSave:s,query:n})=>{const{register:o,handleSubmit:r}=(0,at.mN)(),[i]=Fl(),a=async c=>i(c).unwrap().then(()=>((0,Ie.J7)().publish({type:qn.r1.alertSuccess.name,payload:[(0,j.t)("explore.query-library.query-template-added","Query template successfully added to the library")]}),!0)).catch(()=>((0,Ie.J7)().publish({type:qn.r1.alertError.name,payload:[(0,j.t)("explore.query-library.query-template-error","Error attempting to add this query to the library")]}),!1)),l=Is(n.datasource),d=(0,p.useMemo)(()=>l?.getQueryDisplayText?.(n)||(0,le.ev)(n),[l,n]),f=async c=>{const u=(0,Me.KQ)().toISOString(),x=c.description||(0,j.t)("explore.query-library.default-description","Public",{timestamp:u});a({title:x,targets:[n]}).then(m=>{s(m)})};return(0,t.jsxs)("form",{onSubmit:r(f),children:[(0,t.jsx)("p",{children:Pl}),(0,t.jsx)(pe.D,{label:(0,j.t)("explore.add-to-library-modal.query","Query"),children:(0,t.jsx)(Un.f,{readOnly:!0,value:d})}),(0,t.jsx)(pe.D,{label:(0,j.t)("explore.add-to-library-modal.data-source-name","Data source name"),children:(0,t.jsx)(wl.s,{current:l?.uid,disabled:!0})}),(0,t.jsx)(pe.D,{label:(0,j.t)("explore.add-to-library-modal.data-source-type","Data source type"),children:(0,t.jsx)(Ve.p,{disabled:!0,defaultValue:l?.meta.name})}),(0,t.jsx)(pe.D,{label:(0,j.t)("explore.add-to-library-modal.description","Description"),children:(0,t.jsx)(Ve.p,{id:"query-template-description",autoFocus:!0,...o("description")})}),(0,t.jsx)(pe.D,{label:(0,j.t)("explore.add-to-library-modal.visibility","Visibility"),children:(0,t.jsx)(pt.z,{options:Nl,value:"Public",disabled:!0})}),(0,t.jsx)(ze.K,{showLabel:!0,disabled:!0,label:(0,j.t)("explore.add-to-library-modal.auto-star","Auto-star this query to add it to your starred list in the Query Library.")}),(0,t.jsxs)(Qe.a.ButtonRow,{children:[(0,t.jsx)(q.$n,{variant:"secondary",onClick:()=>e(),fill:"outline",children:(0,t.jsx)(j.x6,{i18nKey:"explore.query-library.cancel",children:"Cancel"})}),(0,t.jsx)(q.$n,{variant:"primary",type:"submit",children:(0,t.jsx)(j.x6,{i18nKey:"explore.query-library.save",children:"Save"})})]})]})};var Ee=h(72433),Kn=h(69529),kl=h(48840),Gt=h(82467),Kt=h(3169),He=h(28444),yt=h(76412);const Ml={setQueries:Y.Rk,changeDatasource:We.wh},zl=(0,Ce.connect)(void 0,Ml);function Hl({rootDatasourceUid:e,queries:s,disabled:n=!1,onClick:o,changeDatasource:r,setQueries:i}){const[a,l]=(0,p.useState)(!1),d=(0,D.useSelector)(J.pF),f=(0,D.useSelector)(J.Kl),c=(0,D.useSelector)(J.K6),u=(y,b)=>!f.dsToExplore.find(S=>S.datasource.uid===y)?.exploreIds.includes(b),x=(y,b)=>b!==void 0&&y!==void 0&&u(b,y)?{fallbackText:"Switch data source and run query",translation:(0,yt.t)("explore.run-query.switch-datasource-button","Switch data source and run query")}:{fallbackText:"Run query",translation:(0,yt.t)("explore.run-query.run-query-button","Run query")},m=async y=>{const b=u(e,y);b&&await r({exploreId:y,datasource:e}),i(y,s),(0,P.rR)("grafana_explore_query_history_run",{queryHistoryEnabled:Q.$.queryHistoryEnabled,differentDataSource:b})},C=()=>{const y=n||s.length===0||e===void 0;if(d){const b=(0,t.jsx)(Re.W,{children:c.map((S,L)=>{const w=x(S[0],e),v=L===0?(0,yt.t)("explore.run-query.left-pane","Left pane"):(0,yt.t)("explore.run-query.right-pane","Right pane");return(0,t.jsx)(Re.W.Item,{ariaLabel:w.fallbackText,onClick:()=>{m(S[0]),o?.()},label:`${v}: ${w.translation}`,disabled:y||S[0]===void 0},L)})});return(0,t.jsx)(ct.m,{onVisibleChange:S=>l(S),placement:"bottom-start",overlay:b,children:(0,t.jsx)(re.I,{"aria-label":"run query options",variant:"canvas",isOpen:a,children:(0,yt.t)("explore.run-query.run-query-button","Run query")})})}else{const b=f.exploreToDS[0]?.exploreId,S=x(b,e);return(0,t.jsx)(q.$n,{variant:"secondary","aria-label":S.translation,onClick:()=>{m(b),o?.()},disabled:y||b===void 0,children:S.translation})}};return(0,t.jsx)(t.Fragment,{children:C()})}const Yn=zl(Hl),xt=()=>(0,N.of)($l),$l=e=>({logo:(0,g.css)({marginRight:e.spacing(2),width:"16px"}),header:(0,g.css)({margin:0,fontSize:e.typography.h5.fontSize,color:e.colors.text.secondary}),mainText:(0,g.css)({margin:0,fontSize:e.typography.body.fontSize,textOverflow:"ellipsis"}),otherText:(0,g.css)({margin:0,fontSize:e.typography.body.fontSize,color:e.colors.text.secondary,textOverflow:"ellipsis"}),singleLine:(0,g.css)({display:"-webkit-box",WebkitBoxOrient:"vertical",WebkitLineClamp:1,overflow:"hidden"}),cell:(0,g.css)({display:"flex",alignItems:"center","&:last-child":{justifyContent:"end"}}),actionButton:(0,g.css)({padding:e.spacing(1)})});function Bl({query:e,rootDatasourceUid:s,queryUid:n}){const[o]=Dl(),{setDrawerOpened:r}=et(),i=xt(),a=l=>{const d=f=>{o({uid:f}),(0,st.JD)((0,Gt.dx)((0,Kt.tZ)((0,j.t)("explore.query-library.query-deleted","Query deleted")))),(0,P.rR)("grafana_explore_query_library_deleted")};(0,Ie.J7)().publish(new He.bY({title:(0,j.t)("explore.query-library.delete-query-title","Delete query"),text:(0,j.t)("explore.query-library.delete-query-text","You're about to remove this query from the query library. This action cannot be undone. Do you want to continue?"),yesText:(0,j.t)("query-library.delete-query-button","Delete query"),icon:"trash-alt",onConfirm:()=>d(l)}))};return(0,t.jsxs)("div",{className:i.cell,children:[(0,t.jsx)(qe.K,{className:i.actionButton,size:"lg",name:"trash-alt",title:(0,j.t)("explore.query-library.delete-query","Delete query"),tooltip:(0,j.t)("explore.query-library.delete-query","Delete query"),onClick:()=>{n&&a(n)}}),(0,t.jsx)(Yn,{queries:e?[e]:[],rootDatasourceUid:s,onClick:()=>r(!1)})]})}const Ql=Bl;function Wl(e){const s=xt();return(0,t.jsx)("div",{children:(0,t.jsx)("span",{className:s.otherText,children:e.user||"Unknown"})})}function Vl(e){const s=Is(e.row.original.datasourceRef),n=xt();return(0,t.jsx)("p",{className:n.otherText,children:s?.meta.name})}function ql(e){const s=xt(),n=(0,Me.KQ)(e.row.original.createdAtTimestamp).format("YYYY-MM-DD HH:mm:ss");return(0,t.jsx)("p",{className:s.otherText,children:n})}function Ul(e){const s=Is(e.row.original.datasourceRef),n=xt();if(!s)return(0,t.jsx)(gt.y,{});if(!e.row.original.query)return(0,t.jsx)("div",{children:"No queries"});const o=e.row.original.query,r=s?.getQueryDisplayText?.(o)||"",i=e.row.original.description,a=s?.name||"";return(0,t.jsxs)("div",{"aria-label":`Query template for ${a}: ${i}`,children:[(0,t.jsxs)("p",{className:n.header,children:[(0,t.jsx)("img",{className:n.logo,src:s?.meta.info.logos.small||"public/img/icn-datasource.svg",alt:s?.meta.info.description}),a]}),(0,t.jsx)(Se.m,{content:r,placement:"bottom-start",children:(0,t.jsx)("p",{className:(0,g.cx)(n.mainText,n.singleLine),children:r})}),(0,t.jsx)("p",{className:(0,g.cx)(n.otherText,n.singleLine),children:i})]})}const Gl=[{id:"description",header:"Data source and query",cell:Ul},{id:"addedBy",header:"Added by",cell:({row:{original:e}})=>(0,t.jsx)(Wl,{user:e.user})},{id:"datasourceType",header:"Datasource type",cell:Vl,sortType:"string"},{id:"createdAtTimestamp",header:"Date added",cell:ql,sortType:(e,s,n,o)=>{const r=e.original.createdAtTimestamp||0,i=s.original.createdAtTimestamp||0;return o?r-i:i-r}},{id:"actions",header:"",cell:({row:{original:e}})=>(0,t.jsx)(Ql,{query:e.query,rootDatasourceUid:e.datasourceRef?.uid,queryUid:e.uid})}],Kl={tableWithSpacing:(0,g.css)({"th:first-child":{width:"50%"}})};function Yl({queryTemplateRows:e}){return(0,t.jsx)(kl.j,{className:Kl.tableWithSpacing,columns:Gl,data:e,getRowId:s=>s.index})}function Zl(){const{data:e,isLoading:s,error:n}=Ol();if(n)return(0,t.jsx)(Kn.p,{variant:"not-found",message:"Something went wrong",children:n.message});if(s)return(0,t.jsx)(gt.y,{});if(!e||e.length===0)return(0,t.jsx)(Kn.p,{message:"Query Library",variant:"not-found",children:(0,t.jsx)("p",{children:"You haven't saved any queries to your library yet. Start adding them from Explore or your Query History tab."})});const o=e.map((r,i)=>{const a=r.targets[0]?.datasource,l=(0,$n.tR)().getInstanceSettings(a)?.meta.name||"";return{index:i.toString(),uid:r.uid,datasourceRef:a,datasourceType:l,createdAtTimestamp:r?.createdAtTimestamp||0,query:r.targets[0],description:r.title,user:r.user}});return(0,t.jsx)(Yl,{queryTemplateRows:o})}function Jl(){return(0,t.jsx)(Zl,{})}var Xl=h(47097),Zn=h(67647),Jn=h(72635);const _l=({query:e})=>{const[s,n]=(0,p.useState)(!1),[o,r]=(0,p.useState)(!1),i=(0,Jn.t)("explore.rich-history-card.add-to-library","Add to library");return Al()&&!o?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(q.$n,{variant:"secondary","aria-label":i,onClick:()=>n(!0),children:i}),(0,t.jsx)(Qe.a,{title:(0,Jn.t)("explore.add-to-library-modal.title","Add query to Query Library"),isOpen:s,onDismiss:()=>n(!1),children:(0,t.jsx)(Gn,{onCancel:()=>n(()=>!1),query:e,onSave:a=>{a&&(n(!1),r(!0))}})})]}):void 0},ec={changeDatasource:We.wh,deleteHistoryItem:Ee.VM,commentHistoryItem:Ee.H9,starHistoryItem:Ee.sh,setQueries:Y.Rk},tc=(0,Ce.connect)(void 0,ec),sc=e=>{const s="240px",n="170px",o=e.colors.background.secondary;return{queryCard:(0,g.css)`
      position: relative;
      display: flex;
      flex-direction: column;
      border: 1px solid ${e.colors.border.weak};
      margin: ${e.spacing(1)} 0;
      background-color: ${o};
      border-radius: ${e.shape.radius.default};
      .starred {
        color: ${e.v1.palette.orange};
      }
    `,cardRow:(0,g.css)`
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: ${e.spacing(1)};
      border-bottom: none;
      :first-of-type {
        border-bottom: 1px solid ${e.colors.border.weak};
        padding: ${e.spacing(.5,1)};
      }
      img {
        height: ${e.typography.fontSize}px;
        max-width: ${e.typography.fontSize}px;
        margin-right: ${e.spacing(1)};
      }
    `,queryActionButtons:(0,g.css)`
      max-width: ${n};
      display: flex;
      justify-content: flex-end;
      font-size: ${e.typography.size.base};
      button {
        margin-left: ${e.spacing(1)};
      }
    `,queryContainer:(0,g.css)`
      font-weight: ${e.typography.fontWeightMedium};
      width: calc(100% - ${s});
    `,updateCommentContainer:(0,g.css)`
      width: calc(100% + ${s});
      margin-top: ${e.spacing(1)};
    `,comment:(0,g.css)`
      overflow-wrap: break-word;
      font-size: ${e.typography.bodySmall.fontSize};
      font-weight: ${e.typography.fontWeightRegular};
      margin-top: ${e.spacing(.5)};
    `,commentButtonRow:(0,g.css)`
      > * {
        margin-top: ${e.spacing(1)};
        margin-right: ${e.spacing(1)};
      }
    `,textArea:(0,g.css)`
      width: 100%;
    `,runButton:(0,g.css)`
      max-width: ${n};
      display: flex;
      justify-content: flex-end;
      button {
        height: auto;
        padding: ${e.spacing(.5,2)};
        line-height: 1.4;
        span {
          white-space: normal !important;
        }
      }
    `,loader:(0,g.css)`
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background-color: ${e.colors.background.secondary};
    `}};function nc(e){const{queryHistoryItem:s,commentHistoryItem:n,starHistoryItem:o,deleteHistoryItem:r,datasourceInstances:i}=e,[a,l]=(0,p.useState)(!1),[d,f]=(0,p.useState)(s.comment),c=(0,N.of)(sc),u=i?i.find(R=>R.uid===s.datasourceUid):void 0,x=async()=>{const R=[...s.queries.map(z=>z.datasource?.type||"unknown")];(0,P.rR)("grafana_explore_query_history_copy_query",{datasources:R,mixed:!!u?.meta.mixed});const O=s.queries.map(z=>{let k=i?.find(H=>H.uid===s.datasourceUid);return k?.meta.mixed&&(k=i?.find(H=>H.uid===z.datasource?.uid)),(0,le.Ax)(z,k)}).join(`
`);(0,rt.uJ)(O),(0,st.JD)((0,Gt.dx)((0,Kt.tZ)((0,j.t)("explore.rich-history-notification.query-copied","Query copied to clipboard"))))},m=async()=>{const R=(0,le.U3)(s);await(0,ps.VP)(R)},C=()=>{const R=O=>{r(O),(0,st.JD)((0,Gt.dx)((0,Kt.tZ)((0,j.t)("explore.rich-history-notification.query-deleted","Query deleted")))),(0,P.rR)("grafana_explore_query_history_deleted",{queryHistoryEnabled:Q.$.queryHistoryEnabled})};s.starred?(0,Ie.J7)().publish(new He.bY({title:(0,j.t)("explore.rich-history-card.delete-query-confirmation-title","Delete"),text:(0,j.t)("explore.rich-history-card.delete-starred-query-confirmation-text","Are you sure you want to permanently delete your starred query?"),yesText:(0,j.t)("explore.rich-history-card.confirm-delete","Delete"),icon:"trash-alt",onConfirm:()=>R(s.id)})):R(s.id)},y=()=>{o(s.id,!s.starred),(0,P.rR)("grafana_explore_query_history_starred",{queryHistoryEnabled:Q.$.queryHistoryEnabled,newValue:!s.starred})},b=()=>l(!a),S=()=>{n(s.id,d),l(!1),(0,P.rR)("grafana_explore_query_history_commented",{queryHistoryEnabled:Q.$.queryHistoryEnabled})},L=()=>{l(!1),f(s.comment)},w=R=>{R.key==="Enter"&&(R.shiftKey||R.ctrlKey)&&S(),R.key==="Escape"&&L()},v=(0,t.jsxs)("div",{className:c.updateCommentContainer,"aria-label":d?(0,j.t)("explore.rich-history-card.update-comment-form","Update comment form"):(0,j.t)("explore.rich-history-card.add-comment-form","Add comment form"),children:[(0,t.jsx)(Un.f,{onKeyDown:w,value:d,placeholder:d?void 0:(0,j.t)("explore.rich-history-card.optional-description","An optional description of what the query does."),onChange:R=>f(R.currentTarget.value),className:c.textArea}),(0,t.jsxs)("div",{className:c.commentButtonRow,children:[(0,t.jsx)(q.$n,{onClick:S,children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-card.save-comment",children:"Save comment"})}),(0,t.jsx)(q.$n,{variant:"secondary",onClick:L,children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-card.cancel",children:"Cancel"})})]})]}),T=(0,t.jsxs)("div",{className:c.queryActionButtons,children:[(0,t.jsx)(qe.K,{name:"comment-alt",onClick:b,tooltip:s.comment?.length>0?(0,j.t)("explore.rich-history-card.edit-comment-tooltip","Edit comment"):(0,j.t)("explore.rich-history-card.add-comment-tooltip","Add comment")}),(0,t.jsx)(qe.K,{name:"copy",onClick:x,tooltip:(0,j.t)("explore.rich-history-card.copy-query-tooltip","Copy query to clipboard")}),u&&(0,t.jsx)(qe.K,{name:"share-alt",onClick:m,tooltip:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-card.copy-shortened-link-tooltip",children:"Copy shortened link to clipboard"})}),(0,t.jsx)(qe.K,{name:"trash-alt",title:(0,j.t)("explore.rich-history-card.delete-query-title","Delete query"),tooltip:(0,j.t)("explore.rich-history-card.delete-query-tooltip","Delete query"),onClick:C}),(0,t.jsx)(qe.K,{name:s.starred?"favorite":"star",iconType:s.starred?"mono":"default",onClick:y,tooltip:s.starred?(0,j.t)("explore.rich-history-card.unstar-query-tooltip","Unstar query"):(0,j.t)("explore.rich-history-card.star-query-tooltip","Star query")})]});return(0,t.jsxs)("div",{className:c.queryCard,children:[(0,t.jsxs)("div",{className:c.cardRow,children:[(0,t.jsx)(Xn,{dsApi:u,size:"sm"}),T]}),(0,t.jsxs)("div",{className:(0,g.cx)(c.cardRow),children:[(0,t.jsxs)("div",{className:c.queryContainer,children:[s?.queries.map((R,O)=>{const z=i?.find(k=>k.uid===R.datasource?.uid);return(0,t.jsx)(rc,{query:{query:R,datasource:z},showDsInfo:u?.meta.mixed},`${R}-${O}`)}),!a&&s.comment&&(0,t.jsx)("div",{"aria-label":(0,j.t)("explore.rich-history-card.query-comment-label","Query comment"),className:c.comment,children:s.comment}),a&&v]}),!a&&(0,t.jsx)(_l,{query:s?.queries[0]}),!a&&(0,t.jsx)("div",{className:c.runButton,children:(0,t.jsx)(Yn,{queries:s.queries,rootDatasourceUid:u?.uid})})]})]})}const oc=e=>({queryRow:(0,g.css)`
    border-top: 1px solid ${e.colors.border.weak};
    display: flex;
    flex-direction: row;
    padding: 4px 0px;
    gap: 4px;
    :first-child {
      border-top: none;
    }
  `,dsInfoContainer:(0,g.css)`
    display: flex;
    align-items: center;
  `,queryText:(0,g.css)`
    word-break: break-all;
  `}),rc=({query:e,showDsInfo:s=!1})=>{const n=(0,N.of)(oc);return(0,t.jsxs)("div",{className:n.queryRow,children:[s&&(0,t.jsxs)("div",{className:n.dsInfoContainer,children:[(0,t.jsx)(Xn,{dsApi:e.datasource,size:"md"}),": "]}),(0,t.jsx)("span",{"aria-label":(0,j.t)("explore.rich-history-card.query-text-label","Query text"),className:n.queryText,children:(0,le.Ax)(e.query,e.datasource)})]})},ic=e=>s=>(0,g.css)`
  display: flex;
  align-items: center;
  font-size: ${s.typography[e==="sm"?"bodySmall":"body"].fontSize};
  font-weight: ${s.typography.fontWeightMedium};
  white-space: nowrap;
`;function Xn({dsApi:e,size:s}){const n=(0,p.useCallback)(r=>ic(s)(r),[s]),o=(0,N.of)(n);return(0,t.jsxs)("div",{className:o,children:[(0,t.jsx)("img",{src:e?.meta.info.logos.small||"public/img/icn-datasource.svg",alt:e?.type||(0,j.t)("explore.rich-history-card.datasource-not-exist","Data source does not exist anymore"),"aria-label":(0,j.t)("explore.rich-history-card.datasource-icon-label","Data source icon")}),(0,t.jsx)("div",{"aria-label":(0,j.t)("explore.rich-history-card.datasource-name-label","Data source name"),children:e?.name||(0,j.t)("explore.rich-history-card.datasource-not-exist","Data source does not exist anymore")})]})}const _n=tc(nc),ac=(e,s)=>({container:(0,g.css)`
      display: flex;
    `,labelSlider:(0,g.css)`
      font-size: ${e.typography.bodySmall.fontSize};
      &:last-of-type {
        margin-top: ${e.spacing(3)};
      }
      &:first-of-type {
        font-weight: ${e.typography.fontWeightMedium};
        margin-bottom: ${e.spacing(2)};
      }
    `,containerContent:(0,g.css)`
      /* 134px is based on the width of the Query history tabs bar, so the content is aligned to right side of the tab */
      width: calc(100% - 134px);
    `,containerSlider:(0,g.css)`
      width: 129px;
      margin-right: ${e.spacing(1)};
    `,fixedSlider:(0,g.css)`
      position: fixed;
    `,slider:(0,g.css)`
      bottom: 10px;
      height: ${s-180}px;
      width: 129px;
      padding: ${e.spacing(1)} 0;
    `,selectors:(0,g.css)`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,filterInput:(0,g.css)`
      margin-bottom: ${e.spacing(1)};
    `,multiselect:(0,g.css)`
      width: 100%;
      margin-bottom: ${e.spacing(1)};
    `,sort:(0,g.css)`
      width: 170px;
    `,sessionName:(0,g.css)`
      display: flex;
      align-items: flex-start;
      justify-content: flex-start;
      margin-top: ${e.spacing(3)};
      h4 {
        margin: 0 10px 0 0;
      }
    `,heading:(0,g.css)`
      font-size: ${e.typography.h4.fontSize};
      margin: ${e.spacing(2,.25,1,.25)};
    `,footer:(0,g.css)`
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: ${e.typography.fontWeightLight};
      font-size: ${e.typography.bodySmall.fontSize};
      a {
        font-weight: ${e.typography.fontWeightMedium};
        margin-left: ${e.spacing(.25)};
      }
    `,queries:(0,g.css)`
      font-size: ${e.typography.bodySmall.fontSize};
      font-weight: ${e.typography.fontWeightRegular};
      margin-left: ${e.spacing(.5)};
    `});function lc(e){const{queries:s,totalQueries:n,loading:o,richHistorySearchFilters:r,updateFilters:i,clearRichHistoryResults:a,loadMoreRichHistory:l,richHistorySettings:d,height:f}=e,c=(0,D.useSelector)(J.Kl),u=(0,N.of)(ac,f),x=(0,le.TR)();(0,p.useEffect)(()=>{const w=!d.activeDatasourcesOnly&&d.lastUsedDatasourceFilters?d.lastUsedDatasourceFilters:c.dsToExplore.map(T=>x.find(R=>R.uid===T.datasource?.uid)?.name).filter(T=>!!T),v={search:"",sortOrder:le.xB.Descending,datasourceFilters:w,from:0,to:d.retentionPeriod,starred:!1};return i(v),()=>{a()}},[]);const{value:m,loading:C}=(0,kt.A)(async()=>{const v=x.map(T=>T.uid).map(async T=>{try{return(0,Pe.l)().get(T)}catch{return Promise.resolve()}});return v!==void 0?(await Promise.all(v)).filter(R=>!!R):[]},[r?.datasourceFilters]);if(!r)return(0,t.jsx)("span",{children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-queries-tab.loading",children:"Loading..."})});const y=(0,le.x8)(s,r.sortOrder),b=to(),S=s.length&&s.length!==n,L=[r.from||0,r.to||d.retentionPeriod];return(0,t.jsxs)("div",{className:u.container,children:[(0,t.jsx)("div",{className:u.containerSlider,children:(0,t.jsxs)("div",{className:u.fixedSlider,children:[(0,t.jsx)("div",{className:u.labelSlider,children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-queries-tab.filter-history",children:"Filter history"})}),(0,t.jsx)("div",{className:u.labelSlider,children:(0,le.IA)(L[0])}),(0,t.jsx)("div",{className:u.slider,children:(0,t.jsx)(Xl.F,{tooltipAlwaysVisible:!1,min:0,max:d.retentionPeriod,value:L,orientation:"vertical",formatTooltipResult:le.IA,reverse:!0,onAfterChange:w=>{i({from:w[0],to:w[1]})}})}),(0,t.jsx)("div",{className:u.labelSlider,children:(0,le.IA)(L[1])})]})}),(0,t.jsxs)("div",{className:u.containerContent,"data-testid":"query-history-queries-tab",children:[(0,t.jsxs)("div",{className:u.selectors,children:[!d.activeDatasourcesOnly&&(0,t.jsx)(ke.KF,{className:u.multiselect,options:x.map(w=>({value:w.name,label:w.name})),value:r.datasourceFilters,placeholder:(0,j.t)("explore.rich-history-queries-tab.filter-placeholder","Filter queries for data sources(s)"),"aria-label":(0,j.t)("explore.rich-history-queries-tab.filter-aria-label","Filter queries for data sources(s)"),onChange:w=>{i({datasourceFilters:w.map(v=>v.value)})}}),(0,t.jsx)("div",{className:u.filterInput,children:(0,t.jsx)(Zn.Z,{escapeRegex:!1,placeholder:(0,j.t)("explore.rich-history-queries-tab.search-placeholder","Search queries"),value:r.search,onChange:w=>i({search:w})})}),(0,t.jsx)("div",{"aria-label":(0,j.t)("explore.rich-history-queries-tab.sort-aria-label","Sort queries"),className:u.sort,children:(0,t.jsx)(ke.l6,{value:b.filter(w=>w.value===r.sortOrder),options:b,placeholder:(0,j.t)("explore.rich-history-queries-tab.sort-placeholder","Sort queries by"),onChange:w=>i({sortOrder:w.value})})})]}),(o||C)&&(0,t.jsx)("span",{children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-queries-tab.loading-results",children:"Loading results..."})}),!(o||C)&&Object.keys(y).map(w=>(0,t.jsxs)("div",{children:[(0,t.jsxs)("div",{className:u.heading,children:[w," ",(0,t.jsx)("span",{className:u.queries,children:S?(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-queries-tab.displaying-partial-queries",defaults:"Displaying {{ count }} queries",values:{count:y[w].length}}):(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-queries-tab.displaying-queries",defaults:"{{ count }} queries",values:{count:y[w].length}})})]}),y[w].map(v=>(0,t.jsx)(_n,{datasourceInstances:m,queryHistoryItem:v},v.id))]},w)),S?(0,t.jsx)("div",{children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-queries-tab.showing-queries",defaults:"Showing {{ shown }} of {{ total }} <0>Load more</0>",values:{shown:s.length,total:n},components:[(0,t.jsx)(q.$n,{onClick:l,children:"Load more"},"loadMoreButton")]})}):null,(0,t.jsx)("div",{className:u.footer,children:Q.$.queryHistoryEnabled?"":(0,j.t)("explore.rich-history-queries-tab.history-local","The history is local to your browser and is not shared with others.")})]})]})}var cc=h(39640);const dc=e=>({container:(0,g.css)`
      font-size: ${e.typography.bodySmall.fontSize};
    `,spaceBetween:(0,g.css)`
      margin-bottom: ${e.spacing(3)};
    `,input:(0,g.css)`
      max-width: 200px;
    `,bold:(0,g.css)`
      font-weight: ${e.typography.fontWeightBold};
    `,bottomMargin:(0,g.css)`
      margin-bottom: ${e.spacing(1)};
    `}),eo=[{value:2,label:(0,j.t)("explore.rich-history-settings-tab.retention-period.2-days","2 days")},{value:5,label:(0,j.t)("explore.rich-history-settings-tab.retention-period.5-days","5 days")},{value:7,label:(0,j.t)("explore.rich-history-settings-tab.retention-period.1-week","1 week")},{value:14,label:(0,j.t)("explore.rich-history-settings-tab.retention-period.2-weeks","2 weeks")}];function uc(e){const{retentionPeriod:s,starredTabAsFirstTab:n,activeDatasourcesOnly:o,onChangeRetentionPeriod:r,toggleStarredTabAsFirstTab:i,toggleActiveDatasourcesOnly:a,deleteRichHistory:l}=e,d=(0,N.of)(dc),f=eo.find(u=>u.value===s),c=()=>{(0,Ie.J7)().publish(new He.bY({title:(0,j.t)("explore.rich-history-settings-tab.delete-title","Delete"),text:(0,j.t)("explore.rich-history-settings-tab.delete-confirm-text","Are you sure you want to permanently delete your query history?"),yesText:(0,j.t)("explore.rich-history-settings-tab.delete-confirm","Delete"),icon:"trash-alt",onConfirm:()=>{l(),(0,st.JD)((0,Gt.dx)((0,Kt.tZ)((0,j.t)("explore.rich-history-settings-tab.query-history-deleted","Query history deleted"))))}}))};return(0,t.jsxs)("div",{className:d.container,children:[(0,it.gQ)().changeRetention?(0,t.jsx)(pe.D,{label:(0,j.t)("explore.rich-history-settings-tab.history-time-span","History time span"),description:(0,j.t)("explore.rich-history-settings-tab.history-time-span-description","Select the period of time for which Grafana will save your query history. Up to {{MAX_HISTORY_ITEMS}} entries will be stored.",{MAX_HISTORY_ITEMS:cc.$H}),children:(0,t.jsx)("div",{className:d.input,children:(0,t.jsx)(ke.l6,{value:f,options:eo,onChange:r})})}):(0,t.jsx)(lt.F,{severity:"info",title:(0,j.t)("explore.rich-history-settings-tab.history-time-span","History time span"),children:(0,j.t)("explore.rich-history-settings-tab.alert-info","Grafana will keep entries up to {{optionLabel}}.Starred entries won't be deleted.",{optionLabel:f?.label})}),(0,t.jsx)(Le.I,{label:(0,j.t)("explore.rich-history-settings-tab.change-default-tab","Change the default active tab from \u201CQuery history\u201D to \u201CStarred\u201D"),className:d.spaceBetween,children:(0,t.jsx)(ze.K,{id:"explore-query-history-settings-default-active-tab",value:n,onChange:i})}),(0,it.gQ)().onlyActiveDataSource&&(0,t.jsx)(Le.I,{label:(0,j.t)("explore.rich-history-settings-tab.only-show-active-datasource","Only show queries for data source currently active in Explore"),className:d.spaceBetween,children:(0,t.jsx)(ze.K,{id:"explore-query-history-settings-data-source-behavior",value:o,onChange:a})}),(0,it.gQ)().clearHistory&&(0,t.jsxs)("div",{children:[(0,t.jsx)("div",{className:d.bold,children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-settings-tab.clear-query-history",children:"Clear query history"})}),(0,t.jsx)("div",{className:d.bottomMargin,children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-settings-tab.clear-history-info",children:"Delete all of your query history, permanently."})}),(0,t.jsx)(q.$n,{variant:"destructive",onClick:c,children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-settings-tab.clear-query-history-button",children:"Clear query history"})})]})]})}const pc=e=>({container:(0,g.css)`
      display: flex;
    `,containerContent:(0,g.css)`
      width: 100%;
    `,selectors:(0,g.css)`
      display: flex;
      justify-content: space-between;
      flex-wrap: wrap;
    `,multiselect:(0,g.css)`
      width: 100%;
      margin-bottom: ${e.spacing(1)};
    `,filterInput:(0,g.css)`
      margin-bottom: ${e.spacing(1)};
    `,sort:(0,g.css)`
      width: 170px;
    `,footer:(0,g.css)`
      height: 60px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: ${e.typography.fontWeightLight};
      font-size: ${e.typography.bodySmall.fontSize};
      a {
        font-weight: ${e.typography.fontWeightMedium};
        margin-left: ${e.spacing(.25)};
      }
    `});function hc(e){const{updateFilters:s,clearRichHistoryResults:n,loadMoreRichHistory:o,richHistorySettings:r,queries:i,totalQueries:a,loading:l,richHistorySearchFilters:d}=e,f=(0,N.of)(pc),c=(0,D.useSelector)(J.Kl),u=(0,le.TR)();(0,p.useEffect)(()=>{const y=r.activeDatasourcesOnly&&r.lastUsedDatasourceFilters?r.lastUsedDatasourceFilters:c.dsToExplore.map(S=>u.find(L=>L.uid===S.datasource?.uid)?.name).filter(S=>!!S),b={search:"",sortOrder:le.xB.Descending,datasourceFilters:y,from:0,to:r.retentionPeriod,starred:!0};return s(b),()=>{n()}},[]);const{value:x,loading:m}=(0,kt.A)(async()=>{const b=await(d?.datasourceFilters&&d?.datasourceFilters.length>0?d?.datasourceFilters:u.map(S=>S.uid)).map(async S=>{try{return(0,Pe.l)().get(S)}catch{return Promise.resolve()}});return b!==void 0?(await Promise.all(b)).filter(L=>!!L):[]},[d?.datasourceFilters]);if(!d)return(0,t.jsxs)("span",{children:[(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-starred-tab.loading",children:"Loading..."}),";"]});const C=to();return(0,t.jsx)("div",{className:f.container,children:(0,t.jsxs)("div",{className:f.containerContent,children:[(0,t.jsxs)("div",{className:f.selectors,children:[!r.activeDatasourcesOnly&&(0,t.jsx)(ke.KF,{className:f.multiselect,options:u.map(y=>({value:y.name,label:y.name})),value:d.datasourceFilters,placeholder:(0,j.t)("explore.rich-history-starred-tab.filter-queries-placeholder","Filter queries for data sources(s)"),"aria-label":(0,j.t)("explore.rich-history-starred-tab.filter-queries-aria-label","Filter queries for data sources(s)"),onChange:y=>{s({datasourceFilters:y.map(b=>b.value)})}}),(0,t.jsx)("div",{className:f.filterInput,children:(0,t.jsx)(Zn.Z,{escapeRegex:!1,placeholder:(0,j.t)("explore.rich-history-starred-tab.search-queries-placeholder","Search queries"),value:d.search,onChange:y=>s({search:y})})}),(0,t.jsx)("div",{"aria-label":(0,j.t)("explore.rich-history-starred-tab.sort-queries-aria-label","Sort queries"),className:f.sort,children:(0,t.jsx)(ke.l6,{value:C.filter(y=>y.value===d.sortOrder),options:C,placeholder:(0,j.t)("explore.rich-history-starred-tab.sort-queries-placeholder","Sort queries by"),onChange:y=>s({sortOrder:y.value})})})]}),l&&m&&(0,t.jsx)("span",{children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-starred-tab.loading-results",children:"Loading results..."})}),!(l&&m)&&i.map(y=>(0,t.jsx)(_n,{queryHistoryItem:y,datasourceInstances:x},y.id)),i.length&&i.length!==a?(0,t.jsx)("div",{children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-starred-tab.showing-queries",defaults:"Showing {{ shown }} of {{ total }} <0>Load more</0>",values:{shown:i.length,total:a},components:[(0,t.jsx)(q.$n,{onClick:o,children:"Load more"},"loadMoreButton")]})}):null,(0,t.jsx)("div",{className:f.footer,children:Q.$.queryHistoryEnabled?"":(0,j.t)("explore.rich-history-starred-tab.local-history-message","The history is local to your browser and is not shared with others.")})]})})}const to=()=>[{label:(0,j.t)("explore.rich-history.newest-first","Newest first"),value:le.xB.Descending},{label:(0,j.t)("explore.rich-history.oldest-first","Oldest first"),value:le.xB.Ascending},{label:(0,j.t)("explore.rich-history.datasource-a-z","Data source A-Z"),value:le.xB.DatasourceAZ},{label:(0,j.t)("explore.rich-history.datasource-z-a","Data source Z-A"),value:le.xB.DatasourceZA}].filter(e=>(0,it.gQ)().availableFilters.includes(e.value));function gc(e){const{richHistory:s,richHistoryTotal:n,height:o,deleteRichHistory:r,onClose:i,firstTab:a}=e,[l,d]=(0,p.useState)(!1),{queryLibraryAvailable:f}=et(),c=T=>{e.updateHistorySettings({...e.richHistorySettings,...T})},u=T=>{const R={...e.richHistorySearchFilters,...T,page:1};e.updateHistorySearchFilters(R),x()},x=(0,oe.debounce)(()=>{e.loadRichHistory(),d(!0)},300),m=T=>{T.value!==void 0&&c({retentionPeriod:T.value})},C=()=>c({starredTabAsFirstTab:!e.richHistorySettings.starredTabAsFirstTab}),y=()=>c({activeDatasourcesOnly:!e.richHistorySettings.activeDatasourcesOnly});(0,p.useEffect)(()=>{d(!1)},[s]);const b={label:Bt.queryLibrary,value:Ue.QueryLibrary,content:(0,t.jsx)(Jl,{}),icon:"book"},S={label:Bt.queryHistory,value:Ue.RichHistory,content:(0,t.jsx)(lc,{queries:s,totalQueries:n||0,loading:l,updateFilters:u,clearRichHistoryResults:()=>e.clearRichHistoryResults(),loadMoreRichHistory:()=>e.loadMoreRichHistory(),richHistorySettings:e.richHistorySettings,richHistorySearchFilters:e.richHistorySearchFilters,height:o}),icon:"history"},L={label:(0,j.t)("explore.rich-history.starred","Starred"),value:Ue.Starred,content:(0,t.jsx)(hc,{queries:s,totalQueries:n||0,loading:l,updateFilters:u,clearRichHistoryResults:()=>e.clearRichHistoryResults(),loadMoreRichHistory:()=>e.loadMoreRichHistory(),richHistorySettings:e.richHistorySettings,richHistorySearchFilters:e.richHistorySearchFilters}),icon:"star"},w={label:(0,j.t)("explore.rich-history.settings","Settings"),value:Ue.Settings,content:(0,t.jsx)(uc,{retentionPeriod:e.richHistorySettings.retentionPeriod,starredTabAsFirstTab:e.richHistorySettings.starredTabAsFirstTab,activeDatasourcesOnly:e.richHistorySettings.activeDatasourcesOnly,onChangeRetentionPeriod:m,toggleStarredTabAsFirstTab:C,toggleActiveDatasourcesOnly:y,deleteRichHistory:r}),icon:"sliders-v-alt"};let v=(f?[b]:[]).concat([S,L,w]);return(0,t.jsx)(Vn.q,{tabs:v,onClose:i,defaultTab:a,closeIconTooltip:(0,j.t)("explore.rich-history.close-tooltip","Close query history"),testId:ot.Tp.pages.Explore.QueryHistory.container})}function fc(e){const s=e.explore,n=s.richHistorySearchFilters,{richHistorySettings:o,richHistory:r,richHistoryTotal:i}=s;return{richHistory:r,richHistoryTotal:i,richHistorySettings:o,richHistorySearchFilters:n}}const mc={initRichHistory:Ee.PA,loadRichHistory:Ee.jX,loadMoreRichHistory:Ee.Uu,clearRichHistoryResults:Ee.wk,updateHistorySettings:Ee.fP,updateHistorySearchFilters:Ee.Bj,deleteRichHistory:Ee.s1},yc=(0,Ce.connect)(fc,mc);function xc(e){const s=(0,N.$j)(),{richHistory:n,richHistoryTotal:o,deleteRichHistory:r,initRichHistory:i,loadRichHistory:a,loadMoreRichHistory:l,clearRichHistoryResults:d,richHistorySettings:f,updateHistorySettings:c,richHistorySearchFilters:u,updateHistorySearchFilters:x,onClose:m}=e;(0,p.useEffect)(()=>{i()},[i]);const{selectedTab:C}=et(),[y,b]=(0,p.useState)(!1);return(0,p.useEffect)(()=>{y||(b(!0),(0,P.rR)("grafana_explore_query_history_opened",{queryHistoryEnabled:Q.$.queryHistoryEnabled,selectedTab:C}))},[y,C]),!f||!C?(0,t.jsx)("span",{children:(0,t.jsx)(j.x6,{i18nKey:"explore.rich-history-container.loading",children:"Loading..."})}):(0,t.jsx)(gc,{richHistory:n,richHistoryTotal:o,firstTab:C,onClose:m,height:s.components.horizontalDrawer.defaultHeight,deleteRichHistory:r,richHistorySettings:f,richHistorySearchFilters:u,updateHistorySettings:c,updateHistorySearchFilters:x,loadRichHistory:a,loadMoreRichHistory:l,clearRichHistoryResults:d})}const vc=yc(xc);var so=h(19361),no=h(15961);function bc(e){const s=(0,$s.C)("explore"),{chrome:n}=(0,St.Il)();(0,p.useEffect)(()=>{if(!e.panes||typeof e.panes!="string")return;let o;try{o=JSON.parse(e.panes)}catch{return}typeof o!="object"||o===null||Promise.allSettled(Object.values(o).map(r=>!r||typeof r!="object"||!(0,no.C)("datasource",r)||!r.datasource||typeof r.datasource!="string"?Promise.reject():(0,Pe.l)().get(r.datasource))).then(r=>r.filter(no.s).map(i=>i.value)).then(r=>{if(r.length===0){h.g.document.title=`${s.main.text} - ${so.M.AppTitle}`,n.update({pageNav:void 0});return}const i=r.map(a=>a.name).join(" | ");n.update({pageNav:{text:i}}),h.g.document.title=`${s.main.text} - ${i} - ${so.M.AppTitle}`})},[e.panes,s.main.text,n])}function Sc(){const{keybindings:e}=(0,St.Il)(),s=(0,D.useDispatch)();(0,p.useEffect)(()=>{e.setupTimeRangeBindings(!1);const n=[];return n.push((0,Ie.J7)().subscribe(He.Rh,()=>{s((0,ve.$_)())})),n.push((0,Ie.J7)().subscribe(He.Io,o=>{s((0,ve.Iy)(o.payload.direction))})),n.push((0,Ie.J7)().subscribe(He.U0,o=>{s((0,ve.ke)(o.payload.scale))})),n.push((0,Ie.J7)().subscribe(He.Bt,()=>{s((0,ve.Xk)())})),n.push((0,Ie.J7)().subscribe(He.VZ,()=>{s((0,ve.GA)())})),()=>{n.forEach(o=>o.unsubscribe())}},[s,e])}const Cc=e=>{const s=(0,D.useDispatch)(),{width:n}=(0,Ts.A)(),o=(0,D.useSelector)(J.K6),r=(0,D.useSelector)(J.pF),[i,a]=(0,p.useState)(.5),l=(0,D.useSelector)(c=>c.explore),d=c=>{const u=n/2,x=(0,oe.inRange)(c,u-100,u+100);s(x?(0,Z.nD)({largerExploreId:void 0}):(0,Z.nD)({largerExploreId:c>u?o[1][0]:o[0][0]})),a(c/n)};let f=0;return r&&(!l.evenSplitPanes&&l.maxedExploreId?f=l.maxedExploreId===o[1][0]?n-e:e:l.evenSplitPanes?f=Math.floor(n/2):i!==void 0&&(f=n*i)),{updateSplitSize:d,widthCalc:f}};function jc(){const{location:e}=(0,St.Il)();(0,p.useEffect)(()=>{const s=e.getSearchObject();(s.from||s.to)&&e.partial({from:void 0,to:void 0},!0)},[e])}const Es=200,Rc="queryLibraryAction";function wc(e){return(0,t.jsx)(Rr,{children:(0,t.jsx)(Tc,{...e})})}function Tc(e){const s=(0,N.of)(Lc),n=(0,N.$j)();jc(),(0,Sn.s)(e.queryParams),bc(e.queryParams);const{chrome:o}=(0,St.Il)(),r=(0,$s.C)("explore"),{updateSplitSize:i,widthCalc:a}=Cc(Es),l=(0,D.useSelector)(J.K6),d=(0,D.useSelector)(J.pF),f=(0,D.useSelector)(J.vC),{drawerOpened:c,setDrawerOpened:u,queryLibraryAvailable:x}=et(),m=Q.$.featureToggles.correlations&&(f?.editorMode||!1),[C,y]=(0,p.useState)();return(0,p.useEffect)(()=>{o.update({sectionNav:r})},[o,r]),(0,p.useEffect)(()=>{(Q.$.featureToggles.queryLibrary||!1)&&jo.d.addKeyedExtraRenderAction(Rc,{scope:me.Jk.Explore,queryActionComponent:S=>(0,t.jsx)(So.q,{title:(0,j.t)("query-operation.header.save-to-query-library","Save to query library"),icon:"save",onClick:()=>{y(S.query)}},S.key)})},[]),Sc(),(0,t.jsxs)("div",{className:(0,g.cx)(s.pageScrollbarWrapper,{[s.correlationsEditorIndicator]:m}),children:[(0,t.jsx)("h1",{className:"sr-only",children:(0,t.jsx)(j.x6,{i18nKey:"nav.explore.title"})}),(0,t.jsx)(Do,{}),m&&(0,t.jsx)(Oo,{panes:l}),(0,t.jsx)(Co.g,{splitOrientation:"vertical",paneSize:a,minSize:Es,maxSize:Es*-1,primary:"second",splitVisible:d,parentStyle:m?{height:`calc(100% - ${n.spacing(6)}`}:{},paneStyle:{overflow:"auto",display:"flex",flexDirection:"column"},onDragFinished:b=>b&&i(b),children:l.map(([b])=>(0,t.jsx)(ue.Xw,{style:"page",children:(0,t.jsx)(jl,{exploreId:b})},b))}),c&&(0,t.jsx)(Ks,{initialHeight:x?"75vh":void 0,children:(0,t.jsx)(vc,{onClose:()=>{u(!1)}})}),(0,t.jsx)(Qe.a,{title:(0,j.t)("explore.add-to-library-modal.title","Add query to Query Library"),isOpen:C!==void 0,onDismiss:()=>y(void 0),children:(0,t.jsx)(Gn,{onCancel:()=>{y(void 0)},onSave:b=>{b&&y(void 0)},query:C})})]})}const Lc=e=>({pageScrollbarWrapper:(0,g.css)({width:"100%",flexGrow:1,minHeight:0,height:"100%",position:"relative",overflow:"hidden"}),correlationsEditorIndicator:(0,g.css)({borderLeft:`4px solid ${e.colors.primary.main}`,borderRight:`4px solid ${e.colors.primary.main}`,borderBottom:`4px solid ${e.colors.primary.main}`,overflow:"scroll"})})},10940:(Hs,Je,h)=>{h.d(Je,{A:()=>p});var t=h(96540),g=function(me,Q){var N=(0,t.useRef)(function(){});(0,t.useEffect)(function(){N.current=me}),(0,t.useEffect)(function(){if(Q!==null){var ue=setInterval(function(){return N.current()},Q||0);return function(){return clearInterval(ue)}}},[Q])};const p=g}}]);

//# sourceMappingURL=explore.047ed7339226f7f75c76.js.map