"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7409],{87409:(Q,h,s)=>{s.r(h),s.d(h,{default:()=>M,groupStateByLabels:()=>g,matchKey:()=>u});var t=s(74848),o=s(32196),j=s(2543),c=s(96540),y=s(72724),x=s(40845),S=s(39558),T=s(42418),C=s(88575),L=s(60029),E=s(67061),A=s(56034),m=s(14578),B=s(10354),R=s(31678),F=s(23770),H=s(61410);function I(e){const n=(0,R.useDispatch)(),a=(0,H.$)(l=>l.managedAlertStateHistory);return(0,c.useEffect)(()=>{n((0,F.JH)(e))},[n,e]),a}var z=s(15458),D=s(75591),K=s(30423);const N=({alertId:e})=>{const[n,a]=(0,c.useState)(""),l=(0,c.useCallback)(r=>{a(r.currentTarget.value)},[]),{loading:i,error:d,result:O=[]}=I(e),v=(0,x.of)(f);if(i&&!d)return(0,t.jsx)(S._,{text:"Loading history..."});if(d&&!i)return(0,t.jsx)(T.F,{title:"Failed to fetch alert state history",children:d.message});const X=[{id:"state",label:"State",size:"max-content",renderCell:G},{id:"value",label:"",size:"auto",renderCell:b},{id:"timestamp",label:"Time",size:"max-content",renderCell:P}],U=Object.entries(g(O)).sort().filter(([r])=>u(r,n)).map(([r,V])=>{const $=V.map(p=>({id:p.id,data:p}));return(0,t.jsxs)("div",{children:[(0,t.jsx)("header",{className:v.tableGroupKey,children:(0,t.jsx)("code",{className:v.goupKeyText,"aria-label":r,children:r})}),(0,t.jsx)(D.E,{cols:X,items:$,pagination:{itemsPerPage:25}})]},r)});return(0,t.jsxs)("div",{children:[(0,t.jsx)("nav",{children:(0,t.jsx)(C.D,{label:(0,t.jsx)(L.J,{children:(0,t.jsxs)(E.B,{gap:.5,alignItems:"center",children:[(0,t.jsx)("span",{children:"Filter group"}),(0,t.jsx)(A.m,{content:(0,t.jsxs)("div",{children:["Filter each state history group either by exact match or a regular expression, ex:"," ",(0,t.jsx)("code",{children:"region=eu-west-1"})," or ",(0,t.jsx)("code",{children:"/region=us-.+/"})]}),children:(0,t.jsx)(m.I,{name:"info-circle",size:"sm"})})]})}),children:(0,t.jsx)(B.p,{prefix:(0,t.jsx)(m.I,{name:"search"}),onChange:l,placeholder:"Search"})})}),U]})};function g(e){const n=e.map(a=>{const l=/{.*?}/g,i=a.text.match(l)?.at(-1)??"";return{id:String(a.id),state:a.newState,text:a.text.replace(i,""),data:a.data,timestamp:a.updated,stringifiedLabels:i}});return(0,j.groupBy)(n,a=>a.stringifiedLabels)}function u(e,n){if(n==="")return!0;if(!(n.startsWith("/")&&n.endsWith("/")))return e.includes(n);try{return new RegExp(n.slice(1,-1)).test(e)}catch{return!1}}function b(e){const n=e.data.data?.evalMatches??[];return(0,t.jsxs)(t.Fragment,{children:[e.data.text,(0,t.jsx)(W,{children:n.map(a=>(0,t.jsx)(z.R,{labelKey:a.metric,value:String(a.value)},a.metric))})]})}function G(e){return(0,t.jsx)(K.C,{state:e.data.state})}function P(e){return(0,t.jsx)("div",{className:J,children:e.data.timestamp&&(0,t.jsx)("span",{children:(0,y.LE)(e.data.timestamp)})})}const W=({children:e})=>{const{wrapper:n}=(0,x.of)(f);return(0,t.jsx)("div",{className:n,children:e})},J=(0,o.css)({display:"flex",alignItems:"flex-end",flexDirection:"column"}),f=e=>({wrapper:(0,o.css)({"& > *":{marginRight:e.spacing(1)}}),tableGroupKey:(0,o.css)({marginTop:e.spacing(2),marginBottom:e.spacing(2)}),goupKeyText:(0,o.css)({overflowX:"auto",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"block"})}),M=N}}]);

//# sourceMappingURL=7409.c9d0654ebb7de0fe4266.js.map