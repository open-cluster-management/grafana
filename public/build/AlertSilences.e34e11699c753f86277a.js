"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9347],{69645:(U,C,t)=>{t.r(C),t.d(C,{default:()=>Ye});var e=t(74848),h=t(24180),x=t(66602),f=t(17272),D=t(37959),B=t(57895),P=t(98569),d=t(32196),v=t(96540),I=t(85858),o=t(40845),j=t(39558),y=t(42418),A=t(67061),R=t(55852),W=t(57418),T=t(14578),H=t(25994),$=t(50720),Q=t(83277),S=t(8484),V=t(91540),se=t(77583),J=t(55740),Y=t(57220),N=t(60021),ae=t(82843),b=t(19073),Z=t(32642),M=t(56361),re=t(64853),le=t(75591),ie=t(64149),oe=t(98164);const ce=({matchers:n})=>{const a=(0,o.of)(de);return(0,e.jsx)("div",{children:(0,e.jsx)(ie.L,{className:a.tags,tags:n.map(r=>`${r.name}${(0,oe.MN)(r)}${r.value}`)})})},de=()=>({tags:(0,d.css)({justifyContent:"flex-start"})});var ue=t(69529),ge=t(76442),he=t(16233),xe=t(75471);const me=({alertManagerSourceName:n})=>{const a=(0,xe.jy)(n);return he.TP.hasPermission(a.create)?(0,e.jsx)(ue.p,{variant:"call-to-action",button:(0,e.jsx)(R.z9,{href:(0,M.nL)("alerting/silence/new",n),icon:"bell-slash",size:"lg",children:(0,e.jsx)(S.x6,{i18nKey:"silences.empty-state.button-title",children:"Create silence"})}),message:(0,S.t)("silences.empty-state.title","You haven't created any silences yet")}):(0,e.jsx)(ge.c,{callToActionElement:(0,e.jsx)("div",{}),message:"No silences found."})};var X=t(70416),fe=t(4554),ve=t(69087),je=t(64047),ye=t(97754);const Ae=({alert:n,className:a})=>{const[r,l]=(0,v.useState)(!0),i=(0,X.dU)({start:new Date(n.startsAt),end:new Date(n.endsAt)}),u=Object.entries(n.labels).reduce((c,[g,s])=>((g==="alertname"||g==="__alert_rule_title__")&&(c=s),c),"");return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("tr",{className:a,children:[(0,e.jsx)("td",{children:(0,e.jsx)(je.e,{isCollapsed:r,onToggle:c=>l(c)})}),(0,e.jsx)("td",{children:(0,e.jsx)(ye.y,{state:n.status.state})}),(0,e.jsxs)("td",{children:["for ",i]}),(0,e.jsx)("td",{children:u})]}),!r&&(0,e.jsxs)("tr",{className:a,children:[(0,e.jsx)("td",{}),(0,e.jsx)("td",{colSpan:5,children:(0,e.jsx)(ve.m,{labels:n.labels,size:"sm"})})]})]})},pe=({silencedAlerts:n})=>{const a=(0,o.of)(fe.L),r=(0,o.of)(Se);return n.length?(0,e.jsxs)("table",{className:(0,d.cx)(a.table,r.tableMargin),children:[(0,e.jsxs)("colgroup",{children:[(0,e.jsx)("col",{className:a.colExpand}),(0,e.jsx)("col",{className:r.colState}),(0,e.jsx)("col",{}),(0,e.jsx)("col",{className:r.colName})]}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:(0,e.jsx)(S.x6,{i18nKey:"silences-table.header.state",children:"State"})}),(0,e.jsx)("th",{}),(0,e.jsx)("th",{children:(0,e.jsx)(S.x6,{i18nKey:"silences-table.header.alert-name",children:"Alert name"})})]})}),(0,e.jsx)("tbody",{children:n.map((l,i)=>(0,e.jsx)(Ae,{alert:l,className:i%2===0?a.evenRow:""},l.fingerprint))})]}):null},Se=n=>({tableMargin:(0,d.css)({marginBottom:n.spacing(1)}),colState:(0,d.css)({width:"110px"}),colName:(0,d.css)({width:"65%"})}),Ee=pe,Ce=({silence:n})=>{const{startsAt:a,endsAt:r,comment:l,createdBy:i,silencedAlerts:u}=n,c=(0,o.of)(De),g="YYYY-MM-DD HH:mm",s=I.parse(a),m=I.parse(r),p=(0,X.dU)({start:new Date(a),end:new Date(r)});return(0,e.jsxs)("div",{className:c.container,children:[(0,e.jsx)("div",{className:c.title,children:"Comment"}),(0,e.jsx)("div",{children:l}),(0,e.jsx)("div",{className:c.title,children:"Schedule"}),(0,e.jsx)("div",{children:`${s?.format(g)} - ${m?.format(g)}`}),(0,e.jsx)("div",{className:c.title,children:"Duration"}),(0,e.jsx)("div",{children:p}),(0,e.jsx)("div",{className:c.title,children:"Created by"}),(0,e.jsx)("div",{children:i}),Array.isArray(u)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:c.title,children:"Affected alerts"}),(0,e.jsx)(Ee,{silencedAlerts:u})]})]})},De=n=>({container:(0,d.css)({display:"grid",gridTemplateColumns:"1fr 9fr",gridRowGap:"1rem",paddingBottom:n.spacing(2)}),title:(0,d.css)({color:n.colors.text.primary}),row:(0,d.css)({margin:n.spacing(1,0)})});var Ie=t(65415);const Pe={[N.RC.Active]:"good",[N.RC.Expired]:"neutral",[N.RC.Pending]:"neutral"},Te=({state:n})=>(0,e.jsx)(Ie.O,{state:Pe[n],children:n});var w=t(2543),Me=t(88575),Re=t(60029),Le=t(56034),Oe=t(10354);const k=()=>(0,w.uniqueId)("query-string-"),Be=()=>{const[n,a]=(0,v.useState)(k()),[r,l]=(0,Q.s)(),{queryString:i}=(0,M.qy)(r),u=(0,o.of)(Ne),c=(0,w.debounce)(m=>{const p=m.target;l({queryString:p.value||null})},400),g=()=>{l({queryString:null,silenceState:null}),setTimeout(()=>a(k()))};let s=i&&i.length>3;try{i?(0,Z.S6)(i):s=!0}catch{s=!1}return(0,e.jsxs)("div",{className:u.flexRow,children:[(0,e.jsx)(Me.D,{className:u.rowChild,label:(0,e.jsx)(Re.J,{children:(0,e.jsxs)(A.B,{gap:.5,children:[(0,e.jsx)("span",{children:"Search by matchers"}),(0,e.jsx)(Le.m,{content:(0,e.jsxs)("div",{children:["Filter silences by using a comma separated list of matchers, e.g.:",(0,e.jsx)("pre",{children:"severity=critical, env=production"})]}),children:(0,e.jsx)(T.I,{name:"info-circle",size:"sm"})})]})}),invalid:!s,error:s?null:"Query must use valid matcher syntax",children:(0,e.jsx)(Oe.p,{className:u.searchInput,prefix:(0,e.jsx)(T.I,{name:"search"}),onChange:c,defaultValue:i??"",placeholder:"Search","data-testid":"search-query-input"},n)}),i&&(0,e.jsx)("div",{className:u.rowChild,children:(0,e.jsx)(R.$n,{variant:"secondary",icon:"times",onClick:g,children:"Clear filters"})})]})},Ne=n=>({searchInput:(0,d.css)({width:"360px"}),flexRow:(0,d.css)({display:"flex",flexDirection:"row",alignItems:"flex-end",paddingBottom:n.spacing(3),borderBottom:`1px solid ${n.colors.border.medium}`}),rowChild:(0,d.css)({marginRight:n.spacing(1),marginBottom:0,maxHeight:"52px"}),fieldLabel:(0,d.css)({fontSize:"12px",fontWeight:500})}),q={pollingInterval:J.wG,refetchOnFocus:!0},ze=({alertManagerSourceName:n})=>{const[a,r]=(0,b.L7)(b.QI.PreviewSilencedInstances),l=a&&r,{data:i=[],isLoading:u}=ae.m.endpoints.getAlertmanagerAlerts.useQuery({amSourceName:n,filter:{silenced:!0,active:!0,inhibited:!0}},{...q,skip:!l}),{data:c=[],isLoading:g,error:s}=V.F.endpoints.getSilences.useQuery({datasourceUid:(0,Y.w5)(n),ruleMetadata:!0,accessControl:!0},q),{currentData:m}=se.L.useDiscoverAmFeaturesQuery({amSourceName:n??""},{skip:!n}),p=(0,M.JZ)(s).includes("the Alertmanager is not configured")&&m?.lazyConfigInit,L=(0,o.of)(be),[O]=(0,Q.s)(),F=ee(c,!1),ne=ee(c,!0),{silenceState:Ge}=(0,M.qy)(O),He=Ge===N.RC.Expired,Ve=(0,v.useMemo)(()=>{const K=E=>i.filter(z=>z.status.silencedBy.includes(E));return F.map(E=>{const z=l?K(E.id):void 0;return{id:E.id,data:{...E,silencedAlerts:z}}})},[F,i,l]),G=(0,v.useMemo)(()=>{const K=E=>i.filter(z=>z.status.silencedBy.includes(E));return ne.map(E=>{const z=l?K(E.id):void 0;return{id:E.id,data:{...E,silencedAlerts:z}}})},[ne,i,l]);if(g||u)return(0,e.jsx)(j._,{text:"Loading silences..."});if(p)return(0,e.jsx)(y.F,{title:"The selected Alertmanager has no configuration",severity:"warning",children:(0,e.jsx)(S.x6,{i18nKey:"silences.table.noConfig",children:"Create a new contact point to create a configuration using the default values or contact your administrator to set up the Alertmanager."})});if(s){const K=(0,M.JZ)(s)||"Unknown error.";return(0,e.jsx)(y.F,{severity:"error",title:"Error loading silences",children:K})}return(0,e.jsxs)("div",{"data-testid":"silences-table",children:[!!c.length&&(0,e.jsxs)(A.B,{direction:"column",children:[(0,e.jsx)(Be,{}),(0,e.jsx)(re._,{actions:[b.QI.CreateSilence],children:(0,e.jsx)(A.B,{justifyContent:"end",children:(0,e.jsx)(R.z9,{href:(0,M.nL)("/alerting/silence/new",n),icon:"plus",children:(0,e.jsx)(S.x6,{i18nKey:"silences.table.add-silence-button",children:"Add Silence"})})})}),(0,e.jsx)(_,{items:Ve,alertManagerSourceName:n,dataTestId:"not-expired-table"}),G.length>0&&(0,e.jsxs)(W.M,{label:`Expired silences (${G.length})`,isOpen:He,children:[(0,e.jsxs)("div",{className:L.callout,children:[(0,e.jsx)(T.I,{className:L.calloutIcon,name:"info-circle"}),(0,e.jsx)("span",{children:(0,e.jsx)(S.x6,{i18nKey:"silences.table.expired-silences",children:"Expired silences are automatically deleted after 5 days."})})]}),(0,e.jsx)(_,{items:G,alertManagerSourceName:n,dataTestId:"expired-table"})]})]}),!c.length&&(0,e.jsx)(me,{alertManagerSourceName:n})]})};function _({items:n,alertManagerSourceName:a,dataTestId:r}){const l=Ke(a);return n.length?(0,e.jsx)(le.E,{pagination:{itemsPerPage:25},items:n,cols:l,isExpandable:!0,dataTestId:r,renderExpandedContent:({data:i})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(H.c,{}),(0,e.jsx)(Ce,{silence:i})]})}):(0,e.jsx)(S.x6,{i18nKey:"silences.table.no-matching-silences",children:"No matching silences found;"})}const ee=(n,a=!1)=>{const[r]=(0,Q.s)();return(0,v.useMemo)(()=>{const{queryString:l}=(0,M.qy)(r),i=r?.silenceIds;return n.filter(u=>typeof i=="string"&&!i.split(",").includes(u.id)||l&&!(0,Z.Zc)(l).every(s=>u.matchers?.some(({name:m,value:p,isEqual:L,isRegex:O})=>s.name===m&&s.value===p&&s.isEqual===L&&s.isRegex===O))?!1:a?u.status.state===N.RC.Expired:u.status.state!==N.RC.Expired)},[r,n,a])},be=n=>({callout:(0,d.css)({backgroundColor:n.colors.background.secondary,borderTop:`3px solid ${n.colors.info.border}`,borderRadius:n.shape.radius.default,height:"62px",display:"flex",flexDirection:"row",alignItems:"center","& > *":{marginLeft:n.spacing(1)}}),calloutIcon:(0,d.css)({color:n.colors.info.text})});function Ke(n){const[a,r]=(0,b.L7)(b.QI.UpdateSilence),[l]=V.F.endpoints.expireSilence.useMutation(),i=n===Y.hY;return(0,v.useMemo)(()=>{const u=g=>{l({datasourceUid:(0,Y.w5)(n),silenceId:g})},c=[{id:"state",label:"State",renderCell:function({data:{status:s}}){return(0,e.jsx)(Te,{state:s.state})},size:3},{id:"alert-rule",label:"Alert rule targeted",renderCell:function({data:{metadata:s}}){return s?.rule_title?(0,e.jsx)($.N,{href:`/alerting/grafana/${s?.rule_uid}/view?returnTo=${encodeURIComponent("/alerting/silences")}`,children:s.rule_title}):"None"},size:8},{id:"matchers",label:"Matching labels",renderCell:function({data:{matchers:s}}){const m=s?.filter(p=>p.name!==J.kW)||[];return(0,e.jsx)(ce,{matchers:m})},size:7},{id:"alerts",label:"Alerts silenced",renderCell:function({data:{silencedAlerts:s}}){return(0,e.jsx)("span",{"data-testid":"alerts",children:Array.isArray(s)?s.length:"-"})},size:2},{id:"schedule",label:"Schedule",renderCell:function({data:{startsAt:s,endsAt:m}}){const p=I.parse(s),L=I.parse(m),O="YYYY-MM-DD HH:mm";return`${p?.format(O)} - ${L?.format(O)}`},size:7}];return a&&c.push({id:"actions",label:"Actions",renderCell:function({data:s}){const m=s.status.state===N.RC.Expired,p=s?.accessControl?.create,L=s?.accessControl?.write,O=m&&(i?p:r),F=!m&&(i?L:r);return(0,e.jsxs)(A.B,{gap:.5,wrap:"wrap",children:[O&&(0,e.jsx)(R.z9,{title:"Recreate",size:"sm",variant:"secondary",icon:"sync",href:(0,M.nL)(`/alerting/silence/${s.id}/edit`,n),children:(0,e.jsx)(S.x6,{i18nKey:"silences.table.recreate-button",children:"Recreate"})}),F&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(R.z9,{title:"Unsilence",size:"sm",variant:"secondary",icon:"bell",onClick:()=>u(s.id),children:(0,e.jsx)(S.x6,{i18nKey:"silences.table.unsilence-button",children:"Unsilence"})}),(0,e.jsx)(R.z9,{title:"Edit",size:"sm",variant:"secondary",icon:"pen",href:(0,M.nL)(`/alerting/silence/${s.id}/edit`,n),children:(0,e.jsx)(S.x6,{i18nKey:"silences.table.edit-button",children:"Edit"})})]})]})},size:5}),c},[n,l,i,r,a])}const Ue=ze,te={icon:"bell-slash"};function Fe(){const{isExact:n,path:a}=(0,h.W5)(),[r,l]=(0,v.useState)();return(0,v.useEffect)(()=>{a==="/alerting/silence/new"?l({...te,id:"silence-new",text:"Silence alert rule",subTitle:"Configure silences to stop notifications from a particular alert rule"}):a==="/alerting/silence/:id/edit"&&l({...te,id:"silence-edit",text:"Edit silence",subTitle:"Recreate existing silence to stop notifications from a particular alert rule"})},[a,n]),r}var We=t(70383);const $e=()=>{const{selectedAlertmanager:n}=(0,We.VI)();return n?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(B.M,{currentAlertmanager:n}),(0,e.jsxs)(h.dO,{children:[(0,e.jsx)(h.qh,{exact:!0,path:"/alerting/silences",children:(0,e.jsx)(Ue,{alertManagerSourceName:n})}),(0,e.jsx)(h.qh,{exact:!0,path:"/alerting/silence/new",children:({location:a})=>{const r=new URLSearchParams(a.search),l=(0,f.Di)((0,f.LP)(r));return(0,e.jsx)(P.G,{formValues:l,alertManagerSourceName:n})}}),(0,e.jsx)(h.qh,{exact:!0,path:"/alerting/silence/:id/edit",children:({match:a})=>a?.params.id&&(0,e.jsx)(P.A,{silenceId:a.params.id,alertManagerSourceName:n})})]})]}):null};function Qe(){const n=Fe();return(0,e.jsx)(D.y,{navId:"silences",pageNav:n,accessType:"instance",children:(0,e.jsx)($e,{})})}const Ye=(0,x.Xc)(Qe,{style:"page"})},64853:(U,C,t)=>{t.d(C,{_:()=>D});var e=t(74848),h=t(2543),x=t.n(h),f=t(19073);const D=({actions:o,children:j})=>{const y=(0,h.filter)(o,v),A=(0,h.filter)(o,I);return y.length?(0,e.jsx)(B,{actions:y,children:j}):A.length?(0,e.jsx)(P,{actions:A,children:j}):null},B=({actions:o,children:j})=>{const y=(0,f.iI)();return d(y,o)?(0,e.jsx)(e.Fragment,{children:j}):null},P=({actions:o,children:j})=>{const y=(0,f.e2)();return d(y,o)?(0,e.jsx)(e.Fragment,{children:j}):null};function d(o,j){return(0,h.chain)(o).pick(j).values().value().some(([y,A])=>A===!0)}function v(o){return Object.values(f.QI).includes(o)}function I(o){return Object.values(f.RY).includes(o)}},64047:(U,C,t)=>{t.d(C,{e:()=>x});var e=t(74848),h=t(55852);const x=({isCollapsed:f,onToggle:D,idControlled:B,className:P,text:d,size:v="xl",...I})=>(0,e.jsx)(h.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!f,"aria-controls":B,className:P,icon:f?"angle-right":"angle-down",onClick:()=>D(!f),...I,children:d})},57895:(U,C,t)=>{t.d(C,{M:()=>v});var e=t(74848),h=t(32196),x=t(40845),f=t(42418),D=t(60021),B=t(82843),P=t(19073),d=t(57220);function v({currentAlertmanager:o}){const j=(0,x.of)(I),y=o!==d.hY,[A,R]=(0,P.Ej)(P.RY.ReadConfigurationStatus),W=A&&R,{currentData:T}=B.m.endpoints.getGrafanaAlertingConfigurationStatus.useQuery(void 0,{skip:y||!W});if(!(T?.alertmanagersChoice&&[D.nA.External,D.nA.All].includes(T?.alertmanagersChoice))||y)return null;const $=T.numExternalAlertmanagers>0;return T.alertmanagersChoice===D.nA.External?(0,e.jsxs)(f.F,{title:"Grafana alerts are not delivered to Grafana Alertmanager",children:["Grafana is configured to send alerts to external Alertmanagers only. Changing Grafana Alertmanager configuration will not affect delivery of your alerts.",(0,e.jsx)("div",{className:j.adminHint,children:"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator."})]}):T.alertmanagersChoice===D.nA.All&&$?(0,e.jsxs)(f.F,{title:"You have additional Alertmanagers to configure",severity:"warning",children:["Ensure you make configuration changes in the correct Alertmanagers; both internal and external. Changing one will not affect the others.",(0,e.jsx)("div",{className:j.adminHint,children:"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator."})]}):null}const I=o=>({adminHint:(0,h.css)({fontSize:o.typography.bodySmall.fontSize,fontWeight:o.typography.bodySmall.fontWeight})})},4554:(U,C,t)=>{t.d(C,{L:()=>h});var e=t(32196);const h=x=>({table:(0,e.css)({width:"100%",borderRadius:x.shape.radius.default,border:`solid 1px ${x.colors.border.weak}`,backgroundColor:x.colors.background.secondary,th:{padding:x.spacing(1)},td:{padding:`0 ${x.spacing(1)}`},tr:{height:"38px"}}),evenRow:(0,e.css)({backgroundColor:x.colors.background.primary}),colExpand:(0,e.css)({width:"36px"}),nameCell:(0,e.css)({gap:x.spacing(1)}),actionsCell:(0,e.css)({textAlign:"right",width:"1%",whiteSpace:"nowrap","& > * + *":{marginLeft:x.spacing(.5)}})})}}]);

//# sourceMappingURL=AlertSilences.e34e11699c753f86277a.js.map