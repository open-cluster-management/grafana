"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7620],{84535:(S,j,t)=>{t.r(j),t.d(j,{PlaylistEditPage:()=>D,default:()=>I});var a=t(74848),m=t(16817),u=t(39601),b=t(69444),h=t(8484),P=t(23833),E=t(86022);const D=({match:A})=>{const C=(0,E.NF)(),y=(0,m.A)(()=>C.getPlaylist(A.params.uid),[A.params]),e=async v=>{await C.updatePlaylist(v),u.Ny.push("/playlists")},M={text:(0,h.t)("playlist-edit.title","Edit playlist"),subTitle:(0,h.t)("playlist-edit.sub-title","A playlist rotates through a pre-selected list of dashboards. A playlist can be a great way to build situational awareness, or just show off your metrics to your team or visitors.")};return(0,a.jsx)(b.Y,{navId:"dashboards/playlists",pageNav:M,children:(0,a.jsxs)(b.Y.Contents,{isLoading:y.loading,children:[y.error&&(0,a.jsxs)("div",{children:[(0,a.jsx)(h.x6,{i18nKey:"playlist-edit.error-prefix",children:"Error loading playlist:"}),JSON.stringify(y.error)]}),y.value&&(0,a.jsx)(P.$,{onSubmit:e,playlist:y.value})]})})},I=D},23833:(S,j,t)=>{t.d(j,{$:()=>G});var a=t(74848),m=t(96540),u=t(13544),b=t(32264),h=t(88575),P=t(10354),E=t(84167),D=t(67061),I=t(55852),A=t(72235),C=t(59429),y=t(99818),e=t(8484),M=t(24439),v=t(91076),T=t(32196),$=t(55127),F=t.n($),K=t(40845),N=t(62930),B=t(14578),R=t(29158),U=t(46334);const L=({items:o,onDelete:l})=>{const r=(0,K.of)(W);if(!o?.length)return(0,a.jsx)("div",{children:(0,a.jsx)("em",{children:(0,a.jsx)(e.x6,{i18nKey:"playlist-edit.form.table-empty",children:"Playlist is empty. Add dashboards below."})})});const p=s=>{let c=s.type==="dashboard_by_tag"?"apps":"tag-alt";const i=[],n=s.dashboards?.[0];return s.dashboards?s.type==="dashboard_by_tag"?(i.push((0,a.jsx)(U.E,{label:s.value,removeIcon:!1,count:0},s.value)),n?i.push((0,a.jsxs)("span",{children:["\xA0 ",F()("dashboard",s.dashboards.length,!0)]},"info")):(c="exclamation-triangle",i.push((0,a.jsx)("span",{children:"\xA0 No dashboards found"},"info")))):n?i.push(s.dashboards.length>1?(0,a.jsxs)("span",{children:["Multiple items found: $",s.value]},"info"):(0,a.jsx)("span",{children:n.name??s.value},"info")):(c="exclamation-triangle",i.push((0,a.jsxs)("span",{children:["\xA0 Not found: ",s.value]},"info"))):i.push((0,a.jsx)(N.y,{},"spinner")),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(B.I,{name:c,className:r.rightMargin},"icon"),i]})};return(0,a.jsx)(a.Fragment,{children:o.map((s,c)=>(0,a.jsx)(v.sx,{draggableId:`${c}`,index:c,children:i=>(0,a.jsxs)("div",{className:r.row,ref:i.innerRef,...i.draggableProps,...i.dragHandleProps,role:"row",children:[(0,a.jsx)("div",{className:r.actions,role:"cell","aria-label":`Playlist item, ${s.type}, ${s.value}`,children:p(s)}),(0,a.jsxs)("div",{className:r.actions,children:[(0,a.jsx)(R.K,{name:"times",size:"md",onClick:()=>l(c),"data-testid":u.Tp.pages.PlaylistForm.itemDelete,tooltip:(0,e.t)("playlist-edit.form.table-delete","Delete playlist item")}),(0,a.jsx)(B.I,{title:(0,e.t)("playlist-edit.form.table-drag","Drag and drop to reorder"),name:"draggabledots",size:"md"})]})]})},`${c}/${s.value}`))})};function W(o){return{row:(0,T.css)`
      padding: 6px;
      background: ${o.colors.background.secondary};
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 3px;

      border: 1px solid ${o.colors.border.medium};
      &:hover {
        border: 1px solid ${o.colors.border.strong};
      }
    `,rightMargin:(0,T.css)`
      margin-right: 5px;
    `,actions:(0,T.css)`
      align-items: center;
      justify-content: center;
      display: flex;
    `,settings:(0,T.css)`
      label: settings;
      text-align: right;
    `}}const z=({items:o,deleteItem:l,moveItem:r})=>{const p=s=>{s.destination&&r(s.source.index,s.destination?.index)};return(0,a.jsx)(E.n,{label:(0,e.t)("playlist-edit.form.table-heading","Dashboards"),children:(0,a.jsx)(v.JY,{onDragEnd:p,children:(0,a.jsx)(v.gL,{droppableId:"playlist-list",direction:"vertical",children:s=>(0,a.jsxs)("div",{ref:s.innerRef,...s.droppableProps,children:[(0,a.jsx)(L,{items:o,onDelete:l}),s.placeholder]})})})})};var Y=t(16817),V=t(86022);function J(o){const[l,r]=(0,m.useState)(o??[]);(0,Y.A)(async()=>{for(const n of l)if(!n.dashboards){r(await(0,V.qY)(l));return}},[l]);const p=(0,m.useCallback)(n=>{n&&r([...l,{type:"dashboard_by_uid",value:n.uid}])},[l]),s=(0,m.useCallback)(n=>{const d=n[0];if(!d||l.find(f=>f.value===d))return;const g={type:"dashboard_by_tag",value:d};r([...l,g])},[l]),c=(0,m.useCallback)((n,d)=>{if(n===d||!l[n])return;const g=Array.from(l),[f]=g.splice(n,1);g.splice(d,0,f),r(g)},[l]),i=(0,m.useCallback)(n=>{const d=l.slice();d.splice(n,1),r(d)},[l]);return{items:l,addByUID:p,addByTag:s,deleteItem:i,moveItem:c}}const G=({onSubmit:o,playlist:l})=>{const[r,p]=(0,m.useState)(!1),{name:s,interval:c,items:i}=l,n=(0,m.useMemo)(()=>()=>(0,M.getGrafanaSearcher)().tags({kind:["dashboard"]}),[]),{items:d,addByUID:g,addByTag:f,deleteItem:H,moveItem:X}=J(i),Q=O=>{p(!0),o({...O,items:d,uid:l.uid})};return(0,a.jsx)(A.l,{onSubmit:Q,validateOn:"onBlur",children:({register:O,errors:x})=>{const Z=d.length===0||Object.keys(x).length>0;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.D,{label:(0,e.t)("playlist-edit.form.name-label","Name"),invalid:!!x.name,error:x?.name?.message,children:(0,a.jsx)(P.p,{type:"text",...O("name",{required:(0,e.t)("playlist-edit.form.name-required","Name is required")}),placeholder:(0,e.t)("playlist-edit.form.name-placeholder","Name"),defaultValue:s,"aria-label":u.Tp.pages.PlaylistForm.name})}),(0,a.jsx)(h.D,{label:(0,e.t)("playlist-edit.form.interval-label","Interval"),invalid:!!x.interval,error:x?.interval?.message,children:(0,a.jsx)(P.p,{type:"text",...O("interval",{required:(0,e.t)("playlist-edit.form.interval-required","Interval is required")}),placeholder:(0,e.t)("playlist-edit.form.interval-placeholder","5m"),defaultValue:c??"5m","aria-label":u.Tp.pages.PlaylistForm.interval})}),(0,a.jsx)(z,{items:d,deleteItem:H,moveItem:X}),(0,a.jsxs)(E.n,{label:(0,e.t)("playlist-edit.form.heading","Add dashboards"),children:[(0,a.jsx)(h.D,{label:(0,e.t)("playlist-edit.form.add-title-label","Add by title"),children:(0,a.jsx)(C.b,{id:"dashboard-picker",onChange:g},d.length)}),(0,a.jsx)(h.D,{label:(0,e.t)("playlist-edit.form.add-tag-label","Add by tag"),children:(0,a.jsx)(y.$,{isClearable:!0,tags:[],hideValues:!0,tagOptions:n,onChange:f,placeholder:(0,e.t)("playlist-edit.form.add-tag-placeholder","Select a tag")})})]}),(0,a.jsxs)(D.B,{children:[(0,a.jsx)(I.$n,{type:"submit",variant:"primary",disabled:Z,icon:r?"spinner":void 0,children:(0,a.jsx)(e.x6,{i18nKey:"playlist-edit.form.save",children:"Save"})}),(0,a.jsx)(I.z9,{variant:"secondary",href:`${b.$.appSubUrl}/playlists`,children:(0,a.jsx)(e.x6,{i18nKey:"playlist-edit.form.cancel",children:"Cancel"})})]})]})}})}}}]);

//# sourceMappingURL=PlaylistEditPage.c8a1a958e82487c5bfd4.js.map