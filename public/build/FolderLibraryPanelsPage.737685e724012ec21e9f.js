"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5804],{15111:(I,u,a)=>{a.r(u),a.d(u,{BrowseFolderLibraryPanelsPage:()=>O,default:()=>M});var e=a(74848),P=a(96540),o=a(69444),r=a(9134),_=a(71101),C=a(16678),n=a(24643),s=a(55314);function O({match:A}){const{uid:l}=A.params,{data:t}=(0,s.kH)(l),[i,v]=(0,P.useState)(void 0),[f]=(0,s.iB)(),d=(0,P.useMemo)(()=>{if(!t)return;const c=(0,_.R4)(t),D=(0,_.pq)(t.uid),E=c.children?.find(h=>h.id===D);return E&&(E.active=!0),c},[t]),m=l?async c=>{if(t){const D=await f({...t,title:c});if("error"in D)throw D.error}}:void 0;return(0,e.jsx)(o.Y,{navId:"dashboards/browse",pageNav:d,onEditTitle:m,actions:(0,e.jsx)(e.Fragment,{children:t&&(0,e.jsx)(r.m,{folder:t})}),children:(0,e.jsxs)(o.Y.Contents,{children:[(0,e.jsx)(C.j,{onClick:v,currentFolderUID:l,showSecondaryActions:!0,showSort:!0,showPanelFilter:!0}),i?(0,e.jsx)(n.F,{onDismiss:()=>v(void 0),libraryPanel:i}):null]})})}const M=O},18241:(I,u,a)=>{a.d(u,{T:()=>A});var e=a(74848),P=a(96540),o=a(32264),r=a(96374),_=a(94753),C=a(68402),n=a(42418),s=a(8484),O=a(55314),M=a(43907);const A=({onConfirm:l,onDismiss:t,selectedItems:i,...v})=>{const{data:f}=(0,O.G2)(i),d=!!(f&&(f.alertRule||f.libraryPanel)),[m,c]=(0,P.useState)(!1),D=async()=>{c(!0);try{await l(),c(!1),t()}catch{c(!1)}};return(0,e.jsx)(r.u,{body:(0,e.jsxs)(e.Fragment,{children:[o.$.featureToggles.dashboardRestore&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(_.E,{element:"p",children:(0,e.jsx)(s.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,e.jsx)(C.$,{v:2})]}),(0,e.jsx)(_.E,{element:"p",children:(0,e.jsx)(s.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,e.jsx)(M.x,{selectedItems:i}),(0,e.jsx)(C.$,{v:2})]}),description:(0,e.jsx)(e.Fragment,{children:d?(0,e.jsx)(n.F,{severity:"warning",title:(0,s.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,e.jsx)(s.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,s.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:m?(0,s.t)("browse-dashboards.action.deleting","Deleting..."):(0,s.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:t,onConfirm:D,title:(0,s.t)("browse-dashboards.action.delete-modal-title","Delete"),...v,disabled:d})}},51887:(I,u,a)=>{a.d(u,{J:()=>l});var e=a(74848),P=a(96540),o=a(37390),r=a(42418),_=a(94753),C=a(68402),n=a(88575),s=a(55852),O=a(36607),M=a(8484),A=a(43907);const l=({onConfirm:t,onDismiss:i,selectedItems:v,...f})=>{const[d,m]=(0,P.useState)(),[c,D]=(0,P.useState)(!1),E=Object.keys(v.folder).filter(L=>v.folder[L]),h=async()=>{if(d!==void 0){D(!0);try{await t(d),D(!1),i()}catch{D(!1)}}};return(0,e.jsxs)(o.a,{title:(0,M.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:i,...f,children:[E.length>0&&(0,e.jsx)(r.F,{severity:"info",title:(0,M.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,e.jsx)(_.E,{element:"p",children:(0,e.jsx)(M.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,e.jsx)(A.x,{selectedItems:v}),(0,e.jsx)(C.$,{v:3}),(0,e.jsx)(n.D,{label:(0,M.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,e.jsx)(O.d,{value:d,excludeUIDs:E,onChange:m})}),(0,e.jsxs)(o.a.ButtonRow,{children:[(0,e.jsx)(s.$n,{onClick:i,variant:"secondary",fill:"outline",children:(0,e.jsx)(M.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,e.jsx)(s.$n,{disabled:d===void 0||c,onClick:h,variant:"primary",children:c?(0,M.t)("browse-dashboards.action.moving","Moving..."):(0,M.t)("browse-dashboards.action.move-button","Move")})]})]})}},9134:(I,u,a)=>{a.d(u,{m:()=>D});var e=a(74848),P=a(96540),o=a(32264),r=a(14110),_=a(39601),C=a(38138),n=a(64539),s=a(83122),O=a(55852),M=a(14578),A=a(87978),l=a(5108),t=a(10096),i=a(8484),v=a(28444),f=a(55314),d=a(49904),m=a(18241),c=a(51887);function D({folder:E}){const[h,L]=(0,P.useState)(!1),[b,B]=(0,P.useState)(!1),[K]=(0,f.aF)(),[R]=(0,f.Ko)(),{canEditFolders:W,canDeleteFolders:g,canViewPermissions:T,canSetPermissions:y}=(0,d.N)(E),U=o.$.featureToggles.nestedFolders&&W,j=async x=>{await K({folder:E,destinationUID:x}),(0,r.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},p=async()=>{await R(E),(0,r.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:x}=E,z=x&&x.length?x[x.length-1].url:"/dashboards";_.Ny.push(z)},F=()=>{t.lE.publish(new v.S8({component:c.J,props:{selectedItems:{folder:{[E.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:j}}))},S=()=>{t.lE.publish(new v.S8({component:m.T,props:{selectedItems:{folder:{[E.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:p}}))},$=(0,i.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),w=(0,i.t)("browse-dashboards.folder-actions-button.move","Move"),N=(0,i.t)("browse-dashboards.folder-actions-button.delete","Delete"),V=(0,e.jsxs)(C.W,{children:[T&&(0,e.jsx)(n.D,{onClick:()=>B(!0),label:$}),U&&(0,e.jsx)(n.D,{onClick:F,label:w}),g&&(0,e.jsx)(n.D,{destructive:!0,onClick:S,label:N})]});return!T&&!U&&!g?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(s.m,{overlay:V,onVisibleChange:L,children:(0,e.jsxs)(O.$n,{variant:"secondary",children:[(0,e.jsx)(i.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,e.jsx)(M.I,{name:h?"angle-up":"angle-down"})]})}),b&&(0,e.jsx)(A._,{title:(0,i.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:E.title,onClose:()=>B(!1),size:"md",children:(0,e.jsx)(l.x,{resource:"folders",resourceId:E.uid,canSetPermissions:y})})]})}},49904:(I,u,a)=>{a.d(u,{N:()=>C});var e=a(32264),P=a(10096),o=a(31678);function r(n,s){return s&&s.uid!=="general"?P.TP.hasPermissionInMetadata(n,s):P.TP.hasPermission(n)}function _(n){return n&&!e.$.featureToggles.nestedFolders?!1:e.$.featureToggles.accessActionSets?n?P.TP.hasPermissionInMetadata(o.AccessControlAction.FoldersCreate,n):P.TP.hasPermission(o.AccessControlAction.FoldersCreate):!n||n.uid==="general"?r(o.AccessControlAction.FoldersCreate):r(o.AccessControlAction.FoldersCreate)&&r(o.AccessControlAction.FoldersWrite,n)}function C(n){const s=r(o.AccessControlAction.DashboardsCreate,n),O=_(n),M=r(o.AccessControlAction.FoldersDelete,n),A=r(o.AccessControlAction.DashboardsWrite,n),l=r(o.AccessControlAction.FoldersWrite,n),t=r(o.AccessControlAction.FoldersPermissionsWrite,n),i=r(o.AccessControlAction.FoldersPermissionsRead,n);return{canCreateDashboards:s,canCreateFolders:O,canDeleteFolders:M,canEditDashboards:A,canEditFolders:l,canSetPermissions:t,canViewPermissions:i}}},24643:(I,u,a)=>{a.d(u,{F:()=>i});var e=a(74848),P=a(32196),o=a(76459),r=a.n(o),_=a(96540),C=a(76885),n=a(39601),s=a(40845),O=a(37390),M=a(90182),A=a(55852),l=a(8484),t=a(57767);function i({libraryPanel:d,onDismiss:m}){const c=(0,s.of)(f),[D,E]=(0,_.useState)(!1),[h,L]=(0,_.useState)(0),[b,B]=(0,_.useState)(void 0);(0,_.useEffect)(()=>{(async()=>{const T=await(0,t.GN)(d.uid);L(T.length)})()},[d.uid]);const K=(0,_.useCallback)(g=>v(d.uid,g,E),[d.uid]),R=(0,_.useMemo)(()=>r()(K,300,{leading:!0}),[K]),W=g=>{g.preventDefault(),n.Ny.push(C.kM.renderUrl(`/d/${b?.value?.uid}`,{}))};return(0,e.jsxs)(O.a,{title:(0,l.t)("library-panels.modal.title","View panel in dashboard"),onDismiss:m,onClickBackdrop:m,isOpen:!0,children:[(0,e.jsxs)("div",{className:c.container,children:[h===0?(0,e.jsx)("span",{children:(0,e.jsx)(l.x6,{i18nKey:"library-panels.modal.panel-not-linked",children:"Panel is not linked to a dashboard. Add the panel to a dashboard and retry."})}):null,h>0?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsxs)(l.x6,{i18nKey:"library-panels.modal.body",count:h,children:["This panel is being used in ",{count:h}," dashboard. Please choose which dashboard to view the panel in:"]})}),(0,e.jsx)(M.DW,{isClearable:!0,isLoading:D,defaultOptions:!0,loadOptions:R,onChange:B,placeholder:(0,l.t)("library-panels.modal.select-placeholder","Start typing to search for dashboard"),noOptionsMessage:(0,l.t)("library-panels.modal.select-no-options-message","No dashboards found")})]}):null]}),(0,e.jsxs)(O.a.ButtonRow,{children:[(0,e.jsx)(A.$n,{variant:"secondary",onClick:m,fill:"outline",children:(0,e.jsx)(l.x6,{i18nKey:"library-panels.modal.button-cancel",children:"Cancel"})}),(0,e.jsx)(A.$n,{onClick:W,disabled:!b,children:b?(0,l.t)("library-panels.modal.button-view-panel1","View panel in {{label}}...",{label:b?.label}):(0,l.t)("library-panels.modal.button-view-panel2","View panel in dashboard...")})]})]})}async function v(d,m,c){c(!0);const E=(await(0,t.xV)(d)).filter(h=>h.title.toLowerCase().includes(m.toLowerCase())).map(h=>({label:h.title,value:h}));return c(!1),E}function f(d){return{container:(0,P.css)``}}}}]);

//# sourceMappingURL=FolderLibraryPanelsPage.737685e724012ec21e9f.js.map