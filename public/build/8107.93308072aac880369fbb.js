"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8107],{28107:(L,d,r)=>{r.r(d),r.d(d,{ChangePasswordPage:()=>x,default:()=>N});var n=r(74848),e=r(71468),w=r(4392),c=r(69444),P=r(96540),f=r(88575),y=r(67061),v=r(55852),j=r(72235),p=r(35043),t=r(2913),o=r(8484),g=r(78361);const A=({user:i,onChangePassword:s,isSaving:a})=>{const[h,F]=(0,P.useState)(!1),[T,b]=(0,P.useState)(!0),{disableLoginForm:E}=t.Ay,O=i.authLabels?.length&&i.authLabels[0];return O==="LDAP"||O==="Auth Proxy"?(0,n.jsx)("p",{children:(0,n.jsx)(o.x6,{i18nKey:"profile.change-password.ldap-auth-proxy-message",children:"You cannot change password when signed in with LDAP or auth proxy."})}):O&&E?(0,n.jsx)("p",{children:(0,n.jsx)(o.x6,{i18nKey:"profile.change-password.cannot-change-password-message",children:"Password cannot be changed here."})}):(0,n.jsx)(j.l,{onSubmit:s,maxWidth:400,children:({register:D,errors:u,getValues:I,watch:B})=>{const K=B("newPassword");return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(f.D,{label:(0,o.t)("profile.change-password.old-password-label","Old password"),invalid:!!u.oldPassword,error:u?.oldPassword?.message,children:(0,n.jsx)(g.s,{id:"current-password",autoComplete:"current-password",...D("oldPassword",{required:(0,o.t)("profile.change-password.old-password-required","Old password is required")})})}),(0,n.jsx)(f.D,{label:(0,o.t)("profile.change-password.new-password-label","New password"),invalid:!!u.newPassword,error:u?.newPassword?.message,children:(0,n.jsx)(g.s,{id:"new-password",autoComplete:"new-password",onFocus:()=>F(!0),...D("newPassword",{onBlur:()=>b(!1),required:(0,o.t)("profile.change-password.new-password-required","New password is required"),validate:{strongPasswordValidationRegister:p.DP,confirm:m=>m===I().confirmNew||(0,o.t)("profile.change-password.passwords-must-match","Passwords must match"),old:m=>m!==I().oldPassword||(0,o.t)("profile.change-password.new-password-same-as-old","New password can't be the same as the old one.")}})})}),h&&(0,n.jsx)(p.zJ,{pristine:T,password:K,strongPasswordValidations:p.NQ}),(0,n.jsx)(f.D,{label:(0,o.t)("profile.change-password.confirm-password-label","Confirm password"),invalid:!!u.confirmNew,error:u?.confirmNew?.message,children:(0,n.jsx)(g.s,{id:"confirm-new-password",autoComplete:"new-password",...D("confirmNew",{required:(0,o.t)("profile.change-password.confirm-password-required","New password confirmation is required"),validate:m=>m===I().newPassword||(0,o.t)("profile.change-password.passwords-must-match","Passwords must match")})})}),(0,n.jsxs)(y.B,{children:[(0,n.jsx)(v.$n,{variant:"primary",disabled:a,type:"submit",children:(0,n.jsx)(o.x6,{i18nKey:"profile.change-password.change-password-button",children:"Change Password"})}),(0,n.jsx)(v.z9,{variant:"secondary",href:`${t.Ay.appSubUrl}/profile`,fill:"outline",children:(0,n.jsx)(o.x6,{i18nKey:"profile.change-password.cancel-button",children:"Cancel"})})]})]})}})};var l=r(84969);function U(i){const s=i.user,{isUpdating:a,user:h}=s;return{isUpdating:a,user:h}}const S={loadUser:l.YW,changePassword:l.ec},C=(0,e.connect)(U,S);function x({loadUser:i,isUpdating:s,user:a,changePassword:h}){return(0,w.A)(()=>i()),(0,n.jsx)(c.Y,{navId:"profile/password",children:(0,n.jsx)(c.Y.Contents,{isLoading:!a,children:a?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(A,{user:a,onChangePassword:h,isSaving:s})}):null})})}const N=C(x)},84969:(L,d,r)=>{r.d(d,{ec:()=>g,Aj:()=>N,Qe:()=>A,YW:()=>l,_O:()=>x,eg:()=>i});var n=r(32264),e=r(17172);async function w(s){try{await(0,e.AI)().put("/api/user/password",s)}catch(a){console.error(a)}}function c(){return(0,e.AI)().get("/api/user")}function P(){return(0,e.AI)().get("/api/user/teams")}function f(){return(0,e.AI)().get("/api/user/orgs")}function y(){return(0,e.AI)().get("/api/user/auth-tokens")}async function v(s){await(0,e.AI)().post("/api/user/revoke-auth-token",{authTokenId:s})}async function j(s){await(0,e.AI)().post("/api/user/using/"+s.orgId,{})}async function p(s){try{await(0,e.AI)().put("/api/user",s)}catch(a){console.error(a)}}const t={changePassword:w,revokeUserSession:v,loadUser:c,loadSessions:y,loadOrgs:f,loadTeams:P,setUserOrg:j,updateUserProfile:p};var o=r(81862);function g(s){return async function(a){a((0,o.Nm)({updating:!0})),await t.changePassword(s),a((0,o.Nm)({updating:!1}))}}function A(){return async function(s){await s(l()),s(U()),s(S()),s(C())}}function l(){return async function(s){const a=await t.loadUser();s((0,o.HO)({user:a}))}}function U(){return async function(s){s((0,o.ri)());const a=await t.loadTeams();s((0,o.Q9)({teams:a}))}}function S(){return async function(s){s((0,o.Mj)());const a=await t.loadOrgs();s((0,o.ny)({orgs:a}))}}function C(){return async function(s){s((0,o.uh)());const a=await t.loadSessions();s((0,o.RS)({sessions:a}))}}function x(s){return async function(a){a((0,o.Nm)({updating:!0})),await t.revokeUserSession(s),a((0,o.g$)({tokenId:s}))}}function N(s){return async function(a){a((0,o.Nm)({updating:!0})),await t.setUserOrg(s),window.location.href=n.$.appSubUrl+"/profile"}}function i(s){return async function(a){a((0,o.Nm)({updating:!0})),await t.updateUserProfile(s),await a(l()),a((0,o.Nm)({updating:!1}))}}},4392:(L,d,r)=>{r.d(d,{A:()=>w});var n=r(94701),e=function(c){(0,n.A)(function(){c()})};const w=e}}]);

//# sourceMappingURL=8107.93308072aac880369fbb.js.map