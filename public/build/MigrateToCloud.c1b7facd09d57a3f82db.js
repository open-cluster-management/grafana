"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[3704],{76491:(he,$,c)=>{c.r($),c.d($,{default:()=>ce});var t=c(74848),D=c(32264),T=c(42418),E=c(72109),at=c(69444),e=c(8484),v=c(90613),h=c(67061),l=c(94753);const C=({children:o,title:n,linkHref:r,linkTitle:s})=>(0,t.jsxs)(h.B,{gap:2,direction:"column",children:[(0,t.jsx)(l.E,{element:"h4",children:n}),(0,t.jsx)(l.E,{color:"secondary",children:o}),r&&(0,t.jsx)(E.Y,{href:r,external:!0,children:s??r})]}),it=()=>(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.migrate-to-this-stack.title","Let us help you migrate to this stack"),children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.migrate-to-this-stack.body",children:"You can migrate some resources from your self-managed Grafana installation to this cloud stack. To do this securely, you'll need to generate a migration token. Your self-managed instance will use the token to authenticate with this cloud stack."})});var O=c(32196),K=c(40845);const lt=()=>{const o=(0,K.of)(ct);return(0,t.jsxs)(v.a,{alignItems:"flex-start",display:"flex",direction:"column",gap:2,children:[(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.get-started.title","Performing a migration"),linkTitle:(0,e.t)("migrate-to-cloud.get-started.link-title","Learn more about Private Data Source Connect"),linkHref:"https://grafana.com/docs/grafana-cloud/connect-externally-hosted/private-data-source-connect",children:(0,t.jsxs)(h.B,{direction:"column",gap:2,children:[(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.get-started.body",children:"The migration process must be started from your self-managed Grafana instance."}),(0,t.jsxs)("ol",{className:o.list,children:[(0,t.jsx)("li",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.get-started.step-1",children:"Log in to your self-managed instance and navigate to Administration, General, Migrate to Grafana Cloud."})}),(0,t.jsx)("li",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.get-started.step-2",children:'Select "Migrate this instance to Cloud".'})}),(0,t.jsx)("li",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.get-started.step-3",children:"You'll be prompted for a migration token. Generate one from this screen."})}),(0,t.jsx)("li",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.get-started.step-4",children:'In your self-managed instance, select "Upload everything" to upload data sources and dashboards to this cloud stack.'})}),(0,t.jsx)("li",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.get-started.step-5",children:"If some of your data sources will not work over the public internet, you\u2019ll need to install Private Data Source Connect in your self-managed environment."})})]})]})}),(0,t.jsx)(E.Y,{href:"/connections/private-data-source-connections",children:(0,e.t)("migrate-to-cloud.get-started.configure-pdc-link","Configure PDC for this stack")}),(0,t.jsx)(E.Y,{href:"https://grafana.com/docs/grafana-cloud/account-management/migration-guide",children:(0,e.t)("migrate-to-cloud.migrate-to-this-stack.link-title","View the full migration guide")})]})},ct=o=>({list:(0,O.css)({padding:"revert"})});var g=c(96540),H=c(17172),f=c(55852),b=c(59120);function Y(){return(0,t.jsx)(T.F,{severity:"error",title:(0,e.t)("migrate-to-cloud.migration-token.error-title","Something went wrong"),children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.migration-token.error-body",children:"Unable to generate a migration token. Please try again later."})})}var w=c(37390),W=c(10534),z=c(88575),V=c(10354);const dt=({isOpen:o,hideModal:n,migrationToken:r})=>(0,t.jsxs)(w.a,{isOpen:o,title:(0,e.t)("migrate-to-cloud.migration-token.modal-title","Migration token created"),onDismiss:n,children:[r?(0,t.jsx)(ut,{migrationToken:r}):(0,t.jsx)(Y,{}),(0,t.jsxs)(w.a.ButtonRow,{children:[(0,t.jsx)(f.$n,{variant:"secondary",onClick:n,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.migration-token.modal-close",children:"Close"})}),r&&(0,t.jsx)(W.b,{variant:"primary",getText:()=>r,onClipboardCopy:n,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.migration-token.modal-copy-and-close",children:"Copy to clipboard and close"})})]})]});function ut({migrationToken:o}){const n=(0,g.useId)();return(0,t.jsx)(z.D,{description:(0,e.t)("migrate-to-cloud.migration-token.modal-field-description","Copy the token now as you will not be able to see it again. Losing a token requires creating a new one."),htmlFor:n,label:(0,e.t)("migrate-to-cloud.migration-token.modal-field-label","Token"),children:(0,t.jsxs)(h.B,{children:[(0,t.jsx)(V.p,{id:n,value:o,readOnly:!0}),(0,t.jsx)(W.b,{icon:"clipboard-alt",getText:()=>o,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.migration-token.modal-copy-button",children:"Copy to clipboard"})})]})})}var X=c(96374);function gt(o){const{isOpen:n,hasError:r,onConfirm:s,onDismiss:a}=o,i=(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.delete-migration-token-confirm.body",children:"If you've already used this token with a self-managed installation, that installation will no longer be able to upload content."})}),r&&(0,t.jsx)(T.F,{severity:"error",title:(0,e.t)("migrate-to-cloud.delete-migration-token-confirm.error-title","Error deleting token")})]});return(0,t.jsx)(X.u,{isOpen:n,title:(0,e.t)("migrate-to-cloud.delete-migration-token-confirm.title","Delete migration token"),body:i,confirmText:(0,e.t)("migrate-to-cloud.delete-migration-token-confirm.confirm-button","Delete token"),onConfirm:s,onDismiss:a})}var P=c(70255);const mt=({hasToken:o,errorMessageId:n,isFetching:r})=>r?(0,t.jsx)(P.A,{width:100}):o?(0,t.jsx)(l.E,{color:"success",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.token-status.active",children:"Token created and active"})}):n==="cloudmigrations.tokenNotFound"?(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.token-status.no-active",children:"No active token"}):n?(0,t.jsx)(l.E,{color:"error",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.token-status.unknown-error",children:"Error retrieving token"})}):(0,t.jsx)(l.E,{color:"warning",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.token-status.unknown",children:"Unknown"})});function ht(o){if(!(0,H.NF)(o)||typeof o.data!="object"||!o.data)return null;const n=o?.data,r="message"in n&&typeof n.message=="string"?n.message:null,s="messageId"in n&&typeof n.messageId=="string"?n.messageId:null,a="statusCode"in n&&typeof n.statusCode=="number"?n.statusCode:null;return!r||!s||!a?null:{message:r,messageId:s,statusCode:a}}const xt=()=>{const[o,n]=(0,g.useState)(!1),[r,s]=(0,g.useState)(!1),a=(0,b.YX)(),[i,m]=(0,b.dX)(),[d,u]=(0,b.WH)(),p=ht(a.error),j=!!a.data?.id&&p?.statusCode!==404,y=a.isFetching||m.isLoading,I=(0,g.useCallback)(async()=>{"error"in await i()||n(!0)},[i]),k=(0,g.useCallback)(async()=>{if(!a.data?.id)return;"error"in await d({uid:a.data.id})||s(!1)},[d,a.data]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(v.a,{display:"flex",alignItems:"flex-start",direction:"column",gap:2,children:[m?.isError?(0,t.jsx)(Y,{}):(0,t.jsx)(l.E,{color:"secondary",children:(0,t.jsxs)(e.x6,{i18nKey:"migrate-to-cloud.migration-token.status",children:["Current status:"," ",(0,t.jsx)(mt,{hasToken:j,isFetching:y,errorMessageId:p?.messageId})]})}),j?(0,t.jsx)(f.$n,{onClick:()=>s(!0),variant:"destructive",children:(0,e.t)("migrate-to-cloud.migration-token.delete-button","Delete token")}):(0,t.jsx)(f.$n,{disabled:y,onClick:I,children:m.isLoading?(0,e.t)("migrate-to-cloud.migration-token.generate-button-loading","Generating a migration token..."):(0,e.t)("migrate-to-cloud.migration-token.generate-button","Generate a migration token")})]}),(0,t.jsx)(dt,{isOpen:o,hideModal:()=>n(!1),migrationToken:m.data?.token}),(0,t.jsx)(gt,{isOpen:r,onConfirm:k,onDismiss:()=>s(!1),hasError:!!u.error})]})},pt=()=>(0,t.jsx)(v.a,{backgroundColor:"secondary",display:"flex",alignItems:"center",direction:"column",children:(0,t.jsxs)(v.a,{maxWidth:90,paddingY:6,paddingX:2,gap:6,direction:"column",display:"flex",children:[(0,t.jsxs)(h.B,{gap:2,direction:"column",children:[(0,t.jsx)(it,{}),(0,t.jsx)(xt,{})]}),(0,t.jsx)(lt,{})]})});var B=c(10378);function Z(o){const{error:n,children:r,...s}=o,a=ft(n);return(0,t.jsx)(T.F,{...s,children:(0,t.jsxs)(h.B,{direction:"column",gap:1,children:[r,a&&(0,t.jsxs)(l.E,{element:"p",color:"secondary",variant:"bodySmall",children:["Trace ID: ",a]})]})})}function ft(o){const n=(0,H.NF)(o)?o.data:o;if(typeof n=="object"&&n&&"traceID"in n&&typeof n.traceID=="string")return n.traceID}const yt=({isOpen:o,isError:n,isLoading:r,onDisconnectConfirm:s,onDismiss:a})=>{const i=(0,t.jsxs)(h.B,{direction:"column",children:[n&&(0,t.jsx)(T.F,{severity:"error",title:(0,e.t)("migrate-to-cloud.disconnect-modal.error","There was an error disconnecting")}),(0,t.jsx)("div",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.disconnect-modal.body",children:"This will remove the migration token from this installation. If you wish to upload more resources in the future, you will need to enter a new migration token."})})]});return(0,t.jsx)(X.u,{isOpen:o,title:(0,e.t)("migrate-to-cloud.disconnect-modal.title","Disconnect from cloud stack"),body:(0,t.jsx)(t.Fragment,{}),description:i,confirmText:r?(0,e.t)("migrate-to-cloud.disconnect-modal.disconnecting","Disconnecting..."):(0,e.t)("migrate-to-cloud.disconnect-modal.disconnect","Disconnect"),dismissText:(0,e.t)("migrate-to-cloud.disconnect-modal.cancel","Cancel"),onConfirm:s,onDismiss:a})};var jt=c(71259),vt=c(49785);const bt=({isOpen:o,isLoading:n,error:r,hideModal:s,onConfirm:a})=>{const i=(0,g.useId)(),m=(0,K.of)(kt),{handleSubmit:d,register:u,formState:{errors:p},watch:j}=(0,vt.mN)({defaultValues:{token:""}}),y=j("token"),I=k=>{a({cloudMigrationSessionRequestDto:{authToken:k.token}}).then(x=>{typeof x=="object"&&x&&"error"in x||s()})};return(0,t.jsx)(w.a,{isOpen:o,title:(0,e.t)("migrate-to-cloud.connect-modal.title","Connect to a cloud stack"),onDismiss:s,children:(0,t.jsxs)("form",{onSubmit:d(I),children:[(0,t.jsx)(l.E,{color:"secondary",children:(0,t.jsxs)(h.B,{direction:"column",gap:2,children:[(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.connect-modal.body-get-started",children:"To get started, you'll need a Grafana.com account."}),(0,t.jsx)("div",{children:(0,t.jsx)(E.Y,{href:"https://grafana.com/auth/sign-up/create-user?pg=prod-cloud",external:!0,children:(0,e.t)("migrate-to-cloud.connect-modal.body-sign-up","Sign up for a Grafana.com account")})}),(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.connect-modal.body-cloud-stack",children:"You'll also need a cloud stack. If you just signed up, we'll automatically create your first stack. If you have an account, you'll need to select or create a stack."}),(0,t.jsx)("div",{children:(0,t.jsx)(E.Y,{href:"https://grafana.com/auth/sign-in/",external:!0,children:(0,e.t)("migrate-to-cloud.connect-modal.body-view-stacks","View my cloud stacks")})}),(0,t.jsx)("div",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.connect-modal.body-token",children:"Your self-managed Grafana installation needs special access to securely migrate content. You'll need to create a migration token on your chosen cloud stack."})}),(0,t.jsx)("div",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.connect-modal.body-token-instructions",children:"Log into your cloud stack and navigate to Administration, General, Migrate to Grafana Cloud. Create a migration token on that screen and paste the token here."})}),r?(0,t.jsx)(Z,{error:r,severity:"error",title:(0,e.t)("migrate-to-cloud.connect-modal.token-error-title","Error saving token"),children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.connect-modal.token-error-description",children:"There was an error saving the token. See the Grafana server logs for more details."})}):void 0,(0,t.jsx)(z.D,{className:m.field,invalid:!!p.token,error:p.token?.message,label:(0,e.t)("migrate-to-cloud.connect-modal.body-token-field","Migration token"),required:!0,children:(0,t.jsx)(V.p,{...u("token",{required:(0,e.t)("migrate-to-cloud.connect-modal.token-required-error","Migration token is required")}),id:i,placeholder:(0,e.t)("migrate-to-cloud.connect-modal.body-token-field-placeholder","Paste token here")})})]})}),(0,t.jsxs)(w.a.ButtonRow,{children:[(0,t.jsx)(f.$n,{variant:"secondary",onClick:s,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.connect-modal.cancel",children:"Cancel"})}),(0,t.jsx)(f.$n,{type:"submit",disabled:n||!y,children:n?(0,e.t)("migrate-to-cloud.connect-modal.connecting","Connecting to this stack..."):(0,e.t)("migrate-to-cloud.connect-modal.connect","Connect to this stack")})]})]})})},kt=o=>({field:(0,O.css)({alignSelf:"stretch"})}),St=()=>{const[o,n]=(0,g.useState)(!1),[r,s]=(0,b.hZ)();return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(v.a,{display:"flex",gap:2,direction:"column",alignItems:"center",backgroundColor:"secondary",children:[(0,t.jsx)(l.E,{variant:"h3",textAlignment:"center",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.cta.header",children:"Let us manage your Grafana stack"})}),(0,t.jsx)(f.$n,{disabled:s.isLoading,onClick:()=>n(!0),children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.cta.button",children:"Migrate this instance to Cloud"})})]}),(0,t.jsx)(bt,{isOpen:o,isLoading:s.isLoading,error:s.error,onConfirm:r,hideModal:()=>n(!1)})]})},Ct=()=>(0,t.jsxs)(h.B,{gap:4,direction:"column",children:[(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.what-is-cloud.title","What is Grafana Cloud?"),linkTitle:(0,e.t)("migrate-to-cloud.what-is-cloud.link-title","Learn about cloud features"),linkHref:"https://grafana.com/products/cloud",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.what-is-cloud.body",children:"Grafana cloud is a fully managed cloud-hosted observability platform ideal for cloud native environments. It's everything you love about Grafana without the overhead of maintaining, upgrading, and supporting an installation."})}),(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.why-host.title","Why host with Grafana?"),linkTitle:(0,e.t)("migrate-to-cloud.why-host.link-title","More questions? Talk to an expert"),linkHref:"https://grafana.com/contact",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.why-host.body",children:"In addition to the convenience of managed hosting, Grafana Cloud includes many cloud-exclusive features like SLOs, incident management, machine learning, and powerful observability integrations."})}),(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.is-it-secure.title","Is it secure?"),linkTitle:(0,e.t)("migrate-to-cloud.is-it-secure.link-title","Grafana Labs Trust Center"),linkHref:"https://trust.grafana.com",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.is-it-secure.body",children:"Grafana Labs is committed to maintaining the highest standards of data privacy and security. By implementing industry-standard security technologies and procedures, we help protect our customers' data from unauthorized access, use, or disclosure."})})]}),It=()=>(0,t.jsxs)(h.B,{gap:4,direction:"column",children:[(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.pdc.title","Not all my data sources are on the public internet"),linkTitle:(0,e.t)("migrate-to-cloud.pdc.link-title","Learn about PDC"),linkHref:"https://grafana.com/docs/grafana-cloud/connect-externally-hosted/private-data-source-connect",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.pdc.body",children:"Exposing your data sources to the internet can raise security concerns. Private data source connect (PDC) allows Grafana Cloud to access your existing data sources over a secure network tunnel."})}),(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.pricing.title","How much does it cost?"),linkTitle:(0,e.t)("migrate-to-cloud.pricing.link-title","Grafana Cloud pricing"),linkHref:"https://grafana.com/pricing",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.pricing.body",children:"Grafana Cloud has a generous free plan and a 14 day unlimited usage trial. After your trial expires, you'll be billed based on usage over the free plan limits."})}),(0,t.jsx)(C,{title:(0,e.t)("migrate-to-cloud.can-i-move.title","Can I move this installation to Grafana Cloud?"),linkTitle:(0,e.t)("migrate-to-cloud.can-i-move.link-title","Learn about migrating other settings"),linkHref:"https://grafana.com/docs/grafana-cloud/account-management/migration-guide",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.can-i-move.body",children:"Once you connect this installation to a cloud stack, you'll be able to upload data sources and dashboards."})})]}),Et=()=>(0,t.jsx)(v.a,{backgroundColor:"secondary",display:"flex",alignItems:"center",direction:"column",children:(0,t.jsx)(v.a,{maxWidth:180,paddingY:6,paddingX:2,children:(0,t.jsxs)(h.B,{gap:5,direction:"column",children:[(0,t.jsx)(St,{}),(0,t.jsxs)(jt.x,{alignItems:"flex-start",gap:4,columns:{xs:1,lg:2},children:[(0,t.jsx)(Ct,{}),(0,t.jsx)(It,{})]})]})})});var Dt=c(68402),Tt=c(84753);function R({title:o,children:n}){return(0,t.jsxs)(v.a,{minWidth:{xs:0,xxl:16},display:"flex",direction:"column",children:[(0,t.jsx)(l.E,{variant:"bodySmall",color:"secondary",children:o}),(0,t.jsx)(l.E,{variant:"h4",children:n})]})}const wt={dateStyle:"medium",timeStyle:"short"};function Rt(o){const{session:n,snapshot:r,isBusy:s,disconnectIsLoading:a,onDisconnect:i,showBuildSnapshot:m,buildSnapshotIsLoading:d,onBuildSnapshot:u,showUploadSnapshot:p,uploadSnapshotIsLoading:j,onUploadSnapshot:y,showRebuildSnapshot:I}=o,k=r?.stats?.total??0,x=r?.stats?.statuses?.ERROR??0,S=r?.stats?.statuses?.OK??0,M=r?.stats?.statuses?.WARNING??0;return(0,t.jsxs)(v.a,{borderColor:"weak",borderStyle:"solid",padding:2,display:"flex",gap:4,alignItems:"center",justifyContent:"space-between",children:[(0,t.jsxs)(h.B,{gap:4,wrap:!0,children:[(0,t.jsx)(R,{title:(0,e.t)("migrate-to-cloud.summary.snapshot-date","Snapshot timestamp"),children:r?.created?(0,Tt.Y)(r.created,wt):(0,t.jsx)(l.E,{color:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.snapshot-not-created",children:"Not yet created"})})}),(0,t.jsx)(R,{title:(0,e.t)("migrate-to-cloud.summary.total-resource-count","Total resources"),children:k}),(0,t.jsx)(R,{title:(0,e.t)("migrate-to-cloud.summary.errored-resource-count","Errors"),children:x}),(0,t.jsx)(R,{title:(0,e.t)("migrate-to-cloud.summary.successful-resource-count","Successfully migrated"),children:S+M}),(0,t.jsxs)(R,{title:(0,e.t)("migrate-to-cloud.summary.target-stack-title","Uploading to"),children:[n.slug,(0,t.jsx)(Dt.$,{h:1,layout:"inline"}),(0,t.jsx)(f.$n,{disabled:s,onClick:i,variant:"secondary",size:"sm",icon:a?"spinner":void 0,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.disconnect",children:"Disconnect"})})]})]}),(0,t.jsxs)(h.B,{gap:2,wrap:!0,justifyContent:"flex-end",children:[m&&(0,t.jsx)(f.$n,{disabled:s,onClick:u,icon:d?"spinner":void 0,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.start-migration",children:"Build snapshot"})}),I&&(0,t.jsx)(f.$n,{disabled:s,onClick:u,icon:d?"spinner":void 0,variant:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.rebuild-snapshot",children:"Rebuild snapshot"})}),p&&(0,t.jsx)(f.$n,{disabled:s||j,onClick:y,icon:j?"spinner":void 0,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.upload-migration",children:"Upload snapshot"})})]})]})}var Lt=c(48840),Nt=c(19384),G=c(14578),Q=c(78318),At=c(55314);function Gt(o){const n=o.row.original;return(0,t.jsxs)(h.B,{direction:"row",gap:2,alignItems:"center",children:[(0,t.jsx)(Ft,{resource:n}),(0,t.jsx)(h.B,{direction:"column",gap:0,children:(0,t.jsx)(Ot,{data:n})})]})}function Ot({data:o}){switch(o.type){case"DASHBOARD":return(0,t.jsx)(Bt,{data:o});case"DATASOURCE":return(0,t.jsx)(Pt,{data:o});case"FOLDER":return(0,t.jsx)(Mt,{data:o})}}function Kt(o){if("title"in o&&typeof o.title=="string")return o.title}function Pt({data:o}){const n=o.refId,r=q(n);return r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:r.name}),(0,t.jsx)(l.E,{color:"secondary",children:r.type})]}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.E,{children:(0,t.jsxs)(e.x6,{i18nKey:"migrate-to-cloud.resource-table.unknown-datasource-title",children:["Data source ",{datasourceUID:n}]})}),(0,t.jsx)(l.E,{color:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.resource-table.unknown-datasource-type",children:"Unknown data source"})})]})}function Bt({data:o}){const n=o.refId,{data:r,isError:s}=(0,b.bM)({uid:n}),a=(0,g.useMemo)(()=>(r?.dashboard&&Kt(r.dashboard))??n,[r,n]);return s?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.E,{italic:!0,children:"Unable to load dashboard"}),(0,t.jsxs)(l.E,{color:"secondary",children:["Dashboard ",n]})]}):r?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:a}),(0,t.jsx)(l.E,{color:"secondary",children:r.meta?.folderTitle??"Dashboards"})]}):(0,t.jsx)(J,{})}function Mt({data:o}){const{data:n,isLoading:r,isError:s}=(0,At.kH)(o.refId);if(r||!n)return(0,t.jsx)(J,{});if(s)return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.E,{italic:!0,children:"Unable to load dashboard"}),(0,t.jsxs)(l.E,{color:"secondary",children:["Dashboard ",o.refId]})]});const a=n.parents?.[n.parents.length-1]?.title;return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("span",{children:n.title}),(0,t.jsx)(l.E,{color:"secondary",children:a??"Dashboards"})]})}function J(){return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(P.A,{width:250}),(0,t.jsx)(P.A,{width:130})]})}function Ft({resource:o}){const n=(0,K.of)(Ut),r=q(o.type==="DATASOURCE"?o.refId:void 0);if(o.type==="DASHBOARD")return(0,t.jsx)(G.I,{size:"xl",name:"dashboard"});if(o.type==="FOLDER")return(0,t.jsx)(G.I,{size:"xl",name:"folder"});if(o.type==="DATASOURCE"&&r?.meta?.info?.logos?.small)return(0,t.jsx)("img",{className:n.icon,src:r.meta.info.logos.small,alt:""});if(o.type==="DATASOURCE")return(0,t.jsx)(G.I,{size:"xl",name:"database"})}function Ut(){return{icon:(0,O.css)({display:"block",width:(0,Q.cs)("xl"),height:(0,Q.cs)("xl")})}}function q(o){return(0,g.useMemo)(()=>{if(o)return D.$.datasources[o]||Object.values(D.$.datasources).find(r=>r.uid===o)},[o])}function _(o){switch(o){case"DATASOURCE":return(0,e.t)("migrate-to-cloud.resource-type.datasource","Data source");case"DASHBOARD":return(0,e.t)("migrate-to-cloud.resource-type.dashboard","Dashboard");case"FOLDER":return(0,e.t)("migrate-to-cloud.resource-type.folder","Folder");default:return(0,e.t)("migrate-to-cloud.resource-type.unknown","Unknown")}}function $t(o){const{type:n}=o.row.original;return(0,t.jsx)(t.Fragment,{children:_(n)})}function Ht(o){const{resource:n,onClose:r}=o,s=n?.refId,a=n&&_(n.type);let i=(0,e.t)("migrate-to-cloud.resource-details.generic-title","Resource migration details:");return n?.status==="ERROR"?i=(0,e.t)("migrate-to-cloud.resource-details.error-title","Unable to migrate this resource:"):n?.status==="WARNING"&&(i=(0,e.t)("migrate-to-cloud.resource-details.warning-title","Resource migrated with a warning:")),(0,t.jsx)(w.a,{title:(0,e.t)("migrate-to-cloud.resource-details.title","Migration resource details"),isOpen:!!n,onDismiss:r,children:n&&(0,t.jsxs)(h.B,{direction:"column",gap:2,alignItems:"flex-start",children:[(0,t.jsx)(l.E,{element:"p",weight:"bold",children:(0,t.jsxs)(e.x6,{i18nKey:"migrate-to-cloud.resource-details.resource-summary",children:[{refId:s}," (",{typeName:a},")"]})}),n.message?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.E,{element:"p",children:i}),(0,t.jsx)(l.E,{element:"p",weight:"bold",children:n.message})]}):(0,t.jsx)(l.E,{element:"p",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.resource-details.missing-message",children:"No message provided."})}),(0,t.jsx)(f.$n,{onClick:r,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.resource-details.dismiss-button",children:"OK"})})]})})}function Yt(o){const n=o.row.original;return n.status==="PENDING"?(0,t.jsx)(l.E,{color:"secondary",children:(0,e.t)("migrate-to-cloud.resource-status.not-migrated","Not yet uploaded")}):n.status==="OK"?(0,t.jsx)(l.E,{color:"success",children:(0,e.t)("migrate-to-cloud.resource-status.migrated","Uploaded to cloud")}):n.status==="WARNING"?(0,t.jsx)(zt,{item:n}):n.status==="ERROR"?(0,t.jsx)(Wt,{item:n}):(0,t.jsx)(l.E,{color:"secondary",children:(0,e.t)("migrate-to-cloud.resource-status.unknown","Unknown")})}function Wt({item:o}){return(0,t.jsxs)(h.B,{alignItems:"center",children:[(0,t.jsx)(l.E,{color:"error",children:(0,e.t)("migrate-to-cloud.resource-status.failed","Error")}),o.message&&(0,t.jsx)(f.$n,{size:"sm",variant:"secondary",onClick:()=>o.showDetails(o),children:(0,e.t)("migrate-to-cloud.resource-status.error-details-button","Details")})]})}function zt({item:o}){return(0,t.jsxs)(h.B,{alignItems:"center",children:[(0,t.jsx)(l.E,{color:"warning",children:(0,e.t)("migrate-to-cloud.resource-status.warning","Uploaded with warning")}),o.message&&(0,t.jsx)(f.$n,{size:"sm",variant:"secondary",onClick:()=>o.showDetails(o),children:(0,e.t)("migrate-to-cloud.resource-status.warning-details-button","Details")})]})}const Vt=[{id:"name",header:"Name",cell:Gt},{id:"type",header:"Type",cell:$t},{id:"status",header:"Status",cell:Yt}];function Xt({resources:o,numberOfPages:n=0,onChangePage:r,page:s=1}){const[a,i]=(0,g.useState)(),m=(0,g.useCallback)(u=>{i(u)},[]),d=(0,g.useMemo)(()=>o.map(u=>({...u,showDetails:m})),[o,m]);return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.B,{alignItems:"flex-end",direction:"column",children:[(0,t.jsx)(Lt.j,{columns:Vt,data:d,getRowId:u=>u.refId}),(0,t.jsx)(Nt.d,{numberOfPages:n,currentPage:s,onNavigate:r})]}),(0,t.jsx)(Ht,{resource:a,onClose:()=>i(void 0)})]})}var Zt=c(62930);function tt(o){const{title:n,accessory:r,children:s}=o;return(0,t.jsxs)(v.a,{maxWidth:44,display:"flex",direction:"row",gap:1,alignItems:"flex-start",children:[r&&(0,t.jsx)(v.a,{children:r}),(0,t.jsxs)(h.B,{gap:2,direction:"column",alignItems:"flex-start",children:[(0,t.jsx)(l.E,{element:"h3",variant:"h5",children:n}),s]})]})}function Qt(o){const{disabled:n,isLoading:r,onClick:s}=o;return(0,t.jsxs)(tt,{title:(0,e.t)("migrate-to-cloud.build-snapshot.title","No snapshot exists"),accessory:(0,t.jsx)(G.I,{name:"cog",size:"lg"}),children:[(0,t.jsx)(l.E,{element:"p",variant:"body",color:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.build-snapshot.description",children:"This tool can migrate some resources from this installation to your cloud stack. To get started, you'll need to create a snapshot of this installation. Creating a snapshot typically takes less than two minutes. The snapshot is stored alongside this Grafana installation."})}),(0,t.jsx)(l.E,{element:"p",variant:"body",color:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.build-snapshot.when-complete",children:"Once the snapshot is complete, you will be able to upload it to your cloud stack."})}),(0,t.jsx)(f.$n,{disabled:n,onClick:s,icon:r?"spinner":void 0,children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.start-migration",children:"Build snapshot"})})]})}function Jt(o){const{disabled:n,isLoading:r,onClick:s}=o;return(0,t.jsxs)(tt,{title:(0,e.t)("migrate-to-cloud.building-snapshot.title","Building installation snapshot"),accessory:(0,t.jsx)(Zt.y,{inline:!0}),children:[(0,t.jsx)(l.E,{element:"p",variant:"body",color:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.building-snapshot.description",children:"We're creating a point-in-time snapshot of the current state of this installation. Once the snapshot is complete. you'll be able to upload it to Grafana Cloud."})}),(0,t.jsx)(l.E,{element:"p",variant:"body",color:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.building-snapshot.description-eta",children:"Creating a snapshot typically takes less than two minutes."})}),(0,t.jsx)(f.$n,{disabled:n,onClick:s,icon:r?"spinner":void 0,variant:"secondary",children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.cancel-snapshot",children:"Cancel snapshot"})})]})}function qt(){return(0,t.jsx)(l.E,{color:"secondary",textAlignment:"center",children:(0,t.jsxs)(e.x6,{i18nKey:"migrate-to-cloud.support-types-disclosure.text",children:["Dashboards, Folders, and built-in core data sources are migrated to your Grafana Cloud stack."," ",(0,t.jsx)(E.Y,{external:!0,href:"https://grafana.com/docs/grafana-cloud/account-management/migration-guide",children:"Learn about migrating other settings."})]})})}var L=c(72635),_t=c(3169);function te(o){const n=(0,g.useRef)(void 0),r=(0,_t._2)();(0,g.useEffect)(()=>{const s=o?.status,a=n.current!=="FINISHED"&&n.current!==void 0&&s==="FINISHED";if(n.current=s,!!a&&o){const i=(0,L.t)("migrate-to-cloud.onprem.success-title","Migration completed!"),m=ee(o);r.success(i,m)}},[r,o])}function ee(o){const n=[];for(const[a,i]of Object.entries(o.stats?.types??{}))i<=0||(a==="DASHBOARD"?n.push((0,L.t)("migrate-to-cloud.migrated-counts.dashboards","dashboards")):a==="DATASOURCE"?n.push((0,L.t)("migrate-to-cloud.migrated-counts.datasources","data sources")):a==="FOLDER"&&n.push((0,L.t)("migrate-to-cloud.migrated-counts.folders","folders")));const r=o?.stats?.statuses?.OK??0;return(0,L.t)("migrate-to-cloud.onprem.success-message","Successfully migrated {{successCount}} {{types, list}} to your Grafana Cloud instance.",{successCount:r,types:n})}function oe(){const o=(0,b.SM)(),n=o.data?.sessions?.at(-1);return{...o,data:n}}const ne=["INITIALIZING","CREATING","UPLOADING","PENDING_PROCESSING","PROCESSING"],re=["PENDING_UPLOAD","FINISHED","ERROR","UNKNOWN"],se=["INITIALIZING","CREATING"],et=["UPLOADING","PENDING_PROCESSING","PROCESSING"],ot=50;function ae(o,n=1){const[r,s]=(0,g.useState)(!1),a=(0,b.M8)(o?{uid:o}:B.hT),i=a.currentData?.snapshots?.at(0),m=o&&i?.uid?{uid:o,snapshotUid:i.uid,resultLimit:ot,resultPage:n}:B.hT,d=(0,b.YD)(m,{pollingInterval:r?D.$.cloudMigrationPollIntervalMs:0,skipPollingIfUnfocused:!0}),u=a.isError||d.isError;return(0,g.useEffect)(()=>{const p=!u&&ne.includes(d.data?.status);s(p)},[d?.data?.status,u]),{...d,data:m===B.hT?void 0:d.data,error:a.error||d.error,isError:u,isLoading:a.isLoading||d.isLoading,isFetching:a.isFetching||d.isFetching}}const ie=()=>{const[o,n]=(0,g.useState)(!1),r=oe(),[s,a]=(0,g.useState)(1),i=ae(r.data?.uid,s),[m,d]=(0,b.ri)(),[u,p]=(0,b.aD)(),[j,y]=(0,b.r3)(),[I,k]=(0,b.AC)();te(i.data);const x=r.data?.uid,S=i.data?.uid,M=r.isLoading,N=i.data?.status,F=d.isLoading||p.isLoading||y.isLoading||r.isLoading||i.isLoading||k.isLoading,U=!i.isError&&!i.isLoading&&!i.data,nt=se.includes(N),de=!i.isError&&(N==="PENDING_UPLOAD"||et.includes(N)),ue=re.includes(N),A=le({snapshot:i.data,getSnapshotError:i.error,getSessionError:r.error,createSnapshotError:d.error,uploadSnapshotError:p.error,cancelSnapshotError:y.error,disconnectSnapshotError:k.error}),rt=(0,g.useCallback)(async()=>{x&&I({uid:x})},[I,x]),st=(0,g.useCallback)(()=>{x&&m({uid:x})},[m,x]),ge=(0,g.useCallback)(()=>{x&&S&&u({uid:x,snapshotUid:S})},[u,x,S]),me=(0,g.useCallback)(()=>{x&&S&&j({uid:x,snapshotUid:S})},[j,x,S]);return M?(0,t.jsx)("div",{children:(0,t.jsx)(e.x6,{i18nKey:"migrate-to-cloud.summary.page-loading",children:"Loading..."})}):r.data?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(h.B,{direction:"column",gap:2,children:[r.data&&(0,t.jsx)(Rt,{session:r.data,snapshot:i.data,isBusy:F,disconnectIsLoading:k.isLoading,onDisconnect:rt,showBuildSnapshot:U,buildSnapshotIsLoading:d.isLoading,onBuildSnapshot:st,showUploadSnapshot:de,uploadSnapshotIsLoading:p.isLoading||et.includes(N),onUploadSnapshot:ge,showRebuildSnapshot:ue}),A&&(0,t.jsx)(Z,{severity:A.severity,title:A.title,error:A.error,children:(0,t.jsx)(l.E,{element:"p",children:A.body})}),(U||nt)&&(0,t.jsxs)(v.a,{display:"flex",justifyContent:"center",paddingY:10,children:[U&&(0,t.jsx)(Qt,{disabled:F,isLoading:d.isLoading,onClick:st}),nt&&(0,t.jsx)(Jt,{disabled:F,isLoading:y.isLoading,onClick:me})]}),i.data?.results&&i.data.results.length>0&&(0,t.jsxs)(h.B,{gap:4,direction:"column",children:[(0,t.jsx)(Xt,{resources:i.data.results,onChangePage:a,numberOfPages:Math.ceil((i?.data?.stats?.total||0)/ot),page:s}),(0,t.jsx)(qt,{})]})]}),(0,t.jsx)(yt,{isOpen:o,isLoading:k.isLoading,isError:k.isError,onDisconnectConfirm:rt,onDismiss:()=>n(!1)})]}):(0,t.jsx)(Et,{})};function le(o){const{snapshot:n,getSnapshotError:r,getSessionError:s,createSnapshotError:a,uploadSnapshotError:i,cancelSnapshotError:m,disconnectSnapshotError:d}=o,u=(0,e.t)("migrate-to-cloud.onprem.error-see-server-logs","See the Grafana server logs for more details");if(s)return{severity:"error",title:(0,e.t)("migrate-to-cloud.onprem.get-session-error-title","Error loading migration configuration"),body:u,error:s};if(r)return{severity:"error",title:(0,e.t)("migrate-to-cloud.onprem.get-snapshot-error-title","Error loading snapshot"),body:u,error:r};if(d)return{severity:"warning",title:(0,e.t)("migrate-to-cloud.onprem.disconnect-error-title","Error disconnecting"),body:u,error:d};if(a)return{severity:"warning",title:(0,e.t)("migrate-to-cloud.onprem.create-snapshot-error-title","Error creating snapshot"),body:u,error:a};if(i)return{severity:"warning",title:(0,e.t)("migrate-to-cloud.onprem.upload-snapshot-error-title","Error uploading snapshot"),body:u,error:i};if(m)return{severity:"warning",title:(0,e.t)("migrate-to-cloud.onprem.cancel-snapshot-error-title","Error cancelling creating snapshot"),body:u,error:m};if(n?.status==="ERROR")return{severity:"warning",title:(0,e.t)("migrate-to-cloud.onprem.snapshot-error-status-title","Error migrating resources"),body:(0,e.t)("migrate-to-cloud.onprem.snapshot-error-status-body","There was an error creating the snapshot or starting the migration process. See the Grafana server logs for more details")};const p=n?.stats?.statuses?.ERROR??0,j=n?.stats?.statuses?.WARNING??0;if(n?.status==="FINISHED"&&p+j>0){let y="";return p>0?y=(0,e.t)("migrate-to-cloud.onprem.migration-finished-with-errors-body","The migration has completed, but some items could not be migrated to the cloud stack. Check the failed resources for more details"):j>0&&(y=(0,e.t)("migrate-to-cloud.onprem.migration-finished-with-warnings-body","The migration has completed with some warnings. Check individual resources for more details")),{severity:"warning",title:(0,e.t)("migrate-to-cloud.onprem.migration-finished-with-caveat-title","Resource migration complete"),body:y}}}function ce(){const o=D.$.cloudMigrationFeedbackURL;return(0,t.jsxs)(at.Y,{navId:"migrate-to-cloud",children:[(0,t.jsx)(T.F,{title:(0,e.t)("migrate-to-cloud.public-preview.title","Migrate to Grafana Cloud is in public preview"),buttonContent:(0,e.t)("migrate-to-cloud.public-preview.button-text","Give feedback"),severity:"info",onRemove:o?()=>{window.open(o,"_blank")}:void 0,children:(0,t.jsxs)(e.x6,{i18nKey:"migrate-to-cloud.public-preview.message",children:["No SLAs are available yet."," ",(0,t.jsx)(E.Y,{href:"https://grafana.com/docs/grafana-cloud/account-management/migration-guide/#grafana-cloud-migration-assistant",external:!0,children:"Visit our docs"})," ","to learn more about this feature!"]})}),D.$.cloudMigrationIsTarget?(0,t.jsx)(pt,{}):(0,t.jsx)(ie,{})]})}}}]);

//# sourceMappingURL=MigrateToCloud.c1b7facd09d57a3f82db.js.map