"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[7049],{99226:(Te,ue,t)=>{t.d(ue,{gv:()=>$});var e=t(74848),c=t(2543),C=t.n(c),G=t(32264),D=t(67061),h=t(55852),O=t(25968);const M=G.$.unifiedAlerting.minInterval??"10s",U=((J=M)=>{const K=[(0,O.M9)("10s"),(0,O.M9)("30s"),(0,O.M9)("1m"),(0,O.M9)("5m"),(0,O.M9)("10m"),(0,O.M9)("15m"),(0,O.M9)("30m"),(0,O.M9)("1h")],E=(0,O.P8)(J),Y=K.filter(L=>E<=L),te=(0,c.times)(8-Y.length,L=>{const ye=(0,c.last)(Y)??E,ae=Y.length===0?1:2;return ye*ae*(L+1)});return[...Y,...te].map(O.an)})(M),$=({currentInterval:J,onSelect:H})=>(0,e.jsx)(D.B,{direction:"row",gap:.5,role:"listbox",children:U.map(K=>{const E=J===K;return(0,e.jsx)(h.$n,{role:"option","aria-selected":E,variant:E?"primary":"secondary",size:"sm",onClick:()=>H(K),children:K},K)})})},1723:(Te,ue,t)=>{t.d(ue,{R:()=>Qe,I:()=>_});var e=t(74848),c=t(32196),C=t(96540),G=t(49785),D=t(40845),h=t(67061),O=t(29158),M=t(88575),Q=t(60029),U=t(10354),$=t(94753),J=t(15292),H=t(56034),K=t(14578),E=t(8484),Y=t(23662),te=t(25027),L=t(9518),ye=t(61410),ae=t(57220),re=t(25968),Ne=t(64047),ce=t(22040),de=t(2543),Me=t(26272),X=t(13544),Z=t(55852),Ee=t(90182),Ae=t(90613),he=t(37390),Ie=t(28138),Ce=t(16233),ne=t(11230),Ge=t(31678),Be=t(79938),De=t(730),pe=t(63066),Le=t(48205),oe=t(99226),Pe=t(85242);const be=()=>{const a=(0,D.of)(Ke),r=()=>window.open("https://github.com/grafana/grafana/issues/42947","_blank");return(0,e.jsxs)(h.B,{gap:.5,children:[(0,e.jsx)("div",{className:a.slashNotAllowed,children:"Folders with '/' character are not allowed."}),(0,e.jsx)(H.m,{placement:"top",content:"Link to the Github issue",theme:"info",children:(0,e.jsx)(K.I,{name:"info-circle",size:"xs",className:a.infoIcon,onClick:r})})]})},me=a=>a.indexOf("/")!==-1;function we(a){const{value:r}=a,n={warningCondition:u=>me(u),warningComponent:be},s={disallowValues:!0,isAllowedValue:u=>!me(u)};return(0,e.jsx)(Pe.sR,{showRoot:!1,rootName:"",allowEmpty:!0,initialFolderUid:r?.uid,searchQueryType:Ge.SearchQueryType.AlertFolder,...a,permissionLevel:Ge.PermissionLevelString.Edit,customAdd:s,folderWarning:n})}const Ke=a=>({slashNotAllowed:(0,c.css)({color:a.colors.warning.main,fontSize:"12px",marginBottom:"2px"}),infoIcon:(0,c.css)({color:a.colors.warning.main,fontSize:"12px",marginBottom:"2px",cursor:"pointer"})});var Re=t(7921);const Ve=1e3,Se=(a,r)=>{const{isLoading:o,currentData:n}=Be.hK.endpoints.rulerNamespace.useQuery({namespace:a,rulerConfig:De.$q},{skip:!a,refetchOnMountOrArgChange:!0});return{groupOptions:(0,C.useMemo)(()=>n?(Object.values(n).flat()??[]).map(v=>{const m=i(v);return{label:v.name,value:v.name,description:v.interval??pe.T6,isDisabled:r?!1:m,isProvisioned:m}}).sort(p):[],[n,r]),loading:o}},i=a=>a.rules.some(r=>(0,Y.lT)(r)&&!!r.grafana_alert.provenance),p=(a,r)=>a.label?.localeCompare(r.label??"")||0,g=(a,r)=>a.label?.toLowerCase().includes(r.toLowerCase());function j({groupfoldersForGrafana:a,enableProvisionedGroups:r}){const{formState:{errors:o},watch:n,setValue:s,control:u}=(0,G.xW)(),v=(0,D.of)(N),m=n("folder"),R=n("group"),{groupOptions:f,loading:F}=Se(m?.uid??"",r),[T,l]=(0,C.useState)(!1),[A,S]=(0,C.useState)(!1),B=()=>l(!0),w=()=>S(!0),z=x=>{ve(),s("folder",x),l(!1)},ge=(x,ee)=>{s("group",x),s("evaluateEvery",ee),S(!1)},ve=(0,C.useCallback)(()=>{s("group","")},[s]),ie=(0,C.useCallback)(async x=>{const ee=x?f.filter(Oe=>g(Oe,x)):f;return(0,de.take)(ee,Ve)},[f]),Ue=(0,C.useMemo)(()=>(0,de.debounce)(ie,300,{leading:!0}),[ie]),$e=R?{value:R,label:R}:void 0;return(0,e.jsxs)("div",{className:v.container,children:[(0,e.jsxs)(h.B,{alignItems:"center",children:[(0,e.jsx)(M.D,{label:(0,e.jsx)(Q.J,{htmlFor:"folder",description:"Select a folder to store your rule.",children:"Folder"}),className:v.formInput,error:o.folder?.message,"data-testid":"folder-picker",children:(0,e.jsx)(h.B,{direction:"row",alignItems:"center",children:!T&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(G.xI,{render:({field:{ref:x,...ee}})=>(0,e.jsx)("div",{style:{width:420},children:(0,e.jsx)(we,{inputId:"folder",invalid:!!o.folder?.message,...ee,enableReset:!0,onChange:({title:Oe,uid:je})=>{ee.onChange({title:Oe,uid:je}),ve()}})}),name:"folder",rules:{required:{value:!0,message:"Select a folder"},validate:{pathSeparator:x=>(0,Re.G0)(x.uid)}}}),(0,e.jsx)($.E,{color:"secondary",children:"or"}),(0,e.jsx)(Z.$n,{onClick:B,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!Ce.TP.hasPermission(Ge.AccessControlAction.FoldersCreate),"data-testid":X.Tp.components.AlertRules.newFolderButton,children:"New folder"})]})||(0,e.jsx)("div",{children:"Creating new folder..."})})}),T&&(0,e.jsx)(y,{onCreate:z,onClose:()=>l(!1)})]}),T&&(0,e.jsx)(y,{onCreate:z,onClose:()=>l(!1)}),(0,e.jsxs)(h.B,{alignItems:"center",children:[(0,e.jsx)("div",{style:{width:420},children:(0,e.jsx)(M.D,{label:"Evaluation group and interval","data-testid":"group-picker",description:"Define how often the alert rule is evaluated.",className:v.formInput,error:o.group?.message,invalid:!!o.group?.message,children:(0,e.jsx)(G.xI,{render:({field:{ref:x,...ee},fieldState:Oe})=>(0,e.jsx)(Ee.DW,{disabled:!m||F,inputId:"group",...ee,onChange:je=>{ee.onChange(je.label??"")},isLoading:F,invalid:!!m&&!R&&!!Oe.error,loadOptions:Ue,cacheOptions:!0,loadingMessage:"Loading groups...",defaultValue:$e,defaultOptions:f,getOptionLabel:je=>(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{children:je.label}),je.isProvisioned&&(0,e.jsxs)(e.Fragment,{children:[" ",(0,e.jsx)(Le.rS,{})]})]}),placeholder:"Select an evaluation group..."},(0,de.uniqueId)()),name:"group",control:u,rules:{required:{value:!0,message:"Must enter a group name"},validate:{pathSeparator:x=>(0,Re.G0)(x)}}})})}),(0,e.jsxs)(Ae.a,{marginTop:4,gap:1,display:"flex",alignItems:"center",children:[(0,e.jsx)($.E,{color:"secondary",children:"or"}),(0,e.jsx)(Z.$n,{onClick:w,type:"button",icon:"plus",fill:"outline",variant:"secondary",disabled:!m,"data-testid":X.Tp.components.AlertRules.newEvaluationGroupButton,children:"New evaluation group"})]}),A&&(0,e.jsx)(I,{onCreate:ge,onClose:()=>S(!1),groupfoldersForGrafana:a})]})]})}function y({onClose:a,onCreate:r}){const o=(0,D.of)(N),[n,s]=(0,C.useState)(""),u=async()=>{const m=await(0,ne.vV)({title:n});if(!m.uid){Ie.A.emit(Me.r1.alertError,["Folder could not be created"]);return}const R={title:m.title,uid:m.uid};r(R),Ie.A.emit(Me.r1.alertSuccess,["Folder Created","OK"])},v=me(n);return(0,e.jsxs)(he.a,{className:o.modal,isOpen:!0,title:"New folder",onDismiss:a,onClickBackdrop:a,children:[(0,e.jsx)("div",{className:o.modalTitle,children:"Create a new folder to store your rule"}),(0,e.jsxs)("form",{onSubmit:u,children:[(0,e.jsx)(M.D,{label:(0,e.jsx)(Q.J,{htmlFor:"folder",children:"Folder name"}),error:"The folder name can't contain slashes",invalid:v,children:(0,e.jsx)(U.p,{"data-testid":X.Tp.components.AlertRules.newFolderNameField,autoFocus:!0,id:"folderName",placeholder:"Enter a name",value:n,onChange:m=>s(m.currentTarget.value),className:o.formInput})}),(0,e.jsxs)(he.a.ButtonRow,{children:[(0,e.jsx)(Z.$n,{variant:"secondary",type:"button",onClick:a,children:"Cancel"}),(0,e.jsx)(Z.$n,{type:"submit",disabled:!n||v,"data-testid":X.Tp.components.AlertRules.newFolderNameCreateButton,children:"Create"})]})]})]})}function I({onClose:a,onCreate:r,groupfoldersForGrafana:o}){const n=(0,D.of)(N),s=()=>{r(w("group"),w("evaluateEvery"))},{watch:u}=(0,G.xW)(),v="eval-every-input",[m,R]=u(["group","folder.title"]),f=(o&&o[R]?.find(ie=>ie.name===m)?.rules)??[],F=()=>{a()},T=(0,G.mN)({defaultValues:{group:"",evaluateEvery:pe.T6},mode:"onChange",shouldFocusError:!0}),{register:l,handleSubmit:A,formState:S,setValue:B,getValues:w,watch:z}=T,ge=z("evaluateEvery"),ve=ie=>{B("evaluateEvery",ie,{shouldValidate:!0})};return(0,e.jsxs)(he.a,{className:n.modal,isOpen:!0,title:"New evaluation group",onDismiss:F,onClickBackdrop:F,children:[(0,e.jsx)("div",{className:n.modalTitle,children:"Create a new evaluation group to use for this alert rule."}),(0,e.jsx)(G.Op,{...T,children:(0,e.jsxs)("form",{onSubmit:A(()=>s()),children:[(0,e.jsx)(M.D,{label:(0,e.jsx)(Q.J,{htmlFor:"group",description:"A group evaluates all its rules over the same evaluation interval.",children:"Evaluation group"}),error:S.errors.group?.message,invalid:!!S.errors.group,children:(0,e.jsx)(U.p,{"data-testid":X.Tp.components.AlertRules.newEvaluationGroupName,className:n.formInput,autoFocus:!0,id:"group",placeholder:"Enter a name",...l("group",{required:{value:!0,message:"Required."}})})}),(0,e.jsx)(M.D,{error:S.errors.evaluateEvery?.message,invalid:S.errors.evaluateEvery?!0:void 0,label:(0,e.jsx)(Q.J,{htmlFor:v,description:"How often all rules in the group are evaluated.",children:"Evaluation interval"}),children:(0,e.jsxs)(h.B,{direction:"column",children:[(0,e.jsx)(U.p,{"data-testid":X.Tp.components.AlertRules.newEvaluationGroupInterval,className:n.formInput,id:v,placeholder:pe.T6,...l("evaluateEvery",(0,ce.iS)(f))}),(0,e.jsx)(h.B,{direction:"row",alignItems:"flex-end",children:(0,e.jsx)(oe.gv,{currentInterval:ge,onSelect:ve})})]})}),(0,e.jsxs)(he.a.ButtonRow,{children:[(0,e.jsx)(Z.$n,{variant:"secondary",type:"button",onClick:F,children:"Cancel"}),(0,e.jsx)(Z.$n,{type:"submit",disabled:!S.isValid,"data-testid":X.Tp.components.AlertRules.newEvaluationGroupCreate,children:"Create"})]})]})})]})}const N=a=>({container:(0,c.css)({display:"flex",flexDirection:"column",alignItems:"baseline",maxWidth:`${a.breakpoints.values.lg}px`,justifyContent:"space-between"}),formInput:(0,c.css)({flexGrow:1}),modal:(0,c.css)({width:`${a.breakpoints.values.sm}px`}),modalTitle:(0,c.css)({color:a.colors.text.secondary,marginBottom:a.spacing(2)})});var d=t(94822);const P=[{value:d.Q8.Alerting,label:"Alerting"},{value:d.Q8.NoData,label:"No Data"},{value:d.Q8.OK,label:"Normal"},{value:d.Q8.Error,label:"Error"},{value:d.Q8.KeepLast,label:"Keep Last State"}],V=({includeNoData:a,includeError:r,...o})=>{const n=(0,C.useMemo)(()=>a?r?P:P.filter(s=>s.value!==d.Q8.Error):P.filter(s=>s.value!==d.Q8.NoData),[a,r]);return(0,e.jsx)(Ee.l6,{options:n,...o})};var se=t(19338);function k(a){const r=(0,re.P8)(a);return[0,r*1,r*2,r*3,r*4,r*5].map(re.an)}function q({selectedPendingPeriod:a,groupEvaluationInterval:r,onSelect:o}){const n=u=>a===u,s=k(r);return(0,e.jsx)(h.B,{direction:"row",gap:.5,role:"listbox",children:s.map(u=>(0,e.jsx)(Z.$n,{role:"option","aria-selected":n(u),variant:n(u)?"primary":"secondary",size:"sm",onClick:()=>{o(u)},children:u==="0s"?"None":u},u))})}var le=t(271);const _=10,W=a=>({required:{value:!0,message:"Required."},validate:r=>{if(r==="0")return!0;try{const o=(0,re.M9)(r);if(o===0)return!0;try{const n=(0,re.M9)(a);return o>=n?!0:(0,E.t)("alert-rule-form.evaluation-behaviour-for.validation","Pending period must be greater than or equal to the evaluation interval.")}catch{return!0}}catch(o){return o instanceof Error?o.message:(0,E.t)("alert-rule-form.evaluation-behaviour-for.error-parsing","Failed to parse duration")}}}),Fe=(a,r)=>{const{groupOptions:o}=Se(a,!1);return!(0,C.useCallback)(s=>o.some(u=>u.label===s),[o])(r)};function fe({evaluateEvery:a,setEvaluateEvery:r,enableProvisionedGroups:o}){const n=(0,D.of)(xe),{watch:s,setValue:u,getValues:v}=(0,G.xW)(),[m,R]=(0,C.useState)(!1),[f,F,T]=s(["group","folder.uid","folder.title"]),A=(0,ye.$)(x=>x.rulerRules)[ae.hY],B=(0,L.dy)(ae.hY).find(x=>x.uid===F),w=B?.groups.find(x=>x.name===f),z=Fe(F??"",f);(0,C.useEffect)(()=>{!z&&w?.interval&&r(w.interval)},[r,z,u,w]);const ge=(x=!1)=>{x||(0,te.fH)(te.le.leavingRuleGroupEdit),R(!1)},ve=()=>R(!0),ie=A?.loading||z||!F||!f,Ue={name:T,rulesSource:ae.hY,groups:[]},$e={name:f,interval:a,rules:[],totals:{}};return(0,e.jsxs)("div",{children:[(0,e.jsx)(j,{groupfoldersForGrafana:A?.result,enableProvisionedGroups:o}),T&&m&&(0,e.jsx)(ce.u5,{namespace:B??Ue,group:w??$e,folderUid:F,onClose:()=>ge(),intervalEditOnly:!0,hideFolder:!0}),T&&f&&(0,e.jsx)("div",{className:n.evaluationContainer,children:(0,e.jsx)(h.B,{direction:"column",gap:0,children:(0,e.jsx)("div",{className:n.marginTop,children:(0,e.jsx)(h.B,{direction:"column",gap:1,children:v("group")&&v("evaluateEvery")&&(0,e.jsxs)("span",{children:[(0,e.jsxs)(E.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-group.text",values:{evaluateEvery:a},children:["All rules in the selected group are evaluated every ",{evaluateEvery:a},"."]}),!z&&(0,e.jsx)(O.K,{name:"pen","aria-label":"Edit",disabled:ie,onClick:ve})]})})})})})]})}function b({evaluateEvery:a}){const r=(0,D.of)(xe),{register:o,formState:{errors:n},setValue:s,watch:u}=(0,G.xW)(),v="eval-for-input",m=u("evaluateFor"),R=f=>{s("evaluateFor",f)};return(0,e.jsx)(h.B,{direction:"row","justify-content":"flex-start","align-items":"flex-start",children:(0,e.jsx)(M.D,{label:(0,e.jsx)(Q.J,{htmlFor:"evaluateFor",description:'Period the threshold condition must be met to trigger the alert. Selecting "None" triggers the alert immediately once the condition is met.',children:(0,e.jsx)(E.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.pending-period",children:"Pending period"})}),className:r.inlineField,error:n.evaluateFor?.message,invalid:n.evaluateFor?.message?!0:void 0,validationMessageHorizontalOverflow:!0,children:(0,e.jsxs)(h.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(U.p,{id:v,width:8,...o("evaluateFor",W(a))}),(0,e.jsx)(q,{selectedPendingPeriod:m,groupEvaluationInterval:a,onSelect:R})]})})})}function We(){return(0,e.jsxs)(h.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)($.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(E.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.info-help.text",children:"Define the alert behavior when the evaluation fails or the query returns no data."})}),(0,e.jsx)(se.G,{contentText:"These settings can help mitigate temporary data source issues, preventing alerts from unintentionally firing due to lack of data, errors, or timeouts.",externalLink:"https://grafana.com/docs/grafana/latest/alerting/alerting-rules/create-grafana-managed-rule/#configure-no-data-and-error-handling",linkText:"Read more about this option",title:"Configure no data and error handling"})]})}function ze(){return(0,e.jsxs)(h.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)($.E,{variant:"bodySmall",color:"secondary",children:(0,e.jsx)(E.x6,{i18nKey:"alert-rule-form.evaluation-behaviour.description.text",children:"Define how the alert rule is evaluated."})}),(0,e.jsx)(se.G,{contentText:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{children:(0,e.jsx)(E.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description1",children:"Evaluation groups are containers for evaluating alert and recording rules."})}),(0,e.jsx)("p",{children:(0,e.jsx)(E.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description2",children:"An evaluation group defines an evaluation interval - how often a rule is evaluated. Alert rules within the same evaluation group are evaluated over the same evaluation interval."})}),(0,e.jsx)("p",{children:(0,e.jsx)(E.x6,{i18nKey:"alert-rule-form.evaluation-behaviour-description3",children:"Pending period specifies how long the threshold condition must be met before the alert starts firing. This option helps prevent alerts from being triggered by temporary issues."})})]}),externalLink:"https://grafana.com/docs/grafana/latest/alerting/fundamentals/alert-rules/rule-evaluation/",linkText:"Read about evaluation and alert states",title:"Alert rule evaluation"})]})}function Qe({evaluateEvery:a,setEvaluateEvery:r,existing:o,enableProvisionedGroups:n}){const s=(0,D.of)(xe),[u,v]=(0,C.useState)(!1),{watch:m,setValue:R}=(0,G.xW)(),f=m("isPaused"),F=m("type"),T=(0,Y.Mu)(F);return(0,e.jsxs)(le.P,{stepNo:3,title:"Set evaluation behavior",description:ze(),children:[(0,e.jsxs)(h.B,{direction:"column","justify-content":"flex-start","align-items":"flex-start",children:[(0,e.jsx)(fe,{setEvaluateEvery:r,evaluateEvery:a,enableProvisionedGroups:n}),T&&(0,e.jsx)(b,{evaluateEvery:a}),o&&(0,e.jsx)(M.D,{htmlFor:"pause-alert-switch",children:(0,e.jsx)(G.xI,{render:()=>(0,e.jsxs)(h.B,{gap:1,direction:"row",alignItems:"center",children:[(0,e.jsx)(J.d,{id:"pause-alert",onChange:l=>{R("isPaused",l.currentTarget.checked)},value:!!f}),(0,e.jsxs)("label",{htmlFor:"pause-alert",className:s.switchLabel,children:[(0,e.jsx)(E.x6,{i18nKey:"alert-rule-form.pause",children:"Pause evaluation"}),(0,e.jsx)(H.m,{placement:"top",content:"Turn on to pause evaluation for this alert rule.",theme:"info",children:(0,e.jsx)(K.I,{tabIndex:0,name:"info-circle",size:"sm",className:s.infoIcon})})]})]}),name:"isPaused"})})]}),T&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ne.e,{isCollapsed:!u,onToggle:l=>v(!l),text:"Configure no data and error handling"}),u&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(We,{}),(0,e.jsx)(M.D,{htmlFor:"no-data-state-input",label:"Alert state if no data or all values are null",children:(0,e.jsx)(G.xI,{render:({field:{onChange:l,ref:A,...S}})=>(0,e.jsx)(V,{...S,inputId:"no-data-state-input",width:42,includeNoData:!0,includeError:!1,onChange:B=>l(B?.value)}),name:"noDataState"})}),(0,e.jsx)(M.D,{htmlFor:"exec-err-state-input",label:"Alert state if execution error or timeout",children:(0,e.jsx)(G.xI,{render:({field:{onChange:l,ref:A,...S}})=>(0,e.jsx)(V,{...S,inputId:"exec-err-state-input",width:42,includeNoData:!1,includeError:!0,onChange:B=>l(B?.value)}),name:"execErrState"})})]})]})]})}const xe=a=>({inlineField:(0,c.css)({marginBottom:0}),evaluateLabel:(0,c.css)({marginRight:a.spacing(1)}),evaluationContainer:(0,c.css)({color:a.colors.text.secondary,maxWidth:`${a.breakpoints.values.sm}px`,fontSize:a.typography.size.sm}),intervalChangedLabel:(0,c.css)({marginBottom:a.spacing(1)}),warningIcon:(0,c.css)({justifySelf:"center",marginRight:a.spacing(1),color:a.colors.warning.text}),infoIcon:(0,c.css)({marginLeft:"10px"}),warningMessage:(0,c.css)({color:a.colors.warning.text}),bold:(0,c.css)({fontWeight:"bold"}),alignInterval:(0,c.css)({marginTop:a.spacing(1),marginLeft:`-${a.spacing(1)}`}),marginTop:(0,c.css)({marginTop:a.spacing(1)}),switchLabel:(0,c.css)({color:a.colors.text.primary,cursor:"pointer",fontSize:a.typography.bodySmall.fontSize})})},22040:(Te,ue,t)=>{t.d(ue,{u5:()=>Ve,iS:()=>Re});var e=t(74848),c=t(32196),C=t(2543),G=t(96540),D=t(49785),h=t(39938),O=t(40845),M=t(37390),Q=t(67061),U=t(88575),$=t(60029),J=t(10354),H=t(55852),K=t(42418),E=t(3169),Y=t(99140),te=t(72635),L=t(79938),ye=t(17172);function ae(i){if((0,ye.NF)(i)&&i.status===404)return null;throw i}var re=t(48070),Ne=t(57220),ce=t(6833),de=t(43482);function Me(){const[i]=(0,de.D)(),[p]=L.hK.endpoints.upsertRuleGroupForNamespace.useMutation();return(0,ce.Yb)(async(g,j)=>{const{namespaceName:y}=g,I=(0,re.lF)({interval:j}),{newRuleGroupDefinition:N,rulerConfig:d}=await i(g,I),P=(0,te.t)("alerting.rule-groups.update.success","Successfully updated rule group");return p({rulerConfig:d,namespace:y,payload:N,requestOptions:{successMessage:P}}).unwrap()})}function X(){const[i]=(0,de.D)(),[p]=L.hK.endpoints.getRuleGroupForNamespace.useLazyQuery(),[g]=L.hK.endpoints.upsertRuleGroupForNamespace.useMutation(),[j]=L.hK.endpoints.deleteRuleGroupFromNamespace.useMutation(),y=(0,te.t)("alerting.rule-groups.move.success","Successfully moved rule group");return(0,ce.Yb)(async(I,N,d,P)=>{if((0,Ne.z2)(I.dataSourceName))throw new Error("Moving a Grafana-managed rule group to another folder is currently not supported.");const V=(0,re.fO)({namespaceName:N,groupName:d,interval:P}),{newRuleGroupDefinition:se,rulerConfig:k}=await i(I,V),q=I.namespaceName,le=V.payload.namespaceName,_=I.groupName,W=V.payload.groupName;if(W&&(!!W&&_!==W)&&(await p({rulerConfig:k,namespace:le,group:W,requestOptions:{showErrorAlert:!1}}).unwrap().catch(ae))?.rules?.length)throw new Error("Target group already has rules, merging rule groups is currently not supported.");return await g({rulerConfig:k,namespace:le,payload:se,requestOptions:{successMessage:y}}).unwrap(),await j({rulerConfig:k,namespace:q,group:_,requestOptions:{showSuccessAlert:!1}}).unwrap()})}function Z(){const[i]=(0,de.D)(),[p]=L.hK.endpoints.getRuleGroupForNamespace.useLazyQuery(),[g]=L.hK.endpoints.upsertRuleGroupForNamespace.useMutation(),[j]=L.hK.endpoints.deleteRuleGroupFromNamespace.useMutation();return(0,ce.Yb)(async(y,I,N)=>{const d=(0,re.KL)({groupName:I,interval:N}),{newRuleGroupDefinition:P,rulerConfig:V}=await i(y,d),se=y.groupName,k=d.payload.groupName,q=y.namespaceName,le=(0,te.t)("alerting.rule-groups.rename.success","Successfully renamed rule group");if((await p({rulerConfig:V,namespace:q,group:k,requestOptions:{showErrorAlert:!1}}).unwrap().catch(ae))?.rules?.length)throw new Error("Target group has existing rules, merging rule groups is currently not supported.");const W=await g({rulerConfig:V,namespace:q,payload:P,requestOptions:{successMessage:le}}).unwrap();return await j({rulerConfig:V,namespace:q,group:se,requestOptions:{showSuccessAlert:!1}}).unwrap(),W})}var Ee=t(23770),Ae=t(82775),he=t(56361),Ie=t(63066),Ce=t(23662),ne=t(25968),Ge=t(75591),Be=t(32264);const De=()=>(0,e.jsxs)(K.F,{severity:"warning",title:"Global evaluation interval limit exceeded",children:["A minimum evaluation interval of ",(0,e.jsx)("strong",{children:Be.$.unifiedAlerting.minInterval})," has been configured in Grafana.",(0,e.jsx)("br",{}),"Please contact the administrator to configure a lower interval."]});var pe=t(99106),Le=t(99226),oe=t(1723),Pe=t(7921);const be=10;function me({message:i,error:p}){return p?(0,e.jsx)(h.E,{color:"red",icon:"exclamation-circle",text:"Error",tooltip:i}):(0,e.jsx)(h.E,{color:"orange",icon:"exclamation-triangle",text:"Unknown",tooltip:i})}const we=i=>{try{const p=(0,ne.M9)(i);return!(p<oe.I*1e3||p%(oe.I*1e3)!==0)}catch{return!1}},Ke=({rulesWithoutRecordingRules:i})=>{const p=(0,O.of)(Se),{watch:g}=(0,D.xW)(),j=g("groupInterval"),y=!j,I=i.slice().map((d,P)=>({id:P,data:(0,Ce.jg)(d,j)})).sort((d,P)=>(0,ne.P8)(d.data.forDuration??"")-(0,ne.P8)(P.data.forDuration??"")),N=(0,G.useMemo)(()=>[{id:"alertName",label:"Alert",renderCell:({data:{alertName:d}})=>(0,e.jsx)(e.Fragment,{children:d}),size:"330px"},{id:"for",label:"Pending period",renderCell:({data:{forDuration:d}})=>(0,e.jsx)(e.Fragment,{children:d}),size:.5},{id:"numberEvaluations",label:"#Eval",renderCell:({data:{evaluationsToFire:d}})=>y?(0,e.jsx)(me,{message:"#Evaluations not available."}):we(j)?d===0?(0,e.jsx)(me,{message:"Invalid 'For' value: it should be greater or equal to evaluation interval.",error:!0}):(0,e.jsx)(e.Fragment,{children:d}):(0,e.jsx)(me,{message:"Invalid evaluation interval format",error:!0}),size:.4}],[j,y]);return(0,e.jsx)("div",{className:p.tableWrapper,children:(0,e.jsx)(Ge.E,{items:I,cols:N,pagination:{itemsPerPage:be}})})},Re=i=>({required:{value:!0,message:"Required."},validate:p=>{try{const g=(0,ne.M9)(p);if(g<oe.I*1e3)return`Cannot be less than ${oe.I} seconds.`;if(g%(oe.I*1e3)!==0)return`Must be a multiple of ${oe.I} seconds.`;if((0,Ee.uQ)(i,p).length===0)return!0;{const j=i.map(I=>{const{forDuration:N}=(0,Ce.jg)(I,p);return N?(0,ne.P8)(N):null}),y=Math.min(...j.filter(I=>I!==null));return`Evaluation interval should be smaller or equal to "pending period" values for existing rules in this rule group. Choose a value smaller than or equal to "${(0,ne.an)(y)}".`}}catch(g){return g instanceof Error?g.message:"Failed to parse duration"}}});function Ve(i){const{namespace:p,group:g,onClose:j,intervalEditOnly:y,folderUid:I}=i,N=(0,O.of)(Se),d=(0,E._2)(),[P,V]=Me(),[se,k]=Z(),[q,le]=X(),{loading:_,error:W}=(0,ce.Gz)(V,le,k),Fe=(0,G.useMemo)(()=>({namespaceName:(0,pe.EL)(p).name,groupName:g.name,groupInterval:g.interval??Ie.T6}),[p,g.name,g.interval]),fe=(0,Ne.EV)(p.rulesSource),b=fe===Ne.hY,We=(0,pe.EL)(p).parents,ze=b?"Folder":"Namespace",Qe=async l=>{const A={dataSourceName:fe,groupName:g.name,namespaceName:b?I:p.name},S=b?(0,pe.wf)(l.namespaceName,We):l.namespaceName,B=l.groupName,w=l.groupInterval,z=b?!1:S!==A.namespaceName,ge=B!==A.groupName;try{z?await q.execute(A,S,B,w):ge?await se.execute(A,B,w):await P.execute(A,w),j(!0),await(0,Y.JD)((0,Ee.eB)({rulesSourceName:fe}))}catch{}},xe=(0,D.mN)({mode:"onBlur",defaultValues:Fe,shouldFocusError:!0}),{handleSubmit:a,register:r,watch:o,formState:{isDirty:n,errors:s,isValid:u},setValue:v,getValues:m}=xe,R=()=>{d.error("There are errors in the form. Correct the errors and retry.")},f=(0,C.compact)(g.rules.map(l=>l.rulerRule).filter(l=>!(0,Ce.UL)(l))),F=f.length>0,T=y||b?"Edit evaluation group":"Edit namespace or evaluation group";return(0,e.jsx)(M.a,{className:N.modal,isOpen:!0,title:T,onDismiss:j,onClickBackdrop:j,children:(0,e.jsx)(D.Op,{...xe,children:(0,e.jsx)("form",{onSubmit:a(Qe,R),children:(0,e.jsxs)(e.Fragment,{children:[!i.hideFolder&&(0,e.jsxs)(Q.B,{gap:1,alignItems:"center",children:[(0,e.jsx)(U.D,{className:N.formInput,label:(0,e.jsx)($.J,{htmlFor:"namespaceName",description:!b&&"Change the current namespace name. Moving groups between namespaces is not supported",children:ze}),invalid:s.namespaceName?!0:void 0,error:s.namespaceName?.message,children:(0,e.jsx)(J.p,{id:"namespaceName",readOnly:y||b,...r("namespaceName",{required:"Namespace name is required.",validate:{pathSeparator:l=>b?!0:(0,Pe.G0)(l)}})})}),b&&i.folderUrl&&(0,e.jsx)(H.z9,{href:i.folderUrl,title:"Go to folder",variant:"secondary",icon:"folder-open",target:"_blank"})]}),(0,e.jsx)(U.D,{label:(0,e.jsx)($.J,{htmlFor:"groupName",description:"A group evaluates all its rules over the same evaluation interval.",children:"Evaluation group"}),invalid:!!s.groupName,error:s.groupName?.message,children:(0,e.jsx)(J.p,{autoFocus:!0,id:"groupName",readOnly:y,...r("groupName",{required:"Evaluation group name is required.",validate:{pathSeparator:l=>(0,Pe.G0)(l)}})})}),(0,e.jsx)(U.D,{label:(0,e.jsx)($.J,{htmlFor:"groupInterval",description:"How often is the rule evaluated. Applies to every rule within the group.",children:(0,e.jsx)(Q.B,{gap:.5,children:"Evaluation interval"})}),invalid:s.groupInterval?!0:void 0,error:s.groupInterval?.message,children:(0,e.jsxs)(Q.B,{direction:"column",children:[(0,e.jsx)(J.p,{id:"groupInterval",placeholder:Ie.T6,...r("groupInterval",Re(f))}),(0,e.jsx)(Le.gv,{currentInterval:m("groupInterval"),onSelect:l=>v("groupInterval",l,{shouldValidate:!0,shouldDirty:!0})})]})}),b&&(0,Ae.q)(o("groupInterval")).exceedsLimit&&(0,e.jsx)(De,{}),!F&&(0,e.jsx)("div",{children:"This group does not contain alert rules."}),F&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{children:"List of rules that belong to this group"}),(0,e.jsx)("div",{className:N.evalRequiredLabel,children:"#Eval column represents the number of evaluations needed before alert starts firing."}),(0,e.jsx)(Ke,{rulesWithoutRecordingRules:f})]}),W&&(0,e.jsx)(K.F,{title:"Failed to update rule group",children:(0,he.JZ)(W)}),(0,e.jsx)("div",{className:N.modalButtons,children:(0,e.jsxs)(M.a.ButtonRow,{children:[(0,e.jsx)(H.$n,{variant:"secondary",type:"button",disabled:_,onClick:()=>j(!1),fill:"outline",children:"Cancel"}),(0,e.jsx)(H.$n,{type:"submit",disabled:!n||!u||_,children:_?"Saving...":"Save"})]})})]})},JSON.stringify(Fe))})})}const Se=i=>({modal:(0,c.css)({maxWidth:"560px"}),modalButtons:(0,c.css)({top:"-24px",position:"relative"}),formInput:(0,c.css)({flex:1}),tableWrapper:(0,c.css)({marginTop:i.spacing(2),marginBottom:i.spacing(2),height:"100%"}),evalRequiredLabel:(0,c.css)({fontSize:i.typography.bodySmall.fontSize})})},41520:(Te,ue,t)=>{t.d(ue,{V:()=>C});var e=t(96540),c=t(75471);function C(){return(0,e.useMemo)(()=>(0,c.Q9)(),[])}}}]);

//# sourceMappingURL=7049.50a1004049f10a881cca.js.map