"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6299],{10421:(Y,_,e)=>{e.r(_),e.d(_,{default:()=>q});var s=e(74848),v=e(32196),l=e(96540),S=e(70713),M=e(40845),g=e(67647),a=e(69444),r=e(8484),y=e(19519),O=e(24439),i=e(31678),d=e(53477),R=e(39788);class T extends R.lC{setStateAndDoSearch(c){const C=c.sort||this.state.sort||localStorage.getItem(d.w7)||void 0,u=c.query??this.state.query,U=c.tag??this.state.tag,A=u.length===0&&U.length===0;this.setState({sort:C,result:A?void 0:this.state.result,...c}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}}let p;function x(){return p||(p=new T({...R.ue,includePanels:!1,deleted:!0})),p}function n(){const h=x();return[h.useState(),h]}var m=e(14110),t=e(67061),o=e(55852),f=e(28138),E=e(28444),D=e(55314),I=e(37690),b=e(96374),K=e(94753);const W=({onConfirm:h,onDismiss:c,selectedDashboards:C,isLoading:u,...U})=>{const A=C.length,B=async()=>{(0,m.rR)("grafana_delete_permanently_confirm_clicked",{item_counts:{dashboard:A}}),await h(),c()};return(0,s.jsx)(b.u,{body:(0,s.jsx)(K.E,{element:"p",children:(0,s.jsxs)(r.x6,{i18nKey:"recently-deleted.permanently-delete-modal.text",count:A,children:["This action will delete ",{numberOfDashboards:A}," dashboards."]})}),title:(0,r.t)("recently-deleted.permanently-delete-modal.title","Permanently Delete Dashboards"),confirmationText:(0,r.t)("recently-deleted.permanently-delete-modal.confirm-text","Delete"),confirmText:u?(0,r.t)("recently-deleted.permanently-delete-modal.delete-loading","Deleting..."):(0,r.t)("recently-deleted.permanently-delete-modal.delete-button","Delete"),confirmButtonVariant:"destructive",onConfirm:B,onDismiss:c,...U})},N=({onConfirm:h,onDismiss:c,selectedDashboards:C,isLoading:u,...U})=>{const A=C.length,B=async()=>{(0,m.rR)("grafana_restore_confirm_clicked",{item_counts:{dashboard:A}}),await h(),c()};return(0,s.jsx)(b.u,{body:(0,s.jsx)(K.E,{element:"p",children:(0,s.jsxs)(r.x6,{i18nKey:"recently-deleted.restore-modal.text",count:A,children:["This action will restore ",{numberOfDashboards:A}," dashboards."]})}),confirmText:u?(0,r.t)("recently-deleted.restore-modal.restore-loading","Restoring..."):(0,r.t)("recently-deleted.restore-modal.restore-button","Restore"),confirmButtonVariant:"primary",onDismiss:c,onConfirm:B,title:(0,r.t)("recently-deleted.restore-modal.title","Restore Dashboards"),...U})};function V(){const h=(0,i.useDispatch)(),c=(0,I.xK)(),[,C]=n(),[u,{isLoading:U}]=(0,D.vR)(),[A,{isLoading:B}]=(0,D.D$)(),j=(0,l.useMemo)(()=>Object.entries(c.dashboard).filter(([F,z])=>z).map(([F])=>F),[c.dashboard]),G=()=>{h((0,I.cT)({isSelected:!1,folderUID:void 0})),C.doSearchWithDebounce()},H=async()=>{const F=C.state.result?.view.toArray();if(!F)return;const z=j.map(Z=>u({dashboardUID:Z}));await Promise.all(z);const w=new Set;for(const Z of j){const J=F.find(ne=>ne.uid===Z);if(!J)continue;const ae=J.location===d.TF?void 0:J.location;w.add(ae)}h((0,I.xN)(Array.from(w))),G()},ee=async()=>{const F=j.map(z=>A({dashboardUID:z}));await Promise.all(F),G()},te=()=>{(0,m.rR)("grafana_restore_clicked",{item_counts:{dashboard:j.length}}),f.A.publish(new E.S8({component:N,props:{selectedDashboards:j,onConfirm:H,isLoading:U}}))},se=()=>{(0,m.rR)("grafana_delete_permanently_clicked",{item_counts:{dashboard:j.length}}),f.A.publish(new E.S8({component:W,props:{selectedDashboards:j,onConfirm:ee,isLoading:B}}))};return(0,s.jsxs)(t.B,{gap:1,children:[(0,s.jsx)(o.$n,{onClick:te,variant:"secondary",children:(0,s.jsx)(r.x6,{i18nKey:"recently-deleted.buttons.restore",children:"Restore"})}),(0,s.jsx)(o.$n,{onClick:se,variant:"destructive",children:(0,s.jsx)(r.x6,{i18nKey:"recently-deleted.buttons.delete",children:"Delete permanently"})})]})}var Q=e(69529);const P=({searchState:h})=>{const c=!!(h.query||h.tag.length);return(0,s.jsx)(Q.p,{message:c?(0,r.t)("recently-deleted.page.no-search-result","No results found for your query"):(0,r.t)("recently-deleted.page.no-deleted-dashboards","You haven't deleted any dashboards recently."),variant:c?"not-found":"completed",role:"alert",children:(0,s.jsx)(r.x6,{i18nKey:"recently-deleted.page.no-deleted-dashboards-text",children:"When you delete a dashboard, it will appear here for 30 days before being permanently deleted. Your organization administrator can restore recently-deleted dashboards."})})};var L=e(2960),$=e(49904);const X=(0,l.memo)(()=>{const h=(0,i.useDispatch)(),c=(0,M.of)(k),[C,u]=n(),U=(0,I.QE)(),{canEditFolders:A,canEditDashboards:B}=(0,$.N)(),j=A||B;return(0,l.useEffect)(()=>{u.initStateFromUrl(void 0),h((0,I.cT)({isSelected:!1,folderUID:void 0}))},[h,u]),(0,s.jsx)(a.Y,{navId:"dashboards/recently-deleted",children:(0,s.jsxs)(a.Y.Contents,{className:c.pageContents,children:[(0,s.jsx)("div",{children:(0,s.jsx)(g.Z,{placeholder:(0,r.t)("recentlyDeleted.filter.placeholder","Search for dashboards"),value:C.query,escapeRegex:!1,onChange:u.onQueryChange})}),U?(0,s.jsx)(V,{}):(0,s.jsx)("div",{className:c.filters,children:(0,s.jsx)(y.bj,{state:C,getTagOptions:u.getTagOptions,getSortOptions:(0,O.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,O.getGrafanaSearcher)().sortPlaceholder,onLayoutChange:u.onLayoutChange,onSortChange:u.onSortChange,onTagFilterChange:u.onTagFilterChange,onDatasourceChange:u.onDatasourceChange,onPanelTypeChange:u.onPanelTypeChange,onSetIncludePanels:u.onSetIncludePanels})}),(0,s.jsx)("div",{className:c.subView,children:(0,s.jsx)(S.Ay,{children:({width:G,height:H})=>(0,s.jsx)(L.Q,{canSelect:j,width:G,height:H,searchStateManager:u,searchState:C,emptyState:(0,s.jsx)(P,{searchState:C})})})})]})})}),k=h=>({pageContents:(0,v.css)({display:"flex",flexDirection:"column",gap:h.spacing(1),height:"100%"}),subView:(0,v.css)({height:"100%"}),filters:(0,v.css)({display:"none",[h.breakpoints.up("md")]:{display:"block"}})});X.displayName="RecentlyDeletedPage";const q=X},2960:(Y,_,e)=>{e.d(_,{Q:()=>T});var s=e(74848),v=e(96540),l=e(78368),S=e(14236),M=e(69529),g=e(55852),a=e(8484),r=e(97427),y=e(66359),O=e(31678),i=e(37690);const d=25,R={view:new l.R((0,S.Vc)({fields:[{name:"uid",display:!0,values:Array(d).fill(null)},{name:"kind",display:!0,values:Array(d).fill("dashboard")},{name:"name",display:!0,values:Array(d).fill("")},{name:"location",display:!0,values:Array(d).fill("")},{name:"tags",display:!0,values:Array(d).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:d};function T({width:x,height:n,canSelect:m,searchState:t,searchStateManager:o,emptyState:f}){const E=(0,O.useDispatch)(),D=(0,O.useSelector)(P=>P.browseDashboards.selectedItems),I=(0,i.QE)(),{keyboardEvents:b}=(0,r.d)(),K=t.result??R,W=(0,v.useCallback)((P,L)=>P?P==="*"&&L==="*"?I:P==="*"?!1:D[p(P)][L]??!1:!1,[D,I]),N=(0,v.useCallback)(()=>{E((0,i.cT)({isSelected:!1,folderUID:void 0}))},[E]),V=(0,v.useCallback)((P,L)=>{const $=!W(P,L);E((0,i.t$)({item:{kind:p(P),uid:L},isSelected:$}))},[W,E]);if(K.totalRows===0){const P=f??(0,s.jsx)(M.p,{button:(0,s.jsx)(g.$n,{variant:"secondary",onClick:o.onClearSearchAndFilters,children:(0,s.jsx)(a.x6,{i18nKey:"browse-dashboards.no-results.clear",children:"Clear search and filters"})}),message:(0,a.t)("browse-dashboards.no-results.text","No results found for your query"),variant:"not-found",role:"alert"});return(0,s.jsx)("div",{style:{width:x},children:P})}const Q={response:K,selection:m?W:void 0,selectionToggle:m?V:void 0,clearSelection:N,width:x,height:n,onTagSelected:o.onAddTag,keyboardEvents:b,onDatasourceChange:t.datasource?o.onDatasourceChange:void 0,onClickItem:o.onSearchItemClicked};return(0,s.jsx)(y.P,{...Q})}function p(x){switch(x){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+x)}},49904:(Y,_,e)=>{e.d(_,{N:()=>g});var s=e(32264),v=e(10096),l=e(31678);function S(a,r){return r&&r.uid!=="general"?v.TP.hasPermissionInMetadata(a,r):v.TP.hasPermission(a)}function M(a){return a&&!s.$.featureToggles.nestedFolders?!1:s.$.featureToggles.accessActionSets?a?v.TP.hasPermissionInMetadata(l.AccessControlAction.FoldersCreate,a):v.TP.hasPermission(l.AccessControlAction.FoldersCreate):!a||a.uid==="general"?S(l.AccessControlAction.FoldersCreate):S(l.AccessControlAction.FoldersCreate)&&S(l.AccessControlAction.FoldersWrite,a)}function g(a){const r=S(l.AccessControlAction.DashboardsCreate,a),y=M(a),O=S(l.AccessControlAction.FoldersDelete,a),i=S(l.AccessControlAction.DashboardsWrite,a),d=S(l.AccessControlAction.FoldersWrite,a),R=S(l.AccessControlAction.FoldersPermissionsWrite,a),T=S(l.AccessControlAction.FoldersPermissionsRead,a);return{canCreateDashboards:r,canCreateFolders:y,canDeleteFolders:O,canEditDashboards:i,canEditFolders:d,canSetPermissions:R,canViewPermissions:T}}},19519:(Y,_,e)=>{e.d(_,{bj:()=>p});var s=e(74848),v=e(32196),l=e(32264),S=e(40845),M=e(67061),g=e(10880),a=e(55852),r=e(94354),y=e(73725),O=e(99818),i=e(8484),d=e(64161);function R(){return[{value:d.P.Folders,icon:"folder",description:(0,i.t)("search.actions.view-as-folders","View by folders")},{value:d.P.List,icon:"list-ul",description:(0,i.t)("search.actions.view-as-list","View as list")}]}function T(n){const m=n.layout??d.P.Folders;return m===d.P.Folders&&(n.query||n.sort||n.starred||n.tag.length>0)?d.P.List:m}const p=({state:n,showStarredFilter:m,showLayout:t,sortPlaceholder:o,onLayoutChange:f,onSortChange:E,onStarredFilterChange:D=()=>{},onTagFilterChange:I,getTagOptions:b,getSortOptions:K,onDatasourceChange:W,onPanelTypeChange:N,onSetIncludePanels:V})=>{const Q=(0,S.of)(x),P=T(n),L=n.tag.length||n.starred||n.query||n.datasource||n.panel_type?[d.P.Folders]:[];return(0,s.jsxs)(M.B,{justifyContent:"space-between",alignItems:"center",children:[(0,s.jsxs)(M.B,{gap:2,alignItems:"center",children:[(0,s.jsx)(O.$,{isClearable:!1,tags:n.tag,tagOptions:b,onChange:I}),l.$.featureToggles.panelTitleSearch&&(0,s.jsx)(g.S,{"data-testid":"include-panels",disabled:P===d.P.Folders,value:n.includePanels,onChange:()=>V(!n.includePanels),label:(0,i.t)("search.actions.include-panels","Include panels")}),m&&(0,s.jsx)("div",{className:Q.checkboxWrapper,children:(0,s.jsx)(g.S,{label:(0,i.t)("search.actions.starred","Starred"),onChange:D,value:n.starred})}),n.datasource&&(0,s.jsx)(a.$n,{icon:"times",variant:"secondary",onClick:()=>W(void 0),children:(0,s.jsxs)(i.x6,{i18nKey:"search.actions.remove-datasource-filter",children:["Datasource: ",{datasource:n.datasource}]})}),n.panel_type&&(0,s.jsxs)(a.$n,{icon:"times",variant:"secondary",onClick:()=>N(void 0),children:["Panel: ",n.panel_type]})]}),(0,s.jsxs)(M.B,{gap:2,children:[t&&(0,s.jsx)(r.z,{options:R(),disabledOptions:L,onChange:f,value:P}),(0,s.jsx)(y.r,{onChange:$=>E($?.value),value:n.sort,getSortOptions:K,placeholder:o||(0,i.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})]})]})};p.displayName="ActionRow";const x=n=>({checkboxWrapper:(0,v.css)({label:{lineHeight:"1.2"}})})},39788:(Y,_,e)=>{e.d(_,{ET:()=>n,lC:()=>T,ue:()=>i});var s=e(2543),v=e.n(s),l=e(39601),S=e(2619),M=e(33390),g=e(53477),a=e(6204),r=e(24439),y=e(64161),O=e(16757);const i={query:"",tag:[],starred:!1,layout:y.P.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search",deleted:!1},d={sort:null,starred:null,query:null,tag:null,layout:null},R=()=>localStorage.getItem(g.YU)===y.P.List?y.P.List:y.P.Folders;class T extends S.Q{constructor(){super(...arguments),this.updateLocation=(0,s.debounce)(t=>l.Ny.partial(t,!0),300),this.doSearchWithDebounce=(0,s.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...d})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=t=>{this.setStateAndDoSearch({query:t})},this.onRemoveTag=t=>{this.setStateAndDoSearch({tag:this.state.tag.filter(o=>o!==t)})},this.onTagFilterChange=t=>{this.setStateAndDoSearch({tag:t})},this.onAddTag=t=>{this.state.tag&&this.state.tag.includes(t)||this.setStateAndDoSearch({tag:[...this.state.tag,t]})},this.onDatasourceChange=t=>{this.setStateAndDoSearch({datasource:t})},this.onPanelTypeChange=t=>{this.setStateAndDoSearch({panel_type:t})},this.onStarredFilterChange=t=>{const o=t.currentTarget.checked;this.setStateAndDoSearch({starred:o})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSetStarred=t=>{t!==this.state.starred&&this.setStateAndDoSearch({starred:t})},this.onSortChange=t=>{t?localStorage.setItem(g.w7,t):localStorage.removeItem(g.w7),this.state.layout===y.P.Folders?this.setStateAndDoSearch({sort:t,layout:y.P.List}):this.setStateAndDoSearch({sort:t})},this.onLayoutChange=t=>{localStorage.setItem(g.YU,t),this.state.sort&&t===y.P.Folders?this.setStateAndDoSearch({layout:t,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:t,sort:this.state.prevSort})},this.onSetIncludePanels=t=>{this.setStateAndDoSearch({includePanels:t}),M.A.set(g.d7,t)},this.getTagOptions=()=>{const t=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,r.getGrafanaSearcher)().tags(t)},this.onSearchItemClicked=t=>{(0,a.MK)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})},this.onReportSearchUsage=()=>{(0,a.Pf)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})}}initStateFromUrl(t,o=!0){const f=(0,O.N1)(l.Ny.getSearchObject());(f.query||f.datasource||f.panel_type)&&(f.layout=y.P.List);const E=R(),D=localStorage.getItem(g.w7)??void 0,I=E===y.P.List?f.sort||D:null;this.setState({...i,...f,layout:E,sort:I??i.sort,prevSort:D,folderUid:t,eventTrackingNamespace:t?"manage_dashboards":"dashboard_search",deleted:this.state.deleted}),o&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(t){const o=t.sort||this.state.sort||localStorage.getItem(g.w7)||void 0;this.setState({sort:o,...t}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return!!(this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.deleted||this.state.layout===y.P.List)}getSearchQuery(){const t={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred,deleted:this.state.deleted};return t.sort?.length&&!t.sort.includes("name")&&(t.kind=["dashboard","folder"]),t.query?.length||(t.query="*",t.location||(t.kind=["dashboard","folder"])),!this.state.includePanels&&!t.kind&&(t.kind=["dashboard","folder"]),t.panel_type?.length&&(t.kind=["panel"]),t}doSearch(){const t={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted};(0,a.J$)(this.state.eventTrackingNamespace,t),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const o=(0,r.getGrafanaSearcher)(),f=Date.now();(this.state.starred?o.starred(this.lastQuery):o.search(this.lastQuery)).then(D=>{f>this.lastSearchTimestamp&&(this.setState({result:D,loading:!1}),this.lastSearchTimestamp=f)}).catch(D=>{(0,a.KZ)(this.state.eventTrackingNamespace,{...t,error:D?.message}),this.setState({loading:!1})})}}let p;function x(){if(!p){const t=localStorage.getItem(g.YU)??i.layout;let o=M.A.getBool(g.d7,!0);o&&(o=!1),p=new T({...i,layout:t,includePanels:o})}return p}function n(){const m=x();return[m.useState(),m]}}}]);

//# sourceMappingURL=RecentlyDeletedPage.6dbee7285ecc770572e8.js.map