"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1743],{21807:(Pe,S,n)=>{n.r(S),n.d(S,{default:()=>ps});var e=n(74848),d=n(32196),x=n(96540),y=n(13544),z=n(32264),j=n(40675),A=n(40845),J=n(63021),h=n(8484),V=n(16233),E=n(72254),I=n(69444),C=n(31678),M=n(71468),se=n(36663),X=n(42418),L=n(10096),O=n(69546),F=n(10534),P=n(55852),k=n(47259);const q={revokeInvite:k.eb},ne=(0,M.connect)(null,q);class ae extends x.PureComponent{render(){const{invitee:a,revokeInvite:t}=this.props;return(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:a.email}),(0,e.jsx)("td",{children:a.name}),(0,e.jsxs)("td",{className:"text-right",children:[(0,e.jsx)(F.b,{icon:"copy",variant:"secondary",size:"sm",getText:()=>a.url,children:"Copy Invite"}),"\xA0"]}),(0,e.jsx)("td",{children:(0,e.jsx)(P.$n,{variant:"destructive",size:"sm",icon:"times",onClick:()=>t(a.code),"aria-label":"Revoke Invite"})})]})}}const K=ne(ae);class D extends x.PureComponent{render(){const{invitees:a}=this.props;return(0,e.jsxs)("table",{className:"filter-table form-inline",children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Email"}),(0,e.jsx)("th",{children:"Name"}),(0,e.jsx)("th",{}),(0,e.jsx)("th",{style:{width:"34px"}})]})}),(0,e.jsx)("tbody",{"data-testid":"InviteesTable-body",children:a.map((t,o)=>(0,e.jsx)(K,{invitee:t},`${t.id}-${o}`))})]})}}var Q=n(25508),G=n(40823);const{selectAll:te,selectById:ye,selectTotal:re}=G.Tp,oe=(s,a)=>a,ie=(0,Q.Mz)([te,oe],(s,a)=>{const t=new RegExp(a,"i");return s.filter(c=>t.test(c.name)||t.test(c.email))});var _=n(14186),T=n(67647),B=n(94354),w=n(2913),le=n(2543),$=n(17172),i=n(80714),u=n(87617);function f(){return async(s,a)=>{try{s((0,u.Cj)());const{perPage:t,page:o,searchQuery:c,sort:g}=a().users,m=await(0,$.AI)().get("/api/org/users/search",(0,i.F)({perpage:t,page:o,query:c,sort:g}));if(L.TP.licensedAccessControlEnabled()&&L.TP.hasPermission(C.AccessControlAction.ActionUserRolesList)){s((0,u.dJ)());const l=L.TP.user.orgId,p=m?.orgUsers.map(v=>v.userId),r=await(0,$.AI)().post("/api/access-control/users/roles/search",{userIds:p,orgId:l});m.orgUsers.forEach(v=>{v.roles=r?r[v.userId]||[]:[]}),s((0,u.jE)())}s((0,u.Y_)(m))}catch{(0,u.g4)()}}}const ce=(0,le.debounce)(s=>s(f()),300);function R(s){return async a=>{await(0,$.AI)().patch(`/api/org/users/${s.userId}`,{role:s.role}),a(f())}}function de(s){return async a=>{await(0,$.AI)().delete(`/api/org/users/${s}`),a(f())}}function ge(s){return async a=>{a((0,u.EC)(s)),a(f())}}function Re({sortBy:s}){const a=s.length?`${s[0].id}-${s[0].desc?"desc":"asc"}`:void 0;return async t=>{t((0,u.$u)(a)),t(f())}}function Ne(s){return async a=>{a((0,u.t_)(s)),ce(a)}}const Se=s=>{const a=new RegExp(s.searchQuery,"i");return s.users.filter(t=>a.test(t.login)||a.test(t.email)||a.test(t.name))},he=s=>s.searchQuery;function Ke(s){return{searchQuery:he(s.users),pendingInvitesCount:re(s.invites),externalUserMngLinkName:s.users.externalUserMngLinkName,externalUserMngLinkUrl:s.users.externalUserMngLinkUrl}}const $e={changeSearchQuery:Ne},We=(0,M.connect)(Ke,$e)(({externalUserMngLinkName:s,externalUserMngLinkUrl:a,searchQuery:t,pendingInvitesCount:o,changeSearchQuery:c,onShowInvites:g,showInvites:m})=>{const l=[{label:"Users",value:"users"},{label:`Pending Invites (${o})`,value:"invites"}],r=L.TP.hasPermission(C.AccessControlAction.OrgUsersAdd)&&!(w.Ay.disableLoginForm&&w.Ay.externalUserMngInfo);return(0,e.jsxs)("div",{className:"page-action-bar","data-testid":"users-action-bar",children:[(0,e.jsx)(_.I,{grow:!0,children:(0,e.jsx)(T.Z,{value:t,onChange:c,placeholder:"Search user by login, email or name"})}),o>0&&(0,e.jsx)("div",{style:{marginLeft:"1rem"},children:(0,e.jsx)(B.z,{value:m?"invites":"users",options:l,onChange:g})}),r&&(0,e.jsx)(P.z9,{href:"org/users/invite",children:"Invite"}),a&&(0,e.jsx)(P.z9,{href:a,target:"_blank",rel:"noopener",children:s})]})});function ze(s){const a=he(s.users);return{users:Se(s.users),searchQuery:he(s.users),page:s.users.page,totalPages:s.users.totalPages,perPage:s.users.perPage,invitees:ie(s.invites,a),externalUserMngInfo:s.users.externalUserMngInfo,isLoading:s.users.isLoading,rolesLoading:s.users.rolesLoading}}const Fe={loadUsers:f,fetchInvitees:k.G7,changePage:ge,changeSort:Re,updateUser:R,removeUser:de},ue=(0,M.connect)(ze,Fe)(({users:s,page:a,totalPages:t,invitees:o,externalUserMngInfo:c,isLoading:g,rolesLoading:m,loadUsers:l,fetchInvitees:p,changePage:r,updateUser:v,removeUser:H,changeSort:W})=>{const[U,je]=(0,x.useState)(!1),Be=c?(0,se.G)(c):"";(0,x.useEffect)(()=>{l(),p()},[p,l]);const ys=(pe,Ls)=>{v({...Ls,role:pe})},As=pe=>H(pe.userId),fs=()=>{je(!U)},bs=()=>{l()},Us=()=>U?(0,e.jsx)(D,{invitees:o}):(0,e.jsx)(O.b,{users:s,orgId:L.TP.user.orgId,rolesLoading:m,onRoleChange:ys,onRemoveUser:As,onUserRolesChange:bs,fetchData:W,changePage:r,page:a,totalPages:t});return(0,e.jsxs)(I.Y.Contents,{isLoading:!g,children:[(0,e.jsx)(We,{onShowInvites:fs,showInvites:U}),Be&&(0,e.jsx)(X.F,{severity:"info",title:"",children:(0,e.jsx)("div",{dangerouslySetInnerHTML:{__html:Be}})}),g&&Us()]})});function Cs(){return jsx(Page,{navId:"users",children:jsx(ue,{})})}var Qe=n(69529),Ae=n(12942),Ge=n(72109),N=n(67061),Y=n(56034),ee=n(14578),fe=n(94753),be=n(78369),Ue=n(48840),Le=n(19384),we=n(46334),De=n(90613);const Ye=({units:s,icon:a})=>s?.length?s.length>1?(0,e.jsx)(Y.m,{placement:"top",content:(0,e.jsx)(N.B,{direction:"column",children:s?.map(t=>(0,e.jsx)("span",{children:t.name},t.name))}),children:(0,e.jsx)(me,{icon:a,children:s.length})}):(0,e.jsx)(me,{icon:a,children:s[0].name}):null,me=(0,x.forwardRef)(({children:s,icon:a},t)=>(0,e.jsxs)(De.a,{ref:t,display:"flex",alignItems:"center",marginRight:1,children:[(0,e.jsx)(ee.I,{name:a})," ",(0,e.jsx)(De.a,{marginLeft:1,children:s})]}));me.displayName="TooltipContent";const Ze=({users:s,showPaging:a,totalPages:t,onChangePage:o,currentPage:c,fetchData:g})=>{const m=(0,x.useMemo)(()=>s.some(r=>r.licensedRole),[s]),l=(0,x.useMemo)(()=>s.some(r=>r.orgs),[s]),p=(0,x.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:r}})=>r&&(0,e.jsx)(Ae.e,{src:r,alt:"User avatar"})},{id:"login",header:"Login",cell:({row:{original:r}})=>(0,e.jsx)(Ge.Y,{color:"primary",inline:!1,href:`/admin/users/edit/${r.id}`,title:"Edit user",children:r.login}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:r}})=>r,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:r}})=>r,sortType:"string"},...l?[{id:"orgs",header:"Belongs to",cell:({cell:{value:r,row:v}})=>(0,e.jsxs)(N.B,{alignItems:"center",children:[(0,e.jsx)(Ye,{units:r,icon:"building"}),v.original.isAdmin&&(0,e.jsx)(Y.m,{placement:"top",content:"Grafana Admin",children:(0,e.jsx)(ee.I,{name:"shield"})})]})}]:[],...m?[{id:"licensedRole",header:"Licensed role",cell:({cell:{value:r}})=>r==="None"?(0,e.jsxs)(fe.E,{color:"disabled",children:["Not assigned"," ",(0,e.jsx)(Y.m,{placement:"top",content:"A licensed role will be assigned when this user signs in",children:(0,e.jsx)(ee.I,{name:"question-circle"})})]}):r}]:[],{id:"lastSeenAtAge",header:"Last active",headerTooltip:{content:"Time since user was seen using Grafana",iconName:"question-circle"},cell:({cell:{value:r}})=>(0,e.jsx)(e.Fragment,{children:r&&(0,e.jsx)(e.Fragment,{children:r==="10 years"?(0,e.jsx)(fe.E,{color:"disabled",children:"Never"}):r})}),sortType:(r,v)=>new Date(r.original.lastSeenAt).getTime()-new Date(v.original.lastSeenAt).getTime()},{id:"authLabels",header:"Origin",cell:({cell:{value:r}})=>(0,e.jsx)(e.Fragment,{children:Array.isArray(r)&&r.length>0&&(0,e.jsx)(we.E,{label:r[0],removeIcon:!1,count:0})})},{id:"isDisabled",header:"",cell:({cell:{value:r}})=>(0,e.jsx)(e.Fragment,{children:r&&(0,e.jsx)(be.v,{colorIndex:9,name:"Disabled"})})},{id:"edit",header:"",cell:({row:{original:r}})=>(0,e.jsx)(P.z9,{variant:"secondary",size:"sm",icon:"pen",href:`admin/users/edit/${r.id}`,"aria-label":`Edit user ${r.name}`,tooltip:"Edit user"})}],[m,l]);return(0,e.jsxs)(N.B,{direction:"column",gap:2,children:[(0,e.jsx)(Ue.j,{columns:p,data:s,getRowId:r=>String(r.id),fetchData:g}),a&&(0,e.jsx)(N.B,{justifyContent:"flex-end",children:(0,e.jsx)(Le.d,{numberOfPages:t,currentPage:c,onNavigate:o})})]})};var b=n(57334);const Te=[],Ms=s=>{Te.push(s)},He=y.Tp.pages.UserListPage.UserListAdminPage,Je={fetchUsers:b.hU,changeQuery:b.nM,changePage:b.yd,changeFilter:b.$u,changeSort:b.Vk},Ve=s=>({users:s.userListAdmin.users,query:s.userListAdmin.query,showPaging:s.userListAdmin.showPaging,totalPages:s.userListAdmin.totalPages,page:s.userListAdmin.page,filters:s.userListAdmin.filters,isLoading:s.userListAdmin.isLoading}),Ee=(0,M.connect)(Ve,Je)(({fetchUsers:s,query:a,changeQuery:t,users:o,showPaging:c,changeFilter:g,filters:m,totalPages:l,page:p,changePage:r,changeSort:v,isLoading:H})=>{const W=(0,A.of)(Xe);return(0,x.useEffect)(()=>{s()},[s]),(0,e.jsxs)(I.Y.Contents,{children:[(0,e.jsx)("div",{className:W.actionBar,"data-testid":He.container,children:(0,e.jsxs)("div",{className:W.row,children:[(0,e.jsx)(T.Z,{placeholder:"Search user by login, email, or name.",autoFocus:!0,value:a,onChange:t}),(0,e.jsx)(B.z,{options:[{label:"All users",value:!1},{label:"Active last 30 days",value:!0}],onChange:U=>g({name:"activeLast30Days",value:U}),value:m.find(U=>U.name==="activeLast30Days")?.value,className:W.filter}),Te.map((U,je)=>(0,e.jsx)(U,{filters:m,onChange:g,className:W.filter},je)),L.TP.hasPermission(C.AccessControlAction.UsersCreate)&&(0,e.jsx)(P.z9,{href:"admin/users/create",variant:"primary",children:"New user"})]})}),!H&&o.length===0?(0,e.jsx)(Qe.p,{message:(0,h.t)("users.empty-state.message","No users found"),variant:"not-found"}):(0,e.jsx)(Ze,{users:o,showPaging:c,totalPages:l,onChangePage:r,currentPage:p,fetchData:v})]})});function Rs(){return jsx(Page,{navId:"global-users",children:jsx(Ee,{})})}const Xe=s=>({filter:(0,d.css)({margin:s.spacing(0,1),[s.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,d.css)({marginBottom:s.spacing(2),display:"flex",alignItems:"flex-start",gap:s.spacing(2),[s.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,d.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:s.spacing(.5),flexGrow:1,[s.breakpoints.down("sm")]:{flexWrap:"wrap",gap:s.spacing(2),width:"100%"}})}),Ns=null;var ke=n(39938),qe=n(23088);const _e=s=>{if(!s.includes(" "))return{browser:s,computer:""};const a=s.split(" ");return{browser:a[0],computer:a[1]}},Ie=(s,a)=>s.length>a?s.substring(0,a)+"...":s,es=({value:s})=>{const a=_e(s);return(0,e.jsx)(Y.m,{theme:"info-alt",content:s,placement:"top-end",interactive:!0,children:(0,e.jsxs)("span",{children:[Ie(a.browser,10),Ie(a.computer,10)]})})},ss=({devices:s,showPaging:a,totalPages:t,onChangePage:o,currentPage:c,fetchData:g})=>{const m=(0,x.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:l}})=>l&&(0,e.jsx)(Ae.e,{src:l,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:l}})=>"Anonymous"},{id:"userAgent",header:"User Agent",cell:({cell:{value:l}})=>(0,e.jsx)(es,{value:l}),sortType:"string"},{id:"updatedAt",header:"Last active",cell:({cell:{value:l}})=>l,sortType:(l,p)=>new Date(l.original.updatedAt).getTime()-new Date(p.original.updatedAt).getTime()},{id:"clientIp",header:"Origin IP (address)",cell:({cell:{value:l}})=>l&&(0,e.jsx)(ke.E,{text:l,color:"orange"})}],[]);return(0,e.jsxs)(N.B,{direction:"column",gap:2,children:[(0,e.jsx)(Ue.j,{columns:m,data:s,getRowId:l=>l.deviceId,fetchData:g}),a&&(0,e.jsx)(N.B,{justifyContent:"flex-end",children:(0,e.jsx)(Le.d,{numberOfPages:t,currentPage:c,onNavigate:o})}),s.length===0&&(0,e.jsx)(qe.Z,{children:(0,e.jsx)("span",{children:"No anonymous users found."})})]})},ns={fetchUsersAnonymousDevices:b.xq,changeAnonUserSort:b.A5,changeAnonPage:b.is,changeAnonQuery:b.Bc},as=s=>({devices:s.userListAnonymousDevices.devices,query:s.userListAnonymousDevices.query,showPaging:s.userListAnonymousDevices.showPaging,totalPages:s.userListAnonymousDevices.totalPages,page:s.userListAnonymousDevices.page,filters:s.userListAnonymousDevices.filters}),ts=y.Tp.pages.UserListPage.UserListAdminPage,Ce=(0,M.connect)(as,ns)(({devices:s,fetchUsersAnonymousDevices:a,query:t,changeAnonQuery:o,filters:c,showPaging:g,totalPages:m,page:l,changeAnonPage:p,changeAnonUserSort:r})=>{const v=(0,A.of)(rs);return(0,x.useEffect)(()=>{a()},[a]),(0,e.jsxs)(I.Y.Contents,{children:[(0,e.jsx)("div",{className:v.actionBar,"data-testid":ts.container,children:(0,e.jsxs)("div",{className:v.row,children:[(0,e.jsx)(T.Z,{placeholder:"Search devices by IP address.",autoFocus:!0,value:t,onChange:o}),(0,e.jsx)(B.z,{options:[{label:"Active last 30 days",value:!0}],value:c.find(H=>H.name==="activeLast30Days")?.value,className:v.filter})]})}),(0,e.jsx)(ss,{devices:s,showPaging:g,totalPages:m,onChangePage:p,currentPage:l,fetchData:r})]})});function $s(){return jsx(Page,{navId:"anonymous-users",children:jsx(Ce,{})})}const rs=s=>({filter:(0,d.css)({margin:s.spacing(0,1),[s.breakpoints.down("sm")]:{margin:0}}),actionBar:(0,d.css)({marginBottom:s.spacing(2),display:"flex",alignItems:"flex-start",gap:s.spacing(2),[s.breakpoints.down("sm")]:{flexWrap:"wrap"}}),row:(0,d.css)({display:"flex",alignItems:"flex-start",textAlign:"left",marginBottom:s.spacing(.5),flexGrow:1,[s.breakpoints.down("sm")]:{flexWrap:"wrap",gap:s.spacing(2),width:"100%"}})}),Ws=null;var xe=n(72686),ve=n(37390),os=n(39558),Me=n(71678);const is=y.Tp.pages.UserListPage.UsersListPublicDashboardsPage.DashboardsListModal,ls=({email:s,onDismiss:a})=>{const t=(0,A.of)(ds),{data:o,isLoading:c}=(0,xe.kd)(s);return(0,e.jsx)(ve.a,{className:t.modal,isOpen:!0,title:(0,h.t)("public-dashboard-users-access-list.modal.dashboard-modal-title","Public dashboards"),onDismiss:a,children:c?(0,e.jsx)("div",{className:t.loading,children:(0,e.jsx)(os._,{text:(0,h.t)("public-dashboard-users-access-list.dashboard-modal.loading-text","Loading...")})}):o?.map(g=>(0,e.jsxs)("div",{className:t.listItem,"data-testid":is.listItem(g.dashboardUid),children:[(0,e.jsx)("p",{className:t.dashboardTitle,children:g.dashboardTitle}),(0,e.jsxs)("div",{className:t.urlsContainer,children:[(0,e.jsx)("a",{rel:"noreferrer",target:"_blank",className:(0,d.cx)("external-link",t.url),href:(0,E.mL)(g.publicDashboardAccessToken),onClick:a,children:(0,e.jsx)(h.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-link",children:"Public dashboard URL"})}),(0,e.jsx)("span",{className:t.urlsDivider,children:"\u2022"}),(0,e.jsx)("a",{className:(0,d.cx)("external-link",t.url),href:(0,E.gN)(g.dashboardUid,g.slug),onClick:a,children:(0,e.jsx)(h.x6,{i18nKey:"public-dashboard-users-access-list.dashboard-modal.public-dashboard-setting",children:"Public dashboard settings"})})]}),(0,e.jsx)("hr",{className:t.divider})]},g.dashboardUid))})},cs=({email:s})=>{const a=(0,h.t)("public-dashboard-users-access-list.dashboard-modal.open-dashboard-list-text","Open dashboards list");return(0,e.jsx)(Me.$s,{children:({showModal:t,hideModal:o})=>(0,e.jsx)(P.$n,{variant:"secondary",size:"sm",icon:"question-circle",title:a,"aria-label":a,onClick:()=>t(ls,{email:s,onDismiss:o})})})},ds=s=>({modal:(0,d.css)`
    width: 590px;
  `,loading:(0,d.css)`
    display: flex;
    justify-content: center;
  `,listItem:(0,d.css)`
    display: flex;
    flex-direction: column;
    gap: ${s.spacing(.5)};
  `,divider:(0,d.css)`
    margin: ${s.spacing(1.5,0)};
    color: ${s.colors.text.secondary};
  `,urlsContainer:(0,d.css)`
    display: flex;
    gap: ${s.spacing(.5)};

    ${s.breakpoints.down("sm")} {
      flex-direction: column;
    }
  `,urlsDivider:(0,d.css)`
    color: ${s.colors.text.secondary};
    ${s.breakpoints.down("sm")} {
      display: none;
    }
  `,dashboardTitle:(0,d.css)`
    font-size: ${s.typography.body.fontSize};
    font-weight: ${s.typography.fontWeightBold};
    margin-bottom: 0;
  `,url:(0,d.css)`
    font-size: ${s.typography.body.fontSize};
  `}),gs=({user:s,hideModal:a})=>{const[t]=(0,xe.g9)(),o=(0,A.of)(us),c=()=>{t({email:s.email}),a()};return(0,e.jsxs)(ve.a,{className:o.modal,isOpen:!0,title:(0,h.t)("public-dashboard-users-access-list.delete-user-modal.revoke-access-title","Revoke access"),onDismiss:a,children:[(0,e.jsx)("p",{className:o.description,children:(0,e.jsxs)(h.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line1",children:["Are you sure you want to revoke access for ",{email:s.email},"?"]})}),(0,e.jsx)("p",{className:o.description,children:(0,e.jsxs)(h.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.revoke-user-access-modal-desc-line2",shouldUnescape:!0,children:["This action will immediately revoke ",{email:s.email},"'s access to all public dashboards."]})}),(0,e.jsxs)(ve.a.ButtonRow,{children:[(0,e.jsx)(P.$n,{type:"button",variant:"secondary",onClick:a,fill:"outline",children:(0,e.jsx)(h.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-cancel-button",children:"Cancel"})}),(0,e.jsx)(P.$n,{type:"button",variant:"destructive",onClick:c,children:(0,e.jsx)(h.x6,{i18nKey:"public-dashboard-users-access-list.delete-user-modal.delete-user-revoke-access-button",children:"Revoke access"})})]})]})},hs=({user:s})=>{const a=(0,h.t)("public-dashboard-users-access-list.delete-user-modal.delete-user-button-text","Delete user");return(0,e.jsx)(Me.$s,{children:({showModal:t,hideModal:o})=>(0,e.jsx)(P.$n,{size:"sm",variant:"destructive",onClick:()=>t(gs,{user:s,hideModal:o}),icon:"times","aria-label":a,title:a})})},us=s=>({modal:(0,d.css)({width:"500px"}),description:(0,d.css)({fontSize:s.typography.body.fontSize,margin:0})}),ms=y.Tp.pages.UserListPage.publicDashboards,xs=()=>{const{data:s,isLoading:a}=(0,xe.AK)();return(0,e.jsx)(I.Y.Contents,{isLoading:a,children:(0,e.jsxs)("table",{className:"filter-table form-inline","data-testid":ms.container,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:(0,e.jsx)(h.x6,{i18nKey:"public-dashboard-users-access-list.table-header.email-label",children:"Email"})}),(0,e.jsxs)("th",{children:[(0,e.jsx)("span",{children:(0,e.jsx)(h.x6,{i18nKey:"public-dashboard-users-access-list.table-header.activated-label",children:"Activated"})}),(0,e.jsx)(Y.m,{placement:"top",content:(0,h.t)("public-dashboard-users-access-list.table-header.activated-tooltip","Earliest time user has been an active user to a dashboard"),children:(0,e.jsx)(ee.I,{name:"question-circle"})})]}),(0,e.jsx)("th",{children:(0,e.jsx)(h.x6,{i18nKey:"public-dashboard-users-access-list.table-header.last-active-label",children:"Last active"})}),(0,e.jsx)("th",{children:(0,e.jsx)(h.x6,{i18nKey:"public-dashboard-users-access-list.table-header.origin-label",children:"Origin"})}),(0,e.jsx)("th",{children:(0,e.jsx)(h.x6,{i18nKey:"public-dashboard-users-access-list.table-header.role-label",children:"Role"})}),(0,e.jsx)("th",{})]})}),(0,e.jsx)("tbody",{children:s?.map(t=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsx)("span",{className:"ellipsis",title:t.email,children:t.email})}),(0,e.jsx)("td",{className:"max-width-10",children:t.firstSeenAtAge}),(0,e.jsx)("td",{className:"max-width-10",children:t.lastSeenAtAge}),(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsxs)(N.B,{gap:2,children:[(0,e.jsxs)("span",{children:[t.totalDashboards," dashboard(s)"]}),(0,e.jsx)(cs,{email:t.email})]})}),(0,e.jsx)("td",{className:"max-width-10",children:(0,e.jsx)(be.v,{name:"Viewer",colorIndex:19})}),(0,e.jsx)("td",{className:"text-right",children:(0,e.jsx)(hs,{user:t})})]},t.email))})]})})};var vs=(s=>(s.ADMIN="admin",s.ORG="org",s.PUBLIC_DASHBOARDS="public-dashboards",s.ANON="anon",s))(vs||{});const Z=y.Tp.pages.UserListPage,Oe=({view:s,setView:a})=>(0,e.jsx)(j.o,{label:(0,h.t)("users-access-list.tabs.public-dashboard-users-tab-title","Public dashboard users"),active:s==="public-dashboards",onChangeTab:()=>a("public-dashboards"),"data-testid":Z.tabs.publicDashboardsUsers}),js={admin:(0,e.jsx)(Ee,{}),org:(0,e.jsx)(ue,{}),"public-dashboards":(0,e.jsx)(xs,{}),anon:(0,e.jsx)(Ce,{})};function ps(){const s=(0,A.of)(Ps),a=V.TP.hasPermission(C.AccessControlAction.UsersRead),t=V.TP.hasPermission(C.AccessControlAction.OrgUsersRead),[o,c]=(0,x.useState)(()=>a?"admin":t?"org":null),g=t&&a;return(0,e.jsxs)(I.Y,{navId:"global-users",children:[g?(0,e.jsxs)(J.U,{className:s.tabsMargin,children:[(0,e.jsx)(j.o,{label:"All users",active:o==="admin",onChangeTab:()=>c("admin"),"data-testid":Z.tabs.allUsers}),(0,e.jsx)(j.o,{label:"Organization users",active:o==="org",onChangeTab:()=>c("org"),"data-testid":Z.tabs.orgUsers}),z.$.anonymousEnabled&&(0,e.jsx)(j.o,{label:"Anonymous devices",active:o==="anon",onChangeTab:()=>c("anon"),"data-testid":Z.tabs.anonUserDevices}),(0,E.AY)()&&(0,e.jsx)(Oe,{view:o,setView:c})]}):(0,E.AY)()&&(0,e.jsxs)(J.U,{className:s.tabsMargin,children:[(0,e.jsx)(j.o,{label:"Users",active:o==="org",onChangeTab:()=>c("org"),"data-testid":Z.tabs.users}),(0,e.jsx)(Oe,{view:o,setView:c})]}),o?js[o]:(0,e.jsx)(ue,{})]})}const Ps=s=>({tabsMargin:(0,d.css)({marginBottom:s.spacing(3)})})},69546:(Pe,S,n)=>{n.d(S,{b:()=>ae});var e=n(74848),d=n(96540),x=n(13544),y=n(12942),z=n(94753),j=n(90613),A=n(56034),J=n(14578),h=n(78369),V=n(55852),E=n(67061),I=n(48840),C=n(19384),M=n(96374),se=n(89062),X=n(85927),L=n(46334),O=n(10096),F=n(31678),P=n(5133);const k=`This user's role is not editable because it is synchronized from your auth provider.
Refer to the Grafana authentication docs for details.`,q=K=>{const D=K?.isExternallySynced;return!O.TP.hasPermissionInMetadata(F.AccessControlAction.OrgUsersWrite,K)||D},ne=x.Tp.pages.UserListPage.UsersListPage,ae=({users:K,orgId:D,onRoleChange:Q,onUserRolesChange:G,onRemoveUser:te,fetchData:ye,changePage:re,page:oe,totalPages:ie,rolesLoading:_})=>{const[T,B]=(0,d.useState)(null),[w,le]=(0,d.useState)([]);(0,d.useEffect)(()=>{async function i(){try{if(O.TP.hasPermission(F.AccessControlAction.ActionRolesList)){let u=await(0,X.RL)(D);le(u)}}catch{console.error("Error loading options")}}O.TP.licensedAccessControlEnabled()&&i()},[D]);const $=(0,d.useMemo)(()=>[{id:"avatarUrl",header:"",cell:({cell:{value:i}})=>i&&(0,e.jsx)(y.e,{src:i,alt:"User avatar"})},{id:"login",header:"Login",cell:({cell:{value:i}})=>(0,e.jsx)("div",{children:i}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:i}})=>i,sortType:"string"},{id:"name",header:"Name",cell:({cell:{value:i}})=>i,sortType:"string"},{id:"lastSeenAtAge",header:"Last active",cell:({cell:{value:i}})=>(0,e.jsx)(e.Fragment,{children:i&&(0,e.jsx)(e.Fragment,{children:i==="10 years"?(0,e.jsx)(z.E,{color:"disabled",children:"Never"}):i})}),sortType:(i,u)=>new Date(i.original.lastSeenAt).getTime()-new Date(u.original.lastSeenAt).getTime()},{id:"role",header:"Role",cell:({cell:{value:i},row:{original:u}})=>{const f=q(u),ce=async(R,de,ge)=>{await(0,X.eA)(R,de,ge),G&&G()};return O.TP.licensedAccessControlEnabled()?(0,e.jsx)(se.y,{userId:u.userId,roles:u.roles,apply:!0,onApplyRoles:ce,isLoading:_,orgId:D,roleOptions:w,basicRole:i,onBasicRoleChange:R=>Q(R,u),basicRoleDisabled:f,basicRoleDisabledMessage:k,width:40}):(0,e.jsx)(P.r,{"aria-label":"Role",value:i,disabled:f,onChange:R=>Q(R,u)})}},{id:"info",header:"",cell:({row:{original:i}})=>q(i)&&(0,e.jsx)(j.a,{display:"flex",alignItems:"center",marginLeft:1,children:(0,e.jsx)(A.m,{interactive:!0,content:(0,e.jsxs)("div",{children:["This user's role is not editable because it is synchronized from your auth provider. Refer to the\xA0",(0,e.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/administration/user-management/manage-org-users/#change-a-users-organization-permissions",rel:"noreferrer",target:"_blank",children:"Grafana authentication docs"}),"\xA0for details."]}),children:(0,e.jsx)(J.I,{name:"question-circle"})})})},{id:"authLabels",header:"Origin",cell:({cell:{value:i}})=>(0,e.jsx)(e.Fragment,{children:Array.isArray(i)&&i.length>0&&(0,e.jsx)(L.E,{label:i[0],removeIcon:!1,count:0})})},{id:"isDisabled",header:"",cell:({cell:{value:i}})=>(0,e.jsx)(e.Fragment,{children:i&&(0,e.jsx)(h.v,{colorIndex:9,name:"Disabled"})})},{id:"delete",header:"",cell:({row:{original:i}})=>O.TP.hasPermissionInMetadata(F.AccessControlAction.OrgUsersRemove,i)&&(0,e.jsx)(V.$n,{size:"sm",variant:"destructive",onClick:()=>{B(i)},icon:"times","aria-label":`Delete user ${i.name}`})}],[_,D,w,G,Q]);return(0,e.jsxs)(E.B,{direction:"column",gap:2,"data-testid":ne.container,children:[(0,e.jsx)(I.j,{columns:$,data:K,getRowId:i=>String(i.userId),fetchData:ye}),(0,e.jsx)(E.B,{justifyContent:"flex-end",children:(0,e.jsx)(C.d,{onNavigate:re,currentPage:oe,numberOfPages:ie,hideWhenSinglePage:!0})}),!!T&&(0,e.jsx)(M.u,{body:`Are you sure you want to delete user ${T?.login}?`,confirmText:"Delete",title:"Delete",onDismiss:()=>{B(null)},isOpen:!0,onConfirm:()=>{T&&(te(T),B(null))}})]})}},23088:(Pe,S,n)=>{n.d(S,{Z:()=>y});var e=n(74848),d=n(32196),x=n(40845);const y=({children:j})=>{const A=(0,x.of)(z);return(0,e.jsx)("div",{className:A.container,children:j})},z=j=>({container:(0,d.css)({backgroundColor:j.colors.background.secondary,color:j.colors.text.secondary,padding:j.spacing(4),textAlign:"center"})})}}]);

//# sourceMappingURL=UserListPage.f82b8a76fad2637ed180.js.map