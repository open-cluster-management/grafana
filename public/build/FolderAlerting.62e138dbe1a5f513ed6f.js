"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[4333],{30027:(y,A,a)=>{a.r(A),a.d(A,{BrowseFolderAlertingPage:()=>Y,default:()=>X});var s=a(74848),d=a(96540),n=a(69444),l=a(71101),D=a(31678),h=a(32196),e=a(2543),o=a(40996),F=a(40845),c=a(67061),O=a(67647),b=a(90182),u=a(14578),i=a(10860),x=a(64149),j=a(19384),f=a(15054),B=a(21969),I=a(9518),L=a(98439),g=a(39964),_=a(23770),W=a(98164),K=a(57220),p=a(32642),z=a(56361),V=(t=>(t.Ascending="alpha-asc",t.Descending="alpha-desc",t))(V||{});const G=[{label:"Alphabetically [A-Z]",value:"alpha-asc"},{label:"Alphabetically [Z-A]",value:"alpha-desc"}],S=({folder:t})=>{const m=(0,F.of)(J),r=(0,D.useDispatch)(),E=M=>{const k=(0,W.EU)(P,M);U(k)};(0,d.useEffect)(()=>{r((0,_.mB)({rulesSourceName:K.hY})),r((0,_.eB)({rulesSourceName:K.hY}))},[r]);const C=(0,I.dy)(K.hY),{nameFilter:T,labelFilter:P,sortOrder:v,setNameFilter:R,setLabelFilter:U,setSortOrder:w}=H(),q=C.find(M=>M.uid===t.uid)?.groups.flatMap(M=>M.rules)??[],aa=$(q,T,P,v??"alpha-asc"),sa=q.length===0||aa.length===0,{page:ea,numberOfPages:ta,onPageChange:na,pageItems:oa}=(0,L.W)(aa,1,f.FG);return(0,s.jsx)("div",{className:m.container,children:(0,s.jsxs)(c.B,{direction:"column",gap:3,children:[(0,s.jsx)(O.Z,{value:T,onChange:R,placeholder:"Search alert rules by name","data-testid":"name-filter"}),(0,s.jsxs)(c.B,{direction:"row",children:[(0,s.jsx)(b.l6,{value:v,onChange:({value:M})=>M&&w(M),options:G,width:25,"aria-label":"Sort",placeholder:"Sort (Default A-Z)",prefix:(0,s.jsx)(u.I,{name:v==="alpha-asc"?"sort-amount-up":"sort-amount-down"})}),(0,s.jsx)(O.Z,{value:P,onChange:U,placeholder:"Search alerts by labels",className:m.filterLabelsInput,"data-testid":"label-filter"})]}),(0,s.jsx)(c.B,{direction:"column",gap:1,children:oa.map(M=>(0,s.jsxs)(i.Z,{href:(0,z.w$)("grafana",M,""),className:m.card,"data-testid":"alert-card-row",children:[(0,s.jsx)(i.Z.Heading,{children:M.name}),(0,s.jsx)(i.Z.Tags,{children:(0,s.jsx)(x.L,{onClick:E,tags:Object.entries(M.labels).map(([k,ra])=>`${k}=${ra}`)})}),(0,s.jsx)(i.Z.Meta,{children:(0,s.jsxs)("div",{children:[(0,s.jsx)(u.I,{name:"folder"})," ",t.title]})})]},M.name))}),sa&&(0,s.jsx)("div",{className:m.noResults,children:"No alert rules found"}),(0,s.jsx)("div",{className:m.pagination,children:(0,s.jsx)(j.d,{currentPage:ea,numberOfPages:ta,onNavigate:na,hideWhenSinglePage:!0})})]})})};var N=(t=>(t.nameFilter="nameFilter",t.labelFilter="labelFilter",t.sortOrder="sort",t))(N||{});function H(){const[t,m]=(0,g.l)(),[r,E]=(0,d.useState)(t.get("nameFilter")??""),[C,T]=(0,d.useState)(t.get("labelFilter")??""),P=t.get("sort"),[v,R]=(0,d.useState)(P==="alpha-asc"?"alpha-asc":P==="alpha-desc"?"alpha-desc":void 0);return(0,o.A)(()=>m({nameFilter:(0,B.fE)(r),labelFilter:(0,B.fE)(C),sort:(0,B.fE)(v)},!0),400,[r,C,v]),{nameFilter:r,labelFilter:C,sortOrder:v,setNameFilter:E,setLabelFilter:T,setSortOrder:R}}function $(t,m,r,E){const C=(0,p.Zc)(r),T=t.filter(P=>P.name.toLowerCase().includes(m.toLowerCase())&&(0,W.Av)(P.labels,C));return(0,e.orderBy)(T,P=>P.name.toLowerCase(),[E==="alpha-asc"?"asc":"desc"])}const J=t=>({container:(0,h.css)({padding:t.spacing(1)}),card:(0,h.css)({gridTemplateColumns:"auto 1fr 2fr",margin:0}),pagination:(0,h.css)({alignSelf:"center"}),filterLabelsInput:(0,h.css)({flex:1,width:"auto",minWidth:"240px"}),noResults:(0,h.css)({padding:t.spacing(2),backgroundColor:t.colors.background.secondary,fontStyle:"italic"})});var Z=a(55314),Q=a(9134);function Y({match:t}){const{uid:m}=t.params,{data:r}=(0,Z.kH)(m),E=(0,D.useSelector)(v=>v.folder),[C]=(0,Z.iB)(),T=(0,d.useMemo)(()=>{if(!r)return;const v=(0,l.R4)(r),R=(0,l.Fk)(r.uid),U=v.children?.find(w=>w.id===R);return U&&(U.active=!0),v},[r]),P=m?async v=>{if(r){const R=await C({...r,title:v});if("error"in R)throw R.error}}:void 0;return(0,s.jsx)(n.Y,{navId:"dashboards/browse",pageNav:T,onEditTitle:P,actions:(0,s.jsx)(s.Fragment,{children:r&&(0,s.jsx)(Q.m,{folder:r})}),children:(0,s.jsx)(n.Y.Contents,{children:(0,s.jsx)(S,{folder:E})})})}const X=Y},18241:(y,A,a)=>{a.d(A,{T:()=>O});var s=a(74848),d=a(96540),n=a(32264),l=a(96374),D=a(94753),h=a(68402),e=a(42418),o=a(8484),F=a(55314),c=a(43907);const O=({onConfirm:b,onDismiss:u,selectedItems:i,...x})=>{const{data:j}=(0,F.G2)(i),f=!!(j&&(j.alertRule||j.libraryPanel)),[B,I]=(0,d.useState)(!1),L=async()=>{I(!0);try{await b(),I(!1),u()}catch{I(!1)}};return(0,s.jsx)(l.u,{body:(0,s.jsxs)(s.Fragment,{children:[n.$.featureToggles.dashboardRestore&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(D.E,{element:"p",children:(0,s.jsx)(o.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,s.jsx)(h.$,{v:2})]}),(0,s.jsx)(D.E,{element:"p",children:(0,s.jsx)(o.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,s.jsx)(c.x,{selectedItems:i}),(0,s.jsx)(h.$,{v:2})]}),description:(0,s.jsx)(s.Fragment,{children:f?(0,s.jsx)(e.F,{severity:"warning",title:(0,o.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,s.jsx)(o.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,o.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:B?(0,o.t)("browse-dashboards.action.deleting","Deleting..."):(0,o.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:u,onConfirm:L,title:(0,o.t)("browse-dashboards.action.delete-modal-title","Delete"),...x,disabled:f})}},51887:(y,A,a)=>{a.d(A,{J:()=>b});var s=a(74848),d=a(96540),n=a(37390),l=a(42418),D=a(94753),h=a(68402),e=a(88575),o=a(55852),F=a(36607),c=a(8484),O=a(43907);const b=({onConfirm:u,onDismiss:i,selectedItems:x,...j})=>{const[f,B]=(0,d.useState)(),[I,L]=(0,d.useState)(!1),g=Object.keys(x.folder).filter(W=>x.folder[W]),_=async()=>{if(f!==void 0){L(!0);try{await u(f),L(!1),i()}catch{L(!1)}}};return(0,s.jsxs)(n.a,{title:(0,c.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:i,...j,children:[g.length>0&&(0,s.jsx)(l.F,{severity:"info",title:(0,c.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,s.jsx)(D.E,{element:"p",children:(0,s.jsx)(c.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,s.jsx)(O.x,{selectedItems:x}),(0,s.jsx)(h.$,{v:3}),(0,s.jsx)(e.D,{label:(0,c.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,s.jsx)(F.d,{value:f,excludeUIDs:g,onChange:B})}),(0,s.jsxs)(n.a.ButtonRow,{children:[(0,s.jsx)(o.$n,{onClick:i,variant:"secondary",fill:"outline",children:(0,s.jsx)(c.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,s.jsx)(o.$n,{disabled:f===void 0||I,onClick:_,variant:"primary",children:I?(0,c.t)("browse-dashboards.action.moving","Moving..."):(0,c.t)("browse-dashboards.action.move-button","Move")})]})]})}},9134:(y,A,a)=>{a.d(A,{m:()=>L});var s=a(74848),d=a(96540),n=a(32264),l=a(14110),D=a(39601),h=a(38138),e=a(64539),o=a(83122),F=a(55852),c=a(14578),O=a(87978),b=a(5108),u=a(10096),i=a(8484),x=a(28444),j=a(55314),f=a(49904),B=a(18241),I=a(51887);function L({folder:g}){const[_,W]=(0,d.useState)(!1),[K,p]=(0,d.useState)(!1),[z]=(0,j.aF)(),[V]=(0,j.Ko)(),{canEditFolders:G,canDeleteFolders:S,canViewPermissions:N,canSetPermissions:H}=(0,f.N)(g),$=n.$.featureToggles.nestedFolders&&G,J=async E=>{await z({folder:g,destinationUID:E}),(0,l.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},Z=async()=>{await V(g),(0,l.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:E}=g,C=E&&E.length?E[E.length-1].url:"/dashboards";D.Ny.push(C)},Q=()=>{u.lE.publish(new x.S8({component:I.J,props:{selectedItems:{folder:{[g.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:J}}))},Y=()=>{u.lE.publish(new x.S8({component:B.T,props:{selectedItems:{folder:{[g.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:Z}}))},X=(0,i.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),t=(0,i.t)("browse-dashboards.folder-actions-button.move","Move"),m=(0,i.t)("browse-dashboards.folder-actions-button.delete","Delete"),r=(0,s.jsxs)(h.W,{children:[N&&(0,s.jsx)(e.D,{onClick:()=>p(!0),label:X}),$&&(0,s.jsx)(e.D,{onClick:Q,label:t}),S&&(0,s.jsx)(e.D,{destructive:!0,onClick:Y,label:m})]});return!N&&!$&&!S?null:(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(o.m,{overlay:r,onVisibleChange:W,children:(0,s.jsxs)(F.$n,{variant:"secondary",children:[(0,s.jsx)(i.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,s.jsx)(c.I,{name:_?"angle-up":"angle-down"})]})}),K&&(0,s.jsx)(O._,{title:(0,i.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:g.title,onClose:()=>p(!1),size:"md",children:(0,s.jsx)(b.x,{resource:"folders",resourceId:g.uid,canSetPermissions:H})})]})}},49904:(y,A,a)=>{a.d(A,{N:()=>h});var s=a(32264),d=a(10096),n=a(31678);function l(e,o){return o&&o.uid!=="general"?d.TP.hasPermissionInMetadata(e,o):d.TP.hasPermission(e)}function D(e){return e&&!s.$.featureToggles.nestedFolders?!1:s.$.featureToggles.accessActionSets?e?d.TP.hasPermissionInMetadata(n.AccessControlAction.FoldersCreate,e):d.TP.hasPermission(n.AccessControlAction.FoldersCreate):!e||e.uid==="general"?l(n.AccessControlAction.FoldersCreate):l(n.AccessControlAction.FoldersCreate)&&l(n.AccessControlAction.FoldersWrite,e)}function h(e){const o=l(n.AccessControlAction.DashboardsCreate,e),F=D(e),c=l(n.AccessControlAction.FoldersDelete,e),O=l(n.AccessControlAction.DashboardsWrite,e),b=l(n.AccessControlAction.FoldersWrite,e),u=l(n.AccessControlAction.FoldersPermissionsWrite,e),i=l(n.AccessControlAction.FoldersPermissionsRead,e);return{canCreateDashboards:o,canCreateFolders:F,canDeleteFolders:c,canEditDashboards:O,canEditFolders:b,canSetPermissions:u,canViewPermissions:i}}}}]);

//# sourceMappingURL=FolderAlerting.62e138dbe1a5f513ed6f.js.map