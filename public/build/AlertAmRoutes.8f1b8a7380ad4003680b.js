"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[6719],{40715:(ee,T,t)=>{t.d(T,{o:()=>A});var e=t(96540),d=t(31678),o=t(97007);function A(M){const E=(0,d.useDispatch)(),C=(0,e.useRef)(M);C.current=M,(0,e.useEffect)(()=>()=>{E((0,o.N)({cleanupAction:C.current}))},[E])}},6939:(ee,T,t)=>{t.r(T),t.d(T,{default:()=>ia,findRoutesMatchingFilters:()=>kt});var e=t(74848),d=t(32196),o=t(96540),A=t(41053),M=t(40845),E=t(63021),C=t(40675),L=t(40980),F=t(39558),W=t(42418),y=t(67061),c=t(66602),l=t(83277),j=t(37198),I=t(31678),S=t(40715),u=t(82843),h=t(55740),P=t(49962),O=t(75505),G=t(17172),N=t(57220);const J=n=>{const s=n.match(/^(\w+)(\[\d+\])?$/);return s?{type:s[1],index:s[2]}:{type:n,index:void 0}},se=n=>{const s={receivers:{},errorCount:0};n.forEach(i=>{s.receivers[i.name]={active:i.active,notifiers:{},errorCount:0};const m=s.receivers[i.name];i.integrations.forEach(v=>{!!v?.lastNotifyAttemptError&&(m.errorCount+=1);const g=z(v.name);g&&(m.notifiers[g]||(m.notifiers[g]=[]),m.notifiers[g].push(v))})});const r=Object.values(s.receivers).reduce((i,m)=>i+m.errorCount,0);return{...s,errorCount:r}},z=n=>J(n)?.type;async function f(n){try{const s=await(0,O.s)((0,G.AI)().fetch({url:`/api/alertmanager/${(0,N.w5)(n)}/config/api/v1/receivers`,showErrorAlert:!1,showSuccessAlert:!1}));return se(s.data)}catch{return se([])}}const Y=P.Hr.injectEndpoints({endpoints:n=>({contactPointsState:n.query({queryFn:async({amSourceName:s})=>{try{return{data:await f(s)}}catch(r){return{error:r}}}})})}),k=n=>{const s={receivers:{},errorCount:0},{currentData:r}=Y.useContactPointsStateQuery({amSourceName:n??""},{skip:!n,pollingInterval:h.cB});return r??s};var ae=t(37959),re=t(57895),p=t(55852),a=t(8484),b=t(39938),w=t(96374),X=t(42941),K=t(79938),R=t(16293),Z=t(76648),ue=t(84029);const Ee=({exportFormat:n,onClose:s})=>{const{currentData:r="",isFetching:i}=K.hK.useExportMuteTimingsQuery({format:n}),m=`mute-timings-${new Date().getTime()}`;return i?(0,e.jsx)(F._,{text:"Loading...."}):(0,e.jsx)(R.J,{format:n,textDefinition:r,downloadFileName:m,onClose:s})},pe=({exportFormat:n,onClose:s,muteTimingName:r})=>{const{currentData:i="",isFetching:m}=K.hK.useExportMuteTimingQuery({format:n,muteTiming:r}),v=`mute-timing-${r}-${new Date().getTime()}`;return m?(0,e.jsx)(F._,{text:"Loading...."}):(0,e.jsx)(R.J,{format:n,textDefinition:i,downloadFileName:v,onClose:s})},Ie=({onClose:n,muteTimingName:s})=>{const[r,i]=(0,o.useState)("yaml");return(0,e.jsx)(Z.m,{activeTab:r,onTabChange:i,onClose:n,formatProviders:Object.values(ue.sl),children:s?(0,e.jsx)(pe,{exportFormat:r,onClose:n,muteTimingName:s}):(0,e.jsx)(Ee,{exportFormat:r,onClose:n})})},Te=Symbol("all mute timings"),Ge=()=>{const[n,s]=(0,o.useState)(null),[r,i]=(0,X.A)(!1),m=(0,o.useCallback)(()=>{s(null),i(!1)},[i]),v=g=>{s(g),i(!0)};return[(0,o.useMemo)(()=>!n||!r?null:n===Te?(0,e.jsx)(Ie,{onClose:m}):(0,e.jsx)(Ie,{muteTimingName:n,onClose:m}),[r,m,n]),v]};var Ke=t(64853),ie=t(19073),ge=t(56361),Ae=t(54486);const mt=({muteTiming:n,alertManagerSourceName:s})=>{const r=(0,j.gB)({alertmanager:s}),[i,m]=(0,o.useState)(!1),[v,x]=Ge(),[g,D]=(0,ie.L7)(ie.QI.ExportMuteTimings),U=()=>m(!1),$=s===N.hY,H=(0,ge.nL)("/alerting/routes/mute-timing/edit",s,{muteName:n?.metadata?.name||n.name}),te=(0,e.jsx)(p.z9,{href:H,variant:"secondary",size:"sm",icon:n.provisioned?"eye":"pen",children:n.provisioned?(0,e.jsx)(a.x6,{i18nKey:"alerting.common.view",children:"View"}):(0,e.jsx)(a.x6,{i18nKey:"alerting.common.edit",children:"Edit"})});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(y.B,{direction:"row",alignItems:"center",justifyContent:"flex-end",wrap:"wrap",children:[!$&&(0,Ae.d6)(n)&&(0,e.jsx)(b.E,{text:"Disabled",color:"orange"}),(0,e.jsx)(Ke._,{actions:[ie.QI.UpdateMuteTiming],children:te}),g&&(0,e.jsx)(p.z9,{icon:"download-alt",variant:"secondary",size:"sm","data-testid":"export",disabled:!D,onClick:()=>x(n.name),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.common.export",children:"Export"})}),!n.provisioned&&(0,e.jsx)(Ke._,{actions:[ie.QI.DeleteMuteTiming],children:(0,e.jsx)(p.z9,{icon:"trash-alt",variant:"secondary",size:"sm",onClick:()=>m(!0),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.common.delete",children:"Delete"})})})]}),(0,e.jsx)(w.u,{isOpen:i,title:"Delete mute timing",body:`Are you sure you would like to delete "${n.name}"?`,confirmText:(0,a.t)("alerting.common.delete","Delete"),onConfirm:async()=>{await r({name:n?.metadata?.name||n.name}),U()},onDismiss:U}),v]})};var pt=t(2859),qt=t(75591),en=t(23088);const Gt=({buttonIcon:n,buttonLabel:s,buttonSize:r="lg",buttonVariant:i="primary",onButtonClick:m,text:v,href:x,showButton:g=!0})=>{const D=(0,M.of)(tn),U={className:D.button,icon:n,size:r,variant:i};return(0,e.jsx)(en.Z,{children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("p",{className:D.text,children:v}),g&&(x?(0,e.jsx)(p.z9,{href:x,type:"button",...U,children:s}):(0,e.jsx)(p.$n,{onClick:m,type:"button",...U,children:s}))]})})},tn=n=>({container:(0,d.css)({backgroundColor:n.colors.background.secondary,color:n.colors.text.secondary,padding:n.spacing(4),textAlign:"center"}),text:(0,d.css)({marginBottom:n.spacing(2)}),button:(0,d.css)({margin:n.spacing(2,0,1)})});var Nt=t(48205),Ut=t(26058),Ft=t(4724);const nn=({alertManagerSourceName:n,hideActions:s})=>{const r=(0,M.of)(sn),[i,m]=Ge(),{data:v,isLoading:x,error:g}=(0,j.Ad)({alertmanager:n}),D=(0,o.useMemo)(()=>(v||[]).map(_=>({id:_.id,data:_})),[v]),[U,$]=(0,ie.L7)(ie.QI.CreateMuteTiming),[H,te]=(0,ie.L7)(ie.QI.ExportMuteTimings),V=an(n,s);return x?(0,e.jsx)(F._,{text:"Loading mute timings..."}):g?(0,e.jsx)(W.F,{severity:"error",title:(0,a.t)("alerting.mute_timings.error-loading.title","Error loading mute timings"),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.mute_timings.error-loading.description",children:"Could not load mute timings. Please try again later."})}):(0,e.jsxs)("div",{className:r.container,children:[(0,e.jsxs)(y.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)("span",{children:"Enter specific time intervals when not to send notifications or freeze notifications for recurring periods of time."}),(0,e.jsx)(Ut.h,{}),!s&&D.length>0&&(0,e.jsx)(Ke._,{actions:[ie.QI.CreateMuteTiming],children:(0,e.jsx)(p.z9,{className:r.muteTimingsButtons,icon:"plus",variant:"primary",href:(0,ge.nL)("alerting/routes/mute-timing/new",n),children:"Add mute timing"})}),H&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(p.$n,{icon:"download-alt",className:r.muteTimingsButtons,variant:"secondary",disabled:!te,onClick:()=>m(Te),children:(0,e.jsx)(a.x6,{i18nKey:"alerting.common.export-all",children:"Export all"})}),i]})]}),D.length>0?(0,e.jsx)(qt.E,{items:D,cols:V,pagination:{itemsPerPage:25}}):s?(0,e.jsx)(Gt,{text:"No mute timings configured",buttonLabel:"",showButton:!1}):(0,e.jsx)(Gt,{text:"You haven't created any mute timings yet",buttonLabel:"Add mute timing",buttonIcon:"plus",buttonSize:"lg",href:(0,ge.nL)("alerting/routes/mute-timing/new",n),showButton:$})]})};function an(n,s=!1){const[[r,i],[m,v]]=(0,ie.Hl)([ie.QI.UpdateMuteTiming,ie.QI.DeleteMuteTiming]),x=!s&&(i||v);return(0,o.useMemo)(()=>{const g=[{id:"name",label:"Name",renderCell:function({data:U}){return(0,e.jsxs)("div",{children:[U.name," ",U.provisioned&&(0,e.jsx)(Nt.rS,{tooltip:!0,provenance:U.metadata?.annotations?.[pt.a]})]})},size:1},{id:"timeRange",label:"Time range",renderCell:({data:D})=>(0,Ft.av)(D),size:5}];return x&&g.push({id:"actions",label:"Actions",alignColumn:"end",renderCell:({data:D})=>(0,e.jsx)(mt,{muteTiming:D,alertManagerSourceName:n}),size:2}),g},[x,n])}const sn=n=>({container:(0,d.css)({display:"flex",flexFlow:"column nowrap"}),muteTimingsButtons:(0,d.css)({marginBottom:n.spacing(2)})});var ve=t(2543),ce=t(88575),on=t(60029),Ue=t(56034),$e=t(14578),gt=t(10354),Fe=t(90182),Re=t(94753),rn=t(39964),Ve=t(98164),qe=t(32642);const ln=({receivers:n,onChangeReceiver:s,onChangeMatchers:r,matchingCount:i})=>{const[m,v]=(0,rn.l)(),x=(0,o.useRef)(null),{queryString:g,contactPoint:D}=un(m),U=(0,M.of)(mn),$=(0,o.useCallback)(()=>(0,ve.debounce)(r,500),[r]);(0,o.useEffect)(()=>{s(D)},[D,s]),(0,o.useEffect)(()=>{const Q=(0,qe.Zc)(g??"").map(Ve.NL);$()(Q)},[$,g]);const H=(0,o.useCallback)(()=>{x.current&&(x.current.value=""),v({contactPoint:void 0,queryString:void 0})},[v]),te=n.map(dn),V=te.find(Q=>Q.value===D)??null,B=g||D;let _=!!(g&&g.length>3);try{g?(0,qe.S6)(g):_=!0}catch{_=!1}return(0,e.jsxs)(y.B,{direction:"row",alignItems:"flex-end",gap:1,children:[(0,e.jsx)(ce.D,{className:U.noBottom,label:(0,e.jsx)(on.J,{children:(0,e.jsxs)(y.B,{gap:.5,children:[(0,e.jsx)("span",{children:"Search by matchers"}),(0,e.jsx)(Ue.m,{content:(0,e.jsxs)("div",{children:["Filter notification policies by using a comma separated list of matchers, e.g.:",(0,e.jsx)("pre",{children:"severity=critical, region=EMEA"})]}),children:(0,e.jsx)($e.I,{name:"info-circle",size:"sm"})})]})}),invalid:!_,error:_?null:"Query must use valid matcher syntax",children:(0,e.jsx)(gt.p,{ref:x,"data-testid":"search-query-input",placeholder:"Search",width:46,prefix:(0,e.jsx)($e.I,{name:"search"}),onChange:Q=>{v({queryString:Q.currentTarget.value})},defaultValue:g})}),(0,e.jsx)(ce.D,{label:"Search by contact point",style:{marginBottom:0},children:(0,e.jsx)(Fe.l6,{id:"receiver","aria-label":"Search by contact point",value:V,options:te,onChange:Q=>{v({contactPoint:Q?.value})},width:28,isClearable:!0})}),B&&(0,e.jsxs)(y.B,{alignItems:"center",children:[(0,e.jsx)(p.$n,{variant:"secondary",icon:"times",onClick:H,children:"Clear filters"}),(0,e.jsxs)(Re.E,{variant:"bodySmall",color:"secondary",children:[i===0&&"No policies matching filters.",i===1&&`${i} policy matches the filters.`,i>1&&`${i} policies match the filters.`]})]})]})};function Kt(n,s){const r=new Map;function i(m,v){const x=[...v,m];if(s(m)){const g=r.get(m)??[];r.set(m,[...g,...x])}m.routes?.forEach(g=>i(g,x))}return i(n,[]),r}function cn(n,s){const r=(0,qe.J$)(n);return s.every(i=>r.some(m=>(0,ve.isEqual)(i,m)))}const dn=n=>({label:n.name,value:n.name}),un=n=>({queryString:n.get("queryString")??void 0,contactPoint:n.get("contactPoint")??void 0}),mn=()=>({noBottom:(0,d.css)({marginBottom:0})});var De=t(37390),pn=t(62930),ze=t(60021),gn=t(35016),hn=t(26423),fn=t(12210),ht=t(99494),vn=t(37534);const xn=()=>{const{installed:n}=(0,fn._)(ht.W.OnCall),{data:s}=hn.WG.useGrafanaOnCallIntegrationsQuery(void 0,{skip:!n});return i=>{const m=s??[];if(n&&(0,vn.p8)(i,m))return ht.W.OnCall}},wt=n=>{const s=xn(),r=i=>({label:i.name,value:i.name,grafanaAppReceiverType:s(i)});return n.map(r)};var yn=t(55127),He=t.n(yn);const jn=({active:n=0,suppressed:s=0,unprocessed:r=0})=>{const i=[],m=n+s+r;return n&&i.push((0,e.jsx)(b.E,{color:"red",text:`${n} firing`},"firing")),s&&i.push((0,e.jsx)(b.E,{color:"blue",text:`${s} suppressed`},"suppressed")),r&&i.push((0,e.jsx)(b.E,{color:"orange",text:`${r} unprocessed`},"unprocessed")),i.length>1&&i.unshift((0,e.jsxs)(o.Fragment,{children:[m," ",He()("instance",m)]},"total")),!!i.length?(0,e.jsx)(y.B,{gap:.5,children:i}):null};var be=t(49785),En=t(50720),Mn=t(82762),le=t(79657),we=t(33915),$t=t(99903),et=t(27835);const Pn=({actionButtons:n,alertManagerSourceName:s,onSubmit:r,receivers:i,route:m})=>{const v=(0,M.of)($t.t),[x,g]=(0,o.useState)(!1),[D,U]=(0,o.useState)((0,le.gY)(m.group_by)),$=(0,le.YE)(m),{handleSubmit:H,register:te,control:V,formState:{errors:B},setValue:_,getValues:Q}=(0,be.mN)({defaultValues:{...$,overrideTimings:!0,overrideGrouping:!0}});return(0,e.jsxs)("form",{onSubmit:H(r),children:[(0,e.jsx)(ce.D,{label:"Default contact point",invalid:!!B.receiver,error:B.receiver?.message,children:(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{className:v.container,"data-testid":"am-receiver-select",children:[(0,e.jsx)(be.xI,{render:({field:{onChange:ne,ref:he,...ye}})=>(0,e.jsx)(Fe.l6,{"aria-label":"Default contact point",...ye,className:v.input,onChange:de=>ne((0,le.eb)(de)),options:i}),control:V,name:"receiver",rules:{required:{value:!0,message:"Required."}}}),(0,e.jsx)("span",{children:"or"}),(0,e.jsx)(En.N,{className:v.linkText,href:(0,ge.nL)("/alerting/notifications/receivers/new",s),children:"Create a contact point"})]})})}),(0,e.jsx)(ce.D,{label:"Group by",description:"Combine multiple alerts into a single notification by grouping them by the same label values.","data-testid":"am-group-select",children:(0,e.jsx)(be.xI,{render:({field:{onChange:ne,ref:he,...ye}})=>(0,e.jsx)(Fe.KF,{"aria-label":"Group by",...ye,allowCustomValue:!0,className:v.input,onCreateOption:de=>{U(je=>[...je,(0,le.Mk)(de)]),_("groupBy",[...ye.value||[],de])},onChange:de=>ne((0,le.ie)(de)),options:[...le.Yl,...D]}),control:V,name:"groupBy"})}),(0,e.jsx)(Mn.S,{collapsible:!0,className:v.collapse,isOpen:x,label:"Timing options",onToggle:g,children:(0,e.jsxs)("div",{className:v.timingFormContainer,children:[(0,e.jsx)(ce.D,{label:"Group wait",description:"The waiting time before sending the first notification for a new group of alerts. Default 30 seconds.",invalid:!!B.groupWaitValue,error:B.groupWaitValue?.message,"data-testid":"am-group-wait",children:(0,e.jsx)(we.V,{...te("groupWaitValue",{validate:le.hH}),placeholder:et.H.group_wait,className:v.promDurationInput,"aria-label":"Group wait"})}),(0,e.jsx)(ce.D,{label:"Group interval",description:"The wait time before sending a notification about changes in the alert group after the first notification has been sent. Default is 5 minutes.",invalid:!!B.groupIntervalValue,error:B.groupIntervalValue?.message,"data-testid":"am-group-interval",children:(0,e.jsx)(we.V,{...te("groupIntervalValue",{validate:le.hH}),placeholder:et.H.group_interval,className:v.promDurationInput,"aria-label":"Group interval"})}),(0,e.jsx)(ce.D,{label:"Repeat interval",description:"The wait time before resending a notification that has already been sent successfully. Default is 4 hours. Should be a multiple of Group interval.",invalid:!!B.repeatIntervalValue,error:B.repeatIntervalValue?.message,"data-testid":"am-repeat-interval",children:(0,e.jsx)(we.V,{...te("repeatIntervalValue",{validate:ne=>{const he=Q("groupIntervalValue");return(0,le.DY)(ne,he)}}),placeholder:et.H.repeat_interval,className:v.promDurationInput,"aria-label":"Repeat interval"})})]})}),(0,e.jsx)("div",{className:v.container,children:n})]})};var Vt=t(29158),ft=t(15292),In=t(72093),zt=t(70383),Ht=t(51488);function Tn(){const{selectedAlertmanager:n}=(0,zt.VI)(),{currentData:s}=(0,Ht.f)(n),r=s?.alertmanager_config;return(0,o.useMemo)(()=>(r?(0,Ft.IT)(r):[])?.map(v=>({value:v.name,label:v.name,description:v.time_intervals.map(x=>(0,Ve.LF)(x)).join(", AND ")}))??[],[r])}var Se=t(97174);const Yt=({actionButtons:n,receivers:s,route:r,onSubmit:i,defaults:m})=>{const v=(0,M.of)(Dn),x=(0,M.of)($t.t),[g,D]=(0,o.useState)((0,le.gY)(r?.group_by)),U=Tn(),$=[{name:"",operator:ze.ho.equal,value:""}],H=s.sort(An),te={...(0,le.YE)(r),...m},V={...te,object_matchers:r?te.object_matchers:$},{handleSubmit:B,control:_,register:Q,formState:{errors:ne},setValue:he,watch:ye,getValues:de}=(0,be.mN)({defaultValues:V}),{fields:je,append:Ne,remove:Me}=(0,be.jz)({control:_,name:"object_matchers"});return(0,e.jsxs)("form",{onSubmit:B(i),children:[(0,e.jsx)("input",{type:"hidden",...Q("id")}),(0,e.jsxs)(y.B,{direction:"column",alignItems:"flex-start",children:[(0,e.jsx)("div",{children:"Matching labels"}),je.length===0&&(0,e.jsx)(b.E,{color:"orange",className:v.noMatchersWarning,icon:"exclamation-triangle",text:"If no matchers are specified, this notification policy will handle all alert instances."}),je.length>0&&(0,e.jsx)("div",{className:v.matchersContainer,children:je.map((oe,me)=>(0,e.jsxs)(y.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(ce.D,{label:"Label",invalid:!!ne.object_matchers?.[me]?.name,error:ne.object_matchers?.[me]?.name?.message,children:(0,e.jsx)(gt.p,{...Q(`object_matchers.${me}.name`,{required:"Field is required"}),defaultValue:oe.name,placeholder:"label",autoFocus:!0})}),(0,e.jsx)(ce.D,{label:"Operator",children:(0,e.jsx)(be.xI,{render:({field:{onChange:xe,ref:q,...Oe}})=>(0,e.jsx)(Fe.l6,{...Oe,className:v.matchersOperator,onChange:We=>xe(We?.value),options:Ve.xH,"aria-label":"Operator"}),defaultValue:oe.operator,control:_,name:`object_matchers.${me}.operator`,rules:{required:{value:!0,message:"Required."}}})}),(0,e.jsx)(ce.D,{label:"Value",invalid:!!ne.object_matchers?.[me]?.value,error:ne.object_matchers?.[me]?.value?.message,children:(0,e.jsx)(gt.p,{...Q(`object_matchers.${me}.value`),defaultValue:oe.value,placeholder:"value"})}),(0,e.jsx)(Vt.K,{tooltip:"Remove matcher",name:"trash-alt",onClick:()=>Me(me),children:"Remove"})]},oe.id))}),(0,e.jsx)(p.$n,{className:v.addMatcherBtn,icon:"plus",onClick:()=>Ne(le.Rg),variant:"secondary",type:"button",children:"Add matcher"})]}),(0,e.jsx)(ce.D,{label:"Contact point",children:(0,e.jsx)(be.xI,{render:({field:{onChange:oe,ref:me,...xe}})=>(0,e.jsx)(Fe.l6,{"aria-label":"Contact point",...xe,className:x.input,onChange:q=>oe((0,le.eb)(q)),options:H,isClearable:!0}),control:_,name:"receiver"})}),(0,e.jsx)(ce.D,{label:"Continue matching subsequent sibling nodes",children:(0,e.jsx)(ft.d,{id:"continue-toggle",...Q("continue")})}),(0,e.jsx)(ce.D,{label:"Override grouping",children:(0,e.jsx)(ft.d,{id:"override-grouping-toggle",...Q("overrideGrouping")})}),ye().overrideGrouping&&(0,e.jsx)(ce.D,{label:"Group by",description:"Combine multiple alerts into a single notification by grouping them by the same label values. If empty, it is inherited from the parent policy.",children:(0,e.jsx)(be.xI,{rules:{validate:oe=>!oe||oe.length===0?"At least one group by option is required.":!0},render:({field:{onChange:oe,ref:me,...xe},fieldState:{error:q}})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Fe.KF,{"aria-label":"Group by",...xe,invalid:!!q,allowCustomValue:!0,className:x.input,onCreateOption:Oe=>{D(We=>[...We,(0,le.Mk)(Oe)]),he("groupBy",[...xe.value||[],Oe])},onChange:Oe=>oe((0,le.ie)(Oe)),options:[...le.Yl,...g]}),q&&(0,e.jsx)(In.P,{children:q.message})]}),control:_,name:"groupBy"})}),(0,e.jsx)(ce.D,{label:"Override general timings",children:(0,e.jsx)(ft.d,{id:"override-timings-toggle",...Q("overrideTimings")})}),ye().overrideTimings&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(ce.D,{label:Se.G.groupWait.label,description:Se.G.groupWait.description,invalid:!!ne.groupWaitValue,error:ne.groupWaitValue?.message,children:(0,e.jsx)(we.V,{...Q("groupWaitValue",{validate:le.hH}),"aria-label":Se.G.groupWait.ariaLabel,className:x.promDurationInput})}),(0,e.jsx)(ce.D,{label:Se.G.groupInterval.label,description:Se.G.groupInterval.description,invalid:!!ne.groupIntervalValue,error:ne.groupIntervalValue?.message,children:(0,e.jsx)(we.V,{...Q("groupIntervalValue",{validate:le.hH}),"aria-label":Se.G.groupInterval.ariaLabel,className:x.promDurationInput})}),(0,e.jsx)(ce.D,{label:Se.G.repeatInterval.label,description:Se.G.repeatInterval.description,invalid:!!ne.repeatIntervalValue,error:ne.repeatIntervalValue?.message,children:(0,e.jsx)(we.V,{...Q("repeatIntervalValue",{validate:(oe="")=>{const me=de("groupIntervalValue");return(0,le.DY)(oe,me)}}),"aria-label":Se.G.repeatInterval.ariaLabel,className:x.promDurationInput})})]}),(0,e.jsx)(ce.D,{label:"Mute timings","data-testid":"am-mute-timing-select",description:"Add mute timing to policy",invalid:!!ne.muteTimeIntervals,children:(0,e.jsx)(be.xI,{render:({field:{onChange:oe,ref:me,...xe}})=>(0,e.jsx)(Fe.KF,{"aria-label":"Mute timings",...xe,className:x.input,onChange:q=>oe((0,le.ie)(q)),options:U}),control:_,name:"muteTimeIntervals"})}),n]})};function An(n){return n.grafanaAppReceiverType===ht.W.OnCall?-1:0}const Dn=n=>{const s=n.spacing(3.5);return{addMatcherBtn:(0,d.css)({marginBottom:s}),matchersContainer:(0,d.css)({backgroundColor:n.colors.background.secondary,padding:`${n.spacing(1.5)} ${n.spacing(2)}`,paddingBottom:0,width:"fit-content"}),matchersOperator:(0,d.css)({minWidth:"120px"}),noMatchersWarning:(0,d.css)({padding:`${n.spacing(1)} ${n.spacing(2)}`,marginBottom:n.spacing(1)})}};var Qt=t(26928);const Cn=(n=[],s,r)=>{const[i,m]=(0,o.useState)(!1),[v,x]=(0,o.useState)(void 0),[g,D]=(0,o.useState)(),U=wt(n),$=(0,o.useCallback)(()=>{D(void 0),x(void 0),m(!1)},[]),H=(0,o.useCallback)((V,B)=>{D(V),x(B),m(!0)},[]);return[(0,o.useMemo)(()=>r?(0,e.jsx)(vt,{isOpen:i}):(0,e.jsx)(De.a,{isOpen:i,onDismiss:$,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Add notification policy",children:(0,e.jsx)(Yt,{receivers:U,defaults:{groupBy:g?.group_by},onSubmit:V=>{g&&v&&s(V,g,v)},actionButtons:(0,e.jsxs)(De.a.ButtonRow,{children:[(0,e.jsx)(p.$n,{type:"button",variant:"secondary",onClick:$,fill:"outline",children:"Cancel"}),(0,e.jsx)(p.$n,{type:"submit",children:"Save policy"})]})})}),[U,s,$,v,r,g,i]),H,$]},On=(n,s,r,i)=>{const[m,v]=(0,o.useState)(!1),[x,g]=(0,o.useState)(!1),[D,U]=(0,o.useState)(),$=wt(s),H=(0,o.useCallback)(()=>{U(void 0),v(!1)},[]),te=(0,o.useCallback)((B,_)=>{g(_??!1),U(B),v(!0)},[]);return[(0,o.useMemo)(()=>i?(0,e.jsx)(vt,{isOpen:m}):(0,e.jsxs)(De.a,{isOpen:m,onDismiss:H,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Edit notification policy",children:[x&&D&&(0,e.jsx)(Pn,{alertManagerSourceName:n,onSubmit:r,receivers:$,route:D,actionButtons:(0,e.jsxs)(De.a.ButtonRow,{children:[(0,e.jsx)(p.$n,{type:"button",variant:"secondary",onClick:H,fill:"outline",children:"Cancel"}),(0,e.jsx)(p.$n,{type:"submit",children:"Update default policy"})]})}),!x&&(0,e.jsx)(Yt,{receivers:$,route:D,onSubmit:r,actionButtons:(0,e.jsxs)(De.a.ButtonRow,{children:[(0,e.jsx)(p.$n,{type:"button",variant:"secondary",onClick:H,fill:"outline",children:"Cancel"}),(0,e.jsx)(p.$n,{type:"submit",children:"Update policy"})]})})]}),[$,n,H,r,x,i,D,m]),te,H]},Rn=(n,s)=>{const[r,i]=(0,o.useState)(!1),[m,v]=(0,o.useState)(),x=(0,o.useCallback)(()=>{v(void 0),i(!1)},[v]),g=(0,o.useCallback)($=>{v($),i(!0)},[]),D=(0,o.useCallback)(()=>{m&&n(m)},[n,m]);return[(0,o.useMemo)(()=>s?(0,e.jsx)(vt,{isOpen:r}):(0,e.jsxs)(De.a,{isOpen:r,onDismiss:x,closeOnBackdropClick:!0,closeOnEscape:!0,title:"Delete notification policy",children:[(0,e.jsx)("p",{children:"Deleting this notification policy will permanently remove it."}),(0,e.jsx)("p",{children:"Are you sure you want to delete this policy?"}),(0,e.jsxs)(De.a.ButtonRow,{children:[(0,e.jsx)(p.$n,{type:"button",variant:"destructive",onClick:D,children:"Yes, delete policy"}),(0,e.jsx)(p.$n,{type:"button",variant:"secondary",onClick:x,children:"Cancel"})]})]}),[x,D,s,r]),g,x]},bn=n=>{const[s,r]=(0,o.useState)(!1),[i,m]=(0,o.useState)([]),[v,x]=(0,o.useState)([]),[g,D]=(0,o.useState)("default"),U=(0,o.useCallback)(()=>{r(!1),m([]),x([])},[]),$=(0,o.useCallback)((V,B,_)=>{m(V),B&&x(B),_&&D(_),r(!0)},[]),H=(0,o.useMemo)(()=>{const V=i.flatMap(B=>B.alerts);return(0,ve.groupBy)(V,B=>B.status.state)},[i]);return[(0,o.useMemo)(()=>(0,e.jsxs)(De.a,{isOpen:s,onDismiss:U,closeOnBackdropClick:!0,closeOnEscape:!0,title:(0,e.jsxs)(y.B,{direction:"row",alignItems:"center",gap:1,wrap:"wrap",children:[(0,e.jsxs)(y.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)($e.I,{name:"x"})," Matchers"]}),(0,e.jsx)(Qt.s,{matchers:v,formatter:g})]}),children:[(0,e.jsxs)(y.B,{direction:"column",children:[(0,e.jsx)(jn,{active:H[ze.Or.Active]?.length,suppressed:H[ze.Or.Suppressed]?.length,unprocessed:H[ze.Or.Unprocessed]?.length}),(0,e.jsx)("div",{children:i.map((V,B)=>(0,e.jsx)(gn._,{alertManagerSourceName:n,group:V},B))})]}),(0,e.jsx)(De.a.ButtonRow,{children:(0,e.jsx)(p.$n,{type:"button",variant:"secondary",onClick:U,children:"Cancel"})})]}),[i,U,H,v,g,s,n]),$,U]},vt=({isOpen:n})=>(0,e.jsx)(De.a,{isOpen:n,onDismiss:()=>{},closeOnBackdropClick:!1,closeOnEscape:!1,title:(0,e.jsxs)(y.B,{direction:"row",alignItems:"center",gap:.5,children:["Updating... ",(0,e.jsx)(pn.y,{inline:!0})]}),children:"Please wait while we update your notification policies."});var Sn=t(32264),Jt=t(83122),Ce=t(38138),tt=t(72109),Bn=t(69613),xt=t(23896),yt=t(10685),Wn=t(19645),Xt=t(79581),jt=t(35108),Et=t(8406),Be=t(55196);const Ln=({exportFormat:n,onClose:s})=>{const{currentData:r="",isFetching:i}=K.hK.useExportPoliciesQuery({format:n}),m=`policies-${new Date().getTime()}`;return i?(0,e.jsx)(F._,{text:"Loading...."}):(0,e.jsx)(R.J,{format:n,textDefinition:r,downloadFileName:m,onClose:s})},Gn=({onClose:n})=>{const[s,r]=(0,o.useState)("yaml");return(0,e.jsx)(Z.m,{activeTab:s,onTabChange:r,onClose:n,formatProviders:Object.values(ue.sl),children:(0,e.jsx)(Ln,{exportFormat:s,onClose:n})})},Zt=n=>{const{receivers:s=[],contactPointsState:r,readOnly:i=!1,provisioned:m=!1,alertGroups:v=[],alertManagerSourceName:x,currentRoute:g,routeTree:D,inheritedProperties:U,routesMatchingFilters:$={filtersApplied:!1,matchedRoutesWithPath:new Map},matchingInstancesPreview:H={enabled:!1},onEditPolicy:te,onAddPolicy:V,onDeletePolicy:B,onShowAlertInstances:_,isAutoGenerated:Q=!1}=n,ne=(0,M.of)(Ye),he=g===D,ye=g.receiver,de=g.continue??!1,je=(0,qe.J$)(g),Ne=!!(je&&je.length),{filtersApplied:Me,matchedRoutesWithPath:oe}=$,me=Array.from(oe.keys()),xe=Me&&me.some(fe=>fe.id===g.id),q=Array.from(oe.values()).flat(),Oe=q.some(fe=>fe.id===g.id),We=[],at=!Ne&&!he&&!de,st=ye??U?.receiver??"",Pt=r?Xn(st,r):[],ot=g.routes??[],Qe=Me?ot.filter(fe=>q.some(ke=>ke.id===fe.id)):ot,It=Qe.length>0,[Je,rt]=(0,X.A)(!1),Xe=H?.groupsMap?.get(g.id),Tt=Xe?(0,ve.sumBy)(Xe,fe=>fe.alerts.length):void 0,[At,Dt]=(0,ie.L7)(ie.QI.ViewAutogeneratedPolicyTree),Ze=_t(g),[_e,Ct]=(0,X.A)(!Ze),Ot=g.group_by,Rt=g.mute_time_intervals??[],bt={group_wait:g.group_wait,group_interval:g.group_interval,repeat_interval:g.repeat_interval};Pt.forEach(fe=>{We.push(fe)});const it=20,[lt,St]=(0,o.useState)(it),ct=Un(Q,he,m,te,g,rt,B);if(Q&&(!Dt||!At)||Me&&!Oe)return null;const Pe=he||Ze,Le=Qe.filter(fe=>q.some(ke=>ke.id===fe.id)),dt=Me?Le:Qe,ut=dt.slice(0,lt),Lt=dt.length-ut.length,la=Lt>0;return(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(y.B,{direction:"column",gap:1.5,children:[(0,e.jsxs)("div",{className:ne.policyWrapper(xe),"data-testid":he?"am-root-route-container":"am-route-container",children:[de&&(0,e.jsx)(wn,{}),at&&(0,e.jsx)($n,{}),(0,e.jsx)("div",{className:ne.policyItemWrapper,children:(0,e.jsxs)(y.B,{direction:"column",gap:1,children:[(0,e.jsx)("div",{children:(0,e.jsxs)(y.B,{direction:"row",alignItems:"center",gap:1,children:[It?(0,e.jsx)(Vt.K,{name:_e?"angle-down":"angle-right",onClick:Ct,"aria-label":_e?"Collapse":"Expand"}):null,Pe?Ze?(0,e.jsx)(zn,{}):(0,e.jsx)(Vn,{}):Ne?(0,e.jsx)(Qt.s,{matchers:je??[],formatter:(0,Ve.VE)(x)}):(0,e.jsx)("span",{className:ne.metadata,children:"No matchers"}),(0,e.jsx)(Ut.h,{}),We.length>0&&(0,e.jsx)(Kn,{errors:We}),m&&(0,e.jsx)(Nt.rS,{}),(0,e.jsxs)(y.B,{direction:"row",gap:.5,children:[!Q&&!i&&(0,e.jsx)(Ke._,{actions:[ie.QI.CreateNotificationPolicy],children:(0,e.jsx)(xt.A,{shouldWrap:m,wrap:Mt,children:he?(0,e.jsx)(p.$n,{variant:"secondary",icon:"plus",size:"sm",disabled:m,type:"button",onClick:()=>V(g,"child"),children:"New child policy"}):(0,e.jsx)(Jt.m,{overlay:(0,e.jsxs)(Ce.W,{children:[(0,e.jsx)(Ce.W.Item,{label:"New sibling above",icon:"arrow-up",onClick:()=>V(g,"above")}),(0,e.jsx)(Ce.W.Item,{label:"New sibling below",icon:"arrow-down",onClick:()=>V(g,"below")}),(0,e.jsx)(Ce.W.Divider,{}),(0,e.jsx)(Ce.W.Item,{label:"New child policy",icon:"plus",onClick:()=>V(g,"child")})]}),children:(0,e.jsx)(p.$n,{size:"sm",variant:"secondary",disabled:m,icon:"angle-down",type:"button",children:"Add new policy"})})})}),ct.length>0&&(0,e.jsx)(Jt.m,{overlay:(0,e.jsx)(Ce.W,{children:ct}),children:(0,e.jsx)(p.$n,{icon:"ellipsis-h",variant:"secondary",size:"sm",type:"button","aria-label":"more-actions","data-testid":"more-actions"})})]})]})}),(0,e.jsx)(Nn,{matchingInstancesPreview:H,numberOfAlertInstances:Tt,contactPoint:ye??void 0,groupBy:Ot,muteTimings:Rt,timingOptions:bt,inheritedProperties:U,alertManagerSourceName:x,receivers:s,matchingAlertGroups:Xe,matchers:je,isDefaultPolicy:he,onShowAlertInstances:_})]})})]}),(0,e.jsx)("div",{className:ne.childPolicies,children:_e&&(0,e.jsxs)(e.Fragment,{children:[ut.map(fe=>{const ke=(0,Xt.W$)(g,fe,U),ca=_t(fe)||Q,da=i||m||Q;return(0,e.jsx)(Zt,{routeTree:D,currentRoute:fe,receivers:s,contactPointsState:r,readOnly:da,inheritedProperties:ke,onAddPolicy:V,onEditPolicy:te,onDeletePolicy:B,onShowAlertInstances:_,alertManagerSourceName:x,alertGroups:v,routesMatchingFilters:$,matchingInstancesPreview:H,isAutoGenerated:ca,provisioned:m},fe.id)}),la&&(0,e.jsxs)(p.$n,{size:"sm",icon:"angle-down",variant:"secondary",className:ne.moreButtons,onClick:()=>St(lt+it),children:[Lt," additional ",He()("policy",Lt)]})]})}),Je&&(0,e.jsx)(Gn,{onClose:rt})]})})};function Nn({numberOfAlertInstances:n,isDefaultPolicy:s,timingOptions:r,groupBy:i,muteTimings:m=[],matchingInstancesPreview:v,inheritedProperties:x,matchingAlertGroups:g,onShowAlertInstances:D,matchers:U,contactPoint:$,alertManagerSourceName:H,receivers:te}){const V=(0,M.of)(Ye),B=x&&x.group_by,_=x&&Object.keys(x).length>0,Q=(0,ve.isArray)(i)&&i[0]==="...",ne=!Q&&(0,ve.isArray)(i)&&i.length>0,he=s&&(0,ve.isArray)(i)&&i.length===0,ye=!!m.length;return(0,e.jsx)("div",{className:V.metadataRow,children:(0,e.jsxs)(y.B,{direction:"row",alignItems:"center",gap:1,children:[v.enabled&&(0,e.jsxs)(Be.P,{icon:"layers-alt",onClick:()=>{g&&D(g,U,(0,Ve.VE)(H))},"data-testid":"matching-instances",children:[(0,e.jsx)(Re.E,{color:"primary",children:n??"-"}),(0,e.jsx)("span",{children:He()("instance",n)})]}),$&&(0,e.jsxs)(Be.P,{icon:"at","data-testid":"contact-point",children:[(0,e.jsx)("span",{children:"Delivered to"}),(0,e.jsx)(Jn,{alertManagerSourceName:H,receivers:te,contactPoint:$})]}),!B&&(0,e.jsxs)(e.Fragment,{children:[ne&&(0,e.jsxs)(Be.P,{icon:"layer-group","data-testid":"grouping",children:[(0,e.jsx)("span",{children:"Grouped by"}),(0,e.jsx)(Re.E,{color:"primary",children:i.join(", ")})]}),he&&(0,e.jsx)(Be.P,{icon:"layer-group",children:(0,e.jsx)("span",{children:"Single group"})}),Q&&(0,e.jsx)(Be.P,{icon:"layer-group",children:(0,e.jsx)("span",{children:"Not grouping"})})]}),ye&&(0,e.jsxs)(Be.P,{icon:"calendar-slash","data-testid":"mute-timings",children:[(0,e.jsx)("span",{children:"Muted when"}),(0,e.jsx)(Yn,{timings:m,alertManagerSourceName:H})]}),r&&(0,e.jsx)(Qn,{timingOptions:s?(0,ve.defaults)(r,et.H):r}),_&&(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)(Be.P,{icon:"corner-down-right-alt","data-testid":"inherited-properties",children:[(0,e.jsx)("span",{children:"Inherited"}),(0,e.jsx)(Hn,{properties:x})]})})]})})}const Un=(n,s,r,i,m,v,x)=>{const[[g,D],[U,$],[H,te]]=(0,ie.Hl)([ie.QI.UpdateNotificationPolicyTree,ie.QI.DeleteNotificationPolicy,ie.QI.ExportNotificationPolicies]),V=[],B=te&&H&&s&&!n,_=g&&D,Q=U&&$&&!s&&!n;return _&&V.push((0,e.jsx)(o.Fragment,{children:(0,e.jsx)(xt.A,{shouldWrap:r,wrap:Mt,children:(0,e.jsx)(Ce.W.Item,{icon:"edit",disabled:r||n,label:"Edit",onClick:()=>i(m,s)})})},"edit-policy")),B&&V.push((0,e.jsx)(Ce.W.Item,{icon:"download-alt",label:"Export",onClick:v},"export-policy")),Q&&V.push((0,e.jsxs)(o.Fragment,{children:[(0,e.jsx)(Ce.W.Divider,{}),(0,e.jsx)(xt.A,{shouldWrap:r,wrap:Mt,children:(0,e.jsx)(Ce.W.Item,{destructive:!0,icon:"trash-alt",disabled:r||n,label:"Delete",onClick:()=>x(m)})})]},"delete-policy")),V},Fn="__grafana_autogenerated__";function _t(n){return!(Sn.$.featureToggles.alertingSimplifiedRouting??!1)||!n.object_matchers?!1:n.object_matchers.some(r=>r[0]===Fn&&r[1]===ze.ho.equal&&r[2]==="true")??!1}const Mt=n=>(0,e.jsx)(Ue.m,{content:"Provisioned items cannot be edited in the UI",placement:"top",children:(0,e.jsx)("span",{children:n})}),Kn=({errors:n})=>(0,e.jsx)(jt.j,{arrow:!0,placement:"top",content:(0,e.jsx)(y.B,{direction:"column",gap:.5,children:n.map(s=>(0,e.jsx)(o.Fragment,{children:s},(0,ve.uniqueId)()))}),children:(0,e.jsx)("span",{children:(0,e.jsx)(b.E,{icon:"exclamation-circle",color:"red",text:He()("error",n.length,!0)})})}),wn=()=>{const n=(0,M.of)(Ye);return(0,e.jsx)(Ue.m,{placement:"top",content:"This route will continue matching other policies",children:(0,e.jsx)("div",{className:n.gutterIcon,"data-testid":"continue-matching",children:(0,e.jsx)($e.I,{name:"arrow-down"})})})},$n=()=>{const n=(0,M.of)(Ye);return(0,e.jsx)(Ue.m,{placement:"top",content:"This policy matches all labels",children:(0,e.jsx)("div",{className:n.gutterIcon,"data-testid":"matches-all",children:(0,e.jsx)($e.I,{name:"exclamation-triangle"})})})};function Vn(){const n=(0,M.of)(Ye);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Re.E,{element:"h2",variant:"body",weight:"medium",children:"Default policy"}),(0,e.jsx)("span",{className:n.metadata,children:"All alert instances will be handled by the default policy if no other matching policies are found."})]})}function zn(){return(0,e.jsx)(Re.E,{element:"h3",variant:"body",weight:"medium",children:"Auto-generated policies"})}const Hn=({properties:n})=>(0,e.jsx)(jt.j,{arrow:!0,placement:"top",content:(0,e.jsx)(y.B,{direction:"row",gap:.5,children:Object.entries(n).map(([s,r])=>r?(0,e.jsx)(Et.J,{label:Zn(s),value:_n(s,r)},s):null)}),children:(0,e.jsx)("div",{children:(0,e.jsx)(Re.E,{color:"primary",children:He()("property",Object.keys(n).length,!0)})})}),Yn=({timings:n,alertManagerSourceName:s})=>(0,e.jsx)("div",{children:n.map(r=>(0,e.jsx)(tt.Y,{href:(0,ge.i7)(r,s),color:"primary",variant:"bodySmall",inline:!1,children:r},r))}),Qn=({timingOptions:n})=>{const s=n.group_wait,r=n.group_interval,i=n.repeat_interval;if(!s&&!r&&!i)return null;const m=[];return s&&m.push((0,e.jsx)(Ue.m,{placement:"top",content:(0,a.t)("alerting.policies.metadata.timingOptions.groupWait.description","How long to initially wait to send a notification for a group of alert instances."),children:(0,e.jsx)("span",{children:(0,e.jsxs)(a.x6,{i18nKey:"alerting.policies.metadata.timingOptions.groupWait.label",children:["Wait ",(0,e.jsx)(yt.S,{content:s})," to group instances"]})})})),r&&m.push((0,e.jsx)(Ue.m,{placement:"top",content:(0,a.t)("alerting.policies.metadata.timingOptions.groupInterval.description","How long to wait before sending a notification about new alerts that are added to a group of alerts for which an initial notification has already been sent."),children:(0,e.jsx)("span",{children:(0,e.jsxs)(a.x6,{i18nKey:"alerting.policies.metadata.timingOptions.groupInterval.label",children:["Wait ",(0,e.jsx)(yt.S,{content:r})," before sending updates"]})})})),i&&m.push((0,e.jsx)(Ue.m,{placement:"top",content:(0,a.t)("alerting.policies.metadata.timingOptions.repeatInterval.description","How often notifications are sent if the group of alerts has not changed since the last notification."),children:(0,e.jsx)("span",{children:(0,e.jsxs)(a.x6,{i18nKey:"alerting.policies.metadata.timingOptions.repeatInterval.label",children:["Repeated every ",(0,e.jsx)(yt.S,{content:i})]})})})),(0,e.jsx)(Be.P,{icon:"hourglass","data-testid":"timing-options",children:m.map((v,x)=>(0,e.jsxs)("span",{children:[v,x<m.length-1&&" \xB7 "]},(0,ve.uniqueId)()))})},Jn=({alertManagerSourceName:n,contactPoint:s,receivers:r})=>{const i=r.find(x=>x.name===s);if(!i)return(0,e.jsx)(tt.Y,{href:(0,ge.bg)(s,n),color:"primary",variant:"bodySmall",inline:!1,children:s});if(!i.grafana_managed_receiver_configs)return(0,e.jsx)(tt.Y,{href:(0,ge.bg)(s,n),color:"primary",variant:"bodySmall",inline:!1,children:s});const v=(0,ve.groupBy)(i.grafana_managed_receiver_configs,x=>x.type);return(0,e.jsx)(jt.j,{arrow:!0,placement:"top",header:(0,e.jsxs)(Be.P,{icon:"at",children:[(0,e.jsx)("div",{children:"Contact Point"}),(0,e.jsx)(Re.E,{color:"primary",children:s})]}),content:(0,e.jsx)(y.B,{direction:"row",gap:.5,children:Object.entries(v).map(([x,g])=>(0,e.jsx)(Et.J,{label:g.length>1?g.length:void 0,icon:Wn.M[x],value:(0,ve.upperFirst)(x)},(0,ve.uniqueId)()))}),children:(0,e.jsx)(tt.Y,{href:(0,ge.bg)(s,n),color:"primary",variant:"bodySmall",inline:!1,children:s})},(0,ve.uniqueId)())};function Xn(n,s){return Object.entries(s[n]?.notifiers??[]).reduce((m=[],[v,x])=>{const g=x.filter(D=>D.lastNotifyAttemptError).map(D=>(0,e.jsx)(Et.J,{icon:"at",label:`Contact Point \u203A ${D.name}`,value:D.lastNotifyAttemptError},(0,ve.uniqueId)()));return m.concat(g)},[])}const Zn=n=>{switch(n){case"receiver":return"Contact Point";case"group_by":return"Group by";case"group_interval":return"Group interval";case"group_wait":return"Group wait";case"repeat_interval":return"Repeat interval";default:return n}},_n=(n,s)=>{const r=n==="group_by"&&Array.isArray(s)&&s[0]==="...",i=n==="group_by"&&Array.isArray(s)&&s.length===0;return r?(0,e.jsx)(Re.E,{variant:"bodySmall",color:"secondary",children:"Not grouping"}):i?(0,e.jsx)(Re.E,{variant:"bodySmall",color:"secondary",children:"Single group"}):Array.isArray(s)?s.join(", "):s},Ye=n=>({matcher:s=>{const{color:r,borderColor:i}=(0,Bn.MC)(s);return{wrapper:(0,d.css)({color:"#fff",background:r,padding:`${n.spacing(.33)} ${n.spacing(.66)}`,fontSize:n.typography.bodySmall.fontSize,border:`solid 1px ${i}`,borderRadius:n.shape.radius.default})}},childPolicies:(0,d.css)({marginLeft:n.spacing(4),position:"relative","&:before":{content:'""',position:"absolute",height:"calc(100% - 10px)",borderLeft:`solid 1px ${n.colors.border.weak}`,marginTop:0,marginLeft:"-20px"}}),policyItemWrapper:(0,d.css)({padding:n.spacing(1.5)}),metadataRow:(0,d.css)({borderBottomLeftRadius:n.shape.borderRadius(2),borderBottomRightRadius:n.shape.borderRadius(2)}),policyWrapper:(s=!1)=>(0,d.css)({flex:1,position:"relative",background:n.colors.background.secondary,borderRadius:n.shape.radius.default,border:`solid 1px ${n.colors.border.weak}`,...s&&{borderColor:n.colors.primary.border,background:n.colors.primary.transparent}}),metadata:(0,d.css)({color:n.colors.text.secondary,fontSize:n.typography.bodySmall.fontSize,fontWeight:n.typography.bodySmall.fontWeight}),break:(0,d.css)({width:"100%",height:0,marginBottom:n.spacing(2)}),gutterIcon:(0,d.css)({position:"absolute",top:0,transform:"translateY(50%)",left:`-${n.spacing(4)}`,color:n.colors.text.secondary,background:n.colors.background.primary,width:"25px",height:"25px",textAlign:"center",border:`solid 1px ${n.colors.border.weak}`,borderRadius:n.shape.radius.default,padding:0}),moreButtons:(0,d.css)({marginTop:n.spacing(.5),marginBottom:n.spacing(1.5)})});var kn=t(23770),qn=t(19143),ea=t(88467),nt=t(67332),ta=(n=>(n.NotificationPolicies="notification_policies",n.MuteTimings="mute_timings",n))(ta||{});const na=()=>{const n=(0,I.useDispatch)(),s=(0,M.of)(sa),{useGetAlertmanagerAlertGroupsQuery:r}=u.m,[i,m]=(0,l.s)(),{tab:v}=oa(i),[x,g]=(0,o.useState)(v),[D,U]=(0,o.useState)(!1),[$,H]=(0,o.useState)(),[te,V]=(0,o.useState)([]),{selectedAlertmanager:B,hasConfigurationAPI:_,isGrafanaAlertmanager:Q}=(0,zt.VI)(),{getRouteGroupsMap:ne}=(0,qn.L)(),{data:he=[]}=(0,j.Ad)({alertmanager:B??""}),ye=k(B??""),{currentData:de,isLoading:je,error:Ne}=(0,Ht.f)(B,{refetchOnFocus:!0,refetchOnReconnect:!0}),Me=de?.alertmanager_config,{currentData:oe,refetch:me}=r({amSourceName:B??""},{skip:!B}),xe=Me?.receivers??[],q=(0,o.useMemo)(()=>{if(Me?.route)return(0,le.QM)(Me.route)},[Me?.route]),[{value:Oe,error:We},at]=(0,A.A)(ne,[ne]);(0,o.useEffect)(()=>{q&&oe&&at(q,oe,{unquoteMatchers:!Q})},[q,oe,at,Q]);const st=(0,o.useMemo)(()=>q?kt(q,{contactPointFilter:$,labelMatchersFilter:te}):{filtersApplied:!1,matchedRoutesWithPath:new Map},[$,te,q]),Pt=!!Me?.route?.provenance;function ot(Pe){if(!q)return;const Le=(0,nt.AB)(B??"",Pe,q);Je(Le)}function Qe(Pe){if(!q)return;const Le=(0,nt.AS)(Pe,q);Je(Le)}function It(Pe,Le,dt){if(!q)return;const ut=(0,nt.I8)(B??"",Pe,Le,q,dt);Je(ut)}function Je(Pe){if(!de)return;const Le=(0,nt.dn)(Pe);U(!0),n((0,kn.RW)({newConfig:{...de,alertmanager_config:{...de.alertmanager_config,route:Le}},oldConfig:de,alertManagerSourceName:B,successMessage:"Updated notification policies"})).unwrap().then(()=>{B&&me(),Ze(),Tt(),Ot()}).finally(()=>{U(!1)})}const[rt,Xe,Tt]=Cn(xe,It,D),[At,Dt,Ze]=On(B??"",xe,ot,D),[_e,Ct,Ot]=Rn(Qe,D),[Rt,bt]=bn(B??"");if((0,S.o)(Pe=>Pe.unifiedAlerting.saveAMConfig=ea.jA),!B)return null;const it=he.length,lt=de&&!Ne&&!je,St=!de&&je,ct=Ne&&!je,Bt=x==="mute_timings",Wt=x==="notification_policies";return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(re.M,{currentAlertmanager:B}),(0,e.jsxs)(E.U,{children:[(0,e.jsx)(C.o,{label:"Notification Policies",active:Wt,onChangeTab:()=>{g("notification_policies"),m({tab:"notification_policies"})}}),(0,e.jsx)(C.o,{label:"Mute Timings",active:Bt,counter:it,onChangeTab:()=>{g("mute_timings"),m({tab:"mute_timings"})}})]}),(0,e.jsxs)(L.J,{className:s.tabContent,children:[St&&(0,e.jsx)(F._,{text:"Loading Alertmanager config..."}),ct&&(0,e.jsx)(W.F,{severity:"error",title:"Error loading Alertmanager config",children:Ne.message||"Unknown error."}),lt&&(0,e.jsxs)(e.Fragment,{children:[Wt&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(y.B,{direction:"column",gap:1,children:[q&&(0,e.jsx)(ln,{receivers:xe,onChangeMatchers:V,onChangeReceiver:H,matchingCount:st.matchedRoutesWithPath.size}),q&&(0,e.jsx)(Zt,{receivers:xe,routeTree:q,currentRoute:q,alertGroups:oe??[],contactPointsState:ye.receivers,readOnly:!_,provisioned:Pt,alertManagerSourceName:B,onAddPolicy:Xe,onEditPolicy:Dt,onDeletePolicy:Ct,onShowAlertInstances:bt,routesMatchingFilters:st,matchingInstancesPreview:{groupsMap:Oe,enabled:!We},isAutoGenerated:!1})]}),rt,At,_e,Rt]}),Bt&&(0,e.jsx)(nn,{alertManagerSourceName:B,hideActions:!_})]})]})]})},kt=(n,s)=>{const{contactPointFilter:r,labelMatchersFilter:i=[]}=s,m=r||i.length>0,v=!!r&&i.length>0;if(!m)return{filtersApplied:!1,matchedRoutesWithPath:new Map};const x=[],g=(0,Xt._I)(n),D=r?Kt(g,V=>V.receiver===r):new Map,U=Array.from(D.keys());U&&x.push(U);const $=i.length?Kt(g,V=>cn(V,i)):new Map,H=Array.from($.keys());return $.size>0&&x.push(H),{filtersApplied:!0,matchedRoutesWithPath:v?aa($,D):new Map([...$,...D])}};function aa(...n){const s=new Map;for(const r of n[0].keys())n.every(i=>i.has(r))&&s.set(r,n[0].get(r));return s}const sa=n=>({tabContent:(0,d.css)({marginTop:n.spacing(2)})});function oa(n){let s="notification_policies";return n.tab==="notification_policies"&&(s="notification_policies"),n.tab==="mute_timings"&&(s="mute_timings"),{tab:s}}const ra=()=>(0,e.jsx)(ae.y,{navId:"am-routes",accessType:"notification",children:(0,e.jsx)(na,{})}),ia=(0,c.Xc)(ra,{style:"page"})},64853:(ee,T,t)=>{t.d(T,{_:()=>M});var e=t(74848),d=t(2543),o=t.n(d),A=t(19073);const M=({actions:y,children:c})=>{const l=(0,d.filter)(y,F),j=(0,d.filter)(y,W);return l.length?(0,e.jsx)(E,{actions:l,children:c}):j.length?(0,e.jsx)(C,{actions:j,children:c}):null},E=({actions:y,children:c})=>{const l=(0,A.iI)();return L(l,y)?(0,e.jsx)(e.Fragment,{children:c}):null},C=({actions:y,children:c})=>{const l=(0,A.e2)();return L(l,y)?(0,e.jsx)(e.Fragment,{children:c}):null};function L(y,c){return(0,d.chain)(y).pick(c).values().value().some(([l,j])=>j===!0)}function F(y){return Object.values(A.QI).includes(y)}function W(y){return Object.values(A.RY).includes(y)}},64047:(ee,T,t)=>{t.d(T,{e:()=>o});var e=t(74848),d=t(55852);const o=({isCollapsed:A,onToggle:M,idControlled:E,className:C,text:L,size:F="xl",...W})=>(0,e.jsx)(d.$n,{type:"button",fill:"text",variant:"secondary","aria-expanded":!A,"aria-controls":E,className:C,icon:A?"angle-right":"angle-down",onClick:()=>M(!A),...W,children:L})},23896:(ee,T,t)=>{t.d(T,{A:()=>o});var e=t(96540);function d({children:A,shouldWrap:M,wrap:E},C){return M?(0,e.cloneElement)(E(A)):A}const o=(0,e.forwardRef)(d)},23088:(ee,T,t)=>{t.d(T,{Z:()=>A});var e=t(74848),d=t(32196),o=t(40845);const A=({children:E})=>{const C=(0,o.of)(M);return(0,e.jsx)("div",{className:C.container,children:E})},M=E=>({container:(0,d.css)({backgroundColor:E.colors.background.secondary,color:E.colors.text.secondary,padding:E.spacing(4),textAlign:"center"})})},57895:(ee,T,t)=>{t.d(T,{M:()=>F});var e=t(74848),d=t(32196),o=t(40845),A=t(42418),M=t(60021),E=t(82843),C=t(19073),L=t(57220);function F({currentAlertmanager:y}){const c=(0,o.of)(W),l=y!==L.hY,[j,I]=(0,C.Ej)(C.RY.ReadConfigurationStatus),S=j&&I,{currentData:u}=E.m.endpoints.getGrafanaAlertingConfigurationStatus.useQuery(void 0,{skip:l||!S});if(!(u?.alertmanagersChoice&&[M.nA.External,M.nA.All].includes(u?.alertmanagersChoice))||l)return null;const P=u.numExternalAlertmanagers>0;return u.alertmanagersChoice===M.nA.External?(0,e.jsxs)(A.F,{title:"Grafana alerts are not delivered to Grafana Alertmanager",children:["Grafana is configured to send alerts to external Alertmanagers only. Changing Grafana Alertmanager configuration will not affect delivery of your alerts.",(0,e.jsx)("div",{className:c.adminHint,children:"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator."})]}):u.alertmanagersChoice===M.nA.All&&P?(0,e.jsxs)(A.F,{title:"You have additional Alertmanagers to configure",severity:"warning",children:["Ensure you make configuration changes in the correct Alertmanagers; both internal and external. Changing one will not affect the others.",(0,e.jsx)("div",{className:c.adminHint,children:"To change your Alertmanager setup, go to the Alerting Admin page. If you do not have access, contact your Administrator."})]}):null}const W=y=>({adminHint:(0,d.css)({fontSize:y.typography.bodySmall.fontSize,fontWeight:y.typography.bodySmall.fontWeight})})},35016:(ee,T,t)=>{t.d(T,{_:()=>re});var e=t(74848),d=t(32196),o=t(96540),A=t(40845),M=t(67061),E=t(72109),C=t(60021),L=t(56361),F=t(69087),W=t(64047),y=t(55196),c=t(70416),l=t(10562),j=t(97754),I=t(55852),S=t(16233),u=t(31678),h=t(19073),P=t(57220),O=t(71223),G=t(64853);const N=({alert:a,alertManagerSourceName:b})=>{const w=(0,A.of)(J),X=(0,P.z2)(b),K=X?S.TP.hasPermission(u.AccessControlAction.AlertingRuleRead):!0;return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:w.actionsRow,children:[a.status.state===C.Or.Suppressed&&(0,e.jsx)(G._,{actions:[h.QI.CreateSilence,h.QI.UpdateSilence],children:(0,e.jsx)(I.z9,{href:`${(0,L.nL)("/alerting/silences",b)}&silenceIds=${a.status.silencedBy.join(",")}`,className:w.button,icon:"bell",size:"sm",children:"Manage silences"})}),a.status.state===C.Or.Active&&(0,e.jsx)(G._,{actions:[h.QI.CreateSilence],children:(0,e.jsx)(I.z9,{href:(0,L.BK)(b,a.labels),className:w.button,icon:"bell-slash",size:"sm",children:"Silence"})}),K&&a.generatorURL&&(0,e.jsx)(I.z9,{className:w.button,href:a.generatorURL,icon:"chart-line",size:"sm",children:X?"See alert rule":"See source"})]}),Object.entries(a.annotations).map(([R,Z])=>(0,e.jsx)(O.s,{annotationKey:R,value:Z},R)),(0,e.jsxs)("div",{className:w.receivers,children:["Receivers:"," ",a.receivers.map(({name:R})=>R).filter(R=>!!R).join(", ")]})]})},J=a=>({button:(0,d.css)({"& + &":{marginLeft:a.spacing(1)}}),actionsRow:(0,d.css)({padding:`${a.spacing(2,0)} !important`,borderBottom:`1px solid ${a.colors.border.medium}`}),receivers:(0,d.css)({padding:a.spacing(1,0)})}),se=({alerts:a,alertManagerSourceName:b})=>{const w=(0,A.of)(z),X=(0,o.useMemo)(()=>[{id:"state",label:"Notification state",renderCell:({data:R})=>(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.y,{state:R.status.state}),(0,e.jsxs)("span",{className:w.duration,children:["for"," ",(0,c.dU)({start:new Date(R.startsAt),end:new Date(R.endsAt)})]})]}),size:"220px"},{id:"labels",label:"Instance labels",renderCell:({data:{labels:R}})=>(0,e.jsx)(F.m,{labels:R,size:"sm"}),size:1}],[w]),K=(0,o.useMemo)(()=>a.map(R=>({id:R.fingerprint,data:R})),[a]);return(0,e.jsx)("div",{className:w.tableWrapper,"data-testid":"alert-group-table",children:(0,e.jsx)(l.B,{cols:X,items:K,isExpandable:!0,renderExpandedContent:({data:R})=>(0,e.jsx)(N,{alert:R,alertManagerSourceName:b})})})},z=a=>({tableWrapper:(0,d.css)({marginTop:a.spacing(3),[a.breakpoints.up("md")]:{marginLeft:a.spacing(4.5)}}),duration:(0,d.css)({marginLeft:a.spacing(1),fontSize:a.typography.bodySmall.fontSize})});var f=t(55127),Y=t.n(f);const k=a=>({[C.Or.Active]:(0,d.css)({color:a.colors.error.text}),[C.Or.Suppressed]:(0,d.css)({color:a.colors.primary.text}),[C.Or.Unprocessed]:(0,d.css)({color:a.colors.secondary.text})}),ae=({group:a})=>{const b=(0,A.of)(k),w=a.alerts.length,X=a.alerts.reduce((K,R)=>(K[R.status.state]?K[R.status.state]+=1:K[R.status.state]=1,K),{});return(0,e.jsxs)("div",{children:[`${w} ${Y()("alert",w)}: `,Object.entries(X).map(([K,R],Z)=>(0,e.jsxs)("span",{className:b[K],children:[Z>0&&", ",`${R} ${K}`]},`${JSON.stringify(a.labels)}-notifications-${Z}`))]})},re=({alertManagerSourceName:a,group:b})=>{const[w,X]=(0,o.useState)(!0),K=(0,A.of)(p),R=b.receiver.name!=="NONE",Z=b.receiver.name;return(0,e.jsxs)("div",{className:K.wrapper,children:[(0,e.jsxs)("div",{className:K.header,children:[(0,e.jsxs)("div",{className:K.group,"data-testid":"alert-group",children:[(0,e.jsx)(W.e,{size:"sm",isCollapsed:w,onToggle:()=>X(!w),"data-testid":"alert-group-collapse-toggle"}),Object.keys(b.labels).length?(0,e.jsxs)(M.B,{direction:"row",alignItems:"center",children:[(0,e.jsx)(F.m,{labels:b.labels,size:"sm"}),R&&(0,e.jsxs)(y.P,{icon:"at",children:["Delivered to"," ",(0,e.jsx)(E.Y,{href:(0,L.bg)(Z,a),variant:"bodySmall",color:"primary",inline:!1,children:b.receiver.name})]})]}):(0,e.jsx)("span",{children:"No grouping"})]}),(0,e.jsx)(ae,{group:b})]}),!w&&(0,e.jsx)(se,{alertManagerSourceName:a,alerts:b.alerts})]})},p=a=>({wrapper:(0,d.css)({"& + &":{marginTop:a.spacing(2)}}),header:(0,d.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignItems:"center",justifyContent:"space-between",padding:`${a.spacing(1)} ${a.spacing(1)} ${a.spacing(1)} 0`,backgroundColor:a.colors.background.secondary,width:"100%"}),group:(0,d.css)({display:"flex",flexDirection:"row",alignItems:"center"}),summary:(0,d.css)({}),[C.Or.Active]:(0,d.css)({color:a.colors.error.main}),[C.Or.Suppressed]:(0,d.css)({color:a.colors.primary.main}),[C.Or.Unprocessed]:(0,d.css)({color:a.colors.secondary.main})})},10685:(ee,T,t)=>{t.d(T,{S:()=>o});var e=t(74848),d=t(94753);const o=({content:A})=>(0,e.jsx)(d.E,{color:"primary",children:A})},16293:(ee,T,t)=>{t.d(T,{J:()=>j});var e=t(74848),d=t(32196),o=t(4213),A=t.n(o),M=t(96540),E=t(70713),C=t(40845),L=t(32372),F=t(55852),W=t(10534),y=t(72109),c=t(42418),l=t(84029);function j({format:u,textDefinition:h,downloadFileName:P,onClose:O}){const G=(0,C.of)(I),N=l.sl[u],J=(0,M.useCallback)(()=>{const z=new Blob([h],{type:`application/${u};charset=utf-8`});A()(z,`${P}.${u}`)},[h,P,u]),se=(0,M.useMemo)(()=>N.formatter?N.formatter(h):h,[N,h]);return(0,e.jsxs)("div",{className:G.container,children:[(0,e.jsx)(S,{exportProvider:N}),(0,e.jsx)("div",{className:G.content,children:(0,e.jsx)(E.Ay,{disableWidth:!0,children:({height:z})=>(0,e.jsx)(L.B,{width:"100%",height:z,language:u,value:se,monacoOptions:{minimap:{enabled:!1},scrollBeyondLastLine:!1,lineNumbers:"on",readOnly:!0}})})}),(0,e.jsxs)("div",{className:G.actions,children:[(0,e.jsx)(F.$n,{variant:"secondary",onClick:O,children:"Cancel"}),(0,e.jsx)(W.b,{icon:"copy",getText:()=>h,children:"Copy code"}),(0,e.jsx)(F.$n,{icon:"download-alt",onClick:J,children:"Download"})]})]})}const I=u=>({container:(0,d.css)({display:"flex",flexDirection:"column",height:"100%",gap:u.spacing(2)}),content:(0,d.css)({flex:"1 1 100%"}),actions:(0,d.css)({flex:0,justifyContent:"flex-end",display:"flex",gap:u.spacing(1)})});function S({exportProvider:u}){const{name:h,type:P}=u,O={file:{title:"File-provisioning format",component:(0,e.jsxs)(e.Fragment,{children:[h," format is only valid for File Provisioning."," ",(0,e.jsx)(y.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/file-provisioning/",external:!0,children:"Read more in the docs."})]})},api:{title:"API-provisioning format",component:(0,e.jsxs)(e.Fragment,{children:[h," format is only valid for API Provisioning."," ",(0,e.jsx)(y.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/http-api-provisioning/",external:!0,children:"Read more in the docs."})]})},terraform:{title:"Terraform-provisioning format",component:(0,e.jsxs)(e.Fragment,{children:[h," format is only valid for Terraform Provisioning."," ",(0,e.jsx)(y.Y,{href:"https://grafana.com/docs/grafana/latest/alerting/set-up/provision-alerting-resources/terraform-provisioning/",external:!0,children:"Read more in the docs."})]})}},{title:G,component:N}=O[P];return(0,e.jsx)(c.F,{title:G,severity:"info",bottomSpacing:0,topSpacing:0,children:N})}},76648:(ee,T,t)=>{t.d(T,{m:()=>A});var e=t(74848),d=t(87978),o=t(73716);function A({activeTab:M,onTabChange:E,children:C,onClose:L,formatProviders:F,title:W="Export"}){const y=Object.values(F).map(c=>({label:c.name,value:c.exportFormat}));return(0,e.jsx)(d._,{title:W,subtitle:"Select the format and download the file or copy the contents to clipboard",tabs:(0,e.jsx)(o.sb,{tabs:y,setActiveTab:E,activeTab:M}),onClose:L,size:"md",children:C})}},84029:(ee,T,t)=>{t.d(T,{sl:()=>A});const e={name:"JSON",exportFormat:"json",type:"file",formatter:E=>{try{return JSON.stringify(JSON.parse(E),null,4)}catch{return E}}},d={name:"YAML",exportFormat:"yaml",type:"file"},o={name:"Terraform (HCL)",exportFormat:"hcl",type:"terraform"},A={[e.exportFormat]:e,[d.exportFormat]:d,[o.exportFormat]:o},M=[e,d]},37198:(ee,T,t)=>{t.d(T,{XW:()=>f,gB:()=>ae,zm:()=>Y,Ad:()=>z,SD:()=>k,br:()=>re});var e=t(1932),d=t(96540),o=t(82843),A=t(49962);const M=["TimeInterval"],C=A.Hr.enhanceEndpoints({addTagTypes:M}).injectEndpoints({endpoints:p=>({listNamespacedTimeInterval:p.query({query:a=>({url:`/apis/notifications.alerting.grafana.app/v0alpha1/namespaces/${a.namespace}/timeintervals`,params:{pretty:a.pretty,allowWatchBookmarks:a.allowWatchBookmarks,continue:a.continue,fieldSelector:a.fieldSelector,labelSelector:a.labelSelector,limit:a.limit,resourceVersion:a.resourceVersion,resourceVersionMatch:a.resourceVersionMatch,sendInitialEvents:a.sendInitialEvents,timeoutSeconds:a.timeoutSeconds,watch:a.watch}}),providesTags:["TimeInterval"]}),createNamespacedTimeInterval:p.mutation({query:a=>({url:`/apis/notifications.alerting.grafana.app/v0alpha1/namespaces/${a.namespace}/timeintervals`,method:"POST",body:a.comGithubGrafanaGrafanaPkgApisAlertingNotificationsV0Alpha1TimeInterval,params:{pretty:a.pretty,dryRun:a.dryRun,fieldManager:a.fieldManager,fieldValidation:a.fieldValidation}}),invalidatesTags:["TimeInterval"]}),readNamespacedTimeInterval:p.query({query:a=>({url:`/apis/notifications.alerting.grafana.app/v0alpha1/namespaces/${a.namespace}/timeintervals/${a.name}`,params:{pretty:a.pretty}}),providesTags:["TimeInterval"]}),replaceNamespacedTimeInterval:p.mutation({query:a=>({url:`/apis/notifications.alerting.grafana.app/v0alpha1/namespaces/${a.namespace}/timeintervals/${a.name}`,method:"PUT",body:a.comGithubGrafanaGrafanaPkgApisAlertingNotificationsV0Alpha1TimeInterval,params:{pretty:a.pretty,dryRun:a.dryRun,fieldManager:a.fieldManager,fieldValidation:a.fieldValidation}}),invalidatesTags:["TimeInterval"]}),deleteNamespacedTimeInterval:p.mutation({query:a=>({url:`/apis/notifications.alerting.grafana.app/v0alpha1/namespaces/${a.namespace}/timeintervals/${a.name}`,method:"DELETE",body:a.ioK8SApimachineryPkgApisMetaV1DeleteOptions,params:{pretty:a.pretty,dryRun:a.dryRun,gracePeriodSeconds:a.gracePeriodSeconds,orphanDependents:a.orphanDependents,propagationPolicy:a.propagationPolicy}}),invalidatesTags:["TimeInterval"]}),patchNamespacedTimeInterval:p.mutation({query:a=>({url:`/apis/notifications.alerting.grafana.app/v0alpha1/namespaces/${a.namespace}/timeintervals/${a.name}`,method:"PATCH",body:a.ioK8SApimachineryPkgApisMetaV1Patch,params:{pretty:a.pretty,dryRun:a.dryRun,fieldManager:a.fieldManager,fieldValidation:a.fieldValidation,force:a.force}}),invalidatesTags:["TimeInterval"]})}),overrideExisting:!1});var L=t(4724),F=t(23770),W=t(98164),y=t(57220),c=t(2859),l=t(51703),j=t(31678);const{useLazyGetAlertmanagerConfigurationQuery:I}=o.m,{useLazyListNamespacedTimeIntervalQuery:S,useCreateNamespacedTimeIntervalMutation:u,useLazyReadNamespacedTimeIntervalQuery:h,useReplaceNamespacedTimeIntervalMutation:P,useDeleteNamespacedTimeIntervalMutation:O}=C,G=p=>{const{metadata:a,spec:b}=p;return{...b,id:b.name,metadata:a,provisioned:a.annotations?.[c.a]!==c.r}},N=(p,a)=>({...p,id:p.name,provisioned:!!(a&&a!==c.r)}),J=()=>I({selectFromResult:({data:p,...a})=>{if(!p)return{data:p,...a};const{alertmanager_config:b}=p,w=b.muteTimeProvenances??{};return{data:(0,L.IT)(b).map(R=>N(R,w[R.name])),...a}}}),se=()=>S({selectFromResult:({data:p,...a})=>({data:p?.items.map(b=>G(b)),...a})}),z=({alertmanager:p})=>{const a=(0,l.d)(p),[b,w]=se(),[X,K]=J();return(0,d.useEffect)(()=>{if(a){const R=(0,l.k)();b({namespace:R})}else X(p)},[p,X,b,a]),a?w:K},f=({alertmanager:p})=>{const a=(0,l.d)(p),b=(0,j.useDispatch)(),[w]=u(),[X]=I(),K=p===y.hY;if(a){const R=(0,l.k)();return({timeInterval:Z})=>w({namespace:R,comGithubGrafanaGrafanaPkgApisAlertingNotificationsV0Alpha1TimeInterval:{metadata:{},spec:Z}}).unwrap()}return async({timeInterval:R})=>{const Z=await X(p).unwrap(),ue=(0,e.jM)(Z,Ee=>{const pe=K?"mute_time_intervals":"time_intervals";Ee.alertmanager_config[pe]=Ee.alertmanager_config[pe]??[],Ee.alertmanager_config[pe]=(Ee.alertmanager_config[pe]??[]).concat(R)});return b((0,F.RW)({newConfig:ue,oldConfig:Z,alertManagerSourceName:p,successMessage:"Mute timing saved"})).unwrap()}},Y=({alertmanager:p,name:a})=>{const b=(0,l.d)(p),[w,X]=h({selectFromResult:({data:Z,...ue})=>Z?{data:G(Z),...ue}:{data:Z,...ue}}),[K,R]=I({selectFromResult:({data:Z,...ue})=>{if(!Z)return{data:Z,...ue};const Ee=Z?.alertmanager_config??{},Ie=(0,L.IT)(Ee).find(({name:Te})=>Te===a);if(Ie){const Te=Ee?.muteTimeProvenances??{};return{data:N(Ie,Te[Ie.name]),...ue}}return{...ue,data:void 0,isError:!0}}});return(0,d.useEffect)(()=>{if(b){const Z=(0,l.k)();w({namespace:Z,name:a},!0)}else K(p,!0)},[p,K,w,a,b]),b?X:R},k=({alertmanager:p})=>{const a=(0,l.d)(p),b=(0,j.useDispatch)(),[w]=P(),[X]=I();return a?async({timeInterval:K,originalName:R})=>{const Z=(0,l.k)();return w({name:R,namespace:Z,comGithubGrafanaGrafanaPkgApisAlertingNotificationsV0Alpha1TimeInterval:{spec:K,metadata:{name:R}}}).unwrap()}:async({timeInterval:K,originalName:R})=>{const Z=K.name!==R,ue=await X(p).unwrap(),Ee=(0,e.jM)(ue,pe=>{const Ie=(pe.alertmanager_config?.time_intervals||[])?.findIndex(({name:Ge})=>Ge===R);Ie!==-1&&(pe.alertmanager_config.time_intervals[Ie]=K);const Te=(pe.alertmanager_config?.mute_time_intervals||[])?.findIndex(({name:Ge})=>Ge===R);Te!==-1&&(pe.alertmanager_config.mute_time_intervals[Te]=K),Z&&pe.alertmanager_config.route&&(pe.alertmanager_config.route=(0,W.Lt)(K.name,R,pe.alertmanager_config.route))});return b((0,F.RW)({newConfig:Ee,oldConfig:ue,alertManagerSourceName:p,successMessage:"Mute timing saved"})).unwrap()}},ae=({alertmanager:p})=>{const a=(0,l.d)(p),b=(0,j.useDispatch)(),[w]=O();return a?async({name:X})=>{const K=(0,l.k)();return w({name:X,namespace:K,ioK8SApimachineryPkgApisMetaV1DeleteOptions:{}}).unwrap()}:async({name:X})=>b((0,F.$8)(p,X))},re=({alertmanager:p})=>{const a=(0,l.d)(p),[b]=J();return a?()=>{}:async(w,X)=>{if(!X)return b(p).unwrap().then(K=>!!(0,L.IT)(K.alertmanager_config)?.find(ue=>ue.name===w)?`Mute timing already exists with name "${w}"`:void 0)}}},4724:(ee,T,t)=>{t.d(T,{Hy:()=>L,IT:()=>F,av:()=>y,oB:()=>W});var e=t(74848),d=t(95093),o=t.n(d),A=t(96540),M=t(67061),E=t(98164);const C=/^((([01][0-9])|(2[0-3])):[0-5][0-9])$|(^24:00$)/,L=c=>c?C.test(c):!0,F=c=>[...c.mute_time_intervals??[],...c.time_intervals??[]],W=(c,l)=>{if(!c&&!l)return!0;if(!c&&l||c&&!l)return!1;const j="HH:mm",I=o()().startOf("day").add(c,j),S=o()().startOf("day").add(l,j);return!!(c&&l&&I.isBefore(S)||c&&l&&S.isAfter(I))};function y(c){const j=c.time_intervals.map((I,S)=>{const{times:u,weekdays:h,days_of_month:P,months:O,years:G,location:N}=I,J=(0,E.Dm)(u,N),se=(0,E.uH)(h),z=(0,E.UL)(P),f=(0,E.$P)(O),Y=(0,E.mP)(G);return(0,e.jsx)(A.Fragment,{children:(0,e.jsxs)("div",{children:[`${J} ${se}`,(0,e.jsx)("br",{}),[z,f,Y].join(" | "),(0,e.jsx)("br",{})]})},JSON.stringify(I)+S)});return(0,e.jsx)(M.B,{direction:"column",gap:1,children:j})}},26928:(ee,T,t)=>{t.d(T,{s:()=>W});var e=t(74848),d=t(32196),o=t(2543),A=t.n(o),M=t(40845),E=t(67061),C=t(69613),L=t(32642),F=t(35108);const W=({matchers:l,formatter:j="default"})=>{const I=(0,M.of)(c),S=5,u=(0,o.take)(l,S),h=(0,o.takeRight)(l,l.length-S),P=h.length>0;return(0,e.jsx)("span",{"data-testid":"label-matchers",children:(0,e.jsxs)(E.B,{direction:"row",gap:1,alignItems:"center",wrap:"wrap",children:[u.map(O=>(0,e.jsx)(y,{matcher:O,formatter:j},(0,o.uniqueId)())),P&&(0,e.jsx)(F.j,{arrow:!0,placement:"top",content:(0,e.jsx)(e.Fragment,{children:h.map(O=>(0,e.jsx)(y,{matcher:O},(0,o.uniqueId)()))}),children:(0,e.jsx)("span",{children:(0,e.jsx)("div",{className:I.metadata,children:`and ${h.length} more`})})})]})})},y=({matcher:l,formatter:j="default"})=>{const I=(0,M.of)(c);return(0,e.jsx)("div",{className:I.matcher(l[0]).wrapper,children:(0,e.jsx)(E.B,{direction:"row",gap:0,alignItems:"baseline",children:L.t8[j](l)})})},c=l=>({matcher:j=>{const{color:I,borderColor:S}=(0,C.MC)(j);return{wrapper:(0,d.css)({color:"#fff",background:I,padding:`${l.spacing(.33)} ${l.spacing(.66)}`,fontSize:l.typography.bodySmall.fontSize,border:`solid 1px ${S}`,borderRadius:l.shape.borderRadius(2),whiteSpace:"pre"})}},metadata:(0,d.css)({color:l.colors.text.secondary,fontSize:l.typography.bodySmall.fontSize,fontWeight:l.typography.bodySmall.fontWeight})})},33915:(ee,T,t)=>{t.d(T,{V:()=>c});var e=t(74848),d=t(96540),o=t(10354),A=t(14578),M=t(35108),E=t(32196),C=t(40845),L=t(41068);function F(){const l=(0,C.of)(y);return(0,e.jsxs)("div",{children:["Prometheus duration format consist of a number followed by a time unit.",(0,e.jsx)("br",{}),"Different units can be combined for more granularity.",(0,e.jsx)("hr",{}),(0,e.jsxs)("div",{className:l.list,children:[(0,e.jsxs)("div",{className:l.header,children:[(0,e.jsx)("div",{children:"Symbol"}),(0,e.jsx)("div",{children:"Time unit"}),(0,e.jsx)("div",{children:"Example"})]}),(0,e.jsx)(W,{unit:L.y.seconds,name:"seconds",example:"20s"}),(0,e.jsx)(W,{unit:L.y.minutes,name:"minutes",example:"10m"}),(0,e.jsx)(W,{unit:L.y.hours,name:"hours",example:"4h"}),(0,e.jsx)(W,{unit:L.y.days,name:"days",example:"3d"}),(0,e.jsx)(W,{unit:L.y.weeks,name:"weeks",example:"2w"}),(0,e.jsxs)("div",{className:l.examples,children:[(0,e.jsx)("div",{children:"Multiple units combined"}),(0,e.jsx)("code",{children:"1m30s, 2h30m20s, 1w2d"})]})]})]})}function W({unit:l,name:j,example:I}){const S=(0,C.of)(y);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{className:S.unit,children:l}),(0,e.jsx)("div",{children:j}),(0,e.jsx)("code",{children:I})]})}const y=l=>({unit:(0,E.css)({fontWeight:l.typography.fontWeightBold}),list:(0,E.css)({display:"grid",gridTemplateColumns:"max-content 1fr 2fr",gap:l.spacing(1,3)}),header:(0,E.css)({display:"contents",fontWeight:l.typography.fontWeightBold}),examples:(0,E.css)({display:"contents","& > div":{gridColumn:"1 / span 2"}})}),c=(0,d.forwardRef)((l,j)=>(0,e.jsx)(o.p,{suffix:(0,e.jsx)(M.j,{content:(0,e.jsx)(F,{}),disabled:!1,children:(0,e.jsx)(A.I,{name:"info-circle",size:"lg"})}),...l,ref:j}));c.displayName="PromDurationInput"},99903:(ee,T,t)=>{t.d(T,{t:()=>d});var e=t(32196);const d=o=>({container:(0,e.css)({alignItems:"center",display:"flex",flexFlow:"row nowrap","& > * + *":{marginLeft:o.spacing(1)}}),input:(0,e.css)({flex:1}),promDurationInput:(0,e.css)({maxWidth:o.spacing(32)}),timingFormContainer:(0,e.css)({padding:o.spacing(1)}),linkText:(0,e.css)({textDecoration:"underline"}),collapse:(0,e.css)({border:"none",background:"none",color:o.colors.text.primary})})},97174:(ee,T,t)=>{t.d(T,{G:()=>e});const e={groupWait:{label:"Group wait",description:"The wait time before sending the first notification for a new group of alerts. If empty, it is inherited from the parent policy.",ariaLabel:"Group wait value"},groupInterval:{label:"Group interval",description:"The wait time before sending a notification about changes in the alert group after the first notification has been sent. If empty, it is inherited from the parent policy.",ariaLabel:"Group interval value"},repeatInterval:{label:"Repeat interval",description:"The wait time before resending a notification that has already been sent successfully.",ariaLabel:"Repeat interval value"}}},27835:(ee,T,t)=>{t.d(T,{H:()=>e});const e={group_wait:"30s",group_interval:"5m",repeat_interval:"4h"}},73716:(ee,T,t)=>{t.d(T,{G_:()=>h,sb:()=>P});var e=t(74848),d=t(32196),o=t(20382),A=t(96540),M=t(49785),E=t(70713),C=t(40845),L=t(87978),F=t(63021),W=t(40675),y=t(55852),c=t(56034),l=t(14578),j=t(32372),I=t(63066),S=t(23662);const u=[{label:"Yaml",value:"yaml"}],h=({onClose:z})=>{const[f,Y]=(0,A.useState)("yaml"),{setValue:k}=(0,M.xW)(),ae=(0,C.of)(se),re=p=>{for(const a in p)k(a,p[a]);z()};return(0,e.jsx)(L._,{title:"Inspect Alert rule",subtitle:(0,e.jsx)("div",{className:ae.subtitle,children:(0,e.jsx)(P,{tabs:u,setActiveTab:Y,activeTab:f})}),onClose:z,children:f==="yaml"&&(0,e.jsx)(O,{onSubmit:re})})};function P({tabs:z,activeTab:f,setActiveTab:Y}){return(0,e.jsx)(F.U,{children:z.map((k,ae)=>(0,e.jsx)(W.o,{label:k.label,value:k.value,onChangeTab:()=>Y(k.value),active:f===k.value},`${k.value}-${ae}`))})}const O=({onSubmit:z})=>{const f=(0,C.of)(J),{getValues:Y}=(0,M.xW)(),k=(0,I.l1)(Y()),[ae,re]=(0,A.useState)((0,o.Bh)(k)),p=()=>{const a=(0,o.Hh)(ae),b=Y(),w=N(a);z({...b,...w})};return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:f.applyButton,children:[(0,e.jsx)(y.$n,{type:"button",onClick:p,children:"Apply"}),(0,e.jsx)(c.m,{content:(0,e.jsx)(G,{}),theme:"info",placement:"left-start",interactive:!0,children:(0,e.jsx)(l.I,{name:"exclamation-triangle",size:"xl"})})]}),(0,e.jsx)("div",{className:f.content,children:(0,e.jsx)(E.Ay,{disableWidth:!0,children:({height:a})=>(0,e.jsx)(j.B,{width:"100%",height:a,language:"yaml",value:ae,onBlur:re,monacoOptions:{minimap:{enabled:!1}}})})})]})};function G(){return(0,e.jsxs)("div",{children:["The YAML content in the editor only contains alert rule configuration ",(0,e.jsx)("br",{}),"To configure Prometheus, you need to provide the rest of the"," ",(0,e.jsx)("a",{href:"https://prometheus.io/docs/prometheus/latest/configuration/alerting_rules/",target:"_blank",rel:"noreferrer",children:"configuration file content."})]})}function N(z){return(0,S.$y)(z)?(0,I.Qk)(z):(0,S.i7)(z)?(0,I.XI)(z):{}}const J=z=>({content:(0,d.css)({flexGrow:1,height:"100%",paddingBottom:"16px",marginBottom:z.spacing(2)}),applyButton:(0,d.css)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",flexGrow:0,marginBottom:z.spacing(2)})}),se=()=>({subtitle:(0,d.css)({display:"flex",alignItems:"center",justifyContent:"space-between"})})},51488:(ee,T,t)=>{t.d(T,{f:()=>d});var e=t(82843);function d(o,A){const M=e.m.endpoints.getAlertmanagerConfiguration.useQuery(o??"",{refetchOnMountOrArgChange:!0,...A,skip:!o});return{...M,error:M.error}}},19645:(ee,T,t)=>{t.d(T,{M:()=>e});const e={discord:"discord",email:"envelope",googlechat:"google-hangouts-alt",hipchat:"hipchat",line:"line",pagerduty:"pagerduty",slack:"slack",teams:"microsoft",telegram:"telegram-alt",webhook:"link",sns:"amazon"}},19143:(ee,T,t)=>{t.d(T,{L:()=>F});var e=t(14590),d=t(96540),o=t(25027),A=t(67278);const M=()=>new A.c(new URL(t.p+t.u(5398),t.b));let E;function C(){let W;if(E===void 0)try{W=M(),E=e.LV(W)}catch(c){c instanceof Error&&(0,o.vV)(c)}return{disposeWorker:()=>{W&&E&&(E[e.A2](),W.terminate(),E=void 0,W=void 0)}}}function L(W){if(!E)throw new Error("Route Matcher has not been initialized")}function F(){(0,d.useEffect)(()=>{const{disposeWorker:c}=C();return c},[]);const W=(0,d.useCallback)(async(c,l,j)=>{L(E);const I=performance.now(),S=await E.getRouteGroupsMap(c,l,j),u=performance.now()-I;return(0,o.fH)(`Route Groups Matched in  ${u} ms`,{matchingTime:u.toString(),alertGroupsCount:l.length.toString(),topLevelRoutesCount:c.routes?.length.toString()??"0"}),S},[]),y=(0,d.useCallback)(async(c,l,j)=>{L(E);const I=performance.now(),S=await E.matchInstancesToRoute(c,l,j),u=performance.now()-I;return(0,o.fH)(`Instances Matched in  ${u} ms`,{matchingTime:u.toString(),instancesToMatchCount:l.length.toString(),topLevelRoutesCount:c.routes?.length.toString()??"0"}),S},[]);return{getRouteGroupsMap:W,matchInstancesToRoute:y}}},79657:(ee,T,t)=>{t.d(T,{DY:()=>z,Mk:()=>P,QM:()=>S,Rg:()=>c,SJ:()=>h,YE:()=>u,Yl:()=>j,eb:()=>G,gY:()=>O,hH:()=>J,ie:()=>N});var e=t(2543),d=t.n(e),o=t(60021),A=t(98164),M=t(57220),E=t(32642),C=t(67332),L=t(25968);const F=(f,Y)=>Object.entries(f??{}).reduce((k,[ae,re])=>[...k,{name:ae,value:re,operator:Y?o.ho.regex:o.ho.equal}],[]),W=f=>f.value,y=f=>(f??[]).map(W),c={name:"",value:"",operator:o.ho.equal},l=["grafana_folder","alertname"],j=[{label:"grafana_folder",value:"grafana_folder",isFixed:!0},{label:"alertname",value:"alertname",isFixed:!0},{label:"Disable (...)",value:"..."}],I={id:"",overrideGrouping:!1,groupBy:l,object_matchers:[],routes:[],continue:!1,receiver:"",overrideTimings:!1,groupWaitValue:"",groupIntervalValue:"",repeatIntervalValue:"",muteTimeIntervals:[]};function S(f){return{id:(0,e.uniqueId)("route-"),...f,routes:(f.routes??[]).map(S)}}const u=f=>{if(!f)return I;const Y="id"in f?f.id:(0,e.uniqueId)("route-");if(Object.keys(f).length===0)return{...I,id:Y};const k=[];f.routes?.forEach(p=>{const a=u(p);k.push(a)});const ae=f.object_matchers?.map(p=>({name:p[0],operator:p[1],value:p[2]}))??[],re=f.matchers?.flatMap(p=>(0,E.So)(p).flatMap(A.MU)).map(({name:p,operator:a,value:b})=>({name:(0,E.Ig)(p),operator:a,value:(0,E.Ig)(b)}))??[];return{id:Y,object_matchers:[...re,...ae,...F(f.match,!1),...F(f.match_re,!0)],continue:f.continue??!1,receiver:f.receiver??"",overrideGrouping:Array.isArray(f.group_by)&&f.group_by.length>0,groupBy:f.group_by??void 0,overrideTimings:[f.group_wait,f.group_interval,f.repeat_interval].some(Boolean),groupWaitValue:f.group_wait??"",groupIntervalValue:f.group_interval??"",repeatIntervalValue:f.repeat_interval??"",routes:k,muteTimeIntervals:f.mute_time_intervals??[]}},h=(f,Y,k)=>{const ae=(0,C.eM)(Y.id??"",k),{overrideGrouping:re,groupBy:p,overrideTimings:a,groupWaitValue:b,groupIntervalValue:w,repeatIntervalValue:X,receiver:K}=Y,R=void 0,Z=re?p:R,Ee=a&&b?b:R,Ie=a&&w?w:R,Ge=a&&X?X:R,Ke=Y.object_matchers?.filter(Ae=>Ae.name&&Ae.operator&&Ae.value!==null&&Ae.value!==void 0).map(({name:Ae,operator:mt,value:pt})=>[Ae,mt,pt]),ie=Y.routes?.map(Ae=>h(f,Ae,k)),ge={...ae??{},continue:Y.continue,group_by:Z,object_matchers:Ke,match:void 0,match_re:void 0,group_wait:Ee,group_interval:Ie,repeat_interval:Ge,routes:ie,mute_time_intervals:Y.muteTimeIntervals,receiver:K};return f!==M.hY?(ge.matchers=Y.object_matchers?.map(E.b2),ge.object_matchers=void 0):(ge.object_matchers=(0,E.J$)(ge),ge.matchers=void 0),Y.receiver&&(ge.receiver=Y.receiver),ge},P=f=>({label:f,value:f}),O=f=>(f??[]).map(P),G=f=>f===null?null:f?W(f)??"":"",N=f=>f?y(f):[];function J(f){return!f||f.length===0?!0:(0,L.TN)(f)||"Invalid duration format. Must be {number}{time_unit}"}const se=f=>f.map(Y=>{const[k,ae,re]=Y;return`${k}${ae}${re}`}),z=(f,Y="")=>{if(f.length===0)return!0;const k=J(f),ae=J(Y);if(k!==!0)return k;if(ae!==!0)return ae;const re=(0,L.P8)(f),p=(0,L.P8)(Y);return p!==0&&re<p?"Repeat interval should be higher or equal to Group interval":!0}},2859:(ee,T,t)=>{t.d(T,{a:()=>e,r:()=>d});const e="grafana.com/provenance",d="none"},51703:(ee,T,t)=>{t.d(T,{d:()=>A,k:()=>o});var e=t(32264),d=t(57220);const o=()=>e.$.namespace,A=M=>e.$.featureToggles.alertingApiServer&&M===d.hY},54486:(ee,T,t)=>{t.d(T,{KR:()=>A,Ww:()=>E,d6:()=>y,iF:()=>L,jU:()=>o,jb:()=>W,oU:()=>M});var e=t(2543),d=t.n(e);const o=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],A=["january","february","march","april","may","june","july","august","september","october","november","december"],M={times:[{start_time:"",end_time:""}],weekdays:"",days_of_month:"",months:"",years:"",location:"",disable:!1},E=(c,l,j)=>c?c.split(",").map(I=>I.trim()).every(I=>I.split(":").every(l))||j:!0,C=c=>c?c.split(",").map(l=>l.trim()):void 0,L=c=>{const l=c.time_intervals.map(({times:j,weekdays:I,days_of_month:S,months:u,years:h,location:P,disable:O})=>{const G={times:F(j,O),weekdays:C(I)?.map(N=>N.toLowerCase()),days_of_month:C(S),months:C(u),years:C(h),location:P||void 0};return(0,e.omitBy)(G,e.isUndefined)});return{name:c.name,time_intervals:l}};function F(c,l){if(l)return[];const j=c?.filter(({start_time:I,end_time:S})=>!!I&&!!S);return j?.length?j:void 0}function W(c){return c.times?.length===0||c.weekdays?.length===0||c.days_of_month?.length===0||c.months?.length===0||c.years?.length===0}function y(c){return c.time_intervals.every(l=>W(l))}},79581:(ee,T,t)=>{t.d(T,{W$:()=>c,_I:()=>l,rJ:()=>F});var e=t(2543),d=t.n(e),o=t(60021),A=t(32642);const M=["receiver","group_by","group_wait","group_interval","repeat_interval"];function E(u,h){const P=C(u,h),O=new Map(h.map(G=>[G,{match:!1,matcher:null}]));return u.forEach(G=>{const N=h.find(J=>S(G,J));N&&O.set(N,{match:!0,matcher:G})}),{matches:P,labelsMatch:O}}function C(u,h){for(const P of u)if(!I(P,h))return!1;return!0}function L(u,h){let P=[];const O=E(u.object_matchers??[],h);if(!O.matches)return[];if(u.routes)for(const G of u.routes){const N=L(G,h);if(P=P.concat(N),N.length&&!G.continue)break}return P.length===0&&P.push({route:u,labelsMatch:O.labelsMatch}),P}function F(u){function h(O){O.object_matchers=(0,A.J$)(O),delete O.matchers,delete O.match,delete O.match_re,O.routes?.forEach(h)}const P=structuredClone(u);return h(P),P}function W(u){function h(O){O.object_matchers=O.object_matchers?.map(([G,N,J])=>[unquoteWithUnescape(G),N,unquoteWithUnescape(J)]),O.routes?.forEach(h)}const P=structuredClone(u);return h(P),P}function y(u,h,P){const O=[];return P.reduce((G,N)=>{const J=N.alerts.filter(se=>{const z=Object.entries(se.labels);return L(u,z).some(f=>f.route===h)});return J.length&&G.push({...N,alerts:J}),G},O)}function c(u,h,P){const G={...(0,e.pick)(u,M),...P};return(0,e.reduce)(G,(J,se,z)=>{const f=se!=null,ae=[void 0,"",null].some(a=>h[z]===a)&&f,re=z==="group_by"&&f&&(0,e.isArray)(h[z])&&h[z]?.length===0;return(ae||re)&&(J[z]=se),J},{})}function l(u){return{...u,routes:u.routes?.map(h=>{const P=c(u,h);return l({...h,...P})})}}const j={[o.ho.equal]:(u,h)=>u===h,[o.ho.notEqual]:(u,h)=>u!==h,[o.ho.regex]:(u,h)=>new RegExp(`^(?:${h})$`).test(u),[o.ho.notRegex]:(u,h)=>!new RegExp(`^(?:${h})$`).test(u)};function I(u,h){const[P,O,G]=u;let N="";const J=Object.fromEntries(h)[P];J&&(N=J);const se=j[O];if(!se)throw new Error(`no such operator: ${O}`);return se(N,G)}function S(u,h){const[P,O]=h,[G,N,J]=u;if(P!==G)return!1;const se=j[N];if(!se)throw new Error(`no such operator: ${N}`);return se(O,J)}},67332:(ee,T,t)=>{t.d(T,{AB:()=>E,AS:()=>C,I8:()=>L,dn:()=>W,eM:()=>y});var e=t(1932),d=t(2543),o=t.n(d),A=t(14588),M=t(79657);const E=(c,l,j)=>{if(!y(l.id??"",j))throw new Error(`No such route with ID '${l.id}'`);function S(u){let h=u;if(u.id===l.id){const P=(0,M.SJ)(c,l,j);h={...u,...P}}return{...h,routes:u.routes?.map(S)}}return S(j)},C=(c,l)=>{if(c.id===l.id)throw new Error("You cant remove the root policy");function j(I){return{...I,routes:I.routes?.reduce((S=[],u)=>(u.id===c.id||S.push(j(u)),S),[])}}return j(l)},L=(c,l,j,I,S)=>{const u=(0,M.SJ)(c,l,I);return(0,e.jM)(I,h=>{const[P,O,G]=F(h,j);if(P===void 0||O===void 0||G===void 0)throw new Error(`could not find reference route "${j.id}" in tree`);S==="child"&&(P.routes?P.routes.push(u):P.routes=[u]),S==="above"&&(O.routes=(0,A.insertBeforeImmutably)(O.routes??[],u,G)),S==="below"&&(O.routes=(0,A.insertAfterImmutably)(O.routes??[],u,G))})};function F(c,l){let j,I,S;function u(h,P,O){j||(h.id===l.id&&(j=h,I=O,S=P),h.routes&&h.routes.forEach((G,N)=>u(G,N,h)))}return u(c,0,c),[j,I,S]}function W(c){return(0,d.omit)({...c,routes:c.routes?.map(l=>W(l))},"id")}function y(c,l){return l.id===c?l:l.routes?.find(j=>y(c,j))}}}]);

//# sourceMappingURL=AlertAmRoutes.8f1b8a7380ad4003680b.js.map