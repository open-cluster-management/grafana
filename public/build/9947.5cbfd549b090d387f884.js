"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9947],{40715:(oe,U,t)=>{t.d(U,{o:()=>f});var e=t(96540),n=t(31678),y=t(97007);function f(I){const C=(0,n.useDispatch)(),E=(0,e.useRef)(I);E.current=I,(0,e.useEffect)(()=>()=>{C((0,y.N)({cleanupAction:E.current}))},[C])}},31099:(oe,U,t)=>{t.d(U,{A:()=>m});var e=t(74848),n=t(32196),y=t(1932),f=t(96540),I=t(49785),C=t(42941),E=t(40845),F=t(67061),A=t(94753),$=t(10354),T=t(21744),G=t(88575),B=t(55852),h=t(55740);const _=({field:s})=>{const a=(0,E.of)(be);return(0,e.jsxs)("div",{children:[(0,e.jsx)("span",{className:a.annotationTitle,children:"Custom annotation name and content"}),(0,e.jsx)($.p,{placeholder:"Enter custom annotation name...",width:18,...s,className:a.customAnnotationInput})]})},be=s=>({annotationTitle:(0,n.css)({color:s.colors.text.primary,marginBottom:"3px"}),customAnnotationInput:(0,n.css)({marginTop:"5px",width:"100%"})}),le=_,je=({annotationField:s,annotations:a,annotation:o,index:p})=>{const{control:d}=(0,I.xW)();return(0,e.jsxs)(F.B,{direction:"column",gap:0,children:[(0,e.jsx)("label",{children:(0,e.jsx)(I.xI,{name:`annotations.${p}.key`,defaultValue:s.key,render:({field:{ref:r,...c}})=>{if(!h.J3[o])return(0,e.jsx)(le,{field:c});let u;switch(s.key){case h.YH.dashboardUID:u="Dashboard and panel";break;case h.YH.panelID:u="";break;default:u=h.J3[o]&&h.J3[o]+" (optional)"}return(0,e.jsx)("span",{"data-testid":`annotation-key-${p}`,children:(0,e.jsx)(A.E,{color:"primary",variant:"bodySmall",children:u})})},control:d,rules:{required:{value:!!a[p]?.value,message:"Required."}}})}),(0,e.jsx)(A.E,{variant:"bodySmall",color:"secondary",children:h.H8[o]})]})};var V=t(14578),re=t(56361);const De=({dashboard:s,panel:a,dashboardUid:o,panelId:p,onEditClick:d,onDeleteClick:r})=>{const c=(0,E.of)(Se),u=(0,re.JM)(s?.uid||o),b=(0,re.D2)(s?.uid||o,a?.id?.toString()||p);return(0,e.jsxs)("div",{className:c.container,children:[s&&(0,e.jsxs)("a",{href:u,className:c.link,target:"_blank",rel:"noreferrer","data-testid":"dashboard-annotation",children:[s.title," ",(0,e.jsx)(V.I,{name:"external-link-alt"})]}),!s&&(0,e.jsxs)("span",{className:c.noLink,children:["Dashboard ",o," "]}),a&&(0,e.jsxs)("a",{href:b,className:c.link,target:"_blank",rel:"noreferrer","data-testid":"panel-annotation",children:[a.title||"<No title>"," ",(0,e.jsx)(V.I,{name:"external-link-alt"})]}),!a&&(0,e.jsxs)("span",{className:c.noLink,children:[" - Panel ",p]}),(s||a)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(V.I,{name:"pen",onClick:d,className:c.icon}),(0,e.jsx)(V.I,{name:"trash-alt",onClick:r,className:c.icon})]})]})},Se=s=>({container:(0,n.css)({marginTop:"5px"}),noLink:(0,n.css)({color:s.colors.text.secondary}),link:(0,n.css)({color:s.colors.text.link,marginRight:s.spacing(1.5)}),icon:(0,n.css)({marginRight:s.spacing(1),cursor:"pointer"})}),Ie=De;var Ae=t(2543),Ce=t(40996),ie=t(70713),ce=t(91793),ee=t(56034),de=t(37390),Ee=t(42418),se=t(67647),te=t(39558),Le=t(49962);const ue=Le.Hr.injectEndpoints({endpoints:s=>({search:s.query({query:({query:a})=>{const o=new URLSearchParams({type:"dash-db",limit:"1000",page:"1",sort:"name_sort"});return a&&o.set("query",a),{url:`/api/search?${o.toString()}`}}}),dashboard:s.query({query:({uid:a})=>({url:`/api/dashboards/uid/${a}`})})})});var Q=t(41811),me=t(34214);const Be=(0,Q.A)(s=>{const{dashboard:a,meta:o}=structuredClone(s);return new me.G(a,o)});function q(s){return ue.endpoints.dashboard.useQuery({uid:s??""},{skip:!s,selectFromResult:({currentData:o,data:p,...d})=>({dashboardModel:o?Be(o):void 0,...d})})}function Pe(s,a){return s.title&&a.title?s.title.localeCompare(a.title):s.title&&!a.title?1:!s.title&&a.title?-1:0}const Re=({dashboardUid:s,panelId:a,isOpen:o,onChange:p,onDismiss:d})=>{const r=(0,E.of)(ne),[c,u]=(0,f.useState)(s),[b,L]=(0,f.useState)(a),[z,Z]=(0,f.useState)(""),[k,P]=(0,f.useState)(""),[W,w]=(0,f.useState)(""),{useSearchQuery:R}=ue,{currentData:v=[],isFetching:j}=R({query:k}),{dashboardModel:N,isFetching:M}=q(c),H=(0,f.useCallback)(S=>{u(S),L(void 0)},[]),fe=he(N),ge=fe.filter(S=>S.title?.toLowerCase().includes(W.toLowerCase())).sort(Pe)??[],x=fe.find(S=>pe(S)&&S.id?.toString()===b),D=(0,f.useMemo)(()=>v.map(S=>S.uid).indexOf(c??""),[v,c]),K=s&&s===c,J=D>=0,X=(0,f.useCallback)(S=>{const Y=D>=0;K&&Y&&S?.scrollToItem(D,"smart")},[K,D]);(0,Ce.A)(()=>{P(z)},500,[z]);const xe=({index:S,style:Y})=>{const O=v[S],ve=c===O.uid;return(0,e.jsxs)("button",{type:"button",title:O.title,style:Y,className:(0,n.cx)(r.rowButton,{[r.rowOdd]:S%2===1,[r.rowSelected]:ve}),onClick:()=>H(O.uid),children:[(0,e.jsx)("div",{className:(0,n.cx)(r.dashboardTitle,r.rowButtonTitle),children:O.title}),(0,e.jsxs)("div",{className:r.dashboardFolder,children:[(0,e.jsx)(V.I,{name:"folder"})," ",O.folderTitle??"Dashboards"]})]})},ae=({index:S,style:Y})=>{const O=ge[S],ve=O.title||"<No title>",Te=!!O.id&&b===O.id,Me=O.type==="graph"||O.type==="timeseries",ye=!pe(O);return(0,e.jsxs)("button",{type:"button",style:Y,disabled:ye,className:(0,n.cx)(r.rowButton,r.panelButton,{[r.rowOdd]:S%2===1,[r.rowSelected]:Te}),onClick:()=>ye?Ae.noop:L(O.id),children:[(0,e.jsx)("div",{className:r.rowButtonTitle,title:ve,children:ve}),!Me&&!ye&&(0,e.jsx)(ee.m,{content:"The alert tab and alert annotations are only supported on graph and timeseries panels.",children:(0,e.jsx)(V.I,{name:"exclamation-triangle",className:r.warnIcon,"data-testid":"warning-icon"})}),ye&&(0,e.jsx)(ee.m,{content:"This panel does not have a valid identifier.",children:(0,e.jsx)(V.I,{name:"info-circle","data-testid":"info-icon"})})]})};return(0,e.jsxs)(de.a,{title:"Select dashboard and panel",closeOnEscape:!0,isOpen:o,onDismiss:d,className:r.modal,contentClassName:r.modalContent,children:[!J&&s&&N&&(0,e.jsxs)(Ee.F,{title:"Current selection",severity:"info",topSpacing:0,bottomSpacing:1,className:r.modalAlert,children:[(0,e.jsxs)("div",{children:["Dashboard: ",N.title," (",N.uid,") in folder"," ",N.meta?.folderTitle??"Dashboards"]}),x&&(0,e.jsxs)("div",{children:["Panel: ",x.title," (",x.id,")"]})]}),(0,e.jsxs)("div",{className:r.container,children:[(0,e.jsx)(se.Z,{value:z,onChange:Z,title:"Search dashboard",placeholder:"Search dashboard",autoFocus:!0}),(0,e.jsx)(se.Z,{value:W,onChange:w,title:"Search panel",placeholder:"Search panel"}),(0,e.jsxs)("div",{className:r.column,children:[j&&(0,e.jsx)(te._,{text:"Loading dashboards...",className:r.loadingPlaceholder}),!j&&(0,e.jsx)(ie.Ay,{children:({height:S,width:Y})=>(0,e.jsx)(ce.Y1,{ref:X,itemSize:50,height:S,width:Y,itemCount:v.length,children:xe})})]}),(0,e.jsxs)("div",{className:r.column,children:[!c&&!M&&(0,e.jsx)("div",{className:r.selectDashboardPlaceholder,children:(0,e.jsx)("div",{children:"Select a dashboard to get a list of available panels"})}),M&&(0,e.jsx)(te._,{text:"Loading dashboard...",className:r.loadingPlaceholder}),c&&!M&&(0,e.jsx)(ie.Ay,{children:({width:S,height:Y})=>(0,e.jsx)(ce.Y1,{itemSize:32,height:Y,width:S,itemCount:ge.length,children:ae})})]})]}),(0,e.jsxs)(de.a.ButtonRow,{children:[(0,e.jsx)(B.$n,{type:"button",variant:"secondary",onClick:d,fill:"text",children:"Cancel"}),(0,e.jsx)(B.$n,{type:"button",variant:"primary",disabled:!(c&&b),onClick:()=>{c&&b&&p(c,b)},children:"Confirm"})]})]})};function he(s){if(!s)return[];const a=s.panels.filter(d=>d.type!=="row"),o=s.panels.filter(d=>d.collapsed).flatMap(d=>d.panels??[]);return[...a,...o]}const pe=s=>{const a=typeof s.id=="number",o=typeof s.type=="string",p="libraryPanel"in s;return a&&(o||p)},ne=s=>{const a=(0,B.my)(s);return{container:(0,n.css)({display:"grid",gridTemplateColumns:"1fr 1fr",gridTemplateRows:"min-content auto",gap:s.spacing(2),flex:1}),column:(0,n.css)({flex:"1 1 auto"}),dashboardTitle:(0,n.css)({height:"22px",fontWeight:s.typography.fontWeightBold}),dashboardFolder:(0,n.css)({height:"20px",fontSize:s.typography.bodySmall.fontSize,color:s.colors.text.secondary,display:"flex",flexDirection:"row",justifyContent:"flex-start",columnGap:s.spacing(1),alignItems:"center"}),rowButton:(0,n.css)(a,{padding:s.spacing(.5),overflow:"hidden",textOverflow:"ellipsis",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer",border:"2px solid transparent","&:disabled":{cursor:"not-allowed",color:s.colors.text.disabled}}),rowButtonTitle:(0,n.css)({textOverflow:"ellipsis",overflow:"hidden"}),rowSelected:(0,n.css)({borderColor:s.colors.primary.border}),rowOdd:(0,n.css)({backgroundColor:s.colors.background.secondary}),panelButton:(0,n.css)({display:"flex",gap:s.spacing(1),justifyContent:"space-between",alignItems:"center"}),loadingPlaceholder:(0,n.css)({height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),selectDashboardPlaceholder:(0,n.css)({width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",fontWeight:s.typography.fontWeightBold}),modal:(0,n.css)({height:"100%"}),modalContent:(0,n.css)({flex:1,display:"flex",flexDirection:"column"}),modalAlert:(0,n.css)({flexGrow:0}),warnIcon:(0,n.css)({fill:s.colors.warning.main})}};var Ne=t(19338),l=t(271);const i=()=>{const s=(0,E.of)(g),[a,o]=(0,C.A)(!1),{control:p,register:d,watch:r,formState:{errors:c},setValue:u}=(0,I.xW)(),b=r("annotations"),{fields:L,append:z,remove:Z}=(0,I.jz)({control:p,name:"annotations"}),k=b.find(x=>x.key===h.YH.dashboardUID)?.value,P=Number(b.find(x=>x.key===h.YH.panelID)?.value),[W,w]=(0,f.useState)(void 0),[R,v]=(0,f.useState)(void 0),{dashboardModel:j,isFetching:N}=q(k);(0,f.useEffect)(()=>{if(N||!j)return;w(j);const D=he(j).find(K=>K.id===P);v(D)},[P,j,N]);const M=(x,D)=>{const K=(0,y.jM)(b,J=>{const X=J.find(ae=>ae.key===h.YH.dashboardUID),xe=J.find(ae=>ae.key===h.YH.panelID);X?X.value=x:J.push({key:h.YH.dashboardUID,value:x}),xe?xe.value=D.toString():J.push({key:h.YH.panelID,value:D.toString()})});u("annotations",K),o(!1)},H=()=>{const x=b.filter(D=>D.key!==h.YH.dashboardUID&&D.key!==h.YH.panelID);u("annotations",x),w(void 0),v(void 0)},fe=()=>{o(!0)};function ge(){return(0,e.jsxs)(F.B,{direction:"row",gap:.5,alignItems:"center",children:[(0,e.jsx)(A.E,{variant:"bodySmall",color:"secondary",children:"Add more context in your notification messages."}),(0,e.jsx)(Ne.G,{contentText:`Annotations add metadata to provide more information on the alert in your alert notification messages.
          For example, add a Summary annotation to tell you which value caused the alert to fire or which server it happened on.
          Annotations can contain a combination of text and template code.`,title:"Annotations"})]})}return(0,e.jsx)(l.P,{stepNo:5,title:"Add annotations",description:ge(),fullWidth:!0,children:(0,e.jsxs)(F.B,{direction:"column",gap:1,children:[L.map((x,D)=>{const K=b[D]?.key?.toLocaleLowerCase().endsWith("url"),J=K?$.p:T.f,X=x.key;return(0,e.jsx)("div",{className:s.flexRow,children:(0,e.jsxs)("div",{children:[(0,e.jsx)(je,{annotationField:x,annotations:b,annotation:X,index:D}),k&&P&&x.key===h.YH.dashboardUID&&(0,e.jsx)(Ie,{dashboard:W,panel:R,dashboardUid:k.toString(),panelId:P.toString(),onEditClick:fe,onDeleteClick:H}),(0,e.jsxs)("div",{className:s.annotationValueContainer,children:[(0,e.jsx)(G.D,{hidden:x.key===h.YH.dashboardUID||x.key===h.YH.panelID,className:(0,n.cx)(s.flexRowItemMargin,s.field),invalid:!!c.annotations?.[D]?.value?.message,error:c.annotations?.[D]?.value?.message,children:(0,e.jsx)(J,{"data-testid":`annotation-value-${D}`,className:(0,n.cx)(s.annotationValueInput,{[s.textarea]:!K}),...d(`annotations.${D}.value`),placeholder:K?"https://":x.key&&`Enter a ${x.key}...`||"Enter custom annotation content...",defaultValue:x.value})}),!h.J3[X]&&(0,e.jsx)(B.$n,{type:"button",className:s.deleteAnnotationButton,"aria-label":"delete annotation",icon:"trash-alt",variant:"secondary",onClick:()=>Z(D)})]})]})},x.id)}),(0,e.jsx)(F.B,{direction:"row",gap:1,children:(0,e.jsxs)("div",{className:s.addAnnotationsButtonContainer,children:[(0,e.jsx)(B.$n,{icon:"plus",type:"button",variant:"secondary",onClick:()=>{z({key:"",value:""})},children:"Add custom annotation"}),!W&&(0,e.jsx)(B.$n,{type:"button",variant:"secondary",icon:"dashboard",onClick:()=>o(!0),children:"Link dashboard and panel"})]})}),a&&(0,e.jsx)(Re,{isOpen:!0,dashboardUid:k,panelId:P,onChange:M,onDismiss:()=>o(!1)})]})})},g=s=>({annotationValueInput:(0,n.css)({width:"394px"}),textarea:(0,n.css)({height:"76px"}),addAnnotationsButtonContainer:(0,n.css)({marginTop:s.spacing(1),gap:s.spacing(1),display:"flex"}),field:(0,n.css)({marginBottom:s.spacing(.5)}),flexRow:(0,n.css)({display:"flex",flexDirection:"row",justifyContent:"flex-start"}),flexRowItemMargin:(0,n.css)({marginTop:s.spacing(1)}),deleteAnnotationButton:(0,n.css)({display:"inline-block",marginTop:"10px",marginLeft:"10px"}),annotationTitle:(0,n.css)({color:s.colors.text.primary,marginBottom:"3px"}),annotationContainer:(0,n.css)({marginTop:"5px"}),annotationDescription:(0,n.css)({color:s.colors.text.secondary}),annotationValueContainer:(0,n.css)({display:"flex"})}),m=i},19338:(oe,U,t)=>{t.d(U,{G:()=>F});var e=t(74848),n=t(32196),y=t(40845),f=t(60782),I=t(67061),C=t(14578),E=t(94753);function F({contentText:$,externalLink:T,linkText:G,title:B="Need help?"}){const h=(0,y.of)(A);return(0,e.jsx)(f.G,{content:(0,e.jsx)("div",{className:h.mutedText,children:$}),title:(0,e.jsxs)(I.B,{gap:.5,direction:"row",alignItems:"center",children:[(0,e.jsx)(C.I,{name:"question-circle"}),B]}),footer:T?(0,e.jsx)("a",{href:T,target:"_blank",rel:"noreferrer",children:(0,e.jsx)(I.B,{direction:"row",gap:.5,alignItems:"center",children:(0,e.jsxs)(E.E,{color:"link",children:[G," ",(0,e.jsx)(C.I,{size:"sm",name:"external-link-alt"})]})})}):void 0,closeButton:!0,placement:"bottom-start",children:(0,e.jsx)("div",{className:h.helpInfo,children:(0,e.jsxs)(I.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(C.I,{name:"question-circle",size:"sm"}),(0,e.jsx)(E.E,{variant:"bodySmall",color:"primary",children:"Need help?"})]})})})}const A=$=>({mutedText:(0,n.css)({color:$.colors.text.secondary,fontSize:$.typography.size.sm}),helpInfo:(0,n.css)({cursor:"pointer",textDecoration:"underline"})})},271:(oe,U,t)=>{t.d(U,{P:()=>E});var e=t(74848),n=t(32196),y=t(40845),f=t(84167),I=t(94753),C=t(67061);const E=({title:A,stepNo:$,children:T,fullWidth:G=!1,description:B})=>{const h=(0,y.of)(F);return(0,e.jsx)("div",{className:h.parent,children:(0,e.jsx)(f.n,{className:(0,n.cx)(G&&h.fullWidth),label:(0,e.jsxs)(I.E,{variant:"h3",children:[$,". ",A]}),children:(0,e.jsxs)(C.B,{direction:"column",children:[B&&(0,e.jsx)("div",{className:h.description,children:B}),T]})})})},F=A=>({parent:(0,n.css)({display:"flex",flexDirection:"row",border:`solid 1px ${A.colors.border.weak}`,borderRadius:A.shape.radius.default,padding:`${A.spacing(2)} ${A.spacing(3)}`}),description:(0,n.css)({marginTop:`-${A.spacing(2)}`}),fullWidth:(0,n.css)({width:"100%"})})},97171:(oe,U,t)=>{t.d(U,{DI:()=>me,C1:()=>Be,Ay:()=>Ne});var e=t(74848),n=t(32196),y=t(96540),f=t(49785),I=t(40845),C=t(67061),E=t(94753),F=t(68402),A=t(55852),$=t(39558),T=t(88575),G=t(76892),B=t(10354),h=t(31678),_=t(99494),be=t(49962);const le=be.Hr.injectEndpoints({endpoints:l=>({getLabels:l.query({query:()=>({url:`/api/plugins/${_.W.Labels}/resources/v1/labels/keys`}),providesTags:["GrafanaLabels"]}),getLabelValues:l.query({query:({key:i})=>({url:`/api/plugins/${_.W.Labels}/resources/v1/labels/name/${i}`}),providesTags:["GrafanaLabels"]})})});var Oe=t(12210),je=t(61410),V=t(23770),re=t(75214),De=t(88131),Se=t(90182);const Ie=(0,De.c)({ignoreCase:!1});function Ae(l,i){return Ie({label:l.label??"",value:l.value??"",data:{}},i)}const Ce=(l,i,g)=>{const m=g.some(a=>a.label===l),s=l.trim().length;return!m&&!!s},ie=(0,y.forwardRef)(function({onChange:i,options:g,defaultValue:m,type:s,onOpenMenu:a=()=>{}},o){const p=(0,I.of)(ce);return(0,e.jsx)("div",{ref:o,children:(0,e.jsx)(T.D,{disabled:!1,"data-testid":`alertlabel-${s}-picker`,className:p.resetMargin,children:(0,e.jsx)(Se.l6,{placeholder:`Choose ${s}`,width:29,className:"ds-picker select-container",backspaceRemovesValue:!1,onChange:i,onOpenMenu:a,filterOption:Ae,isValidNewOption:Ce,options:g,maxMenuHeight:500,noOptionsMessage:"No labels found",defaultValue:m,allowCustomValue:!0})})})}),ce=()=>({resetMargin:(0,n.css)({marginBottom:0})}),ee=ie;var de=t(69087),Ee=t(19338);function se({remove:l,index:i}){return(0,e.jsx)(A.$n,{"aria-label":"delete label",icon:"trash-alt","data-testid":`delete-label-${i}`,variant:"secondary",onClick:()=>{l(i)}})}function te({append:l}){return(0,e.jsx)(A.$n,{icon:"plus",type:"button",variant:"secondary",onClick:l,children:"Add more"})}const Le=l=>{const{currentData:i,isLoading:g}=le.endpoints.getLabels.useQuery(void 0,{skip:l});return{loading:g,labelsOpsKeys:i}},ue=l=>{const i=(0,h.useDispatch)();(0,y.useEffect)(()=>{i((0,V.HB)(l))},[i,l]);const m=(0,je.$)(a=>a.rulerRules)[l],s=(0,y.useMemo)(()=>{const a={},o=m?.result;return o&&Object.values(o).flatMap(d=>d).flatMap(d=>d.rules).forEach(d=>{d.labels&&Object.entries(d.labels).forEach(([r,c])=>{if(!c)return;const u=a[r];u?u.add(c):a[r]=new Set([c])})}),a},[m]);return{loading:m?.loading,labelsByKey:s}};function Q(l=[],i){const g=new Set(i?i.map(m=>m.key):[]);return Array.from(l,m=>({label:m,value:m,isDisabled:g.has(m)}))}const me=({labels:l})=>{const i=l.reduce((g,m)=>(m.key&&(g[m.key]=m.value),g),{});return(0,e.jsx)(de.m,{labels:i})};function Be({dataSourceName:l,onClose:i,initialLabels:g}){const m=(0,I.of)(ne),s=d=>{i(d.labelsInSubform)},a=()=>{i()},o=(0,y.useMemo)(()=>({labelsInSubform:g}),[g]),p=(0,f.mN)({defaultValues:o});return(0,e.jsx)(f.Op,{...p,children:(0,e.jsx)("form",{onSubmit:p.handleSubmit(s),children:(0,e.jsxs)(C.B,{direction:"column",gap:4,children:[(0,e.jsx)(E.E,{children:"Add labels to your rule for searching, silencing, or routing to a notification policy."}),(0,e.jsxs)(C.B,{direction:"column",gap:1,children:[(0,e.jsx)(Re,{dataSourceName:l}),(0,e.jsx)(F.$,{v:2}),(0,e.jsx)(me,{labels:p.watch("labelsInSubform")}),(0,e.jsx)(F.$,{v:1}),(0,e.jsxs)("div",{className:m.confirmButton,children:[(0,e.jsx)(A.$n,{type:"button",variant:"secondary",onClick:a,children:"Cancel"}),(0,e.jsx)(A.$n,{type:"submit",children:"Save"})]})]})]})})})}const q=l=>!(0,re.F2)(l);function Pe(l,i,g,m,s){const{loading:a,labelsByKey:o}=ue(l),{loading:p,labelsOpsKeys:d=[]}=Le(!i||g),r=(0,y.useMemo)(()=>d.reduce((j,N)=>(j[N.name]=new Set,j),{}),[d]),c=(0,y.useMemo)(()=>Q(Object.keys(r).filter(q),m),[r,m]),u=(0,y.useMemo)(()=>Q(Object.keys(o).filter(q),m),[o,m]),b=[{label:"From alerts",options:u,expanded:!0},{label:"From system",options:c,expanded:!0}],L=o[s]!==void 0&&o[s]?.size>0,z=r[s]!==void 0&&r[s]?.size>0,Z=!L&&!z,k=!L&&r[s]?.size>0,{currentData:P,isLoading:W=!1,error:w}=le.endpoints.getLabelValues.useQuery({key:s},{skip:!i||!s||L||k||Z}),R=(0,y.useMemo)(()=>{if(L)return[];const j=r[s];if(j?.size>0)return Q(j);if(!W&&P?.values?.length&&!w){const M=P?.values.map(H=>H.name);return r[s]=new Set(M),Q(M)}return[]},[L,r,s,W,P,w]),v=(0,y.useCallback)(j=>q(j)?L||!i?Q(o[j]):R:[],[o,i,R,L]);return{loading:a||p,keysFromExistingAlerts:u,groupedOptions:b,getValuesForLabel:v}}function Re({dataSourceName:l}){const i=(0,I.of)(ne),{control:g,watch:m,formState:{errors:s}}=(0,f.xW)(),a=m("labelsInSubform"),{fields:o,remove:p,append:d}=(0,f.jz)({control:g,name:"labelsInSubform"}),r=(0,y.useCallback)(()=>{d({key:"",value:""})},[d]),{installed:c=!1,loading:u}=(0,Oe._)(_.W.Labels),[b,L]=(0,y.useState)(""),{loading:z,keysFromExistingAlerts:Z,groupedOptions:k,getValuesForLabel:P}=Pe(l,c,u,a,b),W=(0,y.useMemo)(()=>P(b),[b,P]),w=z||u;return(0,e.jsxs)(e.Fragment,{children:[w&&(0,e.jsx)($._,{text:"Loading existing labels"}),!w&&(0,e.jsxs)(C.B,{direction:"column",gap:1,alignItems:"flex-start",children:[o.map((R,v)=>(0,e.jsxs)("div",{className:(0,n.cx)(i.flexRow,i.centerAlignRow),children:[(0,e.jsx)(T.D,{className:i.labelInput,invalid:!!s.labelsInSubform?.[v]?.key?.message,error:s.labelsInSubform?.[v]?.key?.message,"data-testid":`labelsInSubform-key-${v}`,children:(0,e.jsx)(f.xI,{name:`labelsInSubform.${v}.key`,control:g,rules:{required:a[v]?.value?"Required.":!1},render:({field:{onChange:j,ref:N,...M}})=>(0,e.jsx)(ee,{...M,defaultValue:R.key?{label:R.key,value:R.key}:void 0,options:c?k:Z,onChange:H=>{j(H.value),L(H.value)},type:"key"})})}),(0,e.jsx)(G.c,{className:i.equalSign,children:"="}),(0,e.jsx)(T.D,{className:i.labelInput,invalid:!!s.labelsInSubform?.[v]?.value?.message,error:s.labelsInSubform?.[v]?.value?.message,"data-testid":`labelsInSubform-value-${v}`,children:(0,e.jsx)(f.xI,{control:g,name:`labelsInSubform.${v}.value`,rules:{required:a[v]?.value?"Required.":!1},render:({field:{onChange:j,ref:N,...M}})=>(0,e.jsx)(ee,{...M,defaultValue:R.value?{label:R.value,value:R.value}:void 0,options:W,onChange:H=>{j(H.value)},onOpenMenu:()=>{L(a[v].key)},type:"value"})})}),(0,e.jsx)(se,{index:v,remove:p})]},R.id)),(0,e.jsx)(te,{append:r})]})]})}const he=()=>{const l=(0,I.of)(ne),{register:i,control:g,watch:m,formState:{errors:s}}=(0,f.xW)(),a=m("labels"),{fields:o,remove:p,append:d}=(0,f.jz)({control:g,name:"labels"}),r=(0,y.useCallback)(()=>{d({key:"",value:""})},[d]);return(0,e.jsxs)(e.Fragment,{children:[o.map((c,u)=>(0,e.jsx)("div",{children:(0,e.jsxs)("div",{className:(0,n.cx)(l.flexRow,l.centerAlignRow),"data-testid":"alertlabel-input-wrapper",children:[(0,e.jsx)(T.D,{className:l.labelInput,invalid:!!s.labels?.[u]?.key?.message,error:s.labels?.[u]?.key?.message,children:(0,e.jsx)(B.p,{...i(`labels.${u}.key`,{required:{value:!!a[u]?.value,message:"Required."}}),placeholder:"key","data-testid":`label-key-${u}`,defaultValue:c.key})}),(0,e.jsx)(G.c,{className:l.equalSign,children:"="}),(0,e.jsx)(T.D,{className:l.labelInput,invalid:!!s.labels?.[u]?.value?.message,error:s.labels?.[u]?.value?.message,children:(0,e.jsx)(B.p,{...i(`labels.${u}.value`,{required:{value:!!a[u]?.key,message:"Required."}}),placeholder:"value","data-testid":`label-value-${u}`,defaultValue:c.value})}),(0,e.jsx)(se,{index:u,remove:p})]})},c.id)),(0,e.jsx)(te,{append:r})]})};function pe(){return(0,e.jsxs)("div",{children:[(0,e.jsxs)(C.B,{direction:"column",gap:1,children:[(0,e.jsx)(E.E,{element:"h5",children:"Labels"}),(0,e.jsxs)(C.B,{direction:"row",gap:1,children:[(0,e.jsx)(E.E,{variant:"bodySmall",color:"secondary",children:"Add labels to your rule for searching, silencing, or routing to a notification policy."}),(0,e.jsx)(Ee.G,{contentText:`The dropdown only displays labels that you have previously used for alerts.
            Select a label from the options below or type in a new one.`,title:"Labels"})]})]}),(0,e.jsx)(he,{})]})}const ne=l=>({flexColumn:(0,n.css)({display:"flex",flexDirection:"column"}),flexRow:(0,n.css)({display:"flex",flexDirection:"row",justifyContent:"flex-start"}),centerAlignRow:(0,n.css)({alignItems:"center",gap:l.spacing(.5)}),equalSign:(0,n.css)({alignSelf:"flex-start",width:"28px",justifyContent:"center",margin:0}),labelInput:(0,n.css)({width:"175px",margin:0}),confirmButton:(0,n.css)({display:"flex",flexDirection:"row",gap:l.spacing(1),marginLeft:"auto"})}),Ne=pe}}]);

//# sourceMappingURL=9947.5cbfd549b090d387f884.js.map