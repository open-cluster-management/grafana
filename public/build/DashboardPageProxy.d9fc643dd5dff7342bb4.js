"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[9136],{77709:(Et,K,o)=>{o.r(K),o.d(K,{default:()=>js});var n=o(74848),W=o(16817),b=o(32264),p=o(96540),V=o(64388),se=o(80943),re=o(90613),A=o(42418),B=o(69444),k=o(39419),x=o(33390),S=o(20470),f=o(31678),h=o(32196),M=o(24180),P=o(39601),oe=o(71678),E=o(40845),O=o(37390),j=o(55852),z=o(16233);const Se=(0,p.memo)(({dashboard:e})=>{const t=(0,p.useMemo)(()=>P.Ny.getLocation().pathname,[e]),{showModal:a,hideModal:s}=(0,p.useContext)(oe.wE);(0,p.useEffect)(()=>{const i=u=>{Ce(e,e.getInitialSaveModel())||e.state.isDirty&&(u.preventDefault(),u.returnValue="")};return window.addEventListener("beforeunload",i),()=>window.removeEventListener("beforeunload",i)},[e]);const r=i=>t===i.pathname||Ce(e,e.getInitialSaveModel())||!e.state.isDirty?!0:(a(Mt,{dashboard:e,onSaveDashboardClick:()=>{s(),e.openSaveDrawer({onSaveSuccess:()=>{je(i)}})},onDiscard:()=>{e.exitEditMode({skipConfirm:!0}),s(),je(i)},onDismiss:s}),!1);return(0,n.jsx)(M.XG,{when:!0,message:r})});Se.displayName="DashboardPrompt";function je(e){e&&setTimeout(()=>P.Ny.push(e),10)}const Mt=({onDiscard:e,onDismiss:t,onSaveDashboardClick:a})=>{const s=(0,E.of)(It);return(0,n.jsxs)(O.a,{isOpen:!0,title:"Unsaved changes",onDismiss:t,icon:"exclamation-triangle",className:s.modal,children:[(0,n.jsx)("h5",{children:"Do you want to save your changes?"}),(0,n.jsxs)(O.a.ButtonRow,{children:[(0,n.jsx)(j.$n,{variant:"secondary",onClick:t,fill:"outline",children:"Cancel"}),(0,n.jsx)(j.$n,{variant:"destructive",onClick:e,children:"Discard"}),(0,n.jsx)(j.$n,{onClick:a,children:"Save dashboard"})]})]})},It=()=>({modal:(0,h.css)({width:"500px"})});function Ce(e,t){if(!t||t.version===0||!z.TP.isSignedIn||!e)return!0;const{canSave:a,fromScript:s,fromFile:r}=e.state.meta;return!z.TP.isEditor&&!a?!0:!a||s||r}var Te=o(72255);function wt({match:e,route:t,queryParams:a,history:s}){const r=(0,Te.sP)(),{dashboard:i,isLoading:u,loadError:d}=r.useState(),c=s.location.state?.routeReloadCounter,l=(0,p.useMemo)(()=>!!x.A.getObject(S.us),[e.params.uid,e.params.slug,e.params.type]);return(0,p.useEffect)(()=>(t.routeName===f.DashboardRoutes.Normal&&e.params.type==="snapshot"?r.loadSnapshot(e.params.slug):r.loadDashboard({uid:e.params.uid??"",route:t.routeName,urlFolderUid:a.folderUid,keepDashboardFromExploreInLocalStorage:!1}),()=>{r.clearState()}),[r,e.params.uid,t.routeName,a.folderUid,c,e.params.slug,e.params.type]),(0,p.useEffect)(()=>{i&&l&&t.routeName!==f.DashboardRoutes.New&&i.onEnterEditMode(l)},[i,l,t.routeName]),i?e.params.type!=="snapshot"&&i.state.uid&&i.state.uid!==e.params.uid&&t.routeName!==f.DashboardRoutes.Home?null:(0,n.jsxs)(se.$L,{scene:i,children:[(0,n.jsx)(i.Component,{model:i},i.state.key),(0,n.jsx)(Se,{dashboard:i})]}):(0,n.jsx)(B.Y,{navId:"dashboards/browse",layout:V.k.Canvas,"data-testid":"dashboard-scene-page",children:(0,n.jsxs)(re.a,{paddingY:4,display:"flex",direction:"column",alignItems:"center",children:[u&&(0,n.jsx)(k.A,{}),d&&(0,n.jsx)(A.F,{title:"Dashboard failed to load",severity:"error","data-testid":"dashboard-not-found",children:d})]})})}const De=wt;var J=o(71468),Lt=o(71733),C=o(13544),Ne=o(82467),Rt=o(7392),At=o(76888),Ee=o(3169);function Ft(e){switch(e.kiosk){case"tv":return f.KioskMode.TV;case"1":case!0:return f.KioskMode.Full;default:return null}}var Ut=o(91219),ie=o(17422),Me=o(6473),Ie=o(14110),Ot=o(61680);const zt="grafana.angularDeprecation.dashboardNoticeAndMigration.isDismissed";function Vt(e){return zt+"."+e}function Bt(){const e="__feature.autoMigrateOldPanels",t=new URL(window.location.toString());t.searchParams.has(e)||t.searchParams.append(e,"true"),window.open(t.toString(),"_self")}function $t({dashboardUid:e,showAutoMigrateLink:t}){return(0,n.jsx)(Ot.b,{storageKey:Vt(e),defaultValue:!1,children:(a,s)=>a?null:(0,n.jsx)("div",{children:(0,n.jsx)(A.F,{severity:"warning",title:"This dashboard depends on Angular, which is deprecated and will stop working in future releases of Grafana.",onRemove:()=>{(0,Ie.rR)("angular_deprecation_notice_dismissed"),s(!0)},children:(0,n.jsxs)("div",{className:"markdown-html",children:[(0,n.jsx)("a",{href:"https://grafana.com/docs/grafana/latest/developers/angular_deprecation/",className:"external-link",target:"_blank",rel:"noreferrer",children:"Read our deprecation notice and migration advice."}),(0,n.jsx)("br",{}),t&&(0,n.jsx)(j.$n,{fill:"outline",size:"sm",onClick:Bt,style:{marginTop:10},children:"Try migration"})]})})})})}var Wt=o(8480);const Gt=()=>{const e=new URL(window.location.toString()),t=new URLSearchParams(e.search);t.forEach((a,s)=>{if(s.startsWith("__feature.")){const r=s.substring(10);Wt.mz.has(r)&&t.delete(s)}}),window.location.href=new URL(e.origin+e.pathname+"?"+t.toString()).toString()},Qt=()=>{window.open("https://github.com/grafana/grafana/issues/new?assignees=&labels=&projects=&template=0-bug-report.yaml&title=Product+Area%3A+Short+description+of+bug")};function Ht({dashboardUid:e}){const t=(0,E.of)(Kt),[a,s]=(0,p.useState)(!0);return a?(0,n.jsx)(A.F,{severity:"info",title:"This dashboard was migrated from Angular. Please make sure everything is behaving as expected and save and refresh this dashboard to persist the migration.",onRemove:()=>s(!1),children:(0,n.jsxs)("div",{className:"markdown-html",children:[(0,n.jsx)(j.$n,{fill:"outline",size:"sm",className:t.linkButton,onClick:Qt,children:"Report issue"}),(0,n.jsx)(j.$n,{fill:"outline",size:"sm",className:t.linkButton,onClick:Gt,children:"Revert migration"})]})}):null}const Kt=e=>({linkButton:(0,h.css)({marginRight:10})});var Ts=o(53652);function Ds(e){const t=e.match.params.slug??"",a=useAsync(()=>getGrafanaStorage().list("content/"+t),[t]),s=t.length>0?`g/${t}/`:"g/",r=we(t),i=()=>a.value?a.value.fields[0].values.map(c=>{let l=c;const g=l.indexOf(".")<0,m=!g&&l.endsWith(".json"),v=`${s}${l}`;return jsxs(Card,{href:g||m?v:void 0,children:[jsx(Card.Heading,{children:l}),jsx(Card.Figure,{children:jsx(Icon,{name:g?"folder":m?"gf-grid":"file-alt",size:"sm"})})]},l)}):a.loading?jsx(Spinner,{}):jsx("div",{children:"?"}),u=Le();return jsx(Page,{navModel:u,pageNav:r,children:i()})}function we(e){const t=e.split("/");let a=[],s="g",r;for(let i=0;i<t.length;i++)s+=`/${t[i]}`,a.push({text:t[i],url:s,parentItem:r}),r=a[a.length-1];return r}function Le(){return{main:{text:"C:"},node:{text:"Content",url:"/g"}}}const Ns=null;var F=o(28444),Re=o(72401),kt=o(75096),Ae=o(10354),Y=o(14578),le=o(40276),Fe=o(36974),Jt=o(48889),Ue=o(17706);const Yt=()=>{const e=(0,E.of)(Zt),[t,a]=(0,p.useState)(""),s=(0,f.useSelector)(d=>d.dashboard.getModel()),r=(0,p.useMemo)(()=>(0,Ue.nr)(),[]),i=(0,p.useMemo)(()=>(0,Ue.CO)(r,t),[r,t]),u=()=>{P.Ny.partial({addWidget:null})};return(0,n.jsxs)(O.a,{title:"Select widget type",closeOnEscape:!0,closeOnBackdropClick:!0,isOpen:!0,className:e.modal,onClickBackdrop:u,onDismiss:u,children:[(0,n.jsx)(Ae.p,{type:"search",autoFocus:!0,className:e.searchInput,value:t,prefix:(0,n.jsx)(Y.I,{name:"search"}),placeholder:"Search widget",onChange:d=>{a(d.currentTarget.value)}}),(0,n.jsx)(le.E,{children:(0,n.jsx)("div",{className:e.grid,children:i.map((d,c)=>(0,n.jsx)(Jt.f,{disabled:!1,isCurrent:!1,plugin:d,onClick:l=>{const g=(0,Fe.ob)(s,d.id);P.Ny.partial({editPanel:g,addWidget:null})}},d.id))})})]})},Zt=e=>({modal:(0,h.css)({width:"65%",maxWidth:"960px",[e.breakpoints.down("md")]:{width:"100%"}}),searchInput:(0,h.css)({marginBottom:e.spacing(2)}),grid:(0,h.css)({display:"grid",gridGap:e.spacing(1)})});var Xt=o(16495),qt=o(82138),_t=o(9980),Z=o(2543),en=o(28138),tn=o(40996),nn=o(57767),an=o(43535),sn=o(88861);const Oe=({panel:e,folderUid:t,isUnsavedPrompt:a,onDismiss:s,onConfirm:r,onDiscard:i})=>{const[u,d]=(0,p.useState)(""),c=(0,W.A)(async()=>{const D=await(0,nn.xV)(e.libraryPanel.uid);return D.length>0?D.map(w=>w.title):[]},[e.libraryPanel.uid]),[l,g]=(0,p.useState)([]);(0,tn.A)(()=>c.value?g(c.value.filter(D=>D.toLowerCase().includes(u.toLowerCase()))):g([]),300,[c.value,u]);const{saveLibraryPanel:m}=(0,sn.b)(),v=(0,E.of)(an.o),I=(0,p.useCallback)(()=>{i()},[i]),T=a?"Unsaved library panel changes":"Save library panel";return(0,n.jsx)(O.a,{title:T,icon:"save",onDismiss:s,isOpen:!0,children:(0,n.jsxs)("div",{children:[(0,n.jsxs)("p",{className:v.textInfo,children:["This update will affect ",(0,n.jsxs)("strong",{children:[e.libraryPanel.meta?.connectedDashboards," ",e.libraryPanel.meta?.connectedDashboards===1?"dashboard":"dashboards","."]}),"The following dashboards using the panel will be affected:"]}),(0,n.jsx)(Ae.p,{className:v.dashboardSearch,prefix:(0,n.jsx)(Y.I,{name:"search"}),placeholder:"Search affected dashboards",value:u,onChange:D=>d(D.currentTarget.value)}),c.loading?(0,n.jsx)("p",{children:"Loading connected dashboards..."}):(0,n.jsxs)("table",{className:v.myTable,children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:(0,n.jsx)("th",{children:"Dashboard name"})})}),(0,n.jsx)("tbody",{children:l.map((D,w)=>(0,n.jsx)("tr",{children:(0,n.jsx)("td",{children:D})},`dashrow-${w}`))})]}),(0,n.jsxs)(O.a.ButtonRow,{children:[(0,n.jsx)(j.$n,{variant:"secondary",onClick:s,fill:"outline",children:"Cancel"}),a&&(0,n.jsx)(j.$n,{variant:"destructive",onClick:I,children:"Discard"}),(0,n.jsx)(j.$n,{onClick:()=>{m(e,t).then(()=>{r()})},children:"Update all"})]})]})})};var rn=o(98365),ze=o(19752),de=o(79971),Ve=o(80095),U=o(53466);function on(e,t){return async a=>{const s=t.initEditPanel(e);a((0,U.GU)({panel:s,sourcePanel:e}))}}function Be(){return async(e,t)=>{const{getPanel:a}=t().panelEditor;a().configRev=0,e((0,U.MJ)(!0))}}function ln(e,t){return a=>{if(e.libraryPanel?.uid===void 0||!t)return;const s=e.getSaveModel();for(const r of t.panels){if(dn(e,r))continue;r.restoreModel({...s,...(0,Z.pick)(r,"gridPos","id")});const i=r.plugin?.meta.id!==e.plugin?.meta.id;r.plugin=e.plugin,r.configRev++,i&&(r.generateNewKey(),a((0,Ve.XM)({key:r.key,plugin:r.plugin}))),setTimeout(()=>{r.getQueryRunner().useLastResultFrom(e.getQueryRunner())},20)}e.repeat&&setTimeout(()=>t.processRepeats(),20)}}function dn(e,t){return!!(t.libraryPanel?.uid!==e.libraryPanel.uid||t.id&&t.id===e.id||t.repeatPanelId)}function cn(){return async(e,t)=>{const a=t().dashboard.getModel(),{getPanel:s,getSourcePanel:r,shouldDiscardChanges:i}=t().panelEditor,u=s();a&&a.exitPanelEditor();const d=r();if(un(u)&&!i){const c=u.getSaveModel(),l=d.type!==u.type;e(ln(u,a)),d.restoreModel(c),d.configRev++,l&&(d.plugin=u.plugin,d.generateNewKey(),await e((0,Ve.XM)({key:d.key,plugin:u.plugin}))),setTimeout(()=>{d.getQueryRunner().useLastResultFrom(u.getQueryRunner()),d.render(),u.hasSavedPanelEditChange&&!u.hasChanged&&(d.configRev=0)},20)}d.isNew&&(i?a&&(0,ze.FC)(a,d,!0):delete d.isNew),e((0,de.O6)(u.key)),e((0,U.Ox)())}}function un(e){return e.hasChanged||e.hasSavedPanelEditChange||e.isAngularPlugin()}function ce(e){return(t,a)=>{const s={...a().panelEditor.ui,...e};t((0,U.fR)(s));try{x.A.setObject(U.wi,s)}catch(r){console.error(r)}}}var hn=o(78050);const pn=({dashboard:e,onSaveSuccess:t,onDiscard:a,onDismiss:s})=>(0,n.jsxs)(O.a,{isOpen:!0,title:"Unsaved changes",onDismiss:s,icon:"exclamation-triangle",className:(0,h.css)({width:"500px"}),children:[(0,n.jsx)("h5",{children:"Do you want to save your changes?"}),(0,n.jsxs)(O.a.ButtonRow,{children:[(0,n.jsx)(j.$n,{variant:"secondary",onClick:s,fill:"outline",children:"Cancel"}),(0,n.jsx)(j.$n,{variant:"destructive",onClick:a,children:"Discard"}),(0,n.jsx)(hn.C,{dashboard:e,onSaveSuccess:t})]})]}),$e=(0,p.memo)(({dashboard:e})=>{const[t,a]=(0,p.useState)({original:null}),s=(0,f.useDispatch)(),{original:r,originalPath:i}=t,{showModal:u,hideModal:d}=(0,p.useContext)(oe.wE);(0,p.useEffect)(()=>{const l=setTimeout(()=>{const m=P.Ny.getLocation().pathname,v=e.getSaveModelCloneOld();a({originalPath:m,original:v})},1e3),g=en.l.subscribe(F.Eu,()=>{const m=e.getSaveModelCloneOld();a({originalPath:i,original:m})});return()=>{clearTimeout(l),g.unsubscribe()}},[e,i]),(0,p.useEffect)(()=>{const l=g=>{We(e,r)||Qe(e,r)&&(g.preventDefault(),g.returnValue="")};return window.addEventListener("beforeunload",l),()=>window.removeEventListener("beforeunload",l)},[e,r]);const c=l=>{const g=e.panelInEdit,m=new URLSearchParams(l.search);return g&&g.libraryPanel&&g.hasChanged&&!m.has("editPanel")?(u(Oe,{isUnsavedPrompt:!0,panel:e.panelInEdit,folderUid:e.meta.folderUid??"",onConfirm:()=>{d(),X(l)},onDiscard:()=>{s(Be()),X(l),d()},onDismiss:d}),!1):i===l.pathname||!r?(g&&!m.has("editPanel")&&s(cn()),!0):We(e,r)||!Qe(e,r)?!0:(u(pn,{dashboard:e,onSaveSuccess:()=>{d(),X(l)},onDiscard:()=>{a({...t,original:null}),d(),X(l)},onDismiss:d}),!1)};return(0,n.jsx)(M.XG,{when:!0,message:c})});$e.displayName="DashboardPrompt";function X(e){e&&setTimeout(()=>P.Ny.push(e),10)}function We(e,t){if(!t||t.version===0||!z.TP.isSignedIn||!e)return!0;const{canSave:a,fromScript:s,fromFile:r}=e.meta;return!z.TP.isEditor&&!a?!0:!a||s||r}function Ge(e){const t=new rn.G(e);t.expandRows();const a=t.getSaveModelClone();if(delete a.time,delete a.refresh,a.schemaVersion=0,delete a.timezone,a.panels=[],a.templating?.list)for(const s of a.templating.list)delete s.current,delete s.options,delete s.filters;return a}function Qe(e,t){if(e.hasUnsavedChanges())return!0;const a=Ge(e.getSaveModelCloneOld()),s=Ge(t),r=(0,Z.find)(a.nav,{type:"timepicker"}),i=(0,Z.find)(s.nav,{type:"timepicker"});r&&i&&(r.now=i.now);const u=JSON.stringify(a,null),d=JSON.stringify(s,null);return u!==d}var gn=o(62639),L=o(16560),He=o(40334),ue=o(70713),Ke=o(41987),ke=o(87978),G=o(67061),fn=o(29678),he=o(63021),q=o(40675),mn=o(62930),_=o(88575),vn=o(90182),Je=o(10534),xn=o(32372),ee=o(66864),Q=o(15292),bn=o(4213),yn=o.n(bn),Pn=o(72724),te=o(83195),Sn=o(2619),jn=o(85445),$=o(74856),Cn=o(34214),Ye=o(18803),H=(e=>(e[e.Support=0]="Support",e[e.Data=1]="Data",e))(H||{}),ne=(e=>(e[e.PanelSnapshot=0]="PanelSnapshot",e[e.GithubComment=1]="GithubComment",e))(ne||{});class Tn extends Sn.Q{constructor(t){super({panel:t,panelTitle:t.replaceVariables(t.title,void 0,"text")||"Panel",currentTab:0,showMessage:1,snapshotText:"",markdownText:"",randomize:{},snapshotUpdate:0,options:[{label:"GitHub comment",description:"Copy and paste this message into a GitHub issue or comment",value:1},{label:"Panel support snapshot",description:"Dashboard JSON used to help troubleshoot visualization issues",value:0}]}),this.onCurrentTabChange=a=>{this.setState({currentTab:a})},this.onShowMessageChange=a=>{this.setState({showMessage:a.value})},this.onGetMarkdownForClipboard=()=>{const{markdownText:a}=this.state,s=Math.pow(1024,2)*1.5;return a.length>s?(this.setState({error:{title:"Copy to clipboard failed",message:"Snapshot is too large, consider download and attaching a file instead"}}),""):a},this.onDownloadDashboard=()=>{const{snapshotText:a,panelTitle:s}=this.state,r=new Blob([a],{type:"text/plain"}),i=`debug-${s}-${(0,Pn.LE)(new Date)}.json.txt`;yn()(r,i)},this.onSetSnapshotText=a=>{this.setState({snapshotText:a})},this.onToggleRandomize=a=>{const{randomize:s}=this.state;this.setState({randomize:{...s,[a]:!s[a]}})},this.onPreviewDashboard=()=>{const{snapshot:a}=this.state;a&&((0,S.OI)({meta:{},dashboard:a}),o.g.open(b.$.appUrl+"dashboard/new","_blank"))}}async buildDebugDashboard(){const{panel:t,randomize:a,snapshotUpdate:s}=this.state,r=await(0,Ye.E_)(t,a,(0,$.jG)().timeRange()),i=JSON.stringify(r,null,2),u=(0,Ye.jD)(t,i),d=(0,te.cN)((0,te.j_)("bytes")(i?.length??0));let c;if(!t.isAngularPlugin())try{const l=new Cn.G(r,{isEmbedded:!0});c=(0,jn.EH)(l,r).state.body}catch(l){console.log("Error creating scene:",l)}this.setState({snapshot:r,snapshotText:i,markdownText:u,snapshotSize:d,snapshotUpdate:s+1,scene:c})}}function Dn({panel:e,plugin:t,onClose:a}){const s=(0,E.of)(Nn),r=(0,p.useMemo)(()=>new Tn(e),[e]),{currentTab:i,loading:u,error:d,options:c,showMessage:l,snapshotSize:g,markdownText:m,snapshotText:v,randomize:I,panelTitle:T,scene:D}=r.useState();if((0,p.useEffect)(()=>{r.buildDebugDashboard()},[r,t,I]),!t)return null;const w=[{label:"Snapshot",value:H.Support},{label:"Data",value:H.Data}],R=b.$.supportBundlesEnabled&&z.TP.hasPermission(f.AccessControlAction.ActionSupportBundlesCreate);return(0,n.jsxs)(ke._,{title:"Get help with this panel",size:"lg",onClose:a,subtitle:(0,n.jsxs)(G.B,{direction:"column",gap:1,children:[(0,n.jsxs)(G.B,{direction:"row",gap:1,children:[(0,n.jsx)(fn.y,{featureState:Ke.Ay.beta}),(0,n.jsxs)("a",{href:"https://grafana.com/docs/grafana/latest/troubleshooting/",target:"blank",className:"external-link",rel:"noopener noreferrer",children:["Troubleshooting docs ",(0,n.jsx)(Y.I,{name:"external-link-alt"})]})]}),(0,n.jsx)("span",{className:"muted",children:"To request troubleshooting help, send a snapshot of this panel to Grafana Labs Technical Support. The snapshot contains query response data and panel settings."}),R&&(0,n.jsxs)("span",{className:"muted",children:["You can also retrieve a support bundle containing information concerning your Grafana instance and configured datasources in the ",(0,n.jsx)("a",{href:"/support-bundles",children:"support bundles section"}),"."]})]}),tabs:(0,n.jsx)(he.U,{children:w.map((N,ae)=>(0,n.jsx)(q.o,{label:N.label,active:N.value===i,onChangeTab:()=>r.onCurrentTabChange(N.value)},`${N.value}-${ae}`))}),children:[u&&(0,n.jsx)(mn.y,{}),d&&(0,n.jsx)(A.F,{title:d.title,children:d.message}),i===H.Data&&(0,n.jsxs)("div",{className:s.code,children:[(0,n.jsxs)("div",{className:s.opts,children:[(0,n.jsx)(_.D,{label:"Template",className:s.field,children:(0,n.jsx)(vn.l6,{options:c,value:l,onChange:r.onShowMessageChange})}),l===ne.GithubComment?(0,n.jsx)(Je.b,{icon:"copy",getText:r.onGetMarkdownForClipboard,children:"Copy to clipboard"}):(0,n.jsxs)(j.$n,{icon:"download-alt",onClick:r.onDownloadDashboard,children:["Download (",g,")"]})]}),(0,n.jsx)(ue.Ay,{disableWidth:!0,children:({height:N})=>(0,n.jsx)(xn.B,{width:"100%",height:N,language:l===ne.GithubComment?"markdown":"json",showLineNumbers:!0,showMiniMap:!0,value:l===ne.GithubComment?m:v,readOnly:!1,onBlur:r.onSetSnapshotText})})]}),i===H.Support&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(_.D,{label:"Randomize data",description:"Modify the original data to hide sensitve information.  Note the lengths will stay the same, and duplicate values will be equal.",children:(0,n.jsxs)(ee.Gy,{children:[(0,n.jsx)(Q.K,{label:"Labels",id:"randomize-labels",showLabel:!0,value:!!I.labels,onChange:()=>r.onToggleRandomize("labels")}),(0,n.jsx)(Q.K,{label:"Field names",id:"randomize-field-names",showLabel:!0,value:!!I.names,onChange:()=>r.onToggleRandomize("names")}),(0,n.jsx)(Q.K,{label:"String values",id:"randomize-string-values",showLabel:!0,value:!!I.values,onChange:()=>r.onToggleRandomize("values")})]})}),(0,n.jsx)(_.D,{label:"Support snapshot",description:`Panel: ${T}`,children:(0,n.jsxs)(G.B,{children:[(0,n.jsxs)(j.$n,{icon:"download-alt",onClick:r.onDownloadDashboard,children:["Dashboard (",g,")"]}),(0,n.jsx)(Je.b,{icon:"github",getText:r.onGetMarkdownForClipboard,title:"Copy a complete GitHub comment to the clipboard",children:"Copy to clipboard"}),(0,n.jsx)(j.$n,{onClick:r.onPreviewDashboard,variant:"secondary",title:"Open support snapshot dashboard in a new tab",children:"Preview"})]})}),(0,n.jsx)(ue.Ay,{disableWidth:!0,children:({height:N})=>(0,n.jsx)("div",{style:{height:N,overflow:"auto"},children:D&&(0,n.jsx)(D.Component,{model:D})})})]})]})}const Nn=e=>({code:(0,h.css)({flexGrow:1,height:"100%",overflow:"scroll"}),field:(0,h.css)({width:"100%"}),opts:(0,h.css)({display:"flex",width:"100%",flexGrow:0,alignItems:"center",justifyContent:"flex-end",button:{marginLeft:"8px"}})});var pe=o(39070);const ge=(e,t,a)=>{const s=(0,p.useRef)(),[r,i]=(0,p.useState)();return(0,p.useEffect)(()=>{let u=-1,d=0;return s.current=e.getQueryRunner().getData({withTransforms:t.withTransforms,withFieldConfig:!1}).subscribe({next:c=>{if(a){if(u===c.structureRev){const l=Date.now();if(l-d<1e4)return;d=l}u=c.structureRev??-1}i(c)}}),()=>{s.current&&s.current.unsubscribe()}},[e,t.withTransforms]),{data:r,isLoading:r?.state===pe.Gu.Loading,hasSeries:r?!!r.series:!1,hasError:!!(r&&(r.error||r?.errors?.length||r.state===pe.Gu.Error))}};var Ze=o(72574),fe=o(8484),En=o(61453),Mn=o(82344),In=o(61396);const wn=({data:e,metadataDatasource:t})=>!t||!t.components?.MetadataInspector?(0,n.jsx)(fe.x6,{i18nKey:"dashboard.inspect-meta.no-inspector",children:"No Metadata Inspector"}):(0,n.jsx)(t.components.MetadataInspector,{datasource:t,data:e.series});var Ln=o(32067),Rn=o(90820);const An=({panel:e,plugin:t,dashboard:a,tabs:s,data:r,isDataLoading:i,dataOptions:u,metadataDatasource:d,defaultTab:c,onDataOptionsChange:l,onClose:g})=>{const[m,v]=(0,p.useState)(c??L.q.Data);if(!t)return null;let I=Fn(r),T=m;s.find(R=>R.value===m)||(T=L.q.JSON);const D=(0,Ze.w)().replace(e.title,e.scopedVars,"text")||"Panel",w=(0,fe.t)("dashboard.inspect.title","Inspect: {{panelTitle}}",{panelTitle:D});return(0,n.jsxs)(ke._,{title:w,subtitle:r&&Un(r),onClose:g,tabs:(0,n.jsx)(he.U,{children:s.map((R,N)=>(0,n.jsx)(q.o,{label:R.label,active:R.value===T,onChangeTab:()=>v(R.value||L.q.Data)},`${R.value}-${N}`))}),children:[T===L.q.Data&&(0,n.jsx)(En.q,{dataName:e.getDisplayTitle(),panelPluginId:e.type,fieldConfig:e.fieldConfig,hasTransformations:!!e.transformations?.length,data:r&&r.series,isLoading:i,options:u,onOptionsChange:l,timeZone:a.timezone,app:Ke.Jk.Dashboard}),r&&T===L.q.Meta&&(0,n.jsx)(wn,{data:r,metadataDatasource:d}),T===L.q.JSON&&(0,n.jsx)(In.w,{panel:e,dashboard:a,data:r,onClose:g}),T===L.q.Error&&(0,n.jsx)(Mn.y,{errors:I}),r&&T===L.q.Stats&&(0,n.jsx)(Ln.N,{data:r,timeZone:a.getTimezone()}),r&&T===L.q.Query&&(0,n.jsx)(Rn.e,{data:r,onRefreshQuery:()=>e.refresh()})]})};function Fn(e){let t=e?.errors??[];return e?.error&&!t.includes(e.error)&&(t=[e.error,...t]),!t.length&&e?.state===pe.Gu.Error?[{message:"Error loading data"}]:t}function Un(e){const{request:t}=e;if(!t||(0,Z.isEmpty)(t))return"";const a=t.targets.length,s=t.endTime?t.endTime-t.startTime:0,r=(0,te.cN)((0,te.j_)("ms")(s));return(0,n.jsxs)(fe.x6,{i18nKey:"dashboard.inspect.subtitle",children:[{queryCount:a}," queries with total query time of ",{formatted:r}]})}var Xe=o(65123);const On=({panel:e,dashboard:t,plugin:a})=>{const s=(0,M.zy)(),r=new URLSearchParams(s.search).get("inspectTab"),[i,u]=(0,p.useState)({withTransforms:r===L.q.Error,withFieldConfig:!0}),{data:d,isLoading:c,hasError:l}=ge(e,i,!1),g=(0,Xe.sd)(d),m=(0,Xe.kx)(e,t,a,l,g),v=()=>{P.Ny.partial({inspect:null,inspectTab:null})};return a?r===L.q.Help?(0,n.jsx)(Dn,{panel:e,plugin:a,onClose:v}):(0,n.jsx)(An,{dashboard:t,panel:e,plugin:a,defaultTab:r,tabs:m,data:d,isDataLoading:c,dataOptions:i,onDataOptionsChange:u,metadataDatasource:g,onClose:v}):null},zn=(e,t)=>{const a=(0,He.U)(e,t.panel);return a?{plugin:a.plugin}:{plugin:null}},Vn=(0,J.connect)(zn)(On);var qe=o(64423),_e=o(94354),me=o(27746),Bn=o(15068),et=o(3911),$n=o(75269),tt=o(58720),Wn=o(10096),ve=o(12470),xe=o(56034),Gn=o(20601),Qn=o(13344);const Hn=e=>{const t=(0,p.useMemo)(()=>Gn.B.get(e.variable.type).picker,[e.variable]);return e.variable?(0,n.jsxs)(G.B,{gap:0,children:[(0,n.jsx)(Kn,{variable:e.variable}),e.variable.hide!==ve.zL.hideVariable&&t&&(0,n.jsx)(t,{variable:e.variable,readOnly:e.readOnly??!1})]}):(0,n.jsx)("div",{children:"Couldn't load variable"})};function Kn({variable:e}){const t=(0,p.useMemo)(()=>e.label||e.name,[e]);if(e.hide!==ve.zL.dontHide)return null;const a=Qn.qz+e.id;return e.description?(0,n.jsx)(xe.m,{content:e.description,placement:"bottom",children:(0,n.jsx)("label",{className:"gf-form-label gf-form-label--variable","data-testid":C.Tp.pages.Dashboard.SubMenu.submenuItemLabels(t),htmlFor:a,children:t})}):(0,n.jsx)("label",{className:"gf-form-label gf-form-label--variable","data-testid":C.Tp.pages.Dashboard.SubMenu.submenuItemLabels(t),htmlFor:a,children:t})}const nt=({variables:e,readOnly:t})=>{const[a,s]=(0,p.useState)([]),r=(0,E.of)(kn);return(0,p.useEffect)(()=>{s(e.filter(i=>i.hide!==ve.zL.hideVariable))},[e]),a.length===0?null:(0,n.jsx)(n.Fragment,{children:a.map(i=>(0,n.jsx)("div",{className:r.submenuItem,"data-testid":C.Tp.pages.Dashboard.SubMenu.submenuItem,children:(0,n.jsx)(Hn,{variable:i,readOnly:t})},i.id))})},kn=e=>({submenuItem:(0,h.css)({display:"inline-block",".fa-caret-down":{fontSize:"75%",paddingLeft:e.spacing(1)},".gf-form":{marginBottom:0}})});var Jn=o(81862),Yn=o(54174),at=o(82792),be=o(87421),Zn=o(39569),Xn=o(62367),qn=o(70497),_n=o(26443),ea=o(19727),ta=o(41394);const st=e=>t=>t.plugins.panels[e]||(0,ta.$)(`Panel plugin not found (${e})`,!0),ye=({panel:e})=>{const t=(0,f.useDispatch)(),a=(0,f.useSelector)(st(e.type)),s=(0,f.useSelector)(d=>d.panelEditor.ui.isPanelOptionsVisible),r=(0,f.useSelector)(d=>d.panelEditor.isVizPickerOpen),i=()=>{t((0,U.eK)(!r))},u=()=>{t(ce({isPanelOptionsVisible:!s}))};return a?(0,n.jsx)("div",{className:rt.wrapper,children:(0,n.jsxs)(ea.e,{children:[(0,n.jsx)(me.I,{className:rt.vizButton,tooltip:"Click to change visualization",imgSrc:a.meta.info.logos.small,isOpen:r,onClick:i,"data-testid":C.Tp.components.PanelEditor.toggleVizPicker,"aria-label":"Change Visualization",variant:"canvas",fullWidth:!0,children:a.meta.name}),(0,n.jsx)(me.I,{tooltip:s?"Close options pane":"Show options pane",icon:s?"angle-right":"angle-left",onClick:u,variant:"canvas","data-testid":C.Tp.components.PanelEditor.toggleVizOptions,"aria-label":s?"Close options pane":"Show options pane"})]})}):null};ye.displayName="VisualizationTab";const rt={wrapper:(0,h.css)({display:"flex",flexDirection:"column"}),vizButton:(0,h.css)({textAlign:"left"})};var na=o(78685),aa=o(67647),ot=o(15054),it=o(14792),sa=o(68313),ra=o(96227),oa=o(96374);const ia=({onConfirm:e,onDismiss:t,panel:a})=>{const s=(0,at.X)(a),r=`${s?"Changing":"Replace with"} library panel`,i=`${s?"Changing":"Replacing with a"} library panel will remove any changes since last save.`;return(0,n.jsx)(oa.u,{onConfirm:e,onDismiss:t,confirmText:s?"Change":"Replace",title:r,body:i,dismissText:"Cancel",isOpen:!0})};var la=o(83791);const da=({panel:e,searchQuery:t,isWidget:a=!1})=>{const[s,r]=(0,p.useState)(!1),[i,u]=(0,p.useState)(void 0),[d,c]=(0,p.useState)([]),l=(0,p.useCallback)(D=>{c(D.map(w=>w.id))},[c]),g=(0,it.UA)().getCurrent(),m=(0,f.useDispatch)(),v=async()=>{i&&(u(void 0),m((0,de.Xk)(e,i)))},I=()=>r(!0),T=()=>u(void 0);return(0,n.jsxs)(ee.gW,{spacing:"md",children:[!e.libraryPanel&&(0,n.jsx)(ee.gW,{align:"center",children:(0,n.jsx)(j.$n,{icon:"plus",onClick:I,variant:"secondary",fullWidth:!0,children:"Create new library panel"})}),(0,n.jsx)(sa.$,{onChange:l,isWidget:a}),(0,n.jsx)("div",{className:ca.libraryPanelsView,children:(0,n.jsx)(la.y,{currentPanelId:e.libraryPanel?.uid,searchString:t,panelFilter:d,onClickCard:u,showSecondaryActions:!0,isWidget:a})}),s&&(0,n.jsx)(ra.o,{panel:e,onDismiss:()=>r(!1),initialFolderUid:g?.meta.folderUid,isOpen:s}),i&&(0,n.jsx)(ia,{panel:e,onDismiss:T,onConfirm:v})]})},ca={libraryPanelsView:(0,h.css)`
    width: 100%;
  `};var ua=o(56707),lt=o(86292),y=o(32696);const dt=({panel:e,data:t})=>{const a=(0,f.useSelector)(st(e.type)),[s,r]=(0,p.useState)(""),i=!!a.meta.skipDataQuery,u=!!(i&&b.$.featureToggles.vizAndWidgetSplit),d=u?ot.MM:ot.wV,c=u?y.__.Widgets:y.__.Visualizations,[l,g]=(0,na.A)(d,c),m=(0,f.useDispatch)(),v=(0,E.of)(ha),I=(0,p.useRef)(null),T=(0,p.useCallback)(N=>{m((0,de.gW)({panel:e,...N})),N.withModKey||m((0,U.eK)(!1))},[m,e]),D=()=>{m((0,U.eK)(!1))};if(!a)return null;const w=[{label:"Visualizations",value:y.__.Visualizations},{label:"Suggestions",value:y.__.Suggestions},{label:"Library panels",value:y.__.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}],R=[{label:"Widgets",value:y.__.Widgets},{label:"Library panels",value:y.__.LibraryPanels,description:"Reusable panels you can share between multiple dashboards."}];return(0,n.jsxs)("div",{className:v.openWrapper,children:[(0,n.jsxs)("div",{className:v.formBox,children:[(0,n.jsxs)("div",{className:v.searchRow,children:[(0,n.jsx)(aa.Z,{value:s,onChange:r,ref:I,autoFocus:!0,placeholder:"Search for..."}),(0,n.jsx)(j.$n,{title:"Close",variant:"secondary",icon:"angle-up",className:v.closeButton,"aria-label":C.Tp.components.PanelEditor.toggleVizPicker,onClick:D})]}),(0,n.jsx)(_.D,{className:v.customFieldMargin,children:(0,n.jsx)(_e.z,{options:u?R:w,value:l,onChange:g,fullWidth:!0})})]}),(0,n.jsx)("div",{className:v.scrollWrapper,children:(0,n.jsx)(le.E,{autoHeightMin:"100%",children:(0,n.jsxs)("div",{className:v.scrollContent,children:[l===y.__.Visualizations&&(0,n.jsx)(lt.G,{pluginId:a.meta.id,onChange:T,searchQuery:s}),l===y.__.Widgets&&(0,n.jsx)(lt.G,{pluginId:a.meta.id,onChange:T,searchQuery:s,isWidget:!0}),l===y.__.Suggestions&&(0,n.jsx)(ua.a,{onChange:T,searchQuery:s,panel:e,data:t}),l===y.__.LibraryPanels&&(0,n.jsx)(da,{searchQuery:s,panel:e,isWidget:i},"Panel Library")]})})})]})};dt.displayName="VisualizationSelectPane";const ha=e=>({icon:(0,h.css)({color:e.v1.palette.gray33}),wrapper:(0,h.css)({display:"flex",flexDirection:"column",flex:"1 1 0",height:"100%"}),vizButton:(0,h.css)({textAlign:"left"}),scrollWrapper:(0,h.css)({flexGrow:1,minHeight:0}),scrollContent:(0,h.css)({padding:e.spacing(1)}),openWrapper:(0,h.css)({display:"flex",flexDirection:"column",flex:"1 1 100%",height:"100%",background:e.colors.background.primary,border:`1px solid ${e.colors.border.weak}`}),searchRow:(0,h.css)({display:"flex",marginBottom:e.spacing(1)}),closeButton:(0,h.css)({marginLeft:e.spacing(1)}),customFieldMargin:(0,h.css)({marginBottom:e.spacing(1)}),formBox:(0,h.css)({padding:e.spacing(1),paddingBottom:0})}),pa=({plugin:e,panel:t,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:r,dashboard:i,instanceState:u})=>{const d=(0,E.of)(ga),c=(0,f.useSelector)(g=>g.panelEditor.isVizPickerOpen),{data:l}=ge(t,{withTransforms:!0,withFieldConfig:!1},!0);return(0,n.jsxs)("div",{className:d.wrapper,"data-testid":C.Tp.components.PanelEditor.OptionsPane.content,children:[!c&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:d.vizButtonWrapper,children:(0,n.jsx)(ye,{panel:t})}),(0,n.jsx)("div",{className:d.optionsWrapper,children:(0,n.jsx)(_n.Ff,{panel:t,dashboard:i,plugin:e,instanceState:u,data:l,onFieldConfigsChange:a,onPanelOptionsChanged:s,onPanelConfigChange:r})})]}),c&&(0,n.jsx)(dt,{panel:t,data:l})]})},ga=e=>({wrapper:(0,h.css)({height:"100%",width:"100%",display:"flex",flex:"1 1 0",flexDirection:"column",padding:0}),optionsWrapper:(0,h.css)({flexGrow:1,minHeight:0}),vizButtonWrapper:(0,h.css)({padding:`0 ${e.spacing(2,2)} 0`}),legacyOptions:(0,h.css)({label:"legacy-options",".panel-options-grid":{display:"flex",flexDirection:"column"},".panel-options-group":{marginBottom:0},".panel-options-group__body":{padding:`${e.spacing(2)} 0`},".section":{display:"block",margin:`${e.spacing(2)} 0`,"&:first-child":{marginTop:0}}})});var ct=o(3591),fa=o(91052),ma=o(20726),va=o(36663),xa=(e=>(e.Error="Error",e.Info="Info",e.Links="Links",e))(xa||{});class ba extends p.Component{constructor(){super(...arguments),this.timeSrv=(0,$.jG)(),this.getInfoMode=()=>{const{panel:t,error:a}=this.props;if(a)return"Error";if(t.description)return"Info";if(t.links&&t.links.length)return"Links"},this.getInfoContent=()=>{const{panel:t,theme:a}=this.props,s=t.description||"",r=(0,Ze.w)().replace(s,t.scopedVars),i=(0,va.G)(r),u=this.props.links&&this.props.links.getLinks(t.replaceVariables),d=Sa(a);return(0,n.jsxs)("div",{className:d.content,children:[(0,n.jsx)("div",{dangerouslySetInnerHTML:{__html:i}}),u&&u.length>0&&(0,n.jsx)("ul",{className:d.cornerLinks,children:u.map((c,l)=>(0,n.jsx)("li",{children:(0,n.jsx)("a",{href:c.href,target:c.target,children:c.title})},l))})]})},this.onClickError=()=>{P.Ny.partial({inspect:this.props.panel.id,inspectTab:L.q.Error})}}render(){const{error:t}=this.props,a=this.getInfoMode();return a?a==="Error"&&t?(0,n.jsx)(ut,{infoMode:a,content:t,onClick:this.onClickError}):a==="Info"||a==="Links"?(0,n.jsx)(ut,{infoMode:a,content:this.getInfoContent}):null:null}}const ya=(0,E.cV)(ba);function ut({infoMode:e,content:t,onClick:a}){const s=e==="Error"?"error":"info",r=C.Tp.components.Panels.Panel.headerCornerInfo(e.toLowerCase()),i=(0,E.of)(ja);return(0,n.jsx)(xe.m,{content:t,placement:"top-start",theme:s,interactive:!0,children:(0,n.jsxs)("button",{type:"button",className:i.infoCorner,onClick:a,"aria-label":r,children:[(0,n.jsx)(Y.I,{name:Pa[e],size:e==="Links"?"sm":"lg",className:(0,h.cx)(i.icon,{[i.iconLinks]:e==="Links"})}),(0,n.jsx)("span",{className:(0,h.cx)(i.inner,{[i.error]:e==="Error"})})]})})}const Pa={Error:"exclamation",Info:"info",Links:"external-link-alt"},Sa=e=>({content:(0,h.css)({overflow:"auto",code:{whiteSpace:"normal",wordWrap:"break-word"},"pre > code":{display:"block"}}),cornerLinks:(0,h.css)({listStyle:"none",paddingLeft:0})}),ja=e=>({icon:(0,h.css)({position:"absolute",top:0,left:0,zIndex:2,fill:e.colors.text.maxContrast}),iconLinks:(0,h.css)({left:e.spacing(.5),top:e.spacing(.25)}),inner:(0,h.css)({width:0,height:0,position:"absolute",left:0,bottom:0,borderBottom:`${e.spacing(4)} solid transparent`,borderLeft:`${e.spacing(4)} solid ${e.colors.background.secondary}`}),error:(0,h.css)({borderLeftColor:e.colors.error.main}),infoCorner:(0,h.css)({background:"none",border:"none",color:e.colors.text.secondary,cursor:"pointer",position:"absolute",left:0,top:0,width:e.spacing(4),height:e.spacing(4),zIndex:3})});function Ca({width:e,height:t,panel:a,dashboard:s}){const{data:r}=ge(a,{withTransforms:!0,withFieldConfig:!1},!1),[i,u]=(0,p.useState)({frameIndex:0,showHeader:!0,showTypeIcons:!0});if((0,p.useEffect)(()=>{const c=(0,$.jG)(),l=a.events.subscribe(ct._,()=>{const g=(0,ze.nk)(a,c.timeRange());a.runAllPanelQueries({dashboardUID:s.uid,dashboardTimezone:s.getTimezone(),timeData:g,width:e})});return()=>{l.unsubscribe()}},[a,s,e]),!r)return null;const d=r?.errors?r.errors.length>1?"Multiple errors found. Click for more details":r.errors[0].message:r?.error?.message;return(0,n.jsx)(fa.NR,{width:e,height:t,padding:"none",children:(c,l)=>(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ya,{panel:a,error:d}),(0,n.jsx)(ma.m,{title:"Raw data",pluginId:"table",width:c,height:l,data:r,options:i,onOptionsChange:u})]})})}var ht=o(69731),pt=o(8984),Ta=o(40980),gt=o(27747);const Da=({panel:e,dashboard:t,...a})=>{const{rules:s,loading:r}=(0,gt.S)({panelId:e.id,dashboardUID:t.uid});return(0,n.jsx)(q.o,{...a,counter:r?null:s.length})};var Na=o(39558),Ea=o(76885),ft=o(25027),Ma=o(63066);const mt=({dashboard:e,panel:t,className:a})=>{const s=(0,f.useSelector)(c=>c.templating),r=(0,M.zy)(),{loading:i,value:u}=(0,W.A)(()=>(0,Ma.mp)(t,e),[t,e,s]);if(i)return(0,n.jsx)(j.$n,{disabled:!0,children:"New alert rule"});if(!u)return(0,n.jsx)(A.F,{severity:"info",title:"No alerting capable query found",children:"Cannot create alerts from this panel because no query to an alerting capable datasource is found."});const d=Ea.kM.renderUrl("alerting/new",{defaults:JSON.stringify(u),returnTo:r.pathname+r.search});return(0,n.jsx)(j.z9,{icon:"bell",onClick:()=>(0,ft.fH)(ft.le.alertRuleFromPanel),href:d,className:a,"data-testid":"create-alert-rule-button",children:"New alert rule"})};var Ia=o(80215),vt=o(75471),wa=o(56361);const La=({dashboard:e,panel:t})=>{const a=(0,E.of)(Ra),{errors:s,loading:r,rules:i}=(0,gt.S)({dashboardUID:e.uid,panelId:t.id,poll:!0}),u=(0,vt.Wd)("grafana"),d=z.TP.hasPermission(u.create),c=s.length?(0,n.jsx)(A.F,{title:"Errors loading rules",severity:"error",children:s.map((l,g)=>(0,n.jsxs)("div",{children:["Failed to load Grafana rules state: ",(0,wa.JZ)(l)]},g))}):null;return r&&!i.length?(0,n.jsxs)("div",{className:a.innerWrapper,children:[c,(0,n.jsx)(Na._,{text:"Loading rules..."})]}):i.length?(0,n.jsx)(le.E,{autoHeightMin:"100%",children:(0,n.jsxs)("div",{className:a.innerWrapper,children:[c,(0,n.jsx)(Ia.s,{rules:i}),!!e.meta.canSave&&d&&(0,n.jsx)(mt,{className:a.newButton,panel:t,dashboard:e})]})}):(0,n.jsxs)("div",{"data-testid":C.Tp.components.PanelAlertTabContent.content,className:a.noRulesWrapper,children:[c,!!e.uid&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{children:"There are no alert rules linked to this panel."}),!!e.meta.canSave&&d&&(0,n.jsx)(mt,{panel:t,dashboard:e})]}),!e.uid&&!!e.meta.canSave&&(0,n.jsx)(A.F,{severity:"info",title:"Dashboard not saved",children:"Dashboard must be saved before alerts can be added."})]})},Ra=e=>({newButton:(0,h.css)({marginTop:e.spacing(3)}),innerWrapper:(0,h.css)({padding:e.spacing(2)}),noRulesWrapper:(0,h.css)({margin:e.spacing(2),backgroundColor:e.colors.background.secondary,padding:e.spacing(3)})});var Aa=o(66879),xt=o(22391),Fa=o(47311),Pe=o(31193),Ua=o(37464);class Oa extends p.PureComponent{constructor(t){super(t),this.updateLastUsedDatasource=a=>{(0,Fa.tw)(a)},this.onRunQueries=()=>{this.props.panel.refresh()},this.onOpenQueryInspector=()=>{P.Ny.partial({inspect:this.props.panel.id,inspectTab:"query"})},this.onOptionsChange=a=>{const{panel:s}=this.props;s.updateQueries(a),a.dataSource.uid!==s.datasource?.uid&&setTimeout(this.onRunQueries,10),this.forceUpdate()}}buildQueryOptions(t){const a=t.datasource??{default:!0},s=(0,Pe.tR)().getInstanceSettings(a);return this.updateLastUsedDatasource(a),{cacheTimeout:s?.meta.queryOptions?.cacheTimeout?t.cacheTimeout:void 0,dataSource:{default:s?.isDefault,...s?(0,xt.p$)(s):{type:void 0,uid:void 0}},queryCachingTTL:s?.cachingConfig?.enabled?t.queryCachingTTL:void 0,queries:t.targets,maxDataPoints:t.maxDataPoints,minInterval:t.interval,timeRange:{from:t.timeFrom,shift:t.timeShift,hide:t.hideTimeOverride}}}async componentDidMount(){const{panel:t}=this.props;if(!t.datasource){let a;const s=(0,it.UA)().getCurrent()?.uid??"",r=(0,Fe.CW)(s);r?.datasourceUid!==null&&(a=(0,Pe.tR)().getInstanceSettings(r?.datasourceUid)),a||(a=(0,Pe.tR)().getInstanceSettings(null)),t.datasource=(0,xt.p$)(a),this.forceUpdate()}}render(){const{panel:t}=this.props;if(!t.datasource)return null;const a=this.buildQueryOptions(t);return(0,n.jsx)(Ua.g,{options:a,queryRunner:t.getQueryRunner(),onRunQueries:this.onRunQueries,onOpenQueryInspector:this.onOpenQueryInspector,onOptionsChange:this.onOptionsChange})}}const bt=(0,p.memo)(({panel:e,dashboard:t,tabs:a,onChangeTab:s})=>{const r=(0,ht.C)(),i=(0,E.of)(Va),u=(0,p.useCallback)(l=>{let g="panel_editor_tabs_changed";b.$.featureToggles.transformationsRedesign&&(g="transformations_redesign_"+g),l.active||(0,Ie.rR)(g,{tab_id:l.id}),s(l)},[s]);(0,p.useEffect)(()=>{const l=new qe.yU;return l.add(e.events.subscribe(F.zq,r)),l.add(e.events.subscribe(F.JI,r)),()=>l.unsubscribe()},[e,t,r]);const d=a.find(l=>l.active);if(a.length===0)return null;const c=b.$.unifiedAlertingEnabled;return(0,n.jsxs)("div",{className:i.wrapper,children:[(0,n.jsx)(he.U,{className:i.tabBar,hideBorder:!0,children:a.map(l=>l.id===y.M8.Alert&&c?(0,n.jsx)(Da,{label:l.text,active:l.active,onChangeTab:()=>s(l),icon:(0,pt.toIconName)(l.icon),panel:e,dashboard:t},l.id):(0,n.jsx)(q.o,{label:l.text,active:l.active,onChangeTab:()=>u(l),icon:(0,pt.toIconName)(l.icon),counter:za(e,l)},l.id))}),(0,n.jsxs)(Ta.J,{className:i.tabContent,children:[d.id===y.M8.Query&&(0,n.jsx)(Oa,{panel:e,queries:e.targets}),d.id===y.M8.Alert&&(0,n.jsx)(La,{panel:e,dashboard:t}),d.id===y.M8.Transform&&(0,n.jsx)(Aa.o,{panel:e})]})]})});bt.displayName="PanelEditorTabs";function za(e,t){switch(t.id){case y.M8.Query:return e.targets.length;case y.M8.Alert:return e.alert?1:0;case y.M8.Transform:return(e.getTransformations()??[]).length}return null}const Va=e=>({wrapper:(0,h.css)({display:"flex",flexDirection:"column",height:"100%"}),tabBar:(0,h.css)({paddingLeft:e.spacing(2)}),tabContent:(0,h.css)({padding:0,display:"flex",flexDirection:"column",flex:1,minHeight:0,background:e.colors.background.primary,border:`1px solid ${e.components.panel.borderColor}`,borderLeft:"none",borderBottom:"none",borderTopRightRadius:e.shape.borderRadius(1.5)})});var Ba=o(41811),$a=o(2913),Wa=o(57220);const Ga=(0,Ba.A)((e,t)=>{const a=[];if(!t)return a;let s=y.M8.Visualize;if(t.meta.skipDataQuery)return[];t.meta.skipDataQuery||(s=y.M8.Query,a.push({id:y.M8.Query,text:"Query",icon:"database",active:!1}),a.push({id:y.M8.Transform,text:"Transform data",icon:"process",active:!1})),Qa(t)&&a.push({id:y.M8.Alert,text:"Alert",icon:"bell",active:!1});const r=a.find(i=>i.id===(e||s))??a[0];return r.active=!0,a});function Qa(e){const{unifiedAlertingEnabled:t=!1}=(0,$a.zj)(),a=z.TP.hasPermission((0,vt.Wd)(Wa.hY).read);if(!(t&&a))return!1;const r=e.meta.id==="graph",i=e.meta.id==="timeseries";return r||i}var Ha=o(54612);const Ka=(e,t)=>{const a=e.panelEditor.getPanel(),s=(0,He.U)(e,a);return{panel:a,plugin:s?.plugin,instanceState:s?.instanceState,initDone:e.panelEditor.initDone,uiState:e.panelEditor.ui,tableViewEnabled:e.panelEditor.tableViewEnabled,variables:(0,be.SS)(t.dashboard.uid,e)}},ka={initPanelEditor:on,discardPanelChanges:Be,updatePanelEditorUIState:ce,updateTimeZoneForSession:Jn.Cj,toggleTableView:U.kw,notifyApp:Ne.dx},Ja=(0,J.connect)(Ka,ka);class Ya extends p.PureComponent{constructor(){super(...arguments),this.state={showSaveLibraryPanelModal:!1},this.triggerForceUpdate=()=>{this.forceUpdate()},this.onBack=()=>{P.Ny.partial({editPanel:null,tab:null,showCategory:null})},this.onDiscard=()=>{this.props.discardPanelChanges(),this.onBack()},this.onSaveDashboard=()=>{Wn.lE.publish(new F.S8({component:qn.$,props:{dashboard:this.props.dashboard}}))},this.onSaveLibraryPanel=async()=>{(0,at.X)(this.props.panel)&&this.setState({showSaveLibraryPanelModal:!0})},this.onChangeTab=t=>{P.Ny.partial({tab:t.id})},this.onFieldConfigChange=t=>{this.props.panel.updateFieldConfig({...t})},this.onPanelOptionsChanged=t=>{this.props.panel.updateOptions(t)},this.onPanelConfigChanged=(t,a)=>{this.props.panel.setProperty(t,a),this.props.panel.render(),this.forceUpdate()},this.onDisplayModeChange=t=>{const{updatePanelEditorUIState:a}=this.props;this.props.tableViewEnabled&&this.props.toggleTableView(),a({mode:t})},this.onToggleTableView=()=>{this.props.toggleTableView()},this.onGoBackToDashboard=()=>{P.Ny.partial({editPanel:null,tab:null,showCategory:null})},this.onConfirmAndDismissLibarayPanelModel=()=>{this.setState({showSaveLibraryPanelModal:!1})}}componentDidMount(){this.props.initPanelEditor(this.props.sourcePanel,this.props.dashboard)}componentDidUpdate(){const{panel:t,initDone:a}=this.props;a&&!this.eventSubs&&(this.eventSubs=new qe.yU,this.eventSubs.add(t.events.subscribe(F.PR,this.triggerForceUpdate)))}componentWillUnmount(){this.eventSubs?.unsubscribe()}renderPanel(t,a){const{dashboard:s,panel:r,uiState:i,tableViewEnabled:u,theme:d}=this.props;return(0,n.jsxs)("div",{className:t.mainPaneWrapper,children:[this.renderPanelToolbar(t),(0,n.jsx)("div",{className:t.panelWrapper,children:(0,n.jsx)(ue.Ay,{children:({width:c,height:l})=>{if(c<3||l<3)return null;if(a&&(l-=d.spacing.gridSize*2),u)return(0,n.jsx)(Ca,{width:c,height:l,panel:r,dashboard:s});const g=(0,Ha.A)(i.mode,c,l,r);return(0,n.jsx)("div",{className:t.centeringContainer,style:{width:c,height:l},children:(0,n.jsx)("div",{style:g,"data-panelid":r.id,children:(0,n.jsx)(Zn.L,{stateKey:r.key,dashboard:s,panel:r,isEditing:!0,isViewing:!1,lazy:!1,width:g.width,height:g.height},r.key)})})}})})]},"panel")}renderPanelAndEditor(t,a){const{panel:s,dashboard:r,plugin:i,tab:u}=this.props,d=Ga(u,i),c=d.length===0,l=this.renderPanel(a,c);return d.length===0?(0,n.jsx)("div",{className:a.onlyPanel,children:l}):(0,n.jsxs)(tt.g,{splitOrientation:"horizontal",maxSize:-200,paneSize:t.topPaneSize,primary:"first",secondaryPaneStyle:{minHeight:0},onDragFinished:g=>{g&&ce({topPaneSize:g/window.innerHeight})},children:[l,(0,n.jsx)("div",{className:a.tabsWrapper,"data-testid":C.Tp.components.PanelEditor.DataPane.content,children:(0,n.jsx)(bt,{panel:s,dashboard:r,tabs:d,onChangeTab:this.onChangeTab},s.key)},"panel-editor-tabs")]})}renderTemplateVariables(t){const{variables:a}=this.props;return a.length?(0,n.jsx)("div",{className:t.variablesWrapper,children:(0,n.jsx)(nt,{variables:a})}):null}renderPanelToolbar(t){const{dashboard:a,uiState:s,variables:r,updateTimeZoneForSession:i,panel:u,tableViewEnabled:d}=this.props;return(0,n.jsx)("div",{className:t.panelToolbar,children:(0,n.jsxs)(ee.Gy,{justify:r.length>0?"space-between":"flex-end",align:"flex-start",children:[this.renderTemplateVariables(t),(0,n.jsxs)(G.B,{gap:1,children:[(0,n.jsx)(Q.K,{label:"Table view",showLabel:!0,id:"table-view",value:d,onClick:this.onToggleTableView,"data-testid":C.Tp.components.PanelEditor.toggleTableView}),(0,n.jsx)(_e.z,{value:s.mode,options:y.Nt,onChange:this.onDisplayModeChange}),(0,n.jsx)(Xn.$,{dashboard:a,onChangeTimeZone:i,isOnCanvas:!0}),!s.isPanelOptionsVisible&&(0,n.jsx)(ye,{panel:u})]})]})})}renderEditorActions(){const t="sm";let a=[(0,n.jsx)(j.$n,{onClick:this.onDiscard,title:"Undo all changes",size:t,variant:"destructive",fill:"outline",children:"Discard"},"discard"),this.props.dashboard.meta.canSave&&(this.props.panel.libraryPanel?(0,n.jsx)(j.$n,{onClick:this.onSaveLibraryPanel,variant:"primary",size:t,title:"Apply changes and save library panel",children:"Save library panel"},"save-panel"):(0,n.jsx)(j.$n,{onClick:this.onSaveDashboard,title:"Apply changes and save dashboard",size:t,variant:"secondary",children:"Save"},"save")),(0,n.jsx)(j.$n,{onClick:this.onBack,variant:"primary",title:"Apply changes and go back to dashboard","data-testid":C.Tp.components.PanelEditor.applyButton,size:t,children:"Apply"},"apply")];return this.props.panel.libraryPanel&&(a.splice(1,0,(0,n.jsx)(oe.$s,{children:({showModal:s,hideModal:r})=>(0,n.jsx)(me.I,{onClick:()=>{s(Yn.l,{onConfirm:()=>{this.props.panel.unlinkLibraryPanel(),this.forceUpdate()},onDismiss:r,isOpen:!0})},title:"Disconnects this panel from the library panel so that you can edit it regularly.",children:"Unlink"},"unlink")},"unlink-controller")),a.pop()),a}renderOptionsPane(){const{plugin:t,dashboard:a,panel:s,instanceState:r}=this.props;return t?(0,n.jsx)(pa,{plugin:t,dashboard:a,panel:s,instanceState:r,onFieldConfigsChange:this.onFieldConfigChange,onPanelOptionsChanged:this.onPanelOptionsChanged,onPanelConfigChange:this.onPanelConfigChanged}):(0,n.jsx)("div",{})}render(){const{initDone:t,uiState:a,theme:s,sectionNav:r,pageNav:i,className:u,updatePanelEditorUIState:d}=this.props,c=Xa(s,this.props);return t?(0,n.jsxs)(B.Y,{navModel:r,pageNav:i,"data-testid":C.Tp.components.PanelEditor.General.content,layout:V.k.Custom,className:u,children:[(0,n.jsx)($n.H,{actions:(0,n.jsx)(Bn.U,{alignment:"right",children:this.renderEditorActions()})}),(0,n.jsxs)("div",{className:c.wrapper,children:[(0,n.jsx)("div",{className:c.verticalSplitPanesWrapper,children:a.isPanelOptionsVisible?(0,n.jsxs)(tt.g,{splitOrientation:"vertical",maxSize:-300,paneSize:a.rightPaneSize,primary:"second",onDragFinished:l=>{l&&d({rightPaneSize:l/window.innerWidth})},children:[this.renderPanelAndEditor(a,c),this.renderOptionsPane()]}):this.renderPanelAndEditor(a,c)}),this.state.showSaveLibraryPanelModal&&(0,n.jsx)(Oe,{panel:this.props.panel,folderUid:this.props.dashboard.meta.folderUid??"",onConfirm:this.onConfirmAndDismissLibarayPanelModel,onDiscard:this.onDiscard,onDismiss:this.onConfirmAndDismissLibarayPanelModel})]})]}):null}}const Za=(0,E.cV)(Ja(Ya)),Xa=(0,et.N)((e,t)=>{const{uiState:a}=t,s=e.spacing(2);return{wrapper:(0,h.css)({width:"100%",flexGrow:1,minHeight:0,display:"flex",paddingTop:e.spacing(2)}),verticalSplitPanesWrapper:(0,h.css)({display:"flex",flexDirection:"column",height:"100%",width:"100%",position:"relative"}),mainPaneWrapper:(0,h.css)({display:"flex",flexDirection:"column",height:"100%",width:"100%",paddingRight:`${a.isPanelOptionsVisible?0:s}`}),variablesWrapper:(0,h.css)({label:"variablesWrapper",display:"flex",flexGrow:1,flexWrap:"wrap",gap:e.spacing(1,2)}),panelWrapper:(0,h.css)({flex:"1 1 0",minHeight:0,width:"100%",paddingLeft:s}),tabsWrapper:(0,h.css)({height:"100%",width:"100%"}),panelToolbar:(0,h.css)({display:"flex",padding:`0 0 ${s} ${s}`,justifyContent:"space-between",flexWrap:"wrap"}),angularWarning:(0,h.css)({display:"flex",height:e.spacing(4),alignItems:"center"}),toolbarLeft:(0,h.css)({paddingLeft:e.spacing(1)}),centeringContainer:(0,h.css)({display:"flex",justifyContent:"center",alignItems:"center",position:"relative",flexDirection:"column"}),onlyPanel:(0,h.css)({height:"100%",position:"absolute",overflow:"hidden",width:"100%"})}});var qa=o(1702),_a=o(39268),es=o(14186),ts=o(89963),ns=o(42972);const as=({annotation:e,events:t,onEnabledChanged:a})=>{const[s,r]=(0,p.useState)(!1),i=(0,E.of)(ss),u=()=>(0,ns.Dh)().cancel(e);return(0,p.useEffect)(()=>{const d=t.getStream(F.xc).subscribe({next:l=>{l.payload===e&&r(!0)}}),c=t.getStream(F.yj).subscribe({next:l=>{l.payload===e&&r(!1)}});return()=>{d.unsubscribe(),c.unsubscribe()}}),(0,n.jsx)("div",{className:i.annotation,children:(0,n.jsxs)(_a.C,{children:[(0,n.jsx)(es.I,{label:e.name,disabled:s,"data-testid":C.Tp.pages.Dashboard.SubMenu.Annotations.annotationLabel(e.name),children:(0,n.jsx)(Q.K,{label:e.name,value:e.enable,onChange:()=>a(e),disabled:s,"data-testid":C.Tp.pages.Dashboard.SubMenu.Annotations.annotationToggle(e.name)})}),(0,n.jsx)("div",{className:i.indicator,children:(0,n.jsx)(ts.I,{loading:s,onCancel:u})})]})},e.name)};function ss(e){return{annotation:(0,h.css)({display:"inline-block",marginRight:e.spacing(1),".fa-caret-down":{fontSize:"75%",paddingLeft:e.spacing(1)},".gf-form-inline .gf-form":{marginBottom:0}}),indicator:(0,h.css)({alignSelf:"center",padding:`0 ${e.spacing(.5)}`})}}const rs=({annotations:e,onAnnotationChanged:t,events:a})=>{const[s,r]=(0,p.useState)([]);return(0,p.useEffect)(()=>{r(e.filter(i=>i.hide!==!0))},[e]),s.length===0?null:(0,n.jsx)("div",{"data-testid":C.Tp.pages.Dashboard.SubMenu.Annotations.annotationsWrapper,children:s.map(i=>(0,n.jsx)(as,{events:a,annotation:i,onEnabledChanged:t},i.name))})};var os=o(94701),is=o(80997),ls=o(4588),ds=o(6923),yt=o(52424);const cs=({dashboard:e,links:t})=>{const a=(0,ht.C)();return(0,os.A)(()=>{const s=e.events.subscribe(ct.sR,a);return()=>s.unsubscribe()}),t.length?(0,n.jsx)(n.Fragment,{children:t.map((s,r)=>{const i=(0,ds.mQ)().getAnchorInfo(s),u=`${s.title}-$${r}`;if(s.type==="dashboards")return(0,n.jsx)(yt.aK,{link:s,linkInfo:i,dashboardUID:e.uid},u);const d=ls.G[s.icon],c=(0,n.jsx)(yt.Zx,{href:(0,is.Jf)(i.href),target:s.targetBlank?"_blank":void 0,rel:"noreferrer","data-testid":C.Tp.components.DashboardLinks.link,icon:d,children:i.title});return(0,n.jsx)("div",{"data-testid":C.Tp.components.DashboardLinks.container,children:s.tooltip?(0,n.jsx)(xe.m,{content:i.tooltip,children:c}):c},u)})}):null};class us extends p.PureComponent{constructor(){super(...arguments),this.onAnnotationStateChanged=t=>{for(let a=0;a<this.props.dashboard.annotations.list.length;a++){const s=this.props.dashboard.annotations.list[a];if(s.name===t.name){s.enable=!s.enable;break}}this.props.dashboard.startRefresh(),this.forceUpdate()},this.disableSubmitOnEnter=t=>{t.preventDefault()}}render(){const{dashboard:t,variables:a,links:s,annotations:r,theme:i}=this.props,u=ps(i),d=t.meta.isSnapshot??!1;return(0,n.jsxs)("div",{className:u.submenu,children:[(0,n.jsx)("form",{"aria-label":"Template variables",className:u.formStyles,onSubmit:this.disableSubmitOnEnter,children:(0,n.jsx)(nt,{variables:a,readOnly:d})}),(0,n.jsx)(rs,{annotations:r,onAnnotationChanged:this.onAnnotationStateChanged,events:t.events}),(0,n.jsx)("div",{className:u.spacer}),t&&(0,n.jsx)(cs,{dashboard:t,links:s})]})}}const hs=(e,t)=>{const{uid:a}=t.dashboard,s=(0,be.nx)(a,e);return{variables:(0,be.pi)(a,s.variables)}},ps=(0,et.N)(e=>({formStyles:(0,h.css)({display:"contents",flexWrap:"wrap"}),submenu:(0,h.css)({display:"flex",flexDirection:"row",flexWrap:"wrap",alignContent:"flex-start",alignItems:"flex-start",gap:`${e.spacing(1)} ${e.spacing(2)}`,padding:`0 0 ${e.spacing(1)} 0`}),spacer:(0,h.css)({flexGrow:1})})),Pt=(0,E.cV)((0,J.connect)(hs)(us));Pt.displayName="SubMenu";var gs=o(2118),fs=o(61582),St=o(84423),ms=o(3673);const vs=e=>({initPhase:e.dashboard.initPhase,initError:e.dashboard.initError,dashboard:e.dashboard.getModel(),navIndex:e.navIndex}),xs={initDashboard:S.vR,cleanUpDashboardAndVariables:ms.Bz,notifyApp:Ne.dx,cancelVariables:Re.Y7,templateVarsChangedInUrl:Re.Hn},bs=(0,J.connect)(vs,xs);class ys extends p.PureComponent{constructor(){super(...arguments),this.forceRouteReloadCounter=0,this.state=this.getCleanState(),this.updateLiveTimer=()=>{let t;this.props.dashboard?.liveNow&&(t=(0,$.jG)().timeRange()),fs.a.setLiveTimeRange(t)},this.setScrollRef=t=>{this.setState({scrollElement:t})},this.onCloseShareModal=()=>{P.Ny.partial({shareView:null})}}static{this.contextType=At.YE}getCleanState(){return{editView:null,editPanel:null,viewPanel:null,showLoadingState:!1,panelNotFound:!1,editPanelAccessDenied:!1}}componentDidMount(){this.initDashboard(),this.forceRouteReloadCounter=this.props.history.location.state?.routeReloadCounter||0}componentWillUnmount(){this.closeDashboard()}closeDashboard(){this.props.cleanUpDashboardAndVariables(),this.setState(this.getCleanState())}initDashboard(){const{dashboard:t,match:a,queryParams:s}=this.props;t&&this.closeDashboard(),this.props.initDashboard({urlSlug:a.params.slug,urlUid:a.params.uid,urlType:a.params.type,urlFolderUid:s.folderUid,panelType:s.panelType,routeName:this.props.route.routeName,fixUrl:!0,accessToken:a.params.accessToken,keybindingSrv:this.context.keybindings}),setTimeout(this.updateLiveTimer,250)}componentDidUpdate(t,a){const{dashboard:s,match:r,templateVarsChangedInUrl:i}=this.props,u=this.props.history.location.state?.routeReloadCounter;if(s){if(t.match.params.uid!==r.params.uid||u!==void 0&&this.forceRouteReloadCounter!==u){this.initDashboard(),this.forceRouteReloadCounter=u;return}if(t.location.search!==this.props.location.search){const d=t.queryParams,c=this.props.queryParams;(c?.from!==d?.from||c?.to!==d?.to)&&((0,$.jG)().updateTimeRangeFromUrl(),this.updateLiveTimer()),!d?.refresh&&c?.refresh&&(0,$.jG)().setAutoRefresh(c.refresh);const l=(0,kt.Wz)(this.props.queryParams,t.queryParams);l&&i(s.uid,l)}this.state.editPanel&&!a.editPanel&&(Me.t.setEditingState(!0),this.props.dashboard?.events.publish(new F.sL(this.state.editPanel.id))),!this.state.editPanel&&a.editPanel&&(Me.t.setEditingState(!1),this.props.dashboard?.events.publish(new F.i0(a.editPanel.id))),this.state.editPanelAccessDenied&&(this.props.notifyApp((0,Ee.gi)("Permission to edit panel denied")),P.Ny.partial({editPanel:null})),this.state.panelNotFound&&(this.props.notifyApp((0,Ee.gi)("Panel not found")),P.Ny.partial({editPanel:null,viewPanel:null})),b.$.featureToggles.bodyScrolling&&this.state.updateScrollTop!==void 0&&this.state.updateScrollTop!==a.updateScrollTop&&window.scrollTo(0,this.state.updateScrollTop)}}static getDerivedStateFromProps(t,a){const{dashboard:s,queryParams:r}=t,i=r.editPanel,u=r.viewPanel,d=r.editview;if(!s)return a;const c={...a};if(b.$.featureToggles.bodyScrolling&&(!a.editView&&d?(c.editView=d,c.rememberScrollTop=window.scrollY,c.updateScrollTop=0):a.editView&&!d&&(c.updateScrollTop=a.rememberScrollTop,c.editView=null)),!a.editPanel&&i){const l=s.getPanelByUrlId(i);l?s.canEditPanel(l)?(c.editPanel=l,c.rememberScrollTop=b.$.featureToggles.bodyScrolling?window.scrollY:a.scrollElement?.scrollTop,b.$.featureToggles.bodyScrolling&&(c.updateScrollTop=0)):c.editPanelAccessDenied=!0:c.panelNotFound=!0}else a.editPanel&&!i&&(c.editPanel=null,c.updateScrollTop=a.rememberScrollTop);if(!a.viewPanel&&u){const l=s.getPanelByUrlId(u);l?(s.initViewPanel(l),c.viewPanel=l,c.rememberScrollTop=b.$.featureToggles.bodyScrolling?window.scrollY:a.scrollElement?.scrollTop,c.updateScrollTop=0):c.panelNotFound=!0}else a.viewPanel&&!u&&(s.exitViewPanel(a.viewPanel),c.viewPanel=null,c.updateScrollTop=a.rememberScrollTop);return(a.panelNotFound||a.editPanelAccessDenied&&!i)&&(c.panelNotFound=!1,c.editPanelAccessDenied=!1),Ps(t,c)}getInspectPanel(){const{dashboard:t,queryParams:a}=this.props,s=a.inspect;if(!t||!s)return null;const r=t.getPanelById(parseInt(s,10));return r||null}render(){const{dashboard:t,initError:a,queryParams:s}=this.props,{editPanel:r,viewPanel:i,updateScrollTop:u,pageNav:d,sectionNav:c}=this.state,l=Ft(this.props.queryParams);if(!t||!d||!c)return(0,n.jsx)(_t.P,{initPhase:this.props.initPhase});const g=this.getInspectPanel(),m=!r&&!l&&!this.props.queryParams.editview&&t.isSubMenuVisible(),v=l!==f.KioskMode.Full&&!s.editview,I=(0,h.cx)({"panel-in-fullscreen":!!i,"page-hidden":!!(s.editview||r)});if(t.meta.dashboardNotFound)return(0,n.jsx)(B.Y,{navId:"dashboards/browse",layout:V.k.Canvas,pageNav:{text:"Not found"},children:(0,n.jsx)(Rt.L,{entity:"Dashboard"})});const T=new Set(["autoMigrateOldPanels","autoMigrateGraphPanel","autoMigrateTablePanel","autoMigratePiechartPanel","autoMigrateWorldmapPanel","autoMigrateStatPanel","disableAngular"]),D=()=>{const N=new URLSearchParams(window.location.search);let ae=!1;return N.forEach((Tt,Dt)=>{if(Dt.startsWith("__feature.")){const Nt=Dt.substring(10),Cs=Tt==="true"||Tt==="";if(b.$.featureToggles[Nt])return;if(T.has(Nt)&&Cs){ae=!0;return}}}),ae},w=t.panels.some(N=>N.autoMigrateFrom&&St.NB[N.autoMigrateFrom]!=null),R=b.$.featureToggles.angularDeprecationUI&&w&&D()&&t.uid!==null;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(B.Y,{navModel:c,pageNav:d,layout:V.k.Canvas,className:I,scrollRef:this.setScrollRef,scrollTop:u,children:[v&&(0,n.jsx)("header",{"data-testid":C.Tp.pages.Dashboard.DashNav.navV2,children:(0,n.jsx)(Xt.U,{dashboard:t,title:t.title,folderTitle:t.meta.folderTitle,isFullscreen:!!i,kioskMode:l,hideTimePicker:t.timepicker.hidden})}),(0,n.jsx)($e,{dashboard:t}),a&&(0,n.jsx)(qt.y,{}),m&&(0,n.jsx)("section",{"aria-label":C.Tp.pages.Dashboard.SubMenu.submenu,children:(0,n.jsx)(Pt,{dashboard:t,annotations:t.annotations.list,links:t.links})}),b.$.featureToggles.angularDeprecationUI&&t.hasAngularPlugins()&&t.uid!==null&&(0,n.jsx)($t,{dashboardUid:t.uid,showAutoMigrateLink:t.panels.some(N=>St.vI.includes(N.type))}),R&&(0,n.jsx)(Ht,{dashboardUid:t.uid}),(0,n.jsx)(gs.N,{dashboard:t,isEditable:!!t.meta.canEdit,viewPanel:i,editPanel:r}),g&&(0,n.jsx)(Vn,{dashboard:t,panel:g}),s.shareView&&(0,n.jsx)(qa.ShareModal,{dashboard:t,onDismiss:this.onCloseShareModal})]}),r&&(0,n.jsx)(Za,{dashboard:t,sourcePanel:r,tab:this.props.queryParams.tab,sectionNav:c,pageNav:d}),s.editview&&(0,n.jsx)(gn.s,{dashboard:t,editview:s.editview,pageNav:d,sectionNav:c}),s.addWidget&&b.$.featureToggles.vizAndWidgetSplit&&(0,n.jsx)(Yt,{})]})}}function Ps(e,t){const{dashboard:a,navIndex:s}=e;if(!a)return t;let r=t.pageNav,i=t.sectionNav;if((!r||a.title!==r.text||a.meta.folderUrl!==r.parentItem?.url)&&(r={text:a.title,url:Lt.I.getUrlForPartial(e.history.location,{editview:null,editPanel:null,viewPanel:null})}),e.route.routeName===f.DashboardRoutes.Path){i=Le();const d=we(e.match.params.slug);d?.parentItem&&(d.parentItem=d.parentItem)}else i=(0,ie.tc)(e.navIndex,Ut.L1+a.uid,(0,ie.tc)(e.navIndex,"dashboards/browse"));const{folderUid:u}=a.meta;if(u&&r&&i.main.id!=="starred"){const d=(0,ie.tc)(s,`folder-dashboards-${u}`).main;d.id!=="not-found"&&(r={...r,parentItem:d})}return(t.editPanel||t.viewPanel)&&(r={...r,text:`${t.editPanel?"Edit":"View"} panel`,parentItem:r,url:void 0}),t.pageNav===r&&t.sectionNav===i?t:{...t,pageNav:r,sectionNav:i}}const jt=(0,E.cV)(ys);jt.displayName="DashboardPage";const Ct=bs(jt);function Ss(e){const t=e.queryParams.scenes===!0,a=e.queryParams.scenes===!1;if(t||b.$.featureToggles.dashboardScene&&!a)return(0,n.jsx)(De,{...e});const s=(0,Te.sP)(),r=!!(e.route.routeName===f.DashboardRoutes.Home||e.route.routeName===f.DashboardRoutes.Normal&&e.match.params.uid),i=(0,W.A)(async()=>e.match.params.type==="snapshot"?null:s.fetchDashboard({route:e.route.routeName,uid:e.match.params.uid??"",keepDashboardFromExploreInLocalStorage:!0}),[e.match.params.uid,e.route.routeName]);return b.$.featureToggles.dashboardSceneForViewers?i.loading||i?.value?.dashboard?.uid!==e.match.params.uid&&i.value?.meta?.isNew!==!0?null:i.value&&!(i.value.meta?.canEdit||i.value.meta?.canMakeEditable)&&r?(0,n.jsx)(De,{...e}):(0,n.jsx)(Ct,{...e}):(0,n.jsx)(Ct,{...e})}const js=Ss},53652:(Et,K,o)=>{o.d(K,{E:()=>re,o:()=>B});var n=o(89667),W=o(57875),b=o(17172),p=o(32264),V=o(27677);class se{constructor(){}async get(x){const S=`api/storage/read/${x}`.replace("//","/");return(0,b.AI)().get(S)}async list(x){let S="api/storage/list/";x&&(S+=x+"/");const f=await(0,b.AI)().get(S);if(f?.data){const h=(0,n.or)(f);for(const M of h.fields)M.display=(0,W.J)({field:M,theme:p.$.theme2});return h}}async createFolder(x){const S=await(0,b.AI)().post("/api/storage/createFolder",JSON.stringify({path:x}));return S.success?{}:{error:S.message??"unknown error"}}async deleteFolder(x){const S=await(0,b.AI)().post("/api/storage/deleteFolder",JSON.stringify(x));return S.success?{}:{error:S.message??"unknown error"}}async deleteFile(x){const S=await(0,b.AI)().post(`/api/storage/delete/${x.path}`);return S.success?{}:{error:S.message??"unknown error"}}async delete(x){return x.isFolder?this.deleteFolder({path:x.path,force:!0}):this.deleteFile({path:x.path})}async upload(x,S,f){const h=new FormData;h.append("folder",x),h.append("file",S),h.append("overwriteExistingFile",String(f));const M=await fetch("/api/storage/upload",{method:"POST",body:h});let P=await M.json();return P||(P={}),P.status=M.status,P.statusText=M.statusText,M.status!==200&&!P.err&&(P.err=!0),P}async write(x,S){return V.IB.post(`/api/storage/write/${x}`,S)}async getConfig(){return(0,b.AI)().get("/api/storage/config")}async getOptions(x){return(0,b.AI)().get(`/api/storage/options/${x}`)}}function re(k,x){const f=k.toLowerCase().trim();return x.map(M=>M.trim().toLowerCase()).includes(f)}let A;function B(){return A||(A=new se),A}}}]);

//# sourceMappingURL=DashboardPageProxy.d9fc643dd5dff7342bb4.js.map