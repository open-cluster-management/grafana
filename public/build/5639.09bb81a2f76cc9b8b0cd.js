"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[5639],{87965:(Z,T,t)=>{t.d(T,{E3:()=>i,vj:()=>r});const e=`{{ define "__subject" }}[{{ .Status | toUpper }}{{ if eq .Status "firing" }}:{{ .Alerts.Firing | len }}{{ if gt (.Alerts.Resolved | len) 0 }}, RESOLVED:{{ .Alerts.Resolved | len }}{{ end }}{{ end }}] {{ .GroupLabels.SortedPairs.Values | join " " }} {{ if gt (len .CommonLabels) (len .GroupLabels) }}({{ with .CommonLabels.Remove .GroupLabels.Names }}{{ .Values | join " " }}{{ end }}){{ end }}{{ end }}

{{ define "__text_values_list" }}{{ if len .Values }}{{ $first := true }}{{ range $refID, $value := .Values -}}
{{ if $first }}{{ $first = false }}{{ else }}, {{ end }}{{ $refID }}={{ $value }}{{ end -}}
{{ else }}[no value]{{ end }}{{ end }}

{{ define "__text_alert_list" }}{{ range . }}
Value: {{ template "__text_values_list" . }}
Labels:
{{ range .Labels.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}Annotations:
{{ range .Annotations.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}{{ if gt (len .GeneratorURL) 0 }}Source: {{ .GeneratorURL }}
{{ end }}{{ if gt (len .SilenceURL) 0 }}Silence: {{ .SilenceURL }}
{{ end }}{{ if gt (len .DashboardURL) 0 }}Dashboard: {{ .DashboardURL }}
{{ end }}{{ if gt (len .PanelURL) 0 }}Panel: {{ .PanelURL }}
{{ end }}{{ end }}{{ end }}

{{ define "default.title" }}{{ template "__subject" . }}{{ end }}

{{ define "default.message" }}{{ if gt (len .Alerts.Firing) 0 }}**Firing**
{{ template "__text_alert_list" .Alerts.Firing }}{{ if gt (len .Alerts.Resolved) 0 }}

{{ end }}{{ end }}{{ if gt (len .Alerts.Resolved) 0 }}**Resolved**
{{ template "__text_alert_list" .Alerts.Resolved }}{{ end }}{{ end }}

{{ define "__teams_text_alert_list" }}{{ range . }}
Value: {{ template "__text_values_list" . }}
Labels:
{{ range .Labels.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}
Annotations:
{{ range .Annotations.SortedPairs }} - {{ .Name }} = {{ .Value }}
{{ end }}
{{ if gt (len .GeneratorURL) 0 }}Source: [{{ .GeneratorURL }}]({{ .GeneratorURL }})

{{ end }}{{ if gt (len .SilenceURL) 0 }}Silence: [{{ .SilenceURL }}]({{ .SilenceURL }})

{{ end }}{{ if gt (len .DashboardURL) 0 }}Dashboard: [{{ .DashboardURL }}]({{ .DashboardURL }})

{{ end }}{{ if gt (len .PanelURL) 0 }}Panel: [{{ .PanelURL }}]({{ .PanelURL }})

{{ end }}
{{ end }}{{ end }}

{{ define "teams.default.message" }}{{ if gt (len .Alerts.Firing) 0 }}**Firing**
{{ template "__teams_text_alert_list" .Alerts.Firing }}{{ if gt (len .Alerts.Resolved) 0 }}

{{ end }}{{ end }}{{ if gt (len .Alerts.Resolved) 0 }}**Resolved**
{{ template "__teams_text_alert_list" .Alerts.Resolved }}{{ end }}{{ end }}`;var n=t(22153),b=t(49962);const E="/api/alertmanager/grafana/config/api/v1/templates/test",i=b.Hr.injectEndpoints({endpoints:g=>({previewTemplate:g.mutation({query:({template:d,alerts:P,name:C})=>({url:E,data:{template:d,alerts:P,name:C},method:"POST"})}),getDefaultTemplates:g.query({queryFn:async()=>({data:(0,n.D)(e)})})})}),{usePreviewTemplateMutation:r}=i},41965:(Z,T,t)=>{t.d(T,{D:()=>r});var e=t(74848),n=t(32196),b=t(40845),E=t(60029),i=t(67061);function r({label:d,actions:P}){const C=(0,b.of)(g);return(0,e.jsxs)("div",{className:C.container,children:[(0,e.jsx)(E.J,{className:C.label,children:d}),(0,e.jsx)(i.B,{direction:"row",gap:1,children:P})]})}const g=d=>({container:(0,n.css)({display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",padding:d.spacing(1,2),backgroundColor:d.colors.background.secondary,borderBottom:`1px solid ${d.colors.border.medium}`}),label:(0,n.css)({margin:0})})},33594:(Z,T,t)=>{t.d(T,{By:()=>ft,R_:()=>ve});var e=t(74848),n=t(32196),b=t(13999);function E(s,o){return(0,b.f)(s,-o)}const i=null;var r=t(87836),g=t(2940);function d(s,o){return(0,r.A)(s,o*g.Cg)}const P=null;function C(s,o){return(0,r.A)(s,o*g.s0)}const N=null;function F(s,o){return C(s,-o)}const c=null;var h=t(96540),k=t(49785),de=t(42941),Q=t(70713),le=t(39601),x=t(17172),p=t(40845),z=t(21633),I=t(67061),R=t(55852),J=t(42418),X=t(90613),ce=t(84167),me=t(14186),ue=t(10354),fe=t(87978),ge=t(3169),he=t(40715),oe=t(30681),Te=t(75269),Pe=t(61410),je=t(57220),pe=t(56361),Ne=t(88467),Se=t(48205),be=t(41965),Ae=t(33302),Ie=t(83122),ee=t(38138),Be=t(60782),Me=t(32372),De=t(91793),Ue=t(14578),we=t(56034),We=t(78369),re=t(37390),Fe=t(67647),Ce=t(39558),Ke=t(82843),te=t(75214),Ee=t(70026);function ze({onSelect:s,isOpen:o,onClose:A}){const a=(0,p.of)(Ve),[l,w]=(0,h.useState)(),[v,M]=(0,h.useState)(null),{useGetAlertmanagerAlertsQuery:V}=Ke.m,{currentData:B=[],isFetching:j,isError:H}=V({amSourceName:je.hY,filter:{inhibited:!0,silenced:!0,active:!0}}),[K,G]=(0,h.useState)(""),W=(0,h.useMemo)(()=>{const u={};return!j&&B&&B.forEach(m=>{u[m.labels.alertname]||(u[m.labels.alertname]=[]),u[m.labels.alertname].push(m)}),u},[j,B]),O=(0,h.useCallback)(u=>{w(u),M(null)},[]),S=(0,h.useMemo)(()=>{const u=Object.keys(W).filter(D=>D.toLowerCase().includes(K.toLowerCase())),m={};return u.forEach(D=>{m[D]=W[D]}),m},[W,K]);if(H)return null;const f=Object.keys(S||[]),y=({index:u,style:m})=>{if(!S)return null;const D=f[u],U=D===l;return(0,e.jsxs)("button",{type:"button",title:D,style:m,className:(0,n.cx)(a.rowButton,{[a.rowOdd]:u%2===1,[a.rowSelected]:U}),onClick:()=>O(D),children:[(0,e.jsx)("div",{className:(0,n.cx)(a.ruleTitle,a.rowButtonTitle),children:D}),(0,e.jsx)("div",{className:a.alertFolder,children:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(Ue.I,{name:"folder"})," ",S[D][0].labels.grafana_folder??""]})})]})},Y=(u,m)=>{const U=u.map($=>$.labels).map(te.Dd),q=(0,Ee.Q)(U),L=(0,Ee.$)((0,te.Dd)(m.labels),q);return L.length?(0,te.M4)((0,te.zm)(L)):(0,te.M4)(m.labels)},ne=({index:u,style:m})=>{const D=(0,h.useMemo)(()=>l?W[l]:[],[]),U=D[u],q=v?.includes(U),L=(0,h.useMemo)(()=>Y(D,U),[D,U]),_=()=>{if(q&&v){M(v.filter($=>$!==U));return}M([...v||[],U])};return(0,e.jsx)("button",{type:"button",style:m,className:(0,n.cx)(a.rowButton,a.instanceButton,{[a.rowOdd]:u%2===1,[a.rowSelected]:q}),onClick:_,children:(0,e.jsx)("div",{className:a.rowButtonTitle,title:U.labels.alertname,children:(0,e.jsx)(we.m,{placement:"bottom",content:(0,e.jsx)("pre",{children:JSON.stringify(U,null,2)}),theme:"info",children:(0,e.jsx)("div",{children:L.map(($,xt)=>(0,e.jsx)(We.v,{name:$,className:a.tag},xt))})})})})},ye=()=>{const u=v?.map(m=>({status:"firing",annotations:m.annotations,labels:m.labels,startsAt:m.startsAt,endsAt:m.endsAt,generatorURL:m.generatorURL,fingerprint:m.fingerprint}))||[];s(u),se()},se=()=>{w(void 0),M(null),G(""),ie("")},ae=()=>{se(),A()},ie=u=>{G(u)};return(0,e.jsx)("div",{children:(0,e.jsxs)(re.a,{title:"Select alert instances",className:a.modal,closeOnEscape:!0,isOpen:o,onDismiss:ae,contentClassName:a.modalContent,children:[(0,e.jsxs)("div",{className:a.container,children:[(0,e.jsx)(Fe.Z,{value:K,onChange:ie,title:"Search alert rule",placeholder:"Search alert rule",autoFocus:!0}),(0,e.jsx)("div",{children:l&&"Select one or more instances from the list below"||""}),(0,e.jsxs)("div",{className:a.column,children:[j&&(0,e.jsx)(Ce._,{text:"Loading rules...",className:a.loadingPlaceholder}),!j&&(0,e.jsx)(Q.Ay,{children:({height:u,width:m})=>(0,e.jsx)(De.Y1,{itemSize:50,height:u,width:m,itemCount:f.length,children:y})})]}),(0,e.jsxs)("div",{className:a.column,children:[!l&&!j&&(0,e.jsx)("div",{className:a.selectedRulePlaceholder,children:(0,e.jsx)("div",{children:"Select an alert rule to get a list of available firing instances"})}),j&&(0,e.jsx)(Ce._,{text:"Loading rule...",className:a.loadingPlaceholder}),l&&W[l].length&&!j&&(0,e.jsx)(Q.Ay,{children:({width:u,height:m})=>(0,e.jsx)(De.Y1,{itemSize:32,height:m,width:u,itemCount:W[l].length||0,children:ne})})]})]}),(0,e.jsxs)(re.a.ButtonRow,{children:[(0,e.jsx)(R.$n,{type:"button",variant:"secondary",onClick:ae,children:"Cancel"}),(0,e.jsx)(R.$n,{type:"button",variant:"primary",disabled:!(l&&v),onClick:()=>{l&&v&&ye()},children:"Add alert data to payload"})]})]})})}const Ve=s=>{const o=(0,R.my)(s);return{container:(0,n.css)({display:"grid",gridTemplateColumns:"1fr 1.5fr",gridTemplateRows:"min-content auto",gap:s.spacing(2),flex:1}),tag:(0,n.css)({margin:"5px"}),column:(0,n.css)({flex:"1 1 auto"}),alertLabels:(0,n.css)({overflowX:"auto",height:"32px"}),ruleTitle:(0,n.css)({height:"22px",fontWeight:s.typography.fontWeightBold}),rowButton:(0,n.css)(o,{padding:s.spacing(.5),overflow:"hidden",textOverflow:"ellipsis",textAlign:"left",whiteSpace:"nowrap",cursor:"pointer",border:"2px solid transparent","&:disabled":{cursor:"not-allowed",color:s.colors.text.disabled}}),rowButtonTitle:(0,n.css)({overflowX:"auto"}),rowSelected:(0,n.css)({borderColor:s.colors.primary.border}),rowOdd:(0,n.css)({backgroundColor:s.colors.background.secondary}),instanceButton:(0,n.css)({display:"flex",gap:s.spacing(1),justifyContent:"space-between",alignItems:"center"}),loadingPlaceholder:(0,n.css)({height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),selectedRulePlaceholder:(0,n.css)({width:"100%",height:"100%",display:"flex",flexDirection:"column",justifyContent:"center",textAlign:"center",fontWeight:s.typography.fontWeightBold}),modal:(0,n.css)({height:"100%"}),modalContent:(0,n.css)({flex:1,display:"flex",flexDirection:"column"}),modalAlert:(0,n.css)({flexGrow:0}),warnIcon:(0,n.css)({fill:s.colors.warning.main}),labels:(0,n.css)({justifyContent:"flex-start"}),alertFolder:(0,n.css)({height:"20px",fontSize:s.typography.bodySmall.fontSize,color:s.colors.text.secondary,display:"flex",flexDirection:"row",justifyContent:"flex-start",columnGap:s.spacing(1),alignItems:"center"})}},Ge=[{name:"Receiver",type:"string",notes:"Name of the contact point that the notification is being sent to."},{name:"Status",type:"string",notes:"firing if at least one alert is firing, otherwise resolved"},{name:"Alerts",type:"[]Alert",notes:"List of alert objects that are included in this notification."},{name:"Alerts.Firing",type:"[]Alert",notes:"List of firing alerts"},{name:"Alerts.Resolved",type:"[]Alert",notes:"List of resolved alerts"},{name:"GroupLabels",type:"KeyValue",notes:"Labels these alerts were grouped by."},{name:"CommonLabels",type:"KeyValue",notes:"Labels common to all the alerts included in this notification."},{name:"CommonAnnotations",type:"KeyValue",notes:"Annotations common to all the alerts included in this notification."},{name:"ExternalURL",type:"string",notes:"Back link to the Grafana that sent the notification."}],$e=[{name:"labels",type:"Object{}",notes:"Set of labels attached to the alert."},{name:"annotations",type:"Object{}",notes:"Set of annotations attached to the alert."},{name:"startsAt",type:"string (ISO8601)",notes:"Time the alert started firing."},{name:"endsAt",type:"string (ISO8601)",notes:"Time the alert ends firing."}],Je=[{name:"Status",type:"string",notes:"firing or resolved."},{name:"Labels",type:"KeyValue",notes:"Set of labels attached to the alert."},{name:"Annotations",type:"KeyValue",notes:"Set of annotations attached to the alert."},{name:"Values",type:"KeyValue",notes:"The values of all instant queries, reduce and math expressions, and classic conditions for the alert. It does not contain time series data."},{name:"StartsAt",type:"time.Time",notes:"Time the alert started firing."},{name:"EndsAt",type:"time.Time",notes:"Only set if the end time of an alert is known. Otherwise set to a configurable timeout period from the time since the last alert was received."},{name:"GeneratorURL",type:"string",notes:"A back link to Grafana or external Alertmanager."},{name:"SilenceURL",type:"string",notes:"Link to Grafana silence for with labels for this alert pre-filled. Only for Grafana managed alerts."},{name:"DashboardURL",type:"string",notes:"Link to Grafana dashboard, if alert rule belongs to one. Only for Grafana managed alerts."},{name:"PanelURL",type:"string",notes:"Link to Grafana dashboard panel, if alert rule belongs to one. Only for Grafana managed alerts."},{name:"Fingerprint",type:"string",notes:"Fingerprint that can be used to identify the alert."},{name:"ValueString",type:"string",notes:"String that contains the labels and value of each reduced expression in the alert."}],He=[{name:"SortedPairs",returns:"KeyValue",notes:"Returns sorted list of key & value string pairs"},{name:"Remove",args:"[]string",returns:"KeyValue",notes:"Returns a copy of the Key/Value map without the given keys."},{name:"Names",returns:"[]string",notes:"List of label names"},{name:"Values",returns:"[]string",notes:"List of label values"}],Ye=`{
  "summary": "alert summary",
  "description": "alert description"
}
`;var Re=t(35108);function Ze(){const s=(0,p.of)(Qe),o=(0,e.jsx)(xe,{caption:(0,e.jsxs)("h4",{className:s.header,children:["Alert template data ",(0,e.jsx)("span",{children:"Available only when in the context of an Alert (e.g. inside .Alerts loop)"})]}),dataItems:Je});return(0,e.jsx)(I.B,{gap:2,children:(0,e.jsx)(xe,{caption:(0,e.jsx)("h4",{className:s.header,children:"Template Data"}),dataItems:Ge,typeRenderer:A=>A==="[]Alert"?(0,e.jsx)(Re.j,{content:o,children:(0,e.jsx)("div",{className:s.interactiveType,children:A})}):A==="KeyValue"?(0,e.jsx)(Re.j,{content:(0,e.jsx)(Xe,{}),children:(0,e.jsx)("div",{className:s.interactiveType,children:A})}):A})})}const Qe=s=>({header:(0,n.css)({color:s.colors.text.primary,span:{color:s.colors.text.secondary,fontSize:s.typography.bodySmall.fontSize}}),interactiveType:(0,n.css)({color:s.colors.text.link})});function xe({dataItems:s,caption:o,typeRenderer:A}){const a=(0,p.of)(Oe);return(0,e.jsxs)("table",{className:a.table,children:[o&&(0,e.jsx)("caption",{children:o}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Name"}),(0,e.jsx)("th",{children:"Type"}),(0,e.jsx)("th",{children:"Notes"})]})}),(0,e.jsx)("tbody",{children:s.map(({name:l,type:w,notes:v},M)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:l}),(0,e.jsx)("td",{children:A?A(w):w}),(0,e.jsx)("td",{children:v})]},M))})]})}function Xe(){const s=(0,p.of)(Oe);return(0,e.jsxs)("div",{children:["KeyValue is a set of key/value string pairs that represent labels and annotations.",(0,e.jsx)("pre",{children:(0,e.jsx)("code",{children:Ye})}),(0,e.jsxs)("table",{className:s.table,children:[(0,e.jsx)("caption",{children:"Key-value methods"}),(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Name"}),(0,e.jsx)("th",{children:"Arguments"}),(0,e.jsx)("th",{children:"Returns"}),(0,e.jsx)("th",{children:"Notes"})]})}),(0,e.jsx)("tbody",{children:He.map(({name:o,args:A,returns:a,notes:l})=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:o}),(0,e.jsx)("td",{children:A}),(0,e.jsx)("td",{children:a}),(0,e.jsx)("td",{children:l})]},o))})]})]})}const Oe=s=>({table:(0,n.css)({borderCollapse:"collapse",width:"100%",caption:{captionSide:"top"},"td, th":{padding:s.spacing(1,1)},thead:{fontWeight:s.typography.fontWeightBold},"tbody tr:nth-child(2n + 1)":{backgroundColor:s.colors.background.secondary},"tbody td:nth-child(1)":{fontWeight:s.typography.fontWeightBold},"tbody td:nth-child(2)":{fontStyle:"italic"}})});var ke=t(2543),qe=t(10860),_e=t(94354),et=t(31099),tt=t(97171);const nt={annotations:[{key:"",value:""}],labels:[{key:"",value:""}],status:"firing"},st=({isOpen:s,onDismiss:o,onAccept:A})=>{const a=(0,p.of)(at),[l,w]=(0,h.useState)([]),v=(0,k.mN)({defaultValues:nt,mode:"onBlur"}),M=v.watch("annotations"),V=v.watch("labels"),[B,j]=(0,h.useState)("firing"),H=()=>{const O={annotations:M.filter(({key:S,value:f})=>!!S&&!!f).reduce((S,{key:f,value:y})=>({...S,[f]:y}),{}),labels:V.filter(({key:S,value:f})=>!!S&&!!f).reduce((S,{key:f,value:y})=>({...S,[f]:y}),{}),startsAt:"2023-04-01T00:00:00Z",endsAt:B==="firing"?(0,b.f)(new Date,1).toISOString():E(new Date,1).toISOString(),status:B,fingerprint:(0,ke.uniqueId)("fingerprint_")};w(S=>[...S,O]),v.reset()},K=()=>{A(l),w([]),v.reset(),j("firing")},G=()=>{const O=V.some(f=>f.key!==""&&f.value!==""),S=M.some(f=>f.key!==""&&f.value!=="");return O||S},W=[{label:"Firing",value:"firing"},{label:"Resolved",value:"resolved"}];return(0,e.jsx)(re.a,{onDismiss:o,isOpen:s,title:"Add custom alerts",children:(0,e.jsx)(k.Op,{...v,children:(0,e.jsxs)("form",{onSubmit:O=>{O.preventDefault(),O.stopPropagation(),v.reset(),j("firing")},children:[(0,e.jsx)(e.Fragment,{children:(0,e.jsx)(qe.Z,{children:(0,e.jsxs)(I.B,{direction:"column",gap:1,children:[(0,e.jsx)("div",{className:a.section,children:(0,e.jsx)(et.A,{})}),(0,e.jsx)("div",{className:a.section,children:(0,e.jsx)(tt.Ay,{})}),(0,e.jsxs)("div",{className:a.flexWrapper,children:[(0,e.jsx)(_e.z,{value:B,options:W,onChange:O=>j(O)}),(0,e.jsx)(R.$n,{onClick:H,className:a.onAddButton,icon:"plus-circle",type:"button",variant:"secondary",disabled:!G(),children:"Add alert data"})]})]})})}),(0,e.jsx)("div",{className:a.onSubmitWrapper}),l.length>0&&(0,e.jsxs)(I.B,{direction:"column",gap:1,children:[(0,e.jsx)("h5",{children:" Review alert data to add to the payload:"}),(0,e.jsx)("pre",{className:a.result,"data-testid":"payloadJSON",children:JSON.stringify(l,null,2)})]}),(0,e.jsx)("div",{className:a.onSubmitWrapper,children:(0,e.jsx)(re.a.ButtonRow,{children:(0,e.jsx)(R.$n,{onClick:K,disabled:l.length===0,className:a.onSubmitButton,children:"Add alert data to payload"})})})]})})})},at=s=>({section:(0,n.css)({marginBottom:s.spacing(2)}),onAddButton:(0,n.css)({flex:"none",width:"fit-content",paddingRight:s.spacing(1),marginLeft:"auto"}),flexWrapper:(0,n.css)({display:"flex",flexDirection:"row",justifyContent:"space-between"}),onSubmitWrapper:(0,n.css)({display:"flex",flexDirection:"row",alignItems:"baseline",justifyContent:"flex-end"}),onSubmitButton:(0,n.css)({marginLeft:s.spacing(2)}),result:(0,n.css)({width:"570px",height:"363px"})}),lt="Reset to defaults";function ot({payload:s,setPayload:o,defaultPayload:A,setPayloadFormatError:a,payloadFormatError:l,className:w}){const v=(0,p.of)(it),M=()=>{o(A)},[V,B]=(0,h.useState)(!1),j=()=>{B(!1)},H=l!==null,K=()=>{try{const y=JSON.parse(s);JSON.stringify([...y]),a(null)}catch(y){throw a(y instanceof Error?y.message:"Invalid JSON."),y}},G=()=>{try{K(),B(!0)}catch{}},W=()=>{try{K(),f(!0)}catch{}},O=y=>{j(),f(!1),o(Y=>{const ne=JSON.parse(Y);return JSON.stringify([...ne,...y],void 0,2)})},[S,f]=(0,h.useState)(!1);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:(0,n.cx)(v.wrapper,w),children:[(0,e.jsx)(be.D,{label:"Payload",actions:(0,e.jsxs)(I.B,{direction:"row",alignItems:"center",gap:.5,children:[(0,e.jsx)(Ie.m,{overlay:(0,e.jsxs)(ee.W,{children:[(0,e.jsx)(ee.W.Item,{label:"Use existing alert instances",disabled:H,onClick:W}),(0,e.jsx)(ee.W.Item,{label:"Add custom alert instance",disabled:H,onClick:G}),(0,e.jsx)(ee.W.Divider,{}),(0,e.jsx)(ee.W.Item,{label:lt,onClick:M,destructive:!0})]}),children:(0,e.jsx)(R.$n,{variant:"secondary",size:"sm",icon:"angle-down",children:"Edit payload"})}),(0,e.jsx)(Be.G,{content:(0,e.jsx)(rt,{}),placement:"top",fitContent:!0,children:(0,e.jsx)(R.$n,{variant:"secondary",fill:"outline",size:"sm",icon:"question-circle",children:"Help"})})]})}),(0,e.jsx)("div",{className:v.editorWrapper,children:(0,e.jsx)(Q.Ay,{children:({width:y,height:Y})=>(0,e.jsx)(Me.B,{containerStyles:v.editorContainer,width:y,height:Y,language:"json",showLineNumbers:!0,showMiniMap:!1,value:s,readOnly:!1,onBlur:o,monacoOptions:{scrollBeyondLastLine:!1}})})})]}),(0,e.jsx)(st,{isOpen:V,onDismiss:j,onAccept:O}),(0,e.jsx)(ze,{onSelect:O,isOpen:S,onClose:()=>f(!1)})]})}const rt=()=>(0,e.jsx)(xe,{dataItems:$e}),it=s=>({wrapper:(0,n.css)({display:"flex",flexDirection:"column",height:"100%"}),tooltip:(0,n.css)({paddingLeft:s.spacing(1)}),label:(0,n.css)({margin:0}),editorWrapper:(0,n.css)({flex:1}),editorContainer:(0,n.css)({width:"fit-content",border:"none"}),templateDataDocsHeader:(0,n.css)({color:s.colors.text.primary,span:{color:s.colors.text.secondary,fontSize:s.typography.bodySmall.fontSize}})});var dt=t(96615),ct=t(78253),mt=t(57954);const ut=Object.freeze({name:"",content:""}),vt=s=>s.pathname.endsWith("/duplicate"),ft=({existing:s,alertManagerSourceName:o,config:A,provenance:a})=>{const l=(0,p.of)(Le),w=(0,ge._2)(),v=(0,Ae.xW)({alertmanager:o}),M=(0,Ae.A1)({alertmanager:o});(0,he.o)(L=>L.unifiedAlerting.saveAMConfig=Ne.jA);const V=(0,h.useRef)(null),B=o===je.hY,{error:j}=(0,Pe.$)(L=>L.saveAMConfig),[H,K]=(0,de.A)(!1),[G,W]=(0,h.useState)(ve),[O,S]=(0,h.useState)(null),f=(0,z.h)({direction:"column",initialSize:B?.5:1,dragPosition:"middle"}),y=(0,z.h)({direction:"row",initialSize:B?.6:1,dragPosition:"middle"}),Y=(0,k.mN)({mode:"onSubmit",defaultValues:s??ut}),{handleSubmit:ne,register:ye,formState:{errors:se,isSubmitting:ae},getValues:ie,setValue:u,watch:m}=Y,D=async L=>{const _=(0,pe.nL)("/alerting/notifications",o,{tab:oe.ActiveTab.NotificationTemplates});try{s?await M({originalName:s.name,template:L}):await v({template:L}),le.Ny.push(_)}catch($){w.error("Error saving template",(0,pe.JZ)($))}},U=L=>!A.template_files[L]||s?.name===L?!0:"Another template with this name already exists.",q=(0,e.jsxs)(I.B,{children:[(0,e.jsx)(R.$n,{onClick:()=>V.current?.requestSubmit(),variant:"primary",size:"sm",disabled:ae,children:"Save"}),(0,e.jsx)(R.z9,{disabled:ae,href:(0,pe.nL)("alerting/notifications",o,{tab:oe.ActiveTab.NotificationTemplates}),variant:"secondary",size:"sm",children:"Cancel"})]});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(k.Op,{...Y,children:[(0,e.jsx)(Te.H,{actions:q}),(0,e.jsxs)("form",{onSubmit:ne(D),ref:V,className:l.form,children:[j&&(0,e.jsx)(J.F,{severity:"error",title:"Error saving template",children:j.message||(0,x.NF)(j)&&j.data?.message||String(j)}),a&&(0,e.jsx)(X.a,{grow:0,children:(0,e.jsx)(Se.Yi,{resource:Se.hk.Template})}),(0,e.jsxs)(ce.n,{disabled:!!a,className:l.fieldset,children:[(0,e.jsx)(me.I,{label:"Template name",error:se?.name?.message,invalid:!!se.name?.message,required:!0,className:l.nameField,children:(0,e.jsx)(ue.p,{...ye("name",{required:{value:!0,message:"Required."},validate:{nameIsUnique:U}}),placeholder:"Give your template a name",width:42,autoFocus:!0,id:"new-template-name"})}),(0,e.jsxs)("div",{...y.containerProps,className:l.contentContainer,children:[(0,e.jsx)("div",{...y.primaryProps,children:(0,e.jsxs)("div",{...f.containerProps,className:l.contentField,children:[(0,e.jsx)("div",{...f.primaryProps,children:(0,e.jsxs)("div",{className:(0,n.cx)(l.flexColumn,l.containerWithBorderAndRadius,l.minEditorSize),children:[(0,e.jsx)(be.D,{label:"Template",actions:(0,e.jsx)(R.$n,{icon:"question-circle",size:"sm",fill:"outline",variant:"secondary",onClick:K,children:"Help"})}),(0,e.jsx)(X.a,{flex:1,children:(0,e.jsx)(Q.Ay,{children:({width:L,height:_})=>(0,e.jsx)(dt.K,{value:ie("content"),onBlur:$=>u("content",$),containerStyles:l.editorContainer,width:L,height:_})})})]})}),B&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)("div",{...f.splitterProps}),(0,e.jsx)("div",{...f.secondaryProps,children:(0,e.jsx)("div",{className:(0,n.cx)(l.containerWithBorderAndRadius,l.minEditorSize,l.payloadEditor,l.flexFull),children:(0,e.jsx)(ot,{payload:G,defaultPayload:ve,setPayload:W,setPayloadFormatError:S,payloadFormatError:O})})})]})]})}),B&&(0,e.jsx)(e.Fragment,{children:(0,e.jsxs)("div",{...y.secondaryProps,children:[(0,e.jsx)("div",{...y.splitterProps}),(0,e.jsx)(ct.p,{payload:G,templateName:m("name"),setPayloadFormatError:S,payloadFormatError:O,className:(0,n.cx)(l.templatePreview,l.minEditorSize)})]})})]})]})]})]}),H&&(0,e.jsx)(fe._,{title:"Templating cheat sheet",onClose:K,size:"lg",children:(0,e.jsx)(ht,{})})]})};function gt(){const s=(0,p.of)(Le);return(0,e.jsxs)(J.F,{title:"How to",severity:"info",children:[(0,e.jsxs)(I.B,{direction:"row",children:[(0,e.jsxs)("div",{children:["Grafana uses Go templating language to create notification messages.",(0,e.jsx)("br",{}),"To find out more about templating please visit our documentation."]}),(0,e.jsx)("div",{children:(0,e.jsx)(R.z9,{href:"https://grafana.com/docs/grafana/latest/alerting/manage-notifications/template-notifications/",target:"_blank",icon:"external-link-alt",variant:"secondary",children:"Templating documentation"})})]}),(0,e.jsxs)("div",{className:s.snippets,children:["For auto-completion of common templating code, type the following keywords in the content editor:",(0,e.jsx)("div",{className:s.code,children:Object.values(mt.L).map(o=>o.label).join(", ")})]})]})}function ht(){return(0,e.jsxs)(I.B,{direction:"column",gap:1,children:[(0,e.jsx)(gt,{}),(0,e.jsx)(Ze,{})]})}const Le=s=>{const o=s.breakpoints.down("md");return{flexFull:(0,n.css)({flex:1}),minEditorSize:(0,n.css)({minHeight:300,minWidth:300}),payloadEditor:(0,n.css)({minHeight:0}),containerWithBorderAndRadius:(0,n.css)({borderRadius:s.shape.radius.default,border:`1px solid ${s.colors.border.medium}`}),flexColumn:(0,n.css)({display:"flex",flex:1,flexDirection:"column"}),form:(0,n.css)({label:"template-form",height:"100%",display:"flex",flexDirection:"column"}),fieldset:(0,n.css)({label:"template-fieldset",flex:1,display:"flex",flexDirection:"column"}),label:(0,n.css)({margin:0}),nameField:(0,n.css)({marginBottom:s.spacing(1)}),contentContainer:(0,n.css)({flex:1,display:"flex",flexDirection:"row"}),contentField:(0,n.css)({display:"flex",flexDirection:"column",flex:1,marginBottom:0}),templatePreview:(0,n.css)({flex:1,display:"flex"}),templatePayload:(0,n.css)({flex:1}),editorContainer:(0,n.css)({width:"fit-content",border:"none"}),payloadCollapseButton:(0,n.css)({backgroundColor:s.colors.info.transparent,margin:0,[o]:{display:"none"}}),snippets:(0,n.css)({marginTop:s.spacing(2),fontSize:s.typography.bodySmall.fontSize}),code:(0,n.css)({color:s.colors.text.secondary,fontWeight:s.typography.fontWeightBold})}},pt=[{status:"firing",annotations:{summary:"Instance instance1 has been down for more than 5 minutes"},labels:{alertname:"InstanceDown",instance:"instance1"},startsAt:E(new Date,1).toISOString(),endsAt:d(new Date,5).toISOString(),fingerprint:"a5331f0d5a9d81d4",generatorURL:"http://grafana.com/alerting/grafana/cdeqmlhvflz40f/view"},{status:"resolved",annotations:{summary:"CPU usage above 90%"},labels:{alertname:"CpuUsage",instance:"instance1"},startsAt:F(new Date,4).toISOString(),endsAt:new Date().toISOString(),fingerprint:"b77d941310f9d381",generatorURL:"http://grafana.com/alerting/grafana/oZSMdGj7z/view"}],ve=JSON.stringify(pt,null,2)},78253:(Z,T,t)=>{t.d(T,{P:()=>le,p:()=>h});var e=t(74848),n=t(32196),b=t(2543),E=t.n(b),i=t(49785),r=t(70713),g=t(40845),d=t(55852),P=t(90613),C=t(42418),N=t(56361),F=t(41965),c=t(10506);function h({payload:x,templateName:p,payloadFormatError:z,setPayloadFormatError:I,className:R}){const J=(0,g.of)(Q),{watch:X}=(0,i.xW)(),ce=X("content"),{data:me,isLoading:ue,onPreview:fe,error:ge}=(0,c.g)(ce,p,x,I),he=le(ge,z,me);return(0,e.jsxs)("div",{className:(0,n.cx)(J.container,R),children:[(0,e.jsx)(F.D,{label:"Preview",actions:(0,e.jsx)(d.$n,{disabled:ue,icon:"sync","aria-label":"Refresh preview",onClick:fe,size:"sm",variant:"secondary",children:"Refresh"})}),(0,e.jsx)(P.a,{flex:1,children:(0,e.jsx)(r.Ay,{disableWidth:!0,children:({height:oe})=>(0,e.jsx)("div",{className:J.viewerContainer({height:oe}),children:he})})})]})}function k({previews:x}){const p=(0,g.of)(Q),z=x.length===1;return(0,e.jsx)("ul",{className:p.viewer.container,children:x.map(I=>(0,e.jsxs)("li",{className:p.viewer.box,children:[z?null:(0,e.jsx)("header",{className:p.viewer.header,children:I.name}),(0,e.jsx)("pre",{className:p.viewer.pre,children:I.text??"<Empty>"})]},I.name))})}function de({errors:x}){return x.map(p=>(0,e.jsx)(C.F,{title:(0,b.compact)([p.name,p.kind]).join(" \u2013 "),children:p.message},(0,b.uniqueId)("errors-list")))}const Q=x=>({container:(0,n.css)({label:"template-preview-container",display:"flex",flexDirection:"column",borderRadius:x.shape.radius.default,border:`1px solid ${x.colors.border.medium}`}),viewerContainer:({height:p})=>(0,n.css)({height:p,overflow:"auto",backgroundColor:x.colors.background.primary}),viewer:{container:(0,n.css)({display:"flex",flexDirection:"column",height:"inherit"}),box:(0,n.css)({display:"flex",flexDirection:"column",borderBottom:`1px solid ${x.colors.border.medium}`,height:"inherit"}),header:(0,n.css)({fontSize:x.typography.bodySmall.fontSize,padding:x.spacing(1,2),borderBottom:`1px solid ${x.colors.border.medium}`,backgroundColor:x.colors.background.secondary}),errorText:(0,n.css)({color:x.colors.error.text}),pre:(0,n.css)({backgroundColor:"transparent",margin:0,border:"none",padding:x.spacing(2)})}});function le(x,p,z){const I=x?(0,N.JZ)(x):void 0,R=p||I,J=z?.results??[],X=z?.errors;return(0,e.jsxs)(e.Fragment,{children:[R&&(0,e.jsx)(C.F,{severity:"error",title:"Error",children:R}),X&&(0,e.jsx)(de,{errors:X}),J&&(0,e.jsx)(k,{previews:J})]})}},22153:(Z,T,t)=>{t.d(T,{D:()=>e,G7:()=>E,Jl:()=>n,gY:()=>b});function e(i){const r={},g=[],d=/{{(-?\s*)(define|end|if|range|else|with|template)(\s*.*?)?(-?\s*)}}/gs;let P,C=0;for(;(P=d.exec(i))!==null;){const[,,N,F]=P;if(C=P.index,N==="define"){const c=F?.match(/"([^"]+)"/);c&&g.push({type:"define",startIndex:C,name:c[1]})}else if(N==="end"){let c=g.pop();for(;c&&c.type!=="define"&&c.type!=="if"&&c.type!=="range"&&c.type!=="with";)c=g.pop();if(c){const h=d.lastIndex;c.type==="define"&&!c.name?.startsWith("__")&&(r[c.name]={name:c.name,content:i.slice(c.startIndex,h)})}}else(N==="if"||N==="range"||N==="else"||N==="with")&&g.push({type:N,startIndex:C})}for(const N of Object.values(r)){const F=/{{ template "([^"]+)" }}/g;let c;for(;(c=F.exec(N.content))!==null;){const h=c[1];r[h]?.content&&(N.content+=`
`+r[h]?.content,delete r[h])}}return Object.values(r)}function n(i){return`{{ template "${i}" . }}`}function b(i){const r=i.match(/\{\{\s*template\s*"(.*)"\s*\.\s*\}\}/);return r?r[1]:""}function E(i){const r=/\{\{\s*template\s*".*?"\s*\.\s*\}\}/g;if(i.match(r)?.length!==1)return!1;const d=i.split(r);for(const P of d)if(P.trim()!=="")return!1;return!0}},10506:(Z,T,t)=>{t.d(T,{g:()=>b});var e=t(96540),n=t(87965);function b(E,i,r,g){const[d,{data:P,error:C,isLoading:N}]=(0,n.vj)(),F=(0,e.useCallback)(()=>{try{const c=JSON.parse(r);JSON.stringify([...c]),d({template:E,alerts:c,name:i}),g(null)}catch(c){g(c instanceof Error?c.message:"Invalid JSON.")}},[E,i,r,g,d]);return(0,e.useEffect)(()=>F(),[F]),{data:P,error:C,isLoading:N,onPreview:F}}},70026:(Z,T,t)=>{t.d(T,{$:()=>b,Q:()=>E});var e=t(2543),n=t.n(e);function b(i,r){return i.filter(g=>!r.find(d=>JSON.stringify(d)===JSON.stringify(g)))}function E(i){const r=i.flatMap(d=>d);return(0,e.uniqBy)(r.filter(d=>r.filter(C=>(0,e.isEqual)(d,C)).length===Object.keys(i).length),d=>JSON.stringify(d))}},51488:(Z,T,t)=>{t.d(T,{f:()=>n});var e=t(82843);function n(b,E){const i=e.m.endpoints.getAlertmanagerConfiguration.useQuery(b??"",{refetchOnMountOrArgChange:!0,...E,skip:!b});return{...i,error:i.error}}}}]);

//# sourceMappingURL=5639.09bb81a2f76cc9b8b0cd.js.map