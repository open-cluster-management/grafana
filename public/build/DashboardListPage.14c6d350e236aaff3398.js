"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[152],{2471:(oe,N,t)=>{t.r(N),t.d(N,{default:()=>ft});var e=t(74848),c=t(32196),n=t(96540),x=t(24180),R=t(70713),f=t(14110),l=t(40845),E=t(67647),M=t(69444),S=t(31678),C=t(71101),P=t(39788),d=t(8484);function b(s=!1){return s?(0,d.t)("search.search-input.include-panels-placeholder","Search for dashboards, folders, and panels"):(0,d.t)("search.search-input.placeholder","Search for dashboards and folders")}function _(){return(0,d.t)("search.dashboard-actions.new-dashboard","New dashboard")}function T(){return(0,d.t)("search.dashboard-actions.new-folder","New folder")}function h(){return(0,d.t)("search.dashboard-actions.import","Import")}function I(){return(0,d.t)("search.dashboard-actions.new","New")}var a=t(55314),m=t(32264),v=t(55852),U=t(67061),F=t(56034),G=t(28138),J=t(28444),j=t(37690),X=t(18241),ne=t(51887);function ee(){const s=(0,S.useDispatch)(),o=(0,j.xK)(),[g]=(0,a.uz)(),[i]=(0,a.wt)(),[,r]=(0,P.ET)(),u=(0,n.useMemo)(()=>!m.$.featureToggles.nestedFolders&&Object.values(o.folder).some(z=>z),[o]),y=r.hasSearchFilters(),O=()=>{s((0,j.cT)({isSelected:!1,folderUID:void 0})),y&&r.doSearchWithDebounce()},p=async()=>{await g({selectedItems:o}),B("delete",o),O()},D=async z=>{await i({selectedItems:o,destinationUID:z}),B("move",o),O()},$=()=>{G.A.publish(new J.S8({component:ne.J,props:{selectedItems:o,onConfirm:D}}))},K=()=>{G.A.publish(new J.S8({component:X.T,props:{selectedItems:o,onConfirm:p}}))},V=(0,e.jsx)(v.$n,{onClick:$,variant:"secondary",disabled:u,children:(0,e.jsx)(d.x6,{i18nKey:"browse-dashboards.action.move-button",children:"Move"})});return(0,e.jsxs)(U.B,{gap:1,"data-testid":"manage-actions",children:[u?(0,e.jsx)(F.m,{content:(0,d.t)("browse-dashboards.action.cannot-move-folders","Folders cannot be moved"),children:V}):V,(0,e.jsx)(v.$n,{onClick:K,variant:"destructive",children:(0,e.jsx)(d.x6,{i18nKey:"browse-dashboards.action.delete-button",children:"Delete"})})]})}const te={move:"grafana_manage_dashboards_item_moved",delete:"grafana_manage_dashboards_item_deleted"};function B(s,o){const g=Object.keys(o.dashboard).filter(r=>o.dashboard[r]),i=Object.keys(o.folder).filter(r=>o.folder[r]);(0,f.rR)(te[s],{item_counts:{folder:i.length,dashboard:g.length},source:"tree_actions",restore_enabled:m.$.featureToggles.dashboardRestoreUI})}var H=t(19519),se=t(24439);function he(){const[s,o]=(0,P.ET)();return(0,e.jsx)(H.bj,{showStarredFilter:!0,showLayout:!0,state:s,getTagOptions:o.getTagOptions,getSortOptions:(0,se.getGrafanaSearcher)().getSortOptions,sortPlaceholder:(0,se.getGrafanaSearcher)().sortPlaceholder,onLayoutChange:o.onLayoutChange,onStarredFilterChange:o.onStarredFilterChange,onSortChange:o.onSortChange,onTagFilterChange:o.onTagFilterChange,onDatasourceChange:o.onDatasourceChange,onPanelTypeChange:o.onPanelTypeChange,onSetIncludePanels:o.onSetIncludePanels})}var ue=t(69529),ge=t(72109),me=t(76442),fe=t(92955),w=(s=>(s[s.Unselected=0]="Unselected",s[s.Selected=1]="Selected",s[s.Mixed=2]="Mixed",s))(w||{}),ve=t(32885),ae=t(91793),Ee=t(10022),Fe=t(39070),le=t(13544),Pe=t(10880),De=t(49952);function We({row:{original:s},isSelected:o,onItemSelectionChange:g}){const i=s.item;if(!o)return(0,e.jsx)(Ce,{});if(i.kind==="ui")return i.uiKind==="pagination-placeholder"?(0,e.jsx)(Pe.S,{disabled:!0,value:!1}):(0,e.jsx)(Ce,{});if((0,De.I)(i.uid))return(0,e.jsx)(Ce,{});const r=o(i);return(0,e.jsx)(Pe.S,{"data-testid":le.Tp.pages.BrowseDashboards.table.checkbox(i.uid),"aria-label":(0,d.t)("browse-dashboards.dashboards-tree.select-checkbox","Select"),value:r===w.Selected,indeterminate:r===w.Mixed,onChange:u=>g?.(i,u.currentTarget.checked)})}function Ce(){const s=(0,l.of)(Ne);return(0,e.jsx)("span",{className:s.checkboxSpacer})}const Ne=s=>({checkboxSpacer:(0,c.css)({paddingLeft:s.spacing(2)})});function we({isSelected:s,onAllSelectionChange:o}){const g=s?.("$all")??w.Unselected;return(0,e.jsx)(Pe.S,{value:g===w.Selected,indeterminate:g===w.Mixed,"aria-label":(0,d.t)("browse-dashboards.dashboards-tree.select-all-header-checkbox","Select all"),onChange:i=>{g===w.Mixed?o?.(!1):o?.(i.currentTarget.checked)}})}var $e=t(70255),Oe=t(94753),Ve=t(29158),ze=t(62930),Te=t(14578),He=t(50720),Ie=t(78318),Qe=t(40957),je=t(18759);const xe="md",Ae="sm";function Ge({row:{original:s},onFolderClick:o,treeID:g}){const i=(0,l.of)(Ye),{item:r,level:u,isOpen:y}=s,O=(0,j.V6)(),p=y&&!O[r.uid],D=(0,Qe.cu)(s.item,y);return r.kind==="ui"?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(je.T,{level:u,spacing:{xs:1,md:3}}),(0,e.jsx)("span",{className:i.folderButtonSpacer}),r.uiKind==="empty-folder"?(0,e.jsx)("em",{className:i.emptyText,children:(0,e.jsx)(Oe.E,{variant:"body",color:"secondary",truncate:!0,children:"No items"})}):(0,e.jsx)($e.A,{width:200})]}):(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(je.T,{level:u,spacing:{xs:1,md:3}}),r.kind==="folder"?(0,e.jsx)(Ve.K,{size:xe,className:i.chevron,onClick:()=>{o(r.uid,!y)},name:y?"angle-down":"angle-right","aria-label":y?(0,d.t)("browse-dashboards.dashboards-tree.collapse-folder-button","Collapse folder {{title}}",{title:r.title}):(0,d.t)("browse-dashboards.dashboards-tree.expand-folder-button","Expand folder {{title}}",{title:r.title})}):(0,e.jsx)("span",{className:i.folderButtonSpacer}),(0,e.jsxs)("div",{className:i.iconNameContainer,children:[p?(0,e.jsx)(ze.y,{size:Ae}):(0,e.jsx)(Te.I,{size:Ae,name:D}),(0,e.jsx)(Oe.E,{variant:"body",truncate:!0,id:g&&(0,De.e)(g,r),children:r.url?(0,e.jsx)(He.N,{onClick:()=>{(0,f.rR)("manage_dashboards_result_clicked")},href:r.url,className:i.link,children:r.title}):r.title})]})]})}const Ye=s=>({chevron:(0,c.css)({marginRight:s.spacing(1),width:(0,Ie.cs)(xe)}),emptyText:(0,c.css)({overflow:"hidden"}),folderButtonSpacer:(0,c.css)({paddingLeft:`calc(${(0,Ie.cs)(xe)}px + ${s.spacing(1)})`}),iconNameContainer:(0,c.css)({alignItems:"center",display:"flex",gap:s.spacing(1),overflow:"hidden"}),link:(0,c.css)({"&:hover":{textDecoration:"underline"}})});var _e=t(64149);function Ze({row:{original:s}}){const o=(0,l.of)(Je),g=s.item;return g.kind==="ui"?g.uiKind==="pagination-placeholder"?(0,e.jsx)(_e.L.Skeleton,{}):null:g.tags?(0,e.jsx)(_e.L,{className:o.tagList,tags:g.tags}):null}function Je(s){return{tagList:(0,c.css)({justifyContent:"flex-start",flexWrap:"nowrap"})}}var Xe=t(37811);const Le=36,Me=36,ke=0;function qe({items:s,width:o,height:g,isSelected:i,onFolderClick:r,onAllSelectionChange:u,onItemSelectionChange:y,isItemLoaded:O,requestLoadMore:p,canSelect:D=!1}){const $=(0,n.useId)(),K=(0,n.useRef)(null),V=(0,n.useRef)(null),z=(0,l.of)(Re);(0,n.useEffect)(()=>{K.current&&K.current.resetloadMoreItemsCache(!0),V.current&&V.current.resetAfterIndex(0)},[s]);const L=(0,n.useMemo)(()=>{const A={id:"checkbox",width:0,Header:we,Cell:We},Q={id:"name",width:3,Header:(0,e.jsx)("span",{style:{paddingLeft:24},children:(0,e.jsx)(d.x6,{i18nKey:"browse-dashboards.dashboards-tree.name-column",children:"Name"})}),Cell:be=>(0,e.jsx)(Ge,{...be,onFolderClick:r})},Z={id:"tags",width:2,Header:(0,d.t)("browse-dashboards.dashboards-tree.tags-column","Tags"),Cell:Ze};return[D&&A,Q,Z].filter(Fe.zz)},[r,D]),W=(0,ve.useTable)({columns:L,data:s},Xe.A),{getTableProps:k,getTableBodyProps:q,headerGroups:re}=W,de=(0,n.useMemo)(()=>({table:W,isSelected:i,onAllSelectionChange:u,onItemSelectionChange:y,treeID:$}),[W,i,u,y,s,$]),ce=(0,n.useCallback)(A=>O(A),[O]),pe=(0,n.useCallback)((A,Q)=>{const{parentUID:Z}=s[A];p(Z)},[p,s]),Y=(0,n.useCallback)(A=>{const Q=s[A];return Q.item.kind==="ui"&&Q.item.uiKind==="divider"?ke:Me},[s]);return(0,e.jsxs)("div",{...k(),role:"table",children:[re.map(A=>{const{key:Q,...Z}=A.getHeaderGroupProps({style:{width:o}});return(0,e.jsx)("div",{...Z,className:(0,c.cx)(z.row,z.headerRow),children:A.headers.map(Se=>{const{key:be,...vt}=Se.getHeaderProps();return(0,e.jsx)("div",{...vt,role:"columnheader",className:z.cell,children:Se.render("Header",{isSelected:i,onAllSelectionChange:u})},be)})},Q)}),(0,e.jsx)("div",{...q(),"data-testid":le.Tp.pages.BrowseDashboards.table.body,children:(0,e.jsx)(Ee.A,{ref:K,itemCount:s.length,isItemLoaded:ce,loadMoreItems:pe,children:({onItemsRendered:A,ref:Q})=>(0,e.jsx)(ae._m,{ref:Z=>{Q(Z),V.current=Z},height:g-Le,width:o,itemCount:s.length,itemData:de,estimatedItemSize:Me,itemSize:Y,onItemsRendered:A,children:et})})})]})}function et({index:s,style:o,data:g}){const i=(0,l.of)(Re),{table:r,isSelected:u,onItemSelectionChange:y,treeID:O}=g,{rows:p,prepareRow:D}=r,$=p[s];D($);const K=$.original.item,{key:V,...z}=$.getRowProps({style:o});return K.kind==="ui"&&K.uiKind==="divider"?(0,e.jsx)("div",{...z,children:(0,e.jsx)("hr",{className:i.divider})},V):(0,e.jsx)("div",{...z,className:(0,c.cx)(i.row,i.bodyRow),"aria-labelledby":(0,De.e)(O,K),"data-testid":le.Tp.pages.BrowseDashboards.table.row("title"in K?K.title:K.uid),children:$.cells.map(L=>{const{key:W,...k}=L.getCellProps();return(0,e.jsx)("div",{...k,className:i.cell,children:L.render("Cell",{isSelected:u,onItemSelectionChange:y,treeID:O})},W)})},V)}const Re=s=>({row:(0,c.css)({gap:s.spacing(1)}),divider:(0,c.css)({borderTop:`1px solid ${s.colors.border.weak}`,width:"100%",margin:0}),headerRow:(0,c.css)({backgroundColor:s.colors.background.secondary,height:Le}),bodyRow:(0,c.css)({height:Me,"&:hover":{backgroundColor:s.colors.emphasize(s.colors.background.primary,.03)}}),cell:(0,c.css)({padding:s.spacing(1),overflow:"hidden",display:"flex",alignItems:"center"}),link:(0,c.css)({"&:hover":{textDecoration:"underline"}})});function tt({folderUID:s,width:o,height:g,canSelect:i}){const r=(0,j.eC)(s),u=(0,S.useDispatch)(),y=(0,j.q0)(s),O=(0,j.Ms)(),p=(0,j.V6)(),D=(0,n.useCallback)((L,W)=>{u((0,j.wn)({folderUID:L,isOpen:W})),W&&u((0,j.Ii)({parentUID:L,pageSize:fe.md}))},[u]),$=(0,n.useCallback)((L,W)=>{u((0,j.t$)({item:L,isSelected:W}))},[u]),K=(0,n.useCallback)(L=>{if(L==="$all"){if(O.$all)return w.Selected;for(const q of Object.values(O))if(typeof q!="boolean"){for(const re in q)if(q[re])return w.Mixed}return w.Unselected}return O[L.kind][L.uid]?w.Selected:Be(L,p,O)?w.Mixed:w.Unselected},[O,p]),V=(0,n.useCallback)(L=>{const W=y[L];if(!W)return!1;const k=W.item;return!(k.kind==="ui"&&k.uiKind==="pagination-placeholder")},[y]),z=(0,j.Zg)();return r==="fulfilled"&&y.length===0?(0,e.jsx)("div",{style:{width:o},children:i?(0,e.jsx)(ue.p,{variant:"call-to-action",button:(0,e.jsx)(v.z9,{href:s?`dashboard/new?folderUid=${s}`:"dashboard/new",icon:"plus",size:"lg",children:(0,e.jsx)(d.x6,{i18nKey:"browse-dashboards.empty-state.button-title",children:"Create dashboard"})}),message:s?(0,d.t)("browse-dashboards.empty-state.title-folder","This folder doesn't have any dashboards yet"):(0,d.t)("browse-dashboards.empty-state.title","You haven't created any dashboards yet"),children:s&&(0,e.jsxs)(d.x6,{i18nKey:"browse-dashboards.empty-state.pro-tip",children:["Add/move dashboards to your folder at"," ",(0,e.jsx)(ge.Y,{external:!1,href:"/dashboards",children:"Browse dashboards"})]})}):(0,e.jsx)(me.c,{callToActionElement:(0,e.jsx)("span",{children:"This folder is empty"})})}):(0,e.jsx)(qe,{canSelect:i,items:y,width:o,height:g,isSelected:K,onFolderClick:D,onAllSelectionChange:L=>u((0,j.cT)({isSelected:L,folderUID:s})),onItemSelectionChange:$,isItemLoaded:V,requestLoadMore:z})}function Be(s,o,g){const i=o[s.uid];return i?i.items.some(r=>{const u=g[r.kind][r.uid];return u||Be(r,o,g)}):!1}var st=t(38138),ye=t(64539),at=t(83122),ot=t(87978),nt=t(49785),rt=t(88575),lt=t(10354),it=t(71500);const Ke={folderName:""};function dt({onCancel:s,onConfirm:o}){const{handleSubmit:g,register:i,formState:{errors:r}}=(0,nt.mN)({defaultValues:Ke}),u=(0,d.t)("browse-dashboards.action.new-folder-name-required-phrase","Folder name is required."),y=async p=>{try{return await it.P.validateNewFolderName(p),!0}catch(D){if(D instanceof Error)return D.message;throw D}},O=(0,d.t)("browse-dashboards.new-folder-form.name-label","Folder name");return(0,e.jsxs)("form",{name:"addFolder",onSubmit:g(p=>o(p.folderName)),"data-testid":le.Tp.pages.BrowseDashboards.NewFolderForm.form,children:[(0,e.jsx)(rt.D,{label:O,invalid:!!r.folderName,error:r.folderName&&r.folderName.message,children:(0,e.jsx)(lt.p,{"data-testid":le.Tp.pages.BrowseDashboards.NewFolderForm.nameInput,id:"folder-name-input",defaultValue:Ke.folderName,...i("folderName",{required:u,validate:async p=>await y(p)})})}),(0,e.jsxs)(U.B,{children:[(0,e.jsx)(v.$n,{variant:"secondary",fill:"outline",onClick:s,children:(0,e.jsx)(d.x6,{i18nKey:"browse-dashboards.new-folder-form.cancel-label",children:"Cancel"})}),(0,e.jsx)(v.$n,{type:"submit",children:(0,e.jsx)(d.x6,{i18nKey:"browse-dashboards.new-folder-form.create-label",children:"Create"})})]})]})}function ct({parentFolder:s,canCreateDashboard:o,canCreateFolder:g}){const[i,r]=(0,n.useState)(!1),u=(0,x.zy)(),[y]=(0,a.Vc)(),[O,p]=(0,n.useState)(!1),D=async K=>{try{await y({title:K,parentUid:s?.uid});const V=s?.parents?s.parents.length+1:0;(0,f.rR)("grafana_manage_dashboards_folder_created",{is_subfolder:!!s?.uid,folder_depth:V})}finally{p(!1)}},$=(0,e.jsxs)(st.W,{children:[o&&(0,e.jsx)(ye.D,{label:_(),onClick:()=>(0,f.rR)("grafana_menu_item_clicked",{url:ie("/dashboard/new",s?.uid),from:u.pathname}),url:ie("/dashboard/new",s?.uid)}),g&&(0,e.jsx)(ye.D,{onClick:()=>p(!0),label:T()}),o&&(0,e.jsx)(ye.D,{label:h(),onClick:()=>(0,f.rR)("grafana_menu_item_clicked",{url:ie("/dashboard/import",s?.uid),from:u.pathname}),url:ie("/dashboard/import",s?.uid)})]});return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(at.m,{overlay:$,onVisibleChange:r,children:(0,e.jsxs)(v.$n,{children:[I(),(0,e.jsx)(Te.I,{name:i?"angle-up":"angle-down"})]})}),O&&(0,e.jsx)(ot._,{title:T(),subtitle:s?.title?`Location: ${s.title}`:void 0,onClose:()=>p(!1),size:"sm",children:(0,e.jsx)(dt,{onConfirm:D,onCancel:()=>p(!1)})})]})}function ie(s,o){const g=o?s+"?folderUid="+o:s;return m.$.appSubUrl?m.$.appSubUrl+g:g}var ht=t(9134),ut=t(2960),gt=t(49904);const Ue=(0,n.memo)(({match:s})=>{const{uid:o}=s.params,g=(0,S.useDispatch)(),i=(0,l.of)(mt),[r,u]=(0,P.ET)(),y=u.hasSearchFilters(),O=(0,x.zy)(),p=(0,n.useMemo)(()=>new URLSearchParams(O.search),[O.search]);(0,n.useEffect)(()=>{u.initStateFromUrl(o),g((0,j.cT)({isSelected:!1,folderUID:void 0}))},[g,o,u]),(0,n.useEffect)(()=>{u.onSetStarred(p.has("starred"))},[p,u]),(0,n.useEffect)(()=>{!y&&r.result&&u.setState({result:void 0,includePanels:void 0})},[y,r.result,u]);const{data:D}=(0,a.kH)(o??a.hT),[$]=(0,a.iB)(),K=(0,n.useMemo)(()=>{if(!D)return;const Y=(0,C.R4)(D),A=(0,C.Cg)(D.uid),Q=Y.children?.find(Z=>Z.id===A);return Q&&(Q.active=!0),Y},[D]),V=(0,j.QE)(),{data:z}=(0,a.kH)("general");let L=D||z;const{canEditFolders:W,canEditDashboards:k,canCreateDashboards:q,canCreateFolders:re}=(0,gt.N)(L),de=W&&o,ce=W||k,pe=async Y=>{if(D){const A=await $({...D,title:Y});if("error"in A)throw(0,f.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_with_error",error:A.error}),A.error;(0,f.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"success"})}else(0,f.rR)("grafana_browse_dashboards_page_edit_folder_name",{status:"failed_no_folderDTO"})};return(0,e.jsx)(M.Y,{navId:"dashboards/browse",pageNav:K,onEditTitle:de?pe:void 0,actions:(0,e.jsxs)(e.Fragment,{children:[D&&(0,e.jsx)(ht.m,{folder:D}),(q||re)&&(0,e.jsx)(ct,{parentFolder:D,canCreateDashboard:q,canCreateFolder:re})]}),children:(0,e.jsxs)(M.Y.Contents,{className:i.pageContents,children:[(0,e.jsx)("div",{children:(0,e.jsx)(E.Z,{placeholder:b(r.includePanels),value:r.query,escapeRegex:!1,onChange:Y=>u.onQueryChange(Y)})}),V?(0,e.jsx)(ee,{}):(0,e.jsx)("div",{className:i.filters,children:(0,e.jsx)(he,{})}),(0,e.jsx)("div",{className:i.subView,children:(0,e.jsx)(R.Ay,{children:({width:Y,height:A})=>y?(0,e.jsx)(ut.Q,{canSelect:ce,width:Y,height:A,searchState:r,searchStateManager:u}):(0,e.jsx)(tt,{canSelect:ce,width:Y,height:A,folderUID:o})})})]})})}),mt=s=>({pageContents:(0,c.css)({display:"flex",flexDirection:"column",gap:s.spacing(1),height:"100%"}),subView:(0,c.css)({height:"100%"}),filters:(0,c.css)({display:"none",[s.breakpoints.up("md")]:{display:"block"}})});Ue.displayName="BrowseDashboardsPage";const ft=Ue},18241:(oe,N,t)=>{t.d(N,{T:()=>C});var e=t(74848),c=t(96540),n=t(32264),x=t(96374),R=t(94753),f=t(68402),l=t(42418),E=t(8484),M=t(55314),S=t(43907);const C=({onConfirm:P,onDismiss:d,selectedItems:b,..._})=>{const{data:T}=(0,M.G2)(b),h=!!(T&&(T.alertRule||T.libraryPanel)),[I,a]=(0,c.useState)(!1),m=async()=>{a(!0);try{await P(),a(!1),d()}catch{a(!1)}};return(0,e.jsx)(x.u,{body:(0,e.jsxs)(e.Fragment,{children:[n.$.featureToggles.dashboardRestore&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(R.E,{element:"p",children:(0,e.jsx)(E.x6,{i18nKey:"browse-dashboards.action.delete-modal-restore-dashboards-text",children:"This action will delete the selected folders immediately but the selected dashboards will be marked for deletion in 30 days. Your organization administrator can restore the dashboards anytime before the 30 days expire. Folders cannot be restored."})}),(0,e.jsx)(f.$,{v:2})]}),(0,e.jsx)(R.E,{element:"p",children:(0,e.jsx)(E.x6,{i18nKey:"browse-dashboards.action.delete-modal-text",children:"This action will delete the following content:"})}),(0,e.jsx)(S.x,{selectedItems:b}),(0,e.jsx)(f.$,{v:2})]}),description:(0,e.jsx)(e.Fragment,{children:h?(0,e.jsx)(l.F,{severity:"warning",title:(0,E.t)("browse-dashboards.action.delete-modal-invalid-title","Cannot delete folder"),children:(0,e.jsx)(E.x6,{i18nKey:"browse-dashboards.action.delete-modal-invalid-text",children:"One or more folders contain library panels or alert rules. Delete these first in order to proceed."})}):null}),confirmationText:(0,E.t)("browse-dashboards.action.confirmation-text","Delete"),confirmText:I?(0,E.t)("browse-dashboards.action.deleting","Deleting..."):(0,E.t)("browse-dashboards.action.delete-button","Delete"),onDismiss:d,onConfirm:m,title:(0,E.t)("browse-dashboards.action.delete-modal-title","Delete"),..._,disabled:h})}},51887:(oe,N,t)=>{t.d(N,{J:()=>P});var e=t(74848),c=t(96540),n=t(37390),x=t(42418),R=t(94753),f=t(68402),l=t(88575),E=t(55852),M=t(36607),S=t(8484),C=t(43907);const P=({onConfirm:d,onDismiss:b,selectedItems:_,...T})=>{const[h,I]=(0,c.useState)(),[a,m]=(0,c.useState)(!1),v=Object.keys(_.folder).filter(F=>_.folder[F]),U=async()=>{if(h!==void 0){m(!0);try{await d(h),m(!1),b()}catch{m(!1)}}};return(0,e.jsxs)(n.a,{title:(0,S.t)("browse-dashboards.action.move-modal-title","Move"),onDismiss:b,...T,children:[v.length>0&&(0,e.jsx)(x.F,{severity:"info",title:(0,S.t)("browse-dashboards.action.move-modal-alert","Moving this item may change its permissions.")}),(0,e.jsx)(R.E,{element:"p",children:(0,e.jsx)(S.x6,{i18nKey:"browse-dashboards.action.move-modal-text",children:"This action will move the following content:"})}),(0,e.jsx)(C.x,{selectedItems:_}),(0,e.jsx)(f.$,{v:3}),(0,e.jsx)(l.D,{label:(0,S.t)("browse-dashboards.action.move-modal-field-label","Folder name"),children:(0,e.jsx)(M.d,{value:h,excludeUIDs:v,onChange:I})}),(0,e.jsxs)(n.a.ButtonRow,{children:[(0,e.jsx)(E.$n,{onClick:b,variant:"secondary",fill:"outline",children:(0,e.jsx)(S.x6,{i18nKey:"browse-dashboards.action.cancel-button",children:"Cancel"})}),(0,e.jsx)(E.$n,{disabled:h===void 0||a,onClick:U,variant:"primary",children:a?(0,S.t)("browse-dashboards.action.moving","Moving..."):(0,S.t)("browse-dashboards.action.move-button","Move")})]})]})}},9134:(oe,N,t)=>{t.d(N,{m:()=>m});var e=t(74848),c=t(96540),n=t(32264),x=t(14110),R=t(39601),f=t(38138),l=t(64539),E=t(83122),M=t(55852),S=t(14578),C=t(87978),P=t(5108),d=t(10096),b=t(8484),_=t(28444),T=t(55314),h=t(49904),I=t(18241),a=t(51887);function m({folder:v}){const[U,F]=(0,c.useState)(!1),[G,J]=(0,c.useState)(!1),[j]=(0,T.aF)(),[X]=(0,T.Ko)(),{canEditFolders:ne,canDeleteFolders:ee,canViewPermissions:te,canSetPermissions:B}=(0,h.N)(v),H=n.$.featureToggles.nestedFolders&&ne,se=async ae=>{await j({folder:v,destinationUID:ae}),(0,x.rR)("grafana_manage_dashboards_item_moved",{item_counts:{folder:1,dashboard:0},source:"folder_actions"})},he=async()=>{await X(v),(0,x.rR)("grafana_manage_dashboards_item_deleted",{item_counts:{folder:1,dashboard:0},source:"folder_actions"});const{parents:ae}=v,Ee=ae&&ae.length?ae[ae.length-1].url:"/dashboards";R.Ny.push(Ee)},ue=()=>{d.lE.publish(new _.S8({component:a.J,props:{selectedItems:{folder:{[v.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:se}}))},ge=()=>{d.lE.publish(new _.S8({component:I.T,props:{selectedItems:{folder:{[v.uid]:!0},dashboard:{},panel:{},$all:!1},onConfirm:he}}))},me=(0,b.t)("browse-dashboards.folder-actions-button.manage-permissions","Manage permissions"),fe=(0,b.t)("browse-dashboards.folder-actions-button.move","Move"),w=(0,b.t)("browse-dashboards.folder-actions-button.delete","Delete"),ve=(0,e.jsxs)(f.W,{children:[te&&(0,e.jsx)(l.D,{onClick:()=>J(!0),label:me}),H&&(0,e.jsx)(l.D,{onClick:ue,label:fe}),ee&&(0,e.jsx)(l.D,{destructive:!0,onClick:ge,label:w})]});return!te&&!H&&!ee?null:(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(E.m,{overlay:ve,onVisibleChange:F,children:(0,e.jsxs)(M.$n,{variant:"secondary",children:[(0,e.jsx)(b.x6,{i18nKey:"browse-dashboards.folder-actions-button.folder-actions",children:"Folder actions"}),(0,e.jsx)(S.I,{name:U?"angle-up":"angle-down"})]})}),G&&(0,e.jsx)(C._,{title:(0,b.t)("browse-dashboards.action.manage-permissions-button","Manage permissions"),subtitle:v.title,onClose:()=>J(!1),size:"md",children:(0,e.jsx)(P.x,{resource:"folders",resourceId:v.uid,canSetPermissions:B})})]})}},2960:(oe,N,t)=>{t.d(N,{Q:()=>b});var e=t(74848),c=t(96540),n=t(78368),x=t(14236),R=t(69529),f=t(55852),l=t(8484),E=t(97427),M=t(66359),S=t(31678),C=t(37690);const P=25,d={view:new n.R((0,x.Vc)({fields:[{name:"uid",display:!0,values:Array(P).fill(null)},{name:"kind",display:!0,values:Array(P).fill("dashboard")},{name:"name",display:!0,values:Array(P).fill("")},{name:"location",display:!0,values:Array(P).fill("")},{name:"tags",display:!0,values:Array(P).fill([])}],meta:{custom:{locationInfo:[]}}})),loadMoreItems:()=>Promise.resolve(),isItemLoaded:()=>!1,totalRows:P};function b({width:T,height:h,canSelect:I,searchState:a,searchStateManager:m,emptyState:v}){const U=(0,S.useDispatch)(),F=(0,S.useSelector)(B=>B.browseDashboards.selectedItems),G=(0,C.QE)(),{keyboardEvents:J}=(0,E.d)(),j=a.result??d,X=(0,c.useCallback)((B,H)=>B?B==="*"&&H==="*"?G:B==="*"?!1:F[_(B)][H]??!1:!1,[F,G]),ne=(0,c.useCallback)(()=>{U((0,C.cT)({isSelected:!1,folderUID:void 0}))},[U]),ee=(0,c.useCallback)((B,H)=>{const se=!X(B,H);U((0,C.t$)({item:{kind:_(B),uid:H},isSelected:se}))},[X,U]);if(j.totalRows===0){const B=v??(0,e.jsx)(R.p,{button:(0,e.jsx)(f.$n,{variant:"secondary",onClick:m.onClearSearchAndFilters,children:(0,e.jsx)(l.x6,{i18nKey:"browse-dashboards.no-results.clear",children:"Clear search and filters"})}),message:(0,l.t)("browse-dashboards.no-results.text","No results found for your query"),variant:"not-found",role:"alert"});return(0,e.jsx)("div",{style:{width:T},children:B})}const te={response:j,selection:I?X:void 0,selectionToggle:I?ee:void 0,clearSelection:ne,width:T,height:h,onTagSelected:m.onAddTag,keyboardEvents:J,onDatasourceChange:a.datasource?m.onDatasourceChange:void 0,onClickItem:m.onSearchItemClicked};return(0,e.jsx)(M.P,{...te})}function _(T){switch(T){case"folder":return"folder";case"dashboard":return"dashboard";case"panel":return"panel"}throw new Error("Unsupported kind"+T)}},49904:(oe,N,t)=>{t.d(N,{N:()=>f});var e=t(32264),c=t(10096),n=t(31678);function x(l,E){return E&&E.uid!=="general"?c.TP.hasPermissionInMetadata(l,E):c.TP.hasPermission(l)}function R(l){return l&&!e.$.featureToggles.nestedFolders?!1:e.$.featureToggles.accessActionSets?l?c.TP.hasPermissionInMetadata(n.AccessControlAction.FoldersCreate,l):c.TP.hasPermission(n.AccessControlAction.FoldersCreate):!l||l.uid==="general"?x(n.AccessControlAction.FoldersCreate):x(n.AccessControlAction.FoldersCreate)&&x(n.AccessControlAction.FoldersWrite,l)}function f(l){const E=x(n.AccessControlAction.DashboardsCreate,l),M=R(l),S=x(n.AccessControlAction.FoldersDelete,l),C=x(n.AccessControlAction.DashboardsWrite,l),P=x(n.AccessControlAction.FoldersWrite,l),d=x(n.AccessControlAction.FoldersPermissionsWrite,l),b=x(n.AccessControlAction.FoldersPermissionsRead,l);return{canCreateDashboards:E,canCreateFolders:M,canDeleteFolders:S,canEditDashboards:C,canEditFolders:P,canSetPermissions:d,canViewPermissions:b}}},19519:(oe,N,t)=>{t.d(N,{bj:()=>_});var e=t(74848),c=t(32196),n=t(32264),x=t(40845),R=t(67061),f=t(10880),l=t(55852),E=t(94354),M=t(73725),S=t(99818),C=t(8484),P=t(64161);function d(){return[{value:P.P.Folders,icon:"folder",description:(0,C.t)("search.actions.view-as-folders","View by folders")},{value:P.P.List,icon:"list-ul",description:(0,C.t)("search.actions.view-as-list","View as list")}]}function b(h){const I=h.layout??P.P.Folders;return I===P.P.Folders&&(h.query||h.sort||h.starred||h.tag.length>0)?P.P.List:I}const _=({state:h,showStarredFilter:I,showLayout:a,sortPlaceholder:m,onLayoutChange:v,onSortChange:U,onStarredFilterChange:F=()=>{},onTagFilterChange:G,getTagOptions:J,getSortOptions:j,onDatasourceChange:X,onPanelTypeChange:ne,onSetIncludePanels:ee})=>{const te=(0,x.of)(T),B=b(h),H=h.tag.length||h.starred||h.query||h.datasource||h.panel_type?[P.P.Folders]:[];return(0,e.jsxs)(R.B,{justifyContent:"space-between",alignItems:"center",children:[(0,e.jsxs)(R.B,{gap:2,alignItems:"center",children:[(0,e.jsx)(S.$,{isClearable:!1,tags:h.tag,tagOptions:J,onChange:G}),n.$.featureToggles.panelTitleSearch&&(0,e.jsx)(f.S,{"data-testid":"include-panels",disabled:B===P.P.Folders,value:h.includePanels,onChange:()=>ee(!h.includePanels),label:(0,C.t)("search.actions.include-panels","Include panels")}),I&&(0,e.jsx)("div",{className:te.checkboxWrapper,children:(0,e.jsx)(f.S,{label:(0,C.t)("search.actions.starred","Starred"),onChange:F,value:h.starred})}),h.datasource&&(0,e.jsx)(l.$n,{icon:"times",variant:"secondary",onClick:()=>X(void 0),children:(0,e.jsxs)(C.x6,{i18nKey:"search.actions.remove-datasource-filter",children:["Datasource: ",{datasource:h.datasource}]})}),h.panel_type&&(0,e.jsxs)(l.$n,{icon:"times",variant:"secondary",onClick:()=>ne(void 0),children:["Panel: ",h.panel_type]})]}),(0,e.jsxs)(R.B,{gap:2,children:[a&&(0,e.jsx)(E.z,{options:d(),disabledOptions:H,onChange:v,value:B}),(0,e.jsx)(M.r,{onChange:se=>U(se?.value),value:h.sort,getSortOptions:j,placeholder:m||(0,C.t)("search.actions.sort-placeholder","Sort"),isClearable:!0})]})]})};_.displayName="ActionRow";const T=h=>({checkboxWrapper:(0,c.css)({label:{lineHeight:"1.2"}})})},39788:(oe,N,t)=>{t.d(N,{ET:()=>h,lC:()=>b,ue:()=>C});var e=t(2543),c=t.n(e),n=t(39601),x=t(2619),R=t(33390),f=t(53477),l=t(6204),E=t(24439),M=t(64161),S=t(16757);const C={query:"",tag:[],starred:!1,layout:M.P.Folders,sort:void 0,prevSort:void 0,eventTrackingNamespace:"dashboard_search",deleted:!1},P={sort:null,starred:null,query:null,tag:null,layout:null},d=()=>localStorage.getItem(f.YU)===M.P.List?M.P.List:M.P.Folders;class b extends x.Q{constructor(){super(...arguments),this.updateLocation=(0,e.debounce)(a=>n.Ny.partial(a,!0),300),this.doSearchWithDebounce=(0,e.debounce)(()=>this.doSearch(),300),this.lastSearchTimestamp=0,this.onCloseSearch=()=>{this.updateLocation({search:null,folder:null,...P})},this.onClearSearchAndFilters=()=>{this.setStateAndDoSearch({query:"",datasource:void 0,tag:[],panel_type:void 0,starred:void 0,sort:void 0})},this.onQueryChange=a=>{this.setStateAndDoSearch({query:a})},this.onRemoveTag=a=>{this.setStateAndDoSearch({tag:this.state.tag.filter(m=>m!==a)})},this.onTagFilterChange=a=>{this.setStateAndDoSearch({tag:a})},this.onAddTag=a=>{this.state.tag&&this.state.tag.includes(a)||this.setStateAndDoSearch({tag:[...this.state.tag,a]})},this.onDatasourceChange=a=>{this.setStateAndDoSearch({datasource:a})},this.onPanelTypeChange=a=>{this.setStateAndDoSearch({panel_type:a})},this.onStarredFilterChange=a=>{const m=a.currentTarget.checked;this.setStateAndDoSearch({starred:m})},this.onClearStarred=()=>{this.setStateAndDoSearch({starred:!1})},this.onSetStarred=a=>{a!==this.state.starred&&this.setStateAndDoSearch({starred:a})},this.onSortChange=a=>{a?localStorage.setItem(f.w7,a):localStorage.removeItem(f.w7),this.state.layout===M.P.Folders?this.setStateAndDoSearch({sort:a,layout:M.P.List}):this.setStateAndDoSearch({sort:a})},this.onLayoutChange=a=>{localStorage.setItem(f.YU,a),this.state.sort&&a===M.P.Folders?this.setStateAndDoSearch({layout:a,prevSort:this.state.sort,sort:void 0}):this.setStateAndDoSearch({layout:a,sort:this.state.prevSort})},this.onSetIncludePanels=a=>{this.setStateAndDoSearch({includePanels:a}),R.A.set(f.d7,a)},this.getTagOptions=()=>{const a=this.lastQuery??{kind:["dashboard","folder"],query:"*"};return(0,E.getGrafanaSearcher)().tags(a)},this.onSearchItemClicked=a=>{(0,l.MK)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})},this.onReportSearchUsage=()=>{(0,l.Pf)(this.state.eventTrackingNamespace,{layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted})}}initStateFromUrl(a,m=!0){const v=(0,S.N1)(n.Ny.getSearchObject());(v.query||v.datasource||v.panel_type)&&(v.layout=M.P.List);const U=d(),F=localStorage.getItem(f.w7)??void 0,G=U===M.P.List?v.sort||F:null;this.setState({...C,...v,layout:U,sort:G??C.sort,prevSort:F,folderUid:a,eventTrackingNamespace:a?"manage_dashboards":"dashboard_search",deleted:this.state.deleted}),m&&this.hasSearchFilters()&&this.doSearch()}setStateAndDoSearch(a){const m=a.sort||this.state.sort||localStorage.getItem(f.w7)||void 0;this.setState({sort:m,...a}),this.updateLocation({query:this.state.query.length===0?null:this.state.query,tag:this.state.tag,datasource:this.state.datasource,panel_type:this.state.panel_type,starred:this.state.starred?this.state.starred:null,sort:this.state.sort}),this.hasSearchFilters()&&this.doSearchWithDebounce()}hasSearchFilters(){return!!(this.state.query||this.state.tag.length||this.state.starred||this.state.panel_type||this.state.sort||this.state.deleted||this.state.layout===M.P.List)}getSearchQuery(){const a={query:this.state.query,tags:this.state.tag,ds_uid:this.state.datasource,panel_type:this.state.panel_type,location:this.state.folderUid,sort:this.state.sort,explain:this.state.explain,withAllowedActions:this.state.explain,starred:this.state.starred,deleted:this.state.deleted};return a.sort?.length&&!a.sort.includes("name")&&(a.kind=["dashboard","folder"]),a.query?.length||(a.query="*",a.location||(a.kind=["dashboard","folder"])),!this.state.includePanels&&!a.kind&&(a.kind=["dashboard","folder"]),a.panel_type?.length&&(a.kind=["panel"]),a}doSearch(){const a={layout:this.state.layout,starred:this.state.starred,sortValue:this.state.sort,query:this.state.query,tagCount:this.state.tag?.length,includePanels:this.state.includePanels,deleted:this.state.deleted};(0,l.J$)(this.state.eventTrackingNamespace,a),this.lastQuery=this.getSearchQuery(),this.setState({loading:!0});const m=(0,E.getGrafanaSearcher)(),v=Date.now();(this.state.starred?m.starred(this.lastQuery):m.search(this.lastQuery)).then(F=>{v>this.lastSearchTimestamp&&(this.setState({result:F,loading:!1}),this.lastSearchTimestamp=v)}).catch(F=>{(0,l.KZ)(this.state.eventTrackingNamespace,{...a,error:F?.message}),this.setState({loading:!1})})}}let _;function T(){if(!_){const a=localStorage.getItem(f.YU)??C.layout;let m=R.A.getBool(f.d7,!0);m&&(m=!1),_=new b({...C,layout:a,includePanels:m})}return _}function h(){const I=T();return[I.useState(),I]}}}]);

//# sourceMappingURL=DashboardListPage.14c6d350e236aaff3398.js.map