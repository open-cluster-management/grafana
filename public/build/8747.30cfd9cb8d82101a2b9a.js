(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[8747],{35931:(je,B,m)=>{"use strict";m.d(B,{H:()=>e});var F=m(32196),d=m(96540),V=m(40845);function e(w){const{description:se,suffix:ne,feature:J}=w,oe=`Learn more about ${J}`,D=(0,V.of)(I);return d.createElement("span",{className:D.container},se,d.createElement("a",{"aria-label":oe,href:`https://grafana.com/docs/grafana/next/datasources/${ne}`,rel:"noreferrer",target:"_blank"},oe))}const I=w=>({container:(0,F.css)({color:w.colors.text.secondary,a:(0,F.css)({color:w.colors.text.link,textDecoration:"underline",marginLeft:"5px","&:hover":{textDecoration:"none"}})})})},18747:(je,B,m)=>{"use strict";m.r(B),m.d(B,{plugin:()=>Cr});var F=m(40187),d=m(69129),V=m(3591),e=m(74848),I=m(32196),w=m(96540),se=m(43127),ne=m(42418),J=m(40845),oe=m(20084),D=m(76892),j=m(14186),S=m(10354);const ce=t=>(i,r)=>{const n={};for(const o in t)n[o]=t[o](i[o],r);return n},Ve=(t,i,r)=>(0,w.useCallback)(o=>{t(r(i,o))},[t,i,r]),Xe=(0,w.createContext)(void 0),q=()=>{const t=(0,w.useContext)(Xe);if(!t)throw new Error("Use DispatchContext first.");return t},St=t=>({name:t,pipelineAgg:""}),It=t=>`var${Math.max(0,...t.map(i=>parseInt(i.name.match("^var(\\d+)$")?.[1]||"0",10)))+1}`,At=t=>t.settings?.model==="ewma",et=t=>t.settings?.model==="holt",Re=t=>t.settings?.model==="holt_winters",ds=t=>["holt","ewma","holt_winters"].includes(t.settings?.model||""),ue=t=>_[t.type].requiresField,$e=t=>_[t.type].isPipelineAgg,Le=t=>_[t.type].supportsMultipleBucketPaths,fs=t=>_[t.type].supportsMissing,ie=t=>_[t.type].hasSettings,de=t=>_[t.type].hasMeta,Fe=t=>_[t.type].supportsInlineScript,wt=["count","avg","sum","min","max","extended_stats","percentiles","cardinality","raw_document","raw_data","logs","moving_avg","moving_fn","derivative","serial_diff","cumulative_sum","bucket_script","rate","top_metrics"],Ct=t=>wt.includes(t),_={count:{label:"Count",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!1,hasMeta:!1,supportsInlineScript:!1,defaults:{}},avg:{label:"Average",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},sum:{label:"Sum",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},max:{label:"Max",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},min:{label:"Min",impliedQueryType:"metrics",requiresField:!0,supportsInlineScript:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{}},extended_stats:{label:"Extended Stats",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!0,defaults:{meta:{std_deviation_bounds_lower:!0,std_deviation_bounds_upper:!0}}},percentiles:{label:"Percentiles",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,supportsInlineScript:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,hasMeta:!1,defaults:{settings:{percents:["25","50","75","95","99"]}}},cardinality:{label:"Unique Count",impliedQueryType:"metrics",requiresField:!0,supportsMissing:!0,isPipelineAgg:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},moving_avg:{label:"Moving Average",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,versionRange:"<8.0.0",supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{model:"simple",window:"5"}}},moving_fn:{label:"Moving Function",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMultipleBucketPaths:!1,supportsInlineScript:!1,supportsMissing:!1,hasMeta:!1,hasSettings:!0,defaults:{}},derivative:{label:"Derivative",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},serial_diff:{label:"Serial Difference",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{lag:"1"}}},cumulative_sum:{label:"Cumulative Sum",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{}},bucket_script:{label:"Bucket Script",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!0,supportsMissing:!1,supportsMultipleBucketPaths:!0,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{pipelineVariables:[St(It([]))]}},raw_document:{label:"Raw Document (deprecated)",requiresField:!1,impliedQueryType:"raw_document",isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{size:"500"}}},raw_data:{label:"Raw Data",requiresField:!1,impliedQueryType:"raw_data",isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{size:"500"}}},logs:{label:"Logs",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,impliedQueryType:"logs",supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{limit:"500"}}},top_metrics:{label:"Top Metrics",impliedQueryType:"metrics",requiresField:!1,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!1,hasMeta:!1,defaults:{settings:{order:"desc"}}},rate:{label:"Rate",impliedQueryType:"metrics",requiresField:!0,isPipelineAgg:!1,supportsMissing:!1,supportsMultipleBucketPaths:!1,hasSettings:!0,supportsInlineScript:!0,hasMeta:!1,defaults:{}}},Ys={moving_avg:[{label:"window",default:5},{label:"model",default:"simple"},{label:"predict"},{label:"minimize",default:!1}],moving_fn:[{label:"window",default:5},{label:"script"}],derivative:[{label:"unit"}],serial_diff:[{label:"lag"}],cumulative_sum:[{label:"format"}],bucket_script:[]},Mt=(t,i)=>{const r=i.filter(n=>Le(n)?n.pipelineVariables?.some(o=>o.pipelineAgg===t.id):ue(n)&&t.id===n.field);return[...r,...r.flatMap(n=>Mt(n,i))]},Tt=[{label:"Avg",value:"avg"},{label:"Min",value:"min"},{label:"Max",value:"max"},{label:"Sum",value:"sum"},{label:"Count",value:"count"},{label:"Std Dev",value:"std_deviation"},{label:"Std Dev Upper",value:"std_deviation_bounds_upper"},{label:"Std Dev Lower",value:"std_deviation_bounds_lower"}],gs=[{label:"Simple",value:"simple"},{label:"Linear",value:"linear"},{label:"Exponentially Weighted",value:"ewma"},{label:"Holt Linear",value:"holt"},{label:"Holt Winters",value:"holt_winters"}],Dt={pre:"@HIGHLIGHT@",post:"@/HIGHLIGHT@"},he="3";function fe(t="1"){return{type:"count",id:t}}function tt(t="1"){return{type:"date_histogram",id:t,settings:{interval:"auto"}}}const Se=(t,i)=>t.find(r=>r.id===i);function st(t,i){return!!t?.metrics?.some(r=>r.type===i)}function Ks(t){return t in pipelineOptions}function Et(t){return!!metricAggregationConfig[t].supportsMultipleBucketPaths}var Ne=m(21970);const me=t=>ue(t)?`${_[t.type].label} ${t.field}`:_[t.type].label,_e=t=>Object.entries(t).reduce((i,[r,n])=>{if(n==null)return{...i};if(Array.isArray(n)&&n.length===0)return{...i};if(typeof n=="string"&&n.length===0)return{...i};if(!Array.isArray(n)&&typeof n=="object"){const o=_e(n);return Object.keys(o).length===0?{...i}:{...i,[r]:o}}return{...i,[r]:n}},{}),it=t=>{const i=t.match(/^(\d+)/);return i?i[1]:void 0},Qe=t=>(typeof t.settings?.script=="object"?t.settings?.script?.inline:t.settings?.script)||"",rt=t=>!!(0,Ne.gte)(t,"7.16.0"),nt="Support for Elasticsearch versions after their end-of-life (currently versions < 7.16) was removed. Using unsupported version of Elasticsearch may lead to unexpected and incorrect results.",Be=t=>t?.bucketAggs?.slice(-1)[0]?.type==="date_histogram",at=/\$(\w+)|\[\[(\w+?)(?::(\w+))?\]\]|\${(\w+)(?:\.([^:^\}]+))?(?::([^\}]+))?}/g;function Pt(t,i){i=i||{};const r=i.delimiter||".";let n=i.maxDepth||3,o=1;const u={};function f(v,$){Object.keys(v).forEach(h=>{const b=v[h],E=i?.safe&&Array.isArray(b),O=Object.prototype.toString.call(b)==="[object Object]",G=$?$+r+h:h;if(i?.maxDepth||(n=o+1),!E&&O&&b&&Object.keys(b).length&&o<n)return++o,f({...b},G);u[G]=b})}return f(t,null),u}var R=m(65307);const qe=(0,R.VP)("@metrics/add"),We=(0,R.VP)("@metrics/remove"),ke=(0,R.VP)("@metrics/toggle_visibility"),Ie=(0,R.VP)("@metrics/change_field"),Ae=(0,R.VP)("@metrics/change_type"),lt=(0,R.VP)("@metrics/change_attr"),W=(0,R.VP)("@metrics/change_setting"),Ot=(0,R.VP)("@metrics/change_meta"),we=(0,R.VP)("init"),Vt=(0,R.VP)("change_query"),Rt=(0,R.VP)("change_alias_pattern"),ps=(t,i)=>Vt.match(i)?i.payload:we.match(i)?t||"":t,hs=(t,i)=>Rt.match(i)?i.payload:we.match(i)?t||"":t;var ot=m(91410);const Lt=()=>({label:"",query:"*"}),Q={terms:{label:"Terms",requiresField:!0,defaultSettings:{min_doc_count:"1",size:"10",order:"desc",orderBy:"_term"}},filters:{label:"Filters",requiresField:!1,defaultSettings:{filters:[Lt()]}},geohash_grid:{label:"Geo Hash Grid",requiresField:!0,defaultSettings:{precision:he}},date_histogram:{label:"Date Histogram",requiresField:!0,defaultSettings:{interval:"auto",min_doc_count:"0",trimEdges:"0",timeZone:ot.g$.utc}},histogram:{label:"Histogram",requiresField:!0,defaultSettings:{interval:"1000",min_doc_count:"0"}},nested:{label:"Nested (experimental)",requiresField:!0,defaultSettings:{}}},ze=[{label:"Term value",value:"_term"},{label:"Doc Count",value:"_count"}],Ce=[{label:"Top",value:"desc"},{label:"Bottom",value:"asc"}],ms=[{label:"No limit",value:"0"},{label:"1",value:"1"},{label:"2",value:"2"},{label:"3",value:"3"},{label:"5",value:"5"},{label:"10",value:"10"},{label:"15",value:"15"},{label:"20",value:"20"}],Nt=(0,R.VP)("@bucketAggs/add"),_t=(0,R.VP)("@bucketAggs/remove"),Qt=(0,R.VP)("@bucketAggs/change_type"),Bt=(0,R.VP)("@bucketAggs/change_field"),k=(0,R.VP)("@bucketAggs/change_setting"),ys=t=>(i,r)=>{if(Nt.match(r)){const n={id:r.payload,type:"terms",settings:Q.terms.defaultSettings},o=i[i.length-1];return o?.type==="date_histogram"?[...i.slice(0,i.length-1),n,o]:[...i,n]}return _t.match(r)?i.filter(n=>n.id!==r.payload):Qt.match(r)?i.map(n=>n.id!==r.payload.id?n:{id:n.id,type:r.payload.newType,settings:Q[r.payload.newType].defaultSettings}):Bt.match(r)?i.map(n=>n.id!==r.payload.id?n:{...n,field:r.payload.newField}):Ae.match(r)?_[r.payload.type].impliedQueryType!=="metrics"?[]:i.length===0?[{...tt("2"),field:t}]:i:k.match(r)?i.map(n=>{if(n.id!==r.payload.bucketAgg.id)return n;const o=_e({...n.settings,[r.payload.settingName]:r.payload.newValue});return{...n,settings:{...o}}}):we.match(r)?i&&i.length>0?i:[{...tt("2"),field:t}]:i},qt=(t,i)=>{if(qe.match(i))return[...t,fe(i.payload)];if(We.match(i)){const r=t.find(u=>u.id===i.payload),n=[r,...Mt(r,t)],o=t.filter(u=>!n.some(f=>f.id===u.id));return o.length===0?[fe("1")]:o}return Ae.match(i)?t.filter(r=>_[i.payload.type].impliedQueryType==="metrics"?!0:r.id===i.payload.id).map(r=>r.id!==i.payload.id?r:{id:r.id,type:i.payload.type,..._[i.payload.type].defaults}):Ie.match(i)?t.map(r=>{if(r.id!==i.payload.id)return r;const n={...r,field:i.payload.field};return $e(r)?{...n,pipelineAgg:i.payload.field}:n}):ke.match(i)?t.map(r=>r.id!==i.payload?r:{...r,hide:!r.hide}):W.match(i)?t.map(r=>{if(r.id!==i.payload.metric.id)return r;if(ie(r)){const n=_e({...r.settings,[i.payload.settingName]:i.payload.newValue});return{...r,settings:{...n}}}return r}):Ot.match(i)?t.map(r=>r.id!==i.payload.metric.id?r:de(r)?{...r,meta:{...r.meta,[i.payload.meta]:i.payload.newValue}}:r):lt.match(i)?t.map(r=>r.id!==i.payload.metric.id?r:{...r,[i.payload.attribute]:i.payload.newValue}):we.match(i)?t&&t.length>0?t:[fe("1")]:t},Wt=(0,w.createContext)(void 0),Me=(0,w.createContext)(void 0),Te=(0,w.createContext)(void 0),vs=({children:t,onChange:i,onRunQuery:r,query:n,datasource:o,range:u})=>{const f=(0,w.useCallback)((L,O)=>{i(L),(L.query===O.query||O.query===void 0)&&r()},[i,r]),v=ce({query:ps,alias:hs,metrics:qt,bucketAggs:ys(o.timeField)}),$=Ve(L=>f({...n,...L,timeField:o.timeField},n),n,v),h=!n.metrics||!n.bucketAggs||n.query===void 0,[b,E]=(0,w.useState)(h);return(0,w.useEffect)(()=>{b&&h&&($(we()),E(!1))},[b,$,h]),h?null:(0,e.jsx)(Wt.Provider,{value:o,children:(0,e.jsx)(Me.Provider,{value:n,children:(0,e.jsx)(Te.Provider,{value:u,children:(0,e.jsx)(Xe.Provider,{value:$,children:t})})})})},ct=t=>()=>{const i=(0,w.useContext)(t);if(!i)throw new Error("use ElasticsearchProvider first.");return i},z=ct(Me),De=ct(Wt),xs=ct(Te),kt=t=>t.id,bs=t=>parseInt(t,10),js=()=>{const{metrics:t,bucketAggs:i}=z();return(0,w.useMemo)(()=>(Math.max(...[...t?.map(kt)||["0"],...i?.map(kt)||["0"]].map(bs))+1).toString(),[t,i])};var ae=m(55852),N=m(2543),ut=m(39268),ye=m(63056),zt=m(29158);const dt=({children:t,label:i,onRemoveClick:r,onHideClick:n,hidden:o=!1})=>{const u=(0,J.of)($s);return(0,e.jsxs)(ut.C,{children:[(0,e.jsx)(ye.e,{children:(0,e.jsxs)(D.c,{width:17,as:"div",children:[(0,e.jsx)("span",{children:i}),(0,e.jsxs)("span",{className:u.iconWrapper,children:[n&&(0,e.jsx)(zt.K,{name:o?"eye-slash":"eye",onClick:n,size:"sm","aria-pressed":o,className:u.icon,tooltip:"Hide row"}),(0,e.jsx)(zt.K,{name:"trash-alt",size:"sm",className:u.icon,onClick:r||N.noop,disabled:!r,tooltip:"Remove row"})]})]})}),t]})},$s=t=>({iconWrapper:(0,I.css)`
      display: flex;
    `,icon:(0,I.css)`
      color: ${t.colors.text.secondary};
      margin-left: ${t.spacing(.25)};
    `});var ft=m(38401),He=m(83684),ee=m(75505);const gt=t=>Q[t.type].requiresField,Ht=["date_histogram","histogram","terms","filters","geohash_grid","nested"],Fs=t=>Ht.includes(t),Ut=t=>{if(Ct(t))switch(t){case"cardinality":return[];case"top_metrics":return["number"];default:return["number"]}if(Fs(t))switch(t){case"date_histogram":return["date"];case"geohash_grid":return["geo_point"];case"histogram":return["number"];default:return[]}return[]},Ss=({text:t})=>({label:t,value:t}),Ue=t=>{const i=De(),r=xs(),n=Array.isArray(t)?t:Ut(t);let o;return async u=>(o||(o=await(0,ee.s)(i.getFields(n,r))),o.filter(({text:f})=>u===void 0||f.includes(u)).map(Ss))},ge=(0,I.css)`
  min-width: 150px;
`;var Gt=m(14578);const a=(t,i)=>({wrapper:(0,I.css)`
      max-width: 500px;
      display: flex;
      flex-direction: column;
    `,settingsWrapper:(0,I.css)`
      padding-top: ${t.spacing(.5)};
    `,icon:(0,I.css)`
      margin-right: ${t.spacing(.5)};
    `,button:(0,I.css)`
      justify-content: start;
      ${i&&(0,I.css)`
        color: ${t.colors.text.disabled};
      `}
    `}),C=({label:t,children:i,hidden:r=!1})=>{const[n,o]=(0,w.useState)(!1),u=(0,J.$j)(),f=a(u,r);return(0,e.jsx)(ye.e,{children:(0,e.jsxs)("div",{className:(0,I.cx)(f.wrapper),children:[(0,e.jsxs)("button",{className:(0,I.cx)("gf-form-label query-part",f.button,ge),onClick:()=>o(!n),"aria-expanded":n,type:"button",children:[(0,e.jsx)(Gt.I,{name:n?"angle-down":"angle-right","aria-hidden":"true",className:f.icon}),t]}),n&&(0,e.jsx)("div",{className:f.settingsWrapper,children:i})]})})};var Y=m(90182),te=m(20333);const Ge=["1w","1M","1q","1y"];class y{constructor(i){this.timeField=i.timeField}getRangeFilter(){return{[this.timeField]:{gte:"$timeFrom",lte:"$timeTo",format:"epoch_millis"}}}buildTermsAgg(i,r,n){if(r.terms={field:i.field},!i.settings)return r;const o=i.settings?.size?parseInt(i.settings.size,10):500;if(r.terms.size=o===0?500:o,i.settings.orderBy!==void 0){r.terms.order={},i.settings.orderBy==="_term"?r.terms.order._key=i.settings.order:r.terms.order[i.settings.orderBy]=i.settings.order;const u=it(i.settings.orderBy);if(u){for(let f of n.metrics||[])if(f.id===u){f.type==="count"?r.terms.order={_count:i.settings.order}:ue(f)&&(r.aggs={},r.aggs[f.id]={[f.type]:{field:f.field}});break}}}return i.settings.min_doc_count!==void 0&&(r.terms.min_doc_count=parseInt(i.settings.min_doc_count,10),isNaN(r.terms.min_doc_count)&&(r.terms.min_doc_count=i.settings.min_doc_count)),i.settings.missing&&(r.terms.missing=i.settings.missing),r}getDateHistogramAgg(i){const r={},n=i.settings||{};r.field=i.field||this.timeField,r.min_doc_count=n.min_doc_count||0,r.extended_bounds={min:"$timeFrom",max:"$timeTo"},r.format="epoch_millis",n.timeZone&&n.timeZone!==ot.g$.utc&&(r.time_zone=n.timeZone),n.offset!==""&&(r.offset=n.offset);const o=n.interval==="auto"?"${__interval_ms}ms":n.interval;return o!==void 0&&Ge.includes(o)?r.calendar_interval=o:r.fixed_interval=o,r}getHistogramAgg(i){return{interval:i.settings?.interval,field:i.field,min_doc_count:i.settings?.min_doc_count||0}}getFiltersAgg(i){const r={};for(let{query:n,label:o}of i.settings?.filters||[])r[o||n]={query_string:{query:n,analyze_wildcard:!0}};return r}documentQuery(i,r){return i.size=r,i.sort=[{[this.timeField]:{order:"desc",unmapped_type:"boolean"}},{_doc:{order:"desc"}}],i.script_fields={},i}build(i){i.metrics=i.metrics||[fe()],i.bucketAggs=i.bucketAggs||[tt()],i.timeField=this.timeField;let r,n,o,u,f;const v={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};if(i.query&&i.query!==""&&(v.query.bool.filter=[...v.query.bool.filter,{query_string:{analyze_wildcard:!0,query:i.query}}]),i.bucketAggs.length===0&&(r=i.metrics[0],!r||!(r.type==="raw_document"||r.type==="raw_data")))throw{message:"Invalid query"};if(i.metrics?.[0]?.type==="raw_document"||i.metrics?.[0]?.type==="raw_data"){r=i.metrics[0];const $=r.settings?.size?parseInt(r.settings.size,10):500;return this.documentQuery(v,$||500)}for(f=v,n=0;n<i.bucketAggs.length;n++){const $=i.bucketAggs[n],h={};switch($.type){case"date_histogram":{h.date_histogram=this.getDateHistogramAgg($);break}case"histogram":{h.histogram=this.getHistogramAgg($);break}case"filters":{h.filters={filters:this.getFiltersAgg($)};break}case"terms":{this.buildTermsAgg($,h,i);break}case"geohash_grid":{h.geohash_grid={field:$.field,precision:$.settings?.precision||he};break}case"nested":{h.nested={path:$.field};break}}f.aggs=f.aggs||{},f.aggs[$.id]=h,f=h}for(f.aggs={},n=0;n<i.metrics.length;n++){if(r=i.metrics[n],r.type==="count")continue;const $={};let h={};if($e(r))if(Le(r))if(r.pipelineVariables){for(h={buckets_path:{}},o=0;o<r.pipelineVariables.length;o++)if(u=r.pipelineVariables[o],u.name&&u.pipelineAgg&&/^\d*$/.test(u.pipelineAgg)){const b=Se(i.metrics,u.pipelineAgg);b&&(b.type==="count"?h.buckets_path[u.name]="_count":h.buckets_path[u.name]=u.pipelineAgg)}}else continue;else if(r.field&&/^\d*$/.test(r.field)){const b=Se(i.metrics,r.field);b&&(b.type==="count"?h={buckets_path:"_count"}:h={buckets_path:r.field})}else continue;else ue(r)&&(h={field:r.field});if(ie(r))switch(Object.entries(r.settings||{}).filter(([b,E])=>E!==null).forEach(([b,E])=>{h[b]=b==="script"?this.buildScript(Qe(r)):E}),r.type){case"moving_avg":h={...h,...h?.window!==void 0&&{window:this.toNumber(h.window)},...h?.predict!==void 0&&{predict:this.toNumber(h.predict)},...ds(r)&&{settings:{...h.settings,...Object.fromEntries(Object.entries(h.settings||{}).filter(([b])=>["alpha","beta","gamma","period"].includes(b)).filter(([b,E])=>E!==void 0).map(([b,E])=>[b,this.toNumber(E)]))}}};break;case"serial_diff":h={...h,...h.lag!==void 0&&{lag:this.toNumber(h.lag)}};break;case"top_metrics":h={metrics:r.settings?.metrics?.map(b=>({field:b})),size:1},r.settings?.orderBy&&(h.sort=[{[r.settings?.orderBy]:r.settings?.order}]);break}$[r.type]=h,f.aggs[r.id]=$}return v}buildScript(i){return i}toNumber(i){const r=parseFloat(`${i}`);return isNaN(r)?i:r}getTermsQuery(i){const r={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};i.query&&r.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:i.query}});let n=500;i.size&&(n=i.size),r.aggs={1:{terms:{field:i.field,size:n,order:{}}}};const{orderBy:o="key",order:u=o==="doc_count"?"desc":"asc"}=i;if(["asc","desc"].indexOf(u)<0)throw{message:`Invalid query sort order ${u}`};switch(o){case"key":case"term":const f="_key";r.aggs[1].terms.order[f]=u;break;case"doc_count":r.aggs[1].terms.order._count=u;break;default:throw{message:`Invalid query sort type ${o}`}}return r}getLogsQuery(i,r){let n={size:0,query:{bool:{filter:[{range:this.getRangeFilter()}]}}};return i.query&&n.query.bool.filter.push({query_string:{analyze_wildcard:!0,query:i.query}}),n=this.documentQuery(n,r),{...n,aggs:this.build(i).aggs,highlight:{fields:{"*":{}},pre_tags:[Dt.pre],post_tags:[Dt.post],fragment_size:2147483647}}}}const Ye=t=>({value:i})=>i===t,Zs=(t,i)=>i===void 0||t.some(Ye(i))?t:[...t,{value:i,label:i}],Ee=({options:t,value:i,onChange:r})=>{const[n,o]=(0,w.useState)(Zs(t,i)),u=f=>o([...n,{value:f,label:f}]);return{onCreateOption:f=>{u(f),r({value:f})},onChange:r,allowCustomValue:!0,options:n,value:i}},Js=[{label:"auto",value:"auto"},{label:"10s",value:"10s"},{label:"1m",value:"1m"},{label:"5m",value:"5m"},{label:"10m",value:"10m"},{label:"20m",value:"20m"},{label:"1h",value:"1h"},{label:"1d",value:"1d"},{label:"1w",value:"1w"},{label:"1M",value:"1M"},{label:"1q",value:"1q"},{label:"1y",value:"1y"}],Xs=t=>({value:i})=>i===t,P=(t,i,r)=>!r.some(Xs(t))&&t.trim().length>0,Pe=(t,i)=>t.value?.startsWith(i)||!1,Is=t=>t&&Ge.includes(t)?"calendar":"fixed",As=({bucketAgg:t})=>{const i=q(),{current:r}=(0,w.useRef)((0,N.uniqueId)("es-date_histogram-")),n=(0,w.useCallback)(({value:u})=>i(k({bucketAgg:t,settingName:"interval",newValue:u})),[t,i]),o=Is(t.settings?.interval||Q.date_histogram.defaultSettings?.interval);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.I,{label:o==="calendar"?"Calendar interval":"Fixed interval",tooltip:o==="calendar"?"Calendar-aware intervals adapt to varying day lengths, month durations, and leap seconds, considering the calendar context.":"Fixed intervals remain constant, always being multiples of SI units, independent of calendar changes.",...H,children:(0,e.jsx)(Y.l6,{inputId:(0,N.uniqueId)("es-date_histogram-interval"),isValidNewOption:P,filterOption:Pe,...Ee({options:Js,value:t.settings?.interval||Q.date_histogram.defaultSettings?.interval,onChange:n})})}),(0,e.jsx)(j.I,{label:"Min Doc Count",...H,children:(0,e.jsx)(S.p,{id:`${r}-min_doc_count`,onBlur:u=>i(k({bucketAgg:t,settingName:"min_doc_count",newValue:u.target.value})),defaultValue:t.settings?.min_doc_count||Q.date_histogram.defaultSettings?.min_doc_count})}),(0,e.jsx)(j.I,{label:"Trim Edges",...H,tooltip:"Trim the edges on the timeseries datapoints",children:(0,e.jsx)(S.p,{id:`${r}-trime_edges`,onBlur:u=>i(k({bucketAgg:t,settingName:"trimEdges",newValue:u.target.value})),defaultValue:t.settings?.trimEdges||Q.date_histogram.defaultSettings?.trimEdges})}),(0,e.jsx)(j.I,{label:"Offset",...H,tooltip:"Change the start value of each bucket by the specified positive (+) or negative offset (-) duration, such as 1h for an hour, or 1d for a day",children:(0,e.jsx)(S.p,{id:`${r}-offset`,onBlur:u=>i(k({bucketAgg:t,settingName:"offset",newValue:u.target.value})),defaultValue:t.settings?.offset||Q.date_histogram.defaultSettings?.offset})}),(0,e.jsx)(j.I,{label:"Timezone",...H,children:(0,e.jsx)(te.U,{value:t.settings?.timeZone||Q.date_histogram.defaultSettings?.timeZone,includeInternal:[ot.g$.utc],onChange:u=>{i(k({bucketAgg:t,settingName:"timeZone",newValue:u}))}})})]})},pt=({index:t,onAdd:i,onRemove:r,elements:n})=>(0,e.jsxs)("div",{className:(0,I.css)`
        display: flex;
      `,children:[t===0&&(0,e.jsx)(ae.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:i,tooltip:"Add","aria-label":"Add"}),n.length>=2&&(0,e.jsx)(ae.$n,{variant:"secondary",fill:"text",icon:"minus",onClick:r,tooltip:"Remove","aria-label":"Remove"})]}),Ke=(0,R.VP)("@bucketAggregations/filter/add"),ve=(0,R.VP)("@bucketAggregations/filter/remove"),x=(0,R.VP)("@bucketAggregations/filter/change"),ws=(t=[],i)=>Ke.match(i)?[...t,Lt()]:ve.match(i)?t.slice(0,i.payload).concat(t.slice(i.payload+1)):x.match(i)?t.map((r,n)=>n!==i.payload.index?r:i.payload.filter):t,Yt=({bucketAgg:t})=>{const{current:i}=(0,w.useRef)((0,N.uniqueId)("es-filters-")),r=q(),n=Ve(o=>r(k({bucketAgg:t,settingName:"filters",newValue:o})),t.settings?.filters,ws);return(0,w.useEffect)(()=>{t.settings?.filters?.length||n(Ke())},[n,t.settings?.filters?.length]),(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:(0,I.css)`
          display: flex;
          flex-direction: column;
        `,children:t.settings?.filters.map((o,u)=>(0,e.jsxs)("div",{className:(0,I.css)`
              display: flex;
            `,children:[(0,e.jsx)(j.I,{label:"Query",labelWidth:8,children:(0,e.jsx)("div",{className:(0,I.css)`
                  width: 150px;
                `,children:(0,e.jsx)(oe.X,{placeholder:"Lucene Query",portalOrigin:"elasticsearch",onChange:f=>n(x({index:u,filter:{...o,query:f}})),query:o.query})})}),(0,e.jsx)(j.I,{label:"Label",labelWidth:8,children:(0,e.jsx)(S.p,{width:16,id:`${i}-label-${u}`,placeholder:"Label",onBlur:f=>n(x({index:u,filter:{...o,label:f.target.value}})),defaultValue:o.label})}),(0,e.jsx)(pt,{index:u,elements:t.settings?.filters||[],onAdd:()=>n(Ke()),onRemove:()=>n(ve(u))})]},u))})})},Kt=({bucketAgg:t})=>{const{metrics:i}=z(),r=Cs(i),{current:n}=(0,w.useRef)((0,N.uniqueId)("es-terms-")),o=q();return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.I,{label:"Order",...H,children:(0,e.jsx)(Y.l6,{inputId:`${n}-order`,onChange:u=>o(k({bucketAgg:t,settingName:"order",newValue:u.value})),options:Ce,value:t.settings?.order||Q.terms.defaultSettings?.order})}),(0,e.jsx)(j.I,{label:"Size",...H,children:(0,e.jsx)(Y.l6,{inputId:`${n}-size`,...Ee({options:ms,value:t.settings?.size||Q.terms.defaultSettings?.size,onChange({value:u}){o(k({bucketAgg:t,settingName:"size",newValue:u}))}})})}),(0,e.jsx)(j.I,{label:"Min Doc Count",...H,children:(0,e.jsx)(S.p,{id:`${n}-min_doc_count`,onBlur:u=>o(k({bucketAgg:t,settingName:"min_doc_count",newValue:u.target.value})),defaultValue:t.settings?.min_doc_count||Q.terms.defaultSettings?.min_doc_count})}),(0,e.jsx)(j.I,{label:"Order By",...H,children:(0,e.jsx)(Y.l6,{inputId:`${n}-order_by`,onChange:u=>o(k({bucketAgg:t,settingName:"orderBy",newValue:u.value})),options:r,value:t.settings?.orderBy||Q.terms.defaultSettings?.orderBy})}),(0,e.jsx)(j.I,{label:"Missing",...H,children:(0,e.jsx)(S.p,{id:`${n}-missing`,onBlur:u=>o(k({bucketAgg:t,settingName:"missing",newValue:u.target.value})),defaultValue:t.settings?.missing||Q.terms.defaultSettings?.missing})})]})};function re(t){return t.meta?Object.keys(t.meta).filter(r=>t.meta?.[r]).map(r=>{let n=r;return r==="std_deviation_bounds_lower"&&(n="std_lower"),r==="std_deviation_bounds_upper"&&(n="std_upper"),{label:`${me(t)} (${n})`,value:`${t.id}[${n}]`}}):[]}function Zt(t){return t.settings?.percents?t.settings.percents.map(i=>{const r=/^\d+\.\d+/.test(`${i}`)?i:`${i}.0`;return{label:`${me(t)} (${i})`,value:`${t.id}[${r}]`}}):[]}function Jt(t){return t.type!=="top_metrics"&&!$e(t)}const Cs=(t=[])=>{const i=t.filter(Jt).flatMap(r=>r.type==="extended_stats"?re(r):r.type==="percentiles"?Zt(r):{label:me(r),value:r.id});return[...ze,...i]},Ze=t=>i=>i.value===t,Ms=t=>{const{metrics:i}=z();switch(t.type){case"terms":{const r=t.settings?.order||"desc",n=t.settings?.size||"10",o=parseInt(t.settings?.min_doc_count||"0",10),u=t.settings?.orderBy||"_term";let f="";n!=="0"&&(f=`${Ce.find(Ze(r))?.label} ${n}, `),o>0&&(f+=`Min Doc Count: ${o}, `),f+="Order by: ";const v=ze.find(Ze(u));if(v)f+=v.label;else{const $=i?.find(h=>h.id===it(u));$?f+=me($):f+="metric not found"}return n==="0"&&(f+=` (${r})`),f}case"histogram":{const r=t.settings?.interval||"1000",n=parseInt(t.settings?.min_doc_count||"1",10);return`Interval: ${r}${n>0?`, Min Doc Count: ${n}`:""}`}case"filters":return`Filter Queries (${(t.settings?.filters||Q.filters.defaultSettings?.filters).length})`;case"geohash_grid":return`Precision: ${parseInt(t.settings?.precision||he,10)}`;case"date_histogram":{const r=t.settings?.interval||"auto",n=parseInt(t.settings?.min_doc_count||"0",10),o=parseInt(t.settings?.trimEdges||"0",10);let u=`Interval: ${r}`;return n>0&&(u+=`, Min Doc Count: ${n}`),o>0&&(u+=`, Trim edges: ${o}`),u}default:return"Settings"}},H={labelWidth:18},le=({bucketAgg:t})=>{const{current:i}=(0,w.useRef)((0,N.uniqueId)("es-setting-")),r=q(),n=Ms(t);return(0,e.jsxs)(C,{label:n,children:[t.type==="terms"&&(0,e.jsx)(Kt,{bucketAgg:t}),t.type==="date_histogram"&&(0,e.jsx)(As,{bucketAgg:t}),t.type==="filters"&&(0,e.jsx)(Yt,{bucketAgg:t}),t.type==="geohash_grid"&&(0,e.jsx)(j.I,{label:"Precision",...H,children:(0,e.jsx)(S.p,{id:`${i}-geohash_grid-precision`,onBlur:o=>r(k({bucketAgg:t,settingName:"precision",newValue:o.target.value})),defaultValue:t.settings?.precision||Q[t.type].defaultSettings?.precision})}),t.type==="histogram"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.I,{label:"Interval",...H,children:(0,e.jsx)(S.p,{id:`${i}-histogram-interval`,onBlur:o=>r(k({bucketAgg:t,settingName:"interval",newValue:o.target.value})),defaultValue:t.settings?.interval||Q[t.type].defaultSettings?.interval})}),(0,e.jsx)(j.I,{label:"Min Doc Count",...H,children:(0,e.jsx)(S.p,{id:`${i}-histogram-min_doc_count`,onBlur:o=>r(k({bucketAgg:t,settingName:"min_doc_count",newValue:o.target.value})),defaultValue:t.settings?.min_doc_count||Q[t.type].defaultSettings?.min_doc_count})})]})]})},Xt=Object.entries(Q).map(([t,{label:i}])=>({label:i,value:t})),es=t=>({label:Q[t.type].label,value:t.type}),Ts=({value:t})=>{const i=q(),r=Ue(t.type);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(ye.e,{children:[(0,e.jsx)(ft.Y,{className:ge,options:Xt,onChange:n=>i(Qt({id:t.id,newType:n.value})),value:es(t)}),gt(t)&&(0,e.jsx)(He.s,{className:ge,loadOptions:r,onChange:n=>i(Bt({id:t.id,newField:n.value})),placeholder:"Select Field",value:t.field})]}),(0,e.jsx)(le,{bucketAgg:t})]})},Ds=({nextId:t})=>{const i=q(),{bucketAggs:r}=z(),n=r?.length||0;return(0,e.jsx)(e.Fragment,{children:r.map((o,u)=>(0,e.jsxs)(dt,{label:u===0?"Group By":"Then By",onRemoveClick:n>1&&(()=>i(_t(o.id))),children:[(0,e.jsx)(Ts,{value:o}),u===0&&(0,e.jsx)(ae.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:()=>i(Nt(t)),tooltip:"Add grouping condition","aria-label":"Add grouping condition"})]},`${o.type}-${o.id}`))})};var xe=m(15292);const ts=(0,I.css)`
  white-space: nowrap;
`,Oe=t=>({label:me(t),value:t}),Es=t=>t.map(Oe),ht=({options:t,onChange:i,className:r,value:n})=>{const o=t.find(u=>u.id===n);return(0,e.jsx)(ft.Y,{className:(0,I.cx)(r,ts),options:Es(t),onChange:i,placeholder:"Select Metric",value:o?Oe(o):void 0})};function U({label:t,settingName:i,metric:r,placeholder:n,tooltip:o}){const u=q(),[f]=(0,w.useState)((0,N.uniqueId)("es-field-id-"));let $=r.settings?.[i]||"";return i==="script"&&($=Qe(r)),(0,e.jsx)(j.I,{label:t,labelWidth:16,tooltip:o,children:(0,e.jsx)(S.p,{id:f,placeholder:n,onBlur:h=>u(W({metric:r,settingName:i,newValue:h.target.value})),defaultValue:$})})}const mt=(0,R.VP)("@pipelineVariables/add"),yt=(0,R.VP)("@pipelineVariables/remove"),vt=(0,R.VP)("@pipelineVariables/rename"),ss=(0,R.VP)("@pipelineVariables/change_metric"),pe=(t=[],i)=>mt.match(i)?[...t,St(It(t))]:yt.match(i)?t.slice(0,i.payload).concat(t.slice(i.payload+1)):vt.match(i)?t.map((r,n)=>n!==i.payload.index?r:{...r,name:i.payload.newName}):ss.match(i)?t.map((r,n)=>n!==i.payload.index?r:{...r,pipelineAgg:i.payload.newMetric}):t,is=({value:t,previousMetrics:i})=>{const r=q(),n=Ve(o=>r(lt({metric:t,attribute:"pipelineVariables",newValue:o})),t.pipelineVariables,pe);return(0,w.useEffect)(()=>{t.pipelineVariables?.length||n(mt())},[n,t.pipelineVariables?.length]),(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:(0,I.css)`
          display: flex;
        `,children:[(0,e.jsx)(D.c,{width:16,children:"Variables"}),(0,e.jsx)("div",{className:(0,I.css)`
            display: grid;
            grid-template-columns: 1fr auto;
            row-gap: 4px;
            margin-bottom: 4px;
          `,children:t.pipelineVariables.map((o,u)=>(0,e.jsxs)(w.Fragment,{children:[(0,e.jsxs)("div",{className:(0,I.css)`
                  display: grid;
                  column-gap: 4px;
                  grid-template-columns: auto auto;
                `,children:[(0,e.jsx)(S.p,{"aria-label":"Variable name",defaultValue:o.name,placeholder:"Variable Name",onBlur:f=>n(vt({newName:f.target.value,index:u}))}),(0,e.jsx)(ht,{onChange:f=>n(ss({newMetric:f.value.id,index:u})),options:i,value:o.pipelineAgg})]}),(0,e.jsx)(pt,{index:u,elements:t.pipelineVariables||[],onAdd:()=>n(mt()),onRemove:()=>n(yt(u))})]},(0,N.uniqueId)("es-bs-")))})]}),(0,e.jsx)(U,{label:"Script",metric:t,settingName:"script",tooltip:"Elasticsearch v5.0 and above: Scripting language is Painless. Use params.<var> to reference a variable. Elasticsearch pre-v5.0: Scripting language is per default Groovy if not changed. For Groovy use <var> to reference a variable.",placeholder:"params.var1 / params.var2"})]})},xt=({metric:t})=>{const i=q(),{current:r}=(0,w.useRef)((0,N.uniqueId)("es-moving-avg-"));return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.I,{label:"Model",labelWidth:16,children:(0,e.jsx)(Y.l6,{inputId:`${r}-model`,onChange:n=>i(W({metric:t,settingName:"model",newValue:n.value})),options:gs,value:t.settings?.model})}),(0,e.jsx)(U,{label:"Window",settingName:"window",metric:t,placeholder:"5"}),(0,e.jsx)(U,{label:"Predict",settingName:"predict",metric:t}),(At(t)||et(t)||Re(t))&&(0,e.jsx)(j.I,{label:"Alpha",labelWidth:16,children:(0,e.jsx)(S.p,{id:`${r}-alpha`,onBlur:n=>i(W({metric:t,settingName:"settings",newValue:{...t.settings?.settings,alpha:n.target.value}})),defaultValue:t.settings?.settings?.alpha})}),(et(t)||Re(t))&&(0,e.jsx)(j.I,{label:"Beta",labelWidth:16,children:(0,e.jsx)(S.p,{id:`${r}-beta`,onBlur:n=>i(W({metric:t,settingName:"settings",newValue:{...t.settings?.settings,beta:n.target.value}})),defaultValue:t.settings?.settings?.beta})}),Re(t)&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.I,{label:"Gamma",labelWidth:16,children:(0,e.jsx)(S.p,{id:`${r}-gamma`,onBlur:n=>i(W({metric:t,settingName:"settings",newValue:{...t.settings?.settings,gamma:n.target.value}})),defaultValue:t.settings?.settings?.gamma})}),(0,e.jsx)(j.I,{label:"Period",labelWidth:16,children:(0,e.jsx)(S.p,{id:`${r}-period`,onBlur:n=>i(W({metric:t,settingName:"settings",newValue:{...t.settings?.settings,period:n.target.value}})),defaultValue:t.settings?.settings?.period})}),(0,e.jsx)(j.I,{label:"Pad",labelWidth:16,children:(0,e.jsx)(xe.K,{id:`${r}-pad`,onChange:n=>i(W({metric:t,settingName:"settings",newValue:{...t.settings?.settings,pad:n.target.checked}})),checked:!!t.settings?.settings?.pad})})]}),(At(t)||et(t)||Re(t))&&(0,e.jsx)(j.I,{label:"Minimize",labelWidth:16,children:(0,e.jsx)(xe.K,{id:`${r}-minimize`,onChange:n=>i(W({metric:t,settingName:"minimize",newValue:n.target.checked})),checked:!!t.settings?.minimize})})]})},Ps=t=>({value:t,label:t}),M=({metric:t})=>{const i=q(),r=Ue(["number","date"]),n=Ue(t.type);return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.I,{label:"Metrics",labelWidth:16,children:(0,e.jsx)(Y.Iv,{onChange:o=>i(W({metric:t,settingName:"metrics",newValue:o.map(u=>u.value)})),loadOptions:n,value:t.settings?.metrics?.map(Ps),closeMenuOnSelect:!1,defaultOptions:!0})}),(0,e.jsx)(j.I,{label:"Order",labelWidth:16,children:(0,e.jsx)(Y.l6,{onChange:o=>i(W({metric:t,settingName:"order",newValue:o.value})),options:Ce,value:t.settings?.order})}),(0,e.jsx)(j.I,{label:"Order By",labelWidth:16,className:(0,I.css)`
          & > div {
            width: 100%;
          }
        `,children:(0,e.jsx)(He.s,{className:(0,I.css)`
            margin-right: 0;
          `,loadOptions:r,onChange:o=>i(W({metric:t,settingName:"orderBy",newValue:o.value})),placeholder:"Select Field",value:t.settings?.orderBy})})]})},bt=t=>i=>i.value===t,s=t=>{switch(t.type){case"cardinality":return`Precision threshold: ${t.settings?.precision_threshold||""}`;case"percentiles":return t.settings?.percents&&t.settings?.percents?.length>=1?`Values: ${t.settings?.percents}`:"Percents: Default";case"extended_stats":{const i=Object.entries(t.meta||{}).map(([r,n])=>n&&Tt.find(bt(r))?.label).filter(Boolean);return`Stats: ${i.length>0?i.join(", "):"None selected"}`}case"raw_document":case"raw_data":return`Size: ${t.settings?.size||500}`;default:return"Options"}},l={labelWidth:16},c=({metric:t,previousMetrics:i})=>{const{current:r}=(0,w.useRef)((0,N.uniqueId)("es-setting-")),n=q(),o=s(t),u=(0,w.useId)(),f=(0,w.useId)(),v=(0,w.useId)(),$=[{value:"second",label:"Second"},{value:"minute",label:"Minute"},{value:"hour",label:"Hour"},{value:"day",label:"Day"},{value:"week",label:"Week"},{value:"month",label:"Month"},{value:"quarter",label:"Quarter"},{value:"Year",label:"Year"}],h=[{value:"sum",label:"Sum"},{value:"value_count",label:"Value count"}];return(0,e.jsxs)(C,{label:o,hidden:t.hide,children:[t.type==="derivative"&&(0,e.jsx)(U,{label:"Unit",metric:t,settingName:"unit"}),t.type==="serial_diff"&&(0,e.jsx)(U,{label:"Lag",metric:t,settingName:"lag",placeholder:"1"}),t.type==="cumulative_sum"&&(0,e.jsx)(U,{label:"Format",metric:t,settingName:"format"}),t.type==="moving_avg"&&(0,e.jsx)(xt,{metric:t}),t.type==="moving_fn"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(U,{label:"Window",metric:t,settingName:"window"}),(0,e.jsx)(U,{label:"Script",metric:t,settingName:"script"}),(0,e.jsx)(U,{label:"Shift",metric:t,settingName:"shift"})]}),t.type==="top_metrics"&&(0,e.jsx)(M,{metric:t}),t.type==="bucket_script"&&(0,e.jsx)(is,{value:t,previousMetrics:i}),(t.type==="raw_data"||t.type==="raw_document")&&(0,e.jsx)(j.I,{label:"Size",...l,htmlFor:u,children:(0,e.jsx)(S.p,{id:u,onBlur:b=>n(W({metric:t,settingName:"size",newValue:b.target.value})),defaultValue:t.settings?.size??_.raw_data.defaults.settings?.size})}),t.type==="logs"&&(0,e.jsx)(U,{label:"Limit",metric:t,settingName:"limit",placeholder:"500"}),t.type==="cardinality"&&(0,e.jsx)(U,{label:"Precision Threshold",metric:t,settingName:"precision_threshold"}),t.type==="extended_stats"&&(0,e.jsxs)(e.Fragment,{children:[Tt.map(b=>(0,e.jsx)(g,{stat:b,onChange:E=>n(Ot({metric:t,meta:b.value,newValue:E})),value:t.meta?.[b.value]!==void 0?!!t.meta?.[b.value]:!!_.extended_stats.defaults.meta?.[b.value]},b.value)),(0,e.jsx)(U,{label:"Sigma",metric:t,settingName:"sigma",placeholder:"3"})]}),t.type==="percentiles"&&(0,e.jsx)(j.I,{label:"Percentiles",...l,children:(0,e.jsx)(S.p,{id:`${r}-percentiles-percents`,onBlur:b=>n(W({metric:t,settingName:"percents",newValue:b.target.value.split(",").filter(Boolean)})),defaultValue:t.settings?.percents||_.percentiles.defaults.settings?.percents,placeholder:"1,5,25,50,75,95,99"})}),t.type==="rate"&&(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(j.I,{label:"Unit",...l,"data-testid":"unit-select",htmlFor:f,children:(0,e.jsx)(Y.l6,{id:f,onChange:b=>n(W({metric:t,settingName:"unit",newValue:b.value})),options:$,value:t.settings?.unit})}),(0,e.jsx)(j.I,{label:"Mode",...l,"data-testid":"mode-select",htmlFor:v,children:(0,e.jsx)(Y.l6,{id:v,onChange:b=>n(W({metric:t,settingName:"mode",newValue:b.value})),options:h,value:t.settings?.unit})})]}),Fe(t)&&(0,e.jsx)(U,{label:"Script",metric:t,settingName:"script",placeholder:"_value * 1"}),fs(t)&&(0,e.jsx)(U,{label:"Missing",metric:t,settingName:"missing",tooltip:`The missing parameter defines how documents that are missing a value should be treated. By default
            they will be ignored but it is also possible to treat them as if they had a value`})]})},g=({stat:t,onChange:i,value:r})=>{const[n]=(0,w.useState)((0,N.uniqueId)("es-field-id-"));return(0,w.createElement)(j.I,{label:t.label,...l,key:t.value},(0,e.jsx)(xe.K,{id:n,onChange:o=>i(o.target.checked),value:r}))},p=({name:t,metric:i})=>{const r=[];return(0,e.jsxs)(ut.C,{children:[(0,e.jsx)(ye.e,{children:(0,e.jsx)(D.c,{width:17,as:"div",children:(0,e.jsx)("span",{children:t})})}),(0,e.jsx)(c,{metric:i,previousMetrics:r})]})},T=(t,i)=>({color:i&&(0,I.css)`
        &,
        &:hover,
        label,
        a {
          color: ${i?t.colors.text.disabled:t.colors.text.primary};
        }
      `}),A=t=>({label:_[t.type].label,value:t.type}),Z=t=>!_[t.type].isPipelineAgg,hi=(t,i)=>{const r=t.some(Z);return Object.entries(_).filter(([n,o])=>o.impliedQueryType==="metrics").filter(([n,{versionRange:o="*"}])=>i!=null?(0,Ne.satisfies)(i,o):!0).filter(([n,o])=>r||!o.isPipelineAgg).map(([n,{label:o}])=>({label:o,value:n}))},mi=({value:t})=>{const i=T((0,J.$j)(),!!t.hide),r=De(),n=z(),o=q(),u=Ue(t.type),f=async h=>{const b=await r.getDatabaseVersion();return hi(h,b)},v=(0,w.useCallback)(async()=>{const h=await u();return Fe(t)?[{label:"None"},...h]:h},[u,t]),$=n.metrics.slice(0,n.metrics.findIndex(h=>h.id===t.id));return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)(ye.e,{children:[(0,e.jsx)(He.s,{className:(0,I.cx)(i.color,ge),loadOptions:()=>f($),onChange:h=>o(Ae({id:t.id,type:h.value})),value:A(t)}),ue(t)&&!$e(t)&&(0,e.jsx)(He.s,{className:(0,I.cx)(i.color,ge),loadOptions:v,onChange:h=>o(Ie({id:t.id,field:h.value})),placeholder:"Select Field",value:t.field}),$e(t)&&!Le(t)&&(0,e.jsx)(ht,{className:(0,I.cx)(i.color,ge),onChange:h=>o(Ie({id:t.id,field:h.value?.id})),options:$,value:t.field})]}),ie(t)&&(0,e.jsx)(c,{metric:t,previousMetrics:$})]})},yi=({nextId:t})=>{const i=q(),{metrics:r}=z(),n=r?.length||0;return(0,e.jsx)(e.Fragment,{children:r?.map((o,u)=>{switch(o.type){case"logs":return(0,e.jsx)(p,{name:"Logs",metric:o},`${o.type}-${o.id}`);case"raw_data":return(0,e.jsx)(p,{name:"Raw Data",metric:o},`${o.type}-${o.id}`);case"raw_document":return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsx)(p,{name:"Raw Document",metric:o},`${o.type}-${o.id}`),(0,e.jsx)(ne.F,{severity:"warning",title:"The 'Raw Document' query type is deprecated."})]});default:return(0,e.jsxs)(dt,{label:`Metric (${o.id})`,hidden:o.hide,onHideClick:()=>i(ke(o.id)),onRemoveClick:n>1&&(()=>i(We(o.id))),children:[(0,e.jsx)(mi,{value:o}),_[o.type].impliedQueryType==="metrics"&&u===0&&(0,e.jsx)(ae.$n,{variant:"secondary",fill:"text",icon:"plus",onClick:()=>i(qe(t)),tooltip:"Add metric","aria-label":"Add metric"})]},`${o.type}-${o.id}`)}})})};var vi=m(94354);const xi=[{value:"metrics",label:"Metrics"},{value:"logs",label:"Logs"},{value:"raw_data",label:"Raw Data"},{value:"raw_document",label:"Raw Document"}];function bi(t){switch(t){case"logs":case"raw_data":case"raw_document":return t;case"metrics":return"count";default:throw new Error(`invalid query type: ${t}`)}}const ji=()=>{const t=z(),i=q(),r=t.metrics?.[0];if(r==null)return null;const n=_[r.type].impliedQueryType,o=u=>{i(Ae({id:r.id,type:bi(u)}))};return(0,e.jsx)(vi.z,{fullWidth:!1,options:xi,value:n,onChange:o})};function $i(t){const[i,r]=(0,w.useState)(null);return(0,w.useEffect)(()=>{let n=!1;return t.getDatabaseVersion().then(o=>{n||r(o)},o=>{console.log(o)}),()=>{n=!0}},[t]),i}const Fi=({query:t,onChange:i,onRunQuery:r,datasource:n,range:o})=>{const u=$i(n),f=u!=null&&!rt(u);return(0,e.jsxs)(vs,{datasource:n,onChange:i,onRunQuery:r,query:t,range:o||(0,se.E2)(),children:[f&&(0,e.jsx)(ne.F,{title:nt}),(0,e.jsx)(Si,{value:t})]})},ei=t=>({root:(0,I.css)`
    display: flex;
  `,queryItem:(0,I.css)`
    flex-grow: 1;
    margin: 0 ${t.spacing(.5)} ${t.spacing(.5)} 0;
  `}),ti=({value:t,onChange:i})=>{const r=(0,J.of)(ei);return(0,e.jsx)("div",{className:r.queryItem,children:(0,e.jsx)(oe.X,{query:t,onChange:i,placeholder:"Enter a lucene query",portalOrigin:"elasticsearch"})})},Si=({value:t})=>{const i=q(),r=js(),n=(0,w.useId)(),o=(0,J.of)(ei),u=Be(t),f=t.metrics?.every(v=>_[v.type].impliedQueryType==="metrics");return(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("div",{className:o.root,children:[(0,e.jsx)(D.c,{width:17,children:"Query type"}),(0,e.jsx)("div",{className:o.queryItem,children:(0,e.jsx)(ji,{})})]}),(0,e.jsxs)("div",{className:o.root,children:[(0,e.jsx)(D.c,{width:17,children:"Lucene Query"}),(0,e.jsx)(ti,{onChange:v=>i(Vt(v)),value:t?.query}),u&&(0,e.jsx)(j.I,{label:"Alias",labelWidth:15,tooltip:"Aliasing only works for timeseries queries (when the last group is 'Date Histogram'). For all other query types this field is ignored.",htmlFor:n,children:(0,e.jsx)(S.p,{id:n,placeholder:"Alias Pattern",onBlur:v=>i(Rt(v.currentTarget.value)),defaultValue:t.alias})})]}),(0,e.jsx)(yi,{nextId:r}),f&&(0,e.jsx)(Ds,{nextId:r})]})};var Ii=m(19045),Ai=m(66025),wi=m(68704),Ci=m(77657),Mi=m(39748),Os=m(67861),Ti=m(91062),Di=m(32346),rs=m(32264),Vs=m(25994),si=m(67061),Ei=m(17081),Pi=m(6709),Oi=m(91890),Rs=m(29020),Ls=m(35931),Vi=m(84596),Ri=m(55882),Li=m(64078);const Ni=t=>{const{value:i,onChange:r,onDelete:n,suggestions:o,className:u}=t,f=(0,J.of)(Qi),[v,$]=_i(i.datasourceUid),h=b=>E=>{r({...i,[b]:E.currentTarget.value})};return(0,e.jsxs)("div",{className:u,children:[(0,e.jsxs)("div",{className:f.firstRow,children:[(0,e.jsx)(j.I,{label:"Field",htmlFor:"elasticsearch-datasource-config-field",labelWidth:12,tooltip:"Can be exact field name or a regex pattern that will match on the field name.",children:(0,e.jsx)(S.p,{type:"text",id:"elasticsearch-datasource-config-field",value:i.field,onChange:h("field"),width:100})}),(0,e.jsx)(ae.$n,{variant:"destructive",title:"Remove field",icon:"times",onClick:b=>{b.preventDefault(),n()}})]}),(0,e.jsxs)(ut.C,{children:[(0,e.jsxs)("div",{className:f.urlField,children:[(0,e.jsx)(D.c,{htmlFor:"elasticsearch-datasource-internal-link",width:12,children:v?"Query":"URL"}),(0,e.jsx)(Li.l,{placeholder:v?"${__value.raw}":"http://example.com/${__value.raw}",value:i.url||"",onChange:b=>r({...i,url:b}),suggestions:o})]}),(0,e.jsx)("div",{className:f.urlDisplayLabelField,children:(0,e.jsx)(j.I,{label:"URL Label",htmlFor:"elasticsearch-datasource-url-label",labelWidth:14,tooltip:"Use to override the button label.",children:(0,e.jsx)(S.p,{type:"text",id:"elasticsearch-datasource-url-label",value:i.urlDisplayLabel,onChange:h("urlDisplayLabel")})})})]}),(0,e.jsxs)("div",{className:f.row,children:[(0,e.jsx)(j.I,{label:"Internal link",labelWidth:12,children:(0,e.jsx)(xe.K,{label:"Internal link",value:v||!1,onChange:()=>{v&&r({...i,datasourceUid:void 0}),$(!v)}})}),v&&(0,e.jsx)(Ri.s,{tracing:!0,onChange:b=>{r({...i,datasourceUid:b.uid})},current:i.datasourceUid})]})]})};function _i(t){const[i,r]=(0,w.useState)(!!t),n=(0,Vi.A)(t);return(0,w.useEffect)(()=>{!n&&t&&!i&&r(!0),n&&!t&&i&&r(!1)},[n,t,i]),[i,r]}const Qi=()=>({firstRow:(0,I.css)`
    display: flex;
  `,nameField:(0,I.css)`
    flex: 2;
  `,regexField:(0,I.css)`
    flex: 3;
  `,row:(0,I.css)`
    display: flex;
    align-items: baseline;
  `,urlField:(0,I.css)`
    display: flex;
    flex: 1;
  `,urlDisplayLabelField:(0,I.css)`
    flex: 1;
  `}),Bi=t=>({addButton:(0,I.css)`
      margin-right: 10px;
    `,container:(0,I.css)`
      margin-bottom: ${t.spacing(2)};
    `,dataLink:(0,I.css)`
      margin-bottom: ${t.spacing(1)};
    `}),qi=t=>{const{value:i,onChange:r}=t,n=(0,J.of)(Bi);return(0,e.jsx)(Rs.I,{title:"Data links",description:(0,e.jsx)(Ls.H,{description:"Add links to existing fields. Links will be shown in log row details next to the field value.",suffix:"elasticsearch/#data-links",feature:"Elasticsearch data links"}),children:(0,e.jsxs)("div",{className:n.container,children:[i&&i.length>0&&(0,e.jsx)("div",{className:"gf-form-group",children:i.map((o,u)=>(0,e.jsx)(Ni,{className:n.dataLink,value:o,onChange:f=>{const v=[...i];v.splice(u,1,f),r(v)},onDelete:()=>{const f=[...i];f.splice(u,1),r(f)},suggestions:[{value:Pi.c.valueRaw,label:"Raw value",documentation:"Raw value of the field",origin:Oi.$0.Value}]},u))}),(0,e.jsx)(ae.$n,{type:"button",variant:"secondary",className:n.addButton,icon:"plus",onClick:o=>{o.preventDefault();const u=[...i||[],{field:"",url:""}];r(u)},children:"Add"})]})})},Ns=[{label:"No pattern",value:"none"},{label:"Hourly",value:"Hourly",example:"[logstash-]YYYY.MM.DD.HH"},{label:"Daily",value:"Daily",example:"[logstash-]YYYY.MM.DD"},{label:"Weekly",value:"Weekly",example:"[logstash-]GGGG.WW"},{label:"Monthly",value:"Monthly",example:"[logstash-]YYYY.MM"},{label:"Yearly",value:"Yearly",example:"[logstash-]YYYY"}],Wi=({value:t,onChange:i})=>(0,e.jsxs)(Rs.I,{title:"Elasticsearch details",description:(0,e.jsx)(Ls.H,{description:"Specific settings for the Elasticsearch data source.",suffix:"elasticsearch/#index-settings",feature:"Elasticsearch details"}),children:[(0,e.jsx)(j.I,{label:"Index name",htmlFor:"es_config_indexName",labelWidth:29,tooltip:"Name of your Elasticsearch index. You can use a time pattern, such as YYYY.MM.DD, or a wildcard for the index name.",children:(0,e.jsx)(S.p,{id:"es_config_indexName",value:t.jsonData.index??(t.database||""),onChange:ki(t,i),width:24,placeholder:"es-index-name",required:!0})}),(0,e.jsx)(j.I,{label:"Pattern",htmlFor:"es_config_indexPattern",labelWidth:29,tooltip:"If you're using a pattern for your index, select the type, or no pattern.",children:(0,e.jsx)(Y.l6,{inputId:"es_config_indexPattern",value:Ns.find(r=>r.value===(t.jsonData.interval===void 0?"none":t.jsonData.interval)),options:Ns,onChange:Hi(t,i),width:24})}),(0,e.jsx)(j.I,{label:"Time field name",htmlFor:"es_config_timeField",labelWidth:29,tooltip:"Name of your time field. Defaults to @timestamp.",children:(0,e.jsx)(S.p,{id:"es_config_timeField",value:t.jsonData.timeField||"",onChange:_s("timeField",t,i),width:24,placeholder:"@timestamp",required:!0})}),(0,e.jsx)(j.I,{label:"Max concurrent Shard Requests",htmlFor:"es_config_shardRequests",labelWidth:29,tooltip:"Maximum number of concurrent shards a search request can hit per node. Defaults to 5.",children:(0,e.jsx)(S.p,{id:"es_config_shardRequests",value:t.jsonData.maxConcurrentShardRequests||"",onChange:_s("maxConcurrentShardRequests",t,i),width:24})}),(0,e.jsx)(j.I,{label:"Min time interval",htmlFor:"es_config_minTimeInterval",labelWidth:29,tooltip:(0,e.jsxs)(e.Fragment,{children:["A lower limit for the auto group by time interval. Recommended to be set to write frequency, for example"," ",(0,e.jsx)("code",{children:"1m"})," if your data is written every minute."]}),error:"Value is not valid, you can use number with time unit specifier: y, M, w, d, h, m, s",invalid:!!t.jsonData.timeInterval&&!/^\d+(ms|[Mwdhmsy])$/.test(t.jsonData.timeInterval),children:(0,e.jsx)(S.p,{id:"es_config_minTimeInterval",value:t.jsonData.timeInterval||"",onChange:_s("timeInterval",t,i),width:24,placeholder:"10s"})}),(0,e.jsx)(j.I,{label:"Include Frozen Indices",htmlFor:"es_config_frozenIndices",labelWidth:29,tooltip:"Include frozen indices in searches.",children:(0,e.jsx)(xe.K,{id:"es_config_frozenIndices",value:t.jsonData.includeFrozen??!1,onChange:zi("includeFrozen",t,i)})})]}),ki=(t,i)=>r=>{i({...t,database:"",jsonData:{...t.jsonData,index:r.currentTarget.value}})},_s=(t,i,r)=>n=>{r({...i,jsonData:{...i.jsonData,[t]:n.currentTarget.value}})},zi=(t,i,r)=>n=>{r({...i,jsonData:{...i.jsonData,[t]:n.currentTarget.checked}})},Hi=(t,i)=>r=>{const n=r.value==="none"?void 0:r.value,o=t.jsonData.index??t.database;if(!o||o.length===0||o.startsWith("[logstash-]")){let u="";if(n!==void 0){const f=Ns.find(v=>v.value===n);f&&(u=f.example??"")}i({...t,database:"",jsonData:{...t.jsonData,index:u,interval:n}})}else i({...t,jsonData:{...t.jsonData,interval:n}})};function Ui(){return 5}const Gi=t=>{const{value:i,onChange:r}=t,n=o=>u=>{r({...i,[o]:u.currentTarget.value})};return(0,e.jsxs)(Rs.I,{title:"Logs",description:(0,e.jsx)(Ls.H,{description:"Configure which fields the data source uses for log messages and log levels.",suffix:"elasticsearch/#logs",feature:"Elasticsearch log fields"}),children:[(0,e.jsx)(j.I,{label:"Message field name",labelWidth:22,tooltip:"Configure the field to be used for log messages.",children:(0,e.jsx)(S.p,{id:"es_logs-config_logMessageField",value:i.logMessageField,onChange:n("logMessageField"),placeholder:"_source",width:24})}),(0,e.jsx)(j.I,{label:"Level field name",labelWidth:22,tooltip:"Configure the field that determines the level of each log message.",children:(0,e.jsx)(S.p,{id:"es_logs-config_logLevelField",value:i.logLevelField,onChange:n("logLevelField"),width:24})})]})},Yi=t=>({...t,jsonData:{...t.jsonData,timeField:t.jsonData.timeField||"@timestamp",maxConcurrentShardRequests:t.jsonData.maxConcurrentShardRequests||Ui(),logMessageField:t.jsonData.logMessageField||"",logLevelField:t.jsonData.logLevelField||"",includeFrozen:t.jsonData.includeFrozen??!1}}),Ki=t=>!!t.jsonData.timeField&&!!t.jsonData.maxConcurrentShardRequests&&t.jsonData.logMessageField!==void 0&&t.jsonData.logLevelField!==void 0,Zi=t=>{const{options:i,onOptionsChange:r}=t;(0,w.useEffect)(()=>{Ki(i)||r(Yi(i))},[r,i]);const n=(0,Ai.pe)({config:i,onChange:r});return rs.$.sigV4AuthEnabled&&(n.customMethods=[{id:"custom-sigv4",label:"SigV4 auth",description:"AWS Signature Version 4 authentication",component:(0,e.jsx)(Ii._r,{inExperimentalAuthComponent:!0,...t})}],n.selectedMethod=i.jsonData.sigV4Auth?"custom-sigv4":n.selectedMethod),(0,e.jsxs)(e.Fragment,{children:[i.access==="direct"&&(0,e.jsx)(ne.F,{title:"Error",severity:"error",children:"Browser access mode in the Elasticsearch datasource is no longer available. Switch to server access mode."}),(0,e.jsx)(wi.I,{dataSourceName:"Elasticsearch",docsLink:"https://grafana.com/docs/grafana/latest/datasources/elasticsearch",hasRequiredFields:!1}),(0,e.jsx)(Vs.c,{spacing:4}),(0,e.jsx)(Ci.u,{config:i,onChange:r,urlPlaceholder:"http://localhost:9200"}),(0,e.jsx)(Vs.c,{spacing:4}),(0,e.jsx)(Mi.N,{...n,onAuthMethodSelect:o=>{r({...i,basicAuth:o===Os.q.BasicAuth,withCredentials:o===Os.q.CrossSiteCredentials,jsonData:{...i.jsonData,sigV4Auth:o==="custom-sigv4",oauthPassThru:o===Os.q.OAuthForward}})}}),(0,e.jsx)(Vs.c,{spacing:4}),(0,e.jsx)(Ti.A,{title:"Additional settings",description:"Additional settings are optional settings that can be configured for more control over your data source.",isCollapsible:!0,isInitiallyOpen:!0,children:(0,e.jsxs)(si.B,{gap:5,direction:"column",children:[(0,e.jsx)(Di.g,{config:i,onChange:r}),rs.$.secureSocksDSProxyEnabled&&(0,e.jsx)(Ei.Y,{options:i,onOptionsChange:r}),(0,e.jsx)(Wi,{value:i,onChange:r}),(0,e.jsx)(Gi,{value:i.jsonData,onChange:o=>r({...i,jsonData:o})}),(0,e.jsx)(qi,{value:i.jsonData.dataLinks,onChange:o=>{r({...i,jsonData:{...i.jsonData,dataLinks:o}})}})]})})]})};var Ji=m(51553),ns=m(65474),as=m(62467),Qs=m(66847),ii=m(69862),Xi=m(2174),er=m(41560),tr=m(57532),jt=m(81160),sr=m(59099),X=m(9557),ir=m(65879),Bs=m(41987),K=m(47232),rr=m(26657),nr=m(72574),ar=m(19347);const ri={Hourly:{startOf:"hour",amount:"hours"},Daily:{startOf:"day",amount:"days"},Weekly:{startOf:"isoWeek",amount:"weeks"},Monthly:{startOf:"month",amount:"months"},Yearly:{startOf:"year",amount:"years"}};class lr{constructor(i,r){this.pattern=i,this.interval=r,this.dateLocale="en"}getIndexForToday(){return this.interval?(0,K.yT)().locale(this.dateLocale).format(this.pattern):this.pattern}getIndexList(i,r){if(!this.interval)return this.pattern;const o=ri[this.interval],u=(0,K.KQ)(i||(0,K.KQ)(r).add(-7,o.amount)).utc().startOf(o.startOf),f=(0,K.KQ)(r||(0,K.KQ)(i).add(7,o.amount)).utc().startOf(o.startOf).valueOf(),v=[];for(;u.valueOf()<=f;)v.push(u.locale(this.dateLocale).format(this.pattern)),u.add(1,o.amount);return v}}var ls=m(73372);class or extends F.Is{constructor(i,r){super(),this.datasource=i,Object.assign(this,r)}importFromAbstractQuery(i){return{metrics:[{id:"1",type:"logs"}],query:this.getElasticsearchQuery(i.labelMatchers),refId:i.refId}}getElasticsearchQuery(i){return i.map(r=>{switch(r.operator){case ls.D_.Equal:return r.name+':"'+r.value+'"';case ls.D_.NotEqual:return"-"+r.name+':"'+r.value+'"';case ls.D_.EqualRegEx:return r.name+":/"+r.value+"/";case ls.D_.NotEqualRegEx:return"-"+r.name+":/"+r.value+"/"}}).join(" AND ")}}var cr=m(9e4),os=m(81580);function ur(t){const i=t.annotation,r=t.onAnnotationChange;return(0,e.jsxs)(si.B,{direction:"column",gap:5,children:[(0,e.jsx)("div",{children:(0,e.jsx)(ti,{value:i.target?.query,onChange:n=>{const u={...i.target??{refId:"annotation_query"},query:n};r({...i,target:u})}})}),(0,e.jsxs)("div",{children:[(0,e.jsx)("h6",{children:"Field mappings"}),(0,e.jsxs)(cr.U,{children:[(0,e.jsx)(os.c,{label:"Time",children:(0,e.jsx)(S.p,{type:"text",placeholder:"@timestamp",value:i.timeField,onChange:n=>{r({...i,timeField:n.currentTarget.value})}})}),(0,e.jsx)(os.c,{label:"Time End",children:(0,e.jsx)(S.p,{type:"text",value:i.timeEndField,onChange:n=>{r({...i,timeEndField:n.currentTarget.value})}})}),(0,e.jsx)(os.c,{label:"Text",children:(0,e.jsx)(S.p,{type:"text",value:i.textField,onChange:n=>{r({...i,textField:n.currentTarget.value})}})}),(0,e.jsx)(os.c,{label:"Tags",children:(0,e.jsx)(S.p,{type:"text",placeholder:"tags",value:i.tagsField,onChange:n=>{r({...i,tagsField:n.currentTarget.value})}})})]})]}),(0,e.jsx)("div",{})]})}function dr(t){return!t||typeof t!="object"?!1:"meta"in t}var Je=m(94601);function cs(t,i,r,n=""){return ni(t,i,r,n)!==null}function ni(t,i,r,n=""){const o=`${n}${Je.term.escape(i)}`;r=Je.phrase.escape(r);let u=ui(t);return u?qs(u,o,r):null}function qs(t,i,r){return Object.keys(t).length===0?null:ci(t.left)?qs(t.left,i,r):us(t.left)&&t.left.field===i&&t.left.term===r?t.left:zs(t)?null:us(t.right)&&t.right.field===i&&t.right.term===r?t.right:Hs(t.right)?qs(t.right,i,r):null}function $t(t,i,r,n=""){if(cs(t,i,r,n))return t;i=oi(i),r=ks(r);const o=`${n}${i}:"${r}"`;return ai(t,o)}function ai(t,i,r="AND"){return i?t.trim()===""?i:`${t} ${r} ${i}`:t}function fr(t,i){if(!i.key||!i.value)return t;if(i={...i,value:i.value.toString()},["=","!="].includes(i.operator))return $t(t,i.key,i.value,i.operator==="="?"":"-");const n=oi(i.key),o=ks(i.value);let u="";switch(i.operator){case"=~":u=`${n}:/${o}/`;break;case"!~":u=`-${n}:/${o}/`;break;case">":u=`${n}:>${o}`;break;case"<":u=`${n}:<${o}`;break}return ai(t,u)}function li(t,i,r,n=""){const o=ni(t,i,r,n),u=ui(t);return!o||!u?t:Je.toString(Ws(u,o))}function Ws(t,i){return Object.keys(t).length===0?t:ci(t.left)?(t.left=Ws(t.left,i),t):us(t.left)&&(0,N.isEqual)(t.left,i)?(Object.assign(t,{left:void 0,operator:void 0,right:void 0},"right"in t?t.right:{}),t):zs(t)?t:us(t.right)&&(0,N.isEqual)(t.right,i)?(Object.assign(t,{right:void 0,operator:void 0}),t):(Hs(t.right)&&(t.right=Ws(t.right,i)),t)}function oi(t){return Je.term.escape(t)}function ks(t){return t=t.replace(/\\/g,"\\\\"),Je.phrase.escape(t)}function gr(t){return t.replace(/(\w+)\s(:)/gi,"$1$2")}function zs(t){return!t||typeof t!="object"?!1:"left"in t&&!("right"in t)}function Hs(t){return!t||typeof t!="object"?!1:"left"in t&&"right"in t}function ci(t){return zs(t)||Hs(t)}function us(t){return!!(t&&typeof t=="object"&&"term"in t)}function ui(t){try{return Je.parse(gr(t))}catch{return null}}function di(t,i,r=!0){const n=`"${ks(i)}"`;return t.trim()?`${t} ${r?"AND":"NOT"} ${n}`:`${r?"":"NOT "}${n}`}var Us=m(14110),pr=m(45622);const hr=({payload:{dashboardId:t,orgId:i,grafanaVersion:r,queries:n}})=>{try{const o=n[pr.id]?.filter(O=>!O.hide);if(!o?.length)return;const u=o.filter(yr),f=o.filter(O=>!!O.query),v=o.filter(O=>Ft(O)==="logs"),$=o.filter(O=>Ft(O)==="metric"),h=o.filter(O=>Ft(O)==="raw_data"),b=o.filter(O=>Ft(O)==="raw_document"),E=o.filter(mr),L={grafana_version:r,dashboard_id:t,org_id:i,queries_count:o.length,logs_queries_count:v.length,metric_queries_count:$.length,raw_data_queries_count:h.length,raw_document_queries_count:b.length,queries_with_template_variables_count:u.length,queries_with_changed_line_limit_count:E.length,queries_with_lucene_query_count:f.length};(0,Us.rR)("grafana_elasticsearch_dashboard_loaded",L)}catch(o){console.error("error in elasticsearch tracking handler",o)}},Ft=t=>!t.metrics||!t.metrics.length?void 0:["logs","raw_data","raw_document"].includes(t.metrics[0].type)?t.metrics[0].type:"metric",fi=t=>{if(t.metrics?.[0]?.type!=="logs")return;const i=t.metrics?.[0].settings?.limit;return i?parseInt(i,10):void 0},mr=t=>{const i=fi(t);return i!==void 0&&i!==500},yr=t=>at.test(t.query??""),vr=t=>!!t.startsWith(gi);function xr(t,i,r){const{targets:n,app:o}=i;if(!(o===Bs.Jk.Dashboard||o===Bs.Jk.PanelViewer))for(const u of n){if(vr(u.refId))return;(0,Us.rR)("grafana_elasticsearch_query_executed",{app:o,grafana_version:rs.$.buildInfo.version,with_lucene_query:!!u.query,query_type:Ft(u),line_limit:fi(u),alias:u.alias,has_error:t.error!==void 0,has_data:t.data.some(f=>f.length>0),simultaneously_sent_query_count:n.length,time_range_from:i?.range?.from?.toISOString(),time_range_to:i?.range?.to?.toISOString(),time_taken:Date.now()-r.getTime()})}}function br(t){(0,Us.rR)("grafana_elasticsearch_annotation_query_executed",{grafana_version:rs.$.buildInfo.version,has_target_query:!!t.target?.query,has_query:!!t.query,has_time_field:!!t.timeField,has_time_end_field:!!t.timeEndField,has_tags_field:!!t.tagsField,has_text_field:!!t.textField,has_index:!!t.index})}const Tr={filters:[]},Dr={pipelineVariables:[]},Er={bucketAggs:[],metrics:[]},jr=t=>t&&typeof t=="object"&&"responses"in t&&Array.isArray(t.responses)&&t.responses.find(i=>typeof i=="object"&&i!==null&&"hits"in i&&typeof i.hits=="object"&&i.hits!==null&&"hits"in i.hits&&Array.isArray(i.hits.hits)),$r=t=>t&&typeof t=="object"&&"responses"in t&&Array.isArray(t.responses)&&t.responses.find(i=>typeof i=="object"&&i!==null&&"aggregations"in i&&typeof i.aggregations=="object"&&i.aggregations!==null&&Object.keys(i.aggregations).length>0),gi="log-volume-",pi="log-sample-",Fr=["_index","_type","_id","_source","_size","_field_names","_ignored","_routing","_meta"];class Sr extends rr.iy{constructor(i,r=(0,nr.w)()){super(i),this.templateSrv=r,this.getLogRowContext=async(o,u)=>{const f=this.makeLogContextDataRequest(o,u);return(0,ee.s)(this.query(f).pipe((0,Qs.W)(v=>{throw{message:"Error during context query. Please check JS console logs.",status:v.status,statusText:v.statusText}})))},this.makeLogContextDataRequest=(o,u)=>{const f=u?.direction||X.ZF.Backward,v={type:"logs",id:"1",settings:{limit:u?.limit?u?.limit.toString():"10",sortDirection:f===X.ZF.Backward?"desc":"asc",searchAfter:o.dataFrame.fields.find(O=>O.name==="sort")?.values[o.rowIndex]??[o.timeEpochMs]}},$={refId:`log-context-${o.dataFrame.refId}-${f}`,metrics:[v],query:""},h=wr(o.timeEpochMs,f,this.intervalPattern),b={from:h.from,to:h.to,raw:h},E=ir.calculateInterval(b,1);return{requestId:`log-context-request-${o.dataFrame.refId}-${u?.direction}`,targets:[$],interval:E.interval,intervalMs:E.intervalMs,range:b,scopedVars:{},timezone:"UTC",app:Bs.Jk.Explore,startTime:Date.now(),hideFromInspector:!0}},this.basicAuth=i.basicAuth,this.withCredentials=i.withCredentials,this.url=i.url,this.name=i.name,this.isProxyAccess=i.access==="proxy";const n=i.jsonData||{};this.index=n.index??i.database??"",this.timeField=n.timeField,this.indexPattern=new lr(this.index,n.interval),this.intervalPattern=n.interval,this.interval=n.timeInterval,this.maxConcurrentShardRequests=n.maxConcurrentShardRequests,this.queryBuilder=new y({timeField:this.timeField}),this.logLevelField=n.logLevelField||"",this.dataLinks=n.dataLinks||[],this.includeFrozen=n.includeFrozen??!1,this.databaseVersion=null,this.annotations={QueryEditor:ur},this.logLevelField===""&&(this.logLevelField=void 0),this.languageProvider=new or(this)}getResourceRequest(i,r,n){return this.getResource(i,r,n)}postResourceRequest(i,r,n){const o=n??{};return o.headers=o.headers??{},o.headers["content-type"]="application/x-ndjson",this.postResource(i,r,o)}async importFromAbstractQueries(i){return i.map(r=>this.languageProvider.importFromAbstractQuery(r))}requestAllIndices(i=(0,se.E2)()){let r=this.indexPattern.getIndexList(i.from,i.to);Array.isArray(r)||(r=[this.indexPattern.getIndexForToday()]);const n="_mapping",o=r.map(v=>(v=v.replace(/\/$/,""),v===""?n:`${v}/${n}`)),u=7,f=o.length;return(0,Ji.c)({initialState:0,condition:v=>v<Math.min(f,u),iterate:v=>v+1}).pipe((0,ii.Z)(v=>{const $=o[f-v-1];return(0,ns.H)(this.getResource($)).pipe((0,Qs.W)(h=>(0,as.of)({err:h})))}),(0,Xi.j)(v=>v?.err?.status===404),(0,er.v)(()=>"Could not find an available index for this time range."),(0,tr.$)(),(0,jt.T)(v=>{if(v.err)throw v.err;return v}))}annotationQuery(i){const r=this.prepareAnnotationRequest(i);br(i.annotation);const n=(0,ns.H)(this.postResourceRequest("_msearch",r));return(0,ee.s)(n.pipe((0,jt.T)(o=>{if(!jr(o))return[];const u=o?.responses[0].hits?.hits??[];return this.processHitsToAnnotationEvents(i.annotation,u)})))}prepareAnnotationRequest(i){const r=i.annotation,n=r.timeField||"@timestamp",o=r.timeEndField||null,$=i.dashboard.getVariables().filter(be=>be.type==="adhoc").filter(be=>be.datasource?.uid===r.datasource.uid).map(be=>be.filters).flat(),h=r.query??r.target?.query??"",b=[],E={};if(E[n]={from:i.range.from.valueOf(),to:i.range.to.valueOf(),format:"epoch_millis"},b.push({range:E}),o){const be={};be[o]={from:i.range.from.valueOf(),to:i.range.to.valueOf(),format:"epoch_millis"},b.push({range:be})}const L=this.interpolateLuceneQuery(h),O=this.addAdHocFilters(L,$),G={bool:{filter:[{bool:{should:b,minimum_should_match:1}}]}};O&&G.bool.filter.push({query_string:{query:O}});const Mr={query:G,size:1e4},Gs={search_type:"query_then_fetch",ignore_unavailable:!0};return r.index?Gs.index=r.index:Gs.index=this.indexPattern.getIndexList(i.range.from,i.range.to),JSON.stringify(Gs)+`
`+JSON.stringify(Mr)+`
`}processHitsToAnnotationEvents(i,r){const n=i.timeField||"@timestamp",o=i.timeEndField||null,u=i.textField||"tags",f=i.tagsField||null,v=[],$=(h,b)=>{if(!b)return;const E=b.split(".");let L=h;for(let O=0;O<E.length;O++)if(L=L[E[O]],!L)return"";return L};for(let h=0;h<r.length;h++){const b=r[h]._source;let E=$(b,n);if(typeof r[h].fields<"u"){const G=r[h].fields;typeof G=="object"&&((0,N.isString)(G[n])||(0,N.isNumber)(G[n]))&&(E=G[n])}const L={annotation:i,time:(0,K.yT)(E).valueOf(),text:$(b,u)};if(o){const G=$(b,o);G&&(L.timeEnd=(0,K.yT)(G).valueOf())}if(i.titleField){const G=$(b,i.titleField);G&&(L.text=G+`
`+L.text)}const O=$(b,f);typeof O=="string"?L.tags=O.split(","):L.tags=O,v.push(L)}return v}interpolateLuceneQuery(i,r){return this.templateSrv.replace(i,r,"lucene")}interpolateVariablesInQueries(i,r,n){return i.map(o=>this.applyTemplateVariables(o,r,n))}async testDatasource(){const i=await this.getDatabaseVersion(!1),n=(i!=null?rt(i):!0)?"":`WARNING: ${nt} `;return(0,ee.s)(this.getFields(["date"]).pipe((0,ii.Z)(o=>(0,N.find)(o,{text:this.timeField})?(0,as.of)({status:"success",message:`${n}Data source successfully connected.`}):(0,as.of)({status:"error",message:"No date field named "+this.timeField+" found"})),(0,Qs.W)(o=>{const f=`Unable to connect with Elasticsearch${o.message?` (${o.message})`:""}. Please check the server logs for more details.`;return(0,as.of)({status:"error",message:f})})))}getQueryHeader(i,r,n){const o={search_type:i,ignore_unavailable:!0,index:this.indexPattern.getIndexList(r,n)};return JSON.stringify(o)}getQueryDisplayText(i){const r=i.metrics,n=i.bucketAggs;let o="";return i.query&&(o+="Query: "+i.query+", "),o+="Metrics: ",o+=r?.reduce((u,f)=>{let $=_[f.type].label+"(";return ue(f)&&($+=f.field),Le(f)&&($+=Qe(f).replace(new RegExp("params.","g"),"")),$+="), ",`${u} ${$}`},""),o+=n?.reduce((u,f,v)=>{const $=Q[f.type];let h="";return v===0&&(h+=" Group by: "),h+=$.label+"(",gt(f)&&(h+=f.field),`${u} ${h}), `},""),i.alias&&(o+="Alias: "+i.alias),o}getSupplementaryRequest(i,r){switch(i){case X.cF.LogsVolume:return this.getLogsVolumeDataProvider(r);case X.cF.LogsSample:return this.getLogsSampleDataProvider(r);default:return}}getSupportedSupplementaryQueryTypes(){return[X.cF.LogsVolume,X.cF.LogsSample]}getSupplementaryQuery(i,r){let n=!1;switch(i.type){case X.cF.LogsVolume:if(n=r.metrics?.length===1&&r.metrics[0].type==="logs",!n)return;const o=[],u=this.timeField??"@timestamp";return this.logLevelField&&o.push({id:"2",type:"terms",settings:{min_doc_count:"0",size:"0",order:"desc",orderBy:"_count",missing:X.$b.unknown},field:this.logLevelField}),o.push({id:"3",type:"date_histogram",settings:{interval:"auto",min_doc_count:"0",trimEdges:"0"},field:u}),{refId:`${gi}${r.refId}`,query:r.query,metrics:[{type:"count",id:"1"}],timeField:u,bucketAggs:o};case X.cF.LogsSample:return n=Be(r),n?i.limit?{refId:`${pi}${r.refId}`,query:r.query,metrics:[{type:"logs",id:"1",settings:{limit:i.limit.toString()}}]}:{refId:`${pi}${r.refId}`,query:r.query,metrics:[{type:"logs",id:"1"}]}:void 0;default:return}}getLogsVolumeDataProvider(i){const r=(0,N.cloneDeep)(i),n=r.targets.map(o=>this.getSupplementaryQuery({type:X.cF.LogsVolume},o)).filter(o=>!!o);if(n.length)return{...r,targets:n}}getLogsSampleDataProvider(i){const r=(0,N.cloneDeep)(i),u=r.targets.map(f=>this.getSupplementaryQuery({type:X.cF.LogsSample,limit:100},f)).filter(f=>!!f);if(u.length)return{...r,targets:u}}query(i){const r=new Date;return super.query(i).pipe((0,sr.M)(n=>xr(n,i,r)),(0,jt.T)(n=>(n.data.forEach(o=>{Ir(o,this.dataLinks)}),n)))}filterQuery(i){return!i.hide}isMetadataField(i){return Fr.includes(i)}getFields(i,r){const n={float:"number",double:"number",integer:"number",long:"number",date:"date",date_nanos:"date",string:"string",text:"string",scaled_float:"number",nested:"nested",histogram:"number"};return this.requestAllIndices(r).pipe((0,jt.T)(o=>{const u=(h,b)=>this.isMetadataField(b)?!1:!i||i.length===0?!0:i.includes(h.type)||i.includes(n[h.type]),f=[],v={};function $(h){for(const b in h){const E=h[b];if((0,N.isObject)(E.properties)&&(f.push(b),$(E.properties)),(0,N.isObject)(E.fields)&&(f.push(b),$(E.fields)),(0,N.isString)(E.type)){const L=f.concat(b).join(".");u(E,b)&&(v[L]={text:L,type:E.type})}}f.pop()}for(const h in o){const b=o[h];if(b&&b.mappings){const L=b.mappings.properties;$(L)}}return(0,N.map)(v,h=>h)}))}getTerms(i,r=(0,se.E2)()){const o=this.getQueryHeader("query_then_fetch",r.from,r.to);let u=JSON.stringify(this.queryBuilder.getTermsQuery(i));u=u.replace(/\$timeFrom/g,r.from.valueOf().toString()),u=u.replace(/\$timeTo/g,r.to.valueOf().toString()),u=o+`
`+u+`
`;const f=this.getMultiSearchUrl();return(0,ns.H)(this.postResourceRequest(f,u)).pipe((0,jt.T)(v=>{if(!$r(v))return[];if(!v||!v.responses[0].aggregations)return[];const $=v.responses[0].aggregations[1].buckets;return(0,N.map)($,h=>({text:h.key_as_string||h.key,value:h.key}))}))}getMultiSearchUrl(){const i=new URLSearchParams;return this.maxConcurrentShardRequests&&i.append("max_concurrent_shard_requests",`${this.maxConcurrentShardRequests}`),this.includeFrozen&&i.append("ignore_throttled","false"),("_msearch?"+i.toString()).replace(/\?$/,"")}metricFindQuery(i,r){const n=r?.range,o=JSON.parse(i);if(i){if(o.find==="fields")return o.type=this.interpolateLuceneQuery(o.type),(0,ee.s)(this.getFields(o.type,n));if(o.find==="terms")return o.field=this.interpolateLuceneQuery(o.field),o.query=this.interpolateLuceneQuery(o.query),(0,ee.s)(this.getTerms(o,n))}return Promise.resolve([])}getTagKeys(){return(0,ee.s)(this.getFields())}getTagValues(i){return(0,ee.s)(this.getTerms({field:i.key},i.timeRange))}targetContainsTemplate(i){if(this.templateSrv.containsTemplate(i.query)||this.templateSrv.containsTemplate(i.alias))return!0;if(i.bucketAggs){for(const r of i.bucketAggs)if(gt(r)&&this.templateSrv.containsTemplate(r.field)||this.objectContainsTemplate(r.settings))return!0}if(i.metrics){for(const r of i.metrics)if(ue(r)&&(r.field&&this.templateSrv.containsTemplate(r.field)||r.settings&&this.objectContainsTemplate(r.settings)||dr(r)&&this.objectContainsTemplate(r.meta)))return!0}return!1}objectContainsTemplate(i){if(typeof i=="string")return this.templateSrv.containsTemplate(i);if(!i||typeof i!="object")return!1;for(const r in i)if(Array.isArray(i[r])){for(const n of i[r])if(this.objectContainsTemplate(n))return!0}else if(this.objectContainsTemplate(i[r]))return!0;return!1}toggleQueryFilter(i,r){let n=i.query??"";switch(r.type){case"FILTER_FOR":{n=cs(n,r.options.key,r.options.value)?li(n,r.options.key,r.options.value):$t(n,r.options.key,r.options.value);break}case"FILTER_OUT":{cs(n,r.options.key,r.options.value)&&(n=li(n,r.options.key,r.options.value)),n=$t(n,r.options.key,r.options.value,"-");break}}return{...i,query:n}}queryHasFilter(i,r){let n=i.query??"";return cs(n,r.key,r.value)}modifyQuery(i,r){if(!r.options)return i;let n=i.query??"";switch(r.type){case"ADD_FILTER":{n=$t(n,r.options.key,r.options.value);break}case"ADD_FILTER_OUT":{n=$t(n,r.options.key,r.options.value,"-");break}case"ADD_STRING_FILTER":{n=di(n,r.options.value);break}case"ADD_STRING_FILTER_OUT":{n=di(n,r.options.value,!1);break}}return{...i,query:n}}getSupportedQueryModifications(){return["ADD_FILTER","ADD_FILTER_OUT","ADD_STRING_FILTER","ADD_STRING_FILTER_OUT"]}addAdHocFilters(i,r){if(!r)return i;let n=i;return r.forEach(o=>{n=fr(n,o)}),n}applyTemplateVariables(i,r,n){const o=v=>v.type==="filters"?{...v,settings:{...v.settings,filters:v.settings?.filters?.map($=>({...$,query:this.interpolateLuceneQuery($.query,r)||"*"}))}}:v,u={...i,datasource:this.getRef(),query:this.addAdHocFilters(this.interpolateLuceneQuery(i.query||"",r),n),bucketAggs:i.bucketAggs?.map(o)};return JSON.parse(this.templateSrv.replace(JSON.stringify(u),r))}getDatabaseVersionUncached(){const i=(0,ns.H)(this.getResourceRequest(""));return(0,ee.s)(i).then(r=>{const n=r?.version?.number;if(typeof n!="string")return null;try{return new Ne.SemVer(n)}catch(o){return console.error(o),null}},r=>(console.error(r),null))}async getDatabaseVersion(i=!0){if(i){const n=this.databaseVersion;if(n!=null)return n}const r=await this.getDatabaseVersionUncached();return this.databaseVersion=r,r}}function Ir(t,i){if(i.length)for(const r of t.fields){const n=i.filter(o=>new RegExp(o.field).test(r.name));n.length!==0&&(r.config=r.config||{},r.config.links=[...(r.config.links,n.map(Ar))])}}function Ar(t){const i=(0,ar.l)();if(t.datasourceUid){const r=i.getInstanceSettings(t.datasourceUid);return{title:t.urlDisplayLabel||"",url:"",internal:{query:{query:t.url},datasourceUid:t.datasourceUid,datasourceName:r?.name??"Data source not found"}}}else return{title:t.urlDisplayLabel||"",url:t.url}}function wr(t,i,r){if(r){const o=ri[r];return i===X.ZF.Forward?{from:(0,K.KQ)(t).utc(),to:(0,K.KQ)(t).add(7,o.amount).utc().startOf(o.startOf)}:{from:(0,K.KQ)(t).subtract(7,o.amount).utc().startOf(o.startOf),to:(0,K.KQ)(t).utc()}}else return i===X.ZF.Forward?{from:(0,K.KQ)(t).utc(),to:(0,K.KQ)(t).add(7,"hours").utc()}:{from:(0,K.KQ)(t).subtract(7,"hours").utc(),to:(0,K.KQ)(t).utc()}}const Cr=new F.tD(Sr).setQueryEditor(Fi).setConfigEditor(Zi);(0,V.J7)().subscribe(d.gc,hr)},27487:(je,B)=>{B.escape=function(V){return V.replace(/[\+\-\!\(\)\{\}\[\]\^\"\?\:\\\&\|\'\/\s\*\~]/g,m)};function m(d){return"\\"+d}B.unescape=function(V){return V.replace(/\\([\+\-\!\(\)\{\}\[\]\^\"\?\:\\\&\|\'\/\s\*\~])/g,F)};function F(d,V){return V}B.escapePhrase=function(V){return V.replace(/"/g,m)},B.unescapePhrase=function(V){return V.replace(/\\(")/g,F)}},94601:(je,B,m)=>{"use strict";var F=m(79148),d=m(27487);B.parse=F.parse.bind(F),B.toString=m(20559),B.term={escape:d.escape,unescape:d.unescape},B.phrase={escape:d.escapePhrase,unescape:d.unescapePhrase}},79148:je=>{"use strict";function B(d,V){function e(){this.constructor=d}e.prototype=V.prototype,d.prototype=new e}function m(d,V,e,I){this.message=d,this.expected=V,this.found=e,this.location=I,this.name="SyntaxError",typeof Error.captureStackTrace=="function"&&Error.captureStackTrace(this,m)}B(m,Error),m.buildMessage=function(d,V){var e={literal:function(D){return'"'+w(D.text)+'"'},class:function(D){var j="",S;for(S=0;S<D.parts.length;S++)j+=D.parts[S]instanceof Array?se(D.parts[S][0])+"-"+se(D.parts[S][1]):se(D.parts[S]);return"["+(D.inverted?"^":"")+j+"]"},any:function(D){return"any character"},end:function(D){return"end of input"},other:function(D){return D.description}};function I(D){return D.charCodeAt(0).toString(16).toUpperCase()}function w(D){return D.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(j){return"\\x0"+I(j)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(j){return"\\x"+I(j)})}function se(D){return D.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(j){return"\\x0"+I(j)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(j){return"\\x"+I(j)})}function ne(D){return e[D.type](D)}function J(D){var j=new Array(D.length),S,ce;for(S=0;S<D.length;S++)j[S]=ne(D[S]);if(j.sort(),j.length>0){for(S=1,ce=1;S<j.length;S++)j[S-1]!==j[S]&&(j[ce]=j[S],ce++);j.length=ce}switch(j.length){case 1:return j[0];case 2:return j[0]+" or "+j[1];default:return j.slice(0,-1).join(", ")+", or "+j[j.length-1]}}function oe(D){return D?'"'+w(D)+'"':"end of input"}return"Expected "+J(d)+" but "+oe(V)+" found."};function F(d,V){V=V!==void 0?V:{};var e={},I={start:Kt},w=Kt,se=function(s){return s[0]},ne=function(){return{}},J=function(s){return{operator:s}},oe=function(s,l,c,T){var p={start:s,left:l},T=T.length==0?null:T[0].right==null?T[0].left:T[0];return T!=null&&(p.operator=c==""?"<implicit>":c[0],p.right=T),p},D=function(s,l){return l},j=function(s,l,p){var g={left:s},p=p.length==0?null:p[0].right==null?p[0].left:p[0];return p!=null&&(g.operator=l==""?"<implicit>":l[0],g.right=p),g},S=function(s){return s},ce="(",Ve=P("(",!1),Xe=")",q=P(")",!1),St=function(s){return s[0].parenthesized=!0,s[0]},It=function(s,l){return l.field=s==null||s.label==""?"<implicit>":s.label,l.fieldLocation=s==null||s.label==""?null:s.location,l},At=function(s,l){return l.field=s.label,l.fieldLocation=s.location,l},et=function(s,l){var c={field:s==null||s.label==""?"<implicit>":s.label,fieldLocation:s==null||s.label==""?null:s.location};for(var g in l)c[g]=l[g];return c},Re=/^[:]/,ds=Pe([":"],!1,!1),ue=function(s){return{label:s.label,location:s.location}},$e=function(s,l,c,g){var p={term:l,quoted:!0,regex:!1,termLocation:Ee()};return c!=""&&(p.proximity=c),g!=""&&(p.boost=g),s!=""&&(p.prefix=s),p},Le=function(s,l){var c={term:l,quoted:!1,regex:!0,termLocation:Ee()};return c},fs=function(s,l,c,g){var p={term:l.label,quoted:!1,regex:!1,termLocation:Ee()};return c!=""&&(p.similarity=c),g!=""&&(p.boost=g),s!=""&&(p.prefix=s),p},ie="\\",de=P("\\",!1),Fe=function(s){return"\\"+s},wt=".",Ct=P(".",!1),_=/^[^ \t\r\n\f{}()"\/\^~[\]]/,Ys=Pe([" ","	","\r",`
`,"\f","{","}","(",")",'"',"/","^","~","[","]"],!0,!1),Mt=function(s){return s.join("")},Tt=function(s){return{label:s.join(""),location:Ee()}},gs=/^[^: \t\r\n\f{}()"\/\^~[\]]/,Dt=Pe([":"," ","	","\r",`
`,"\f","{","}","(",")",'"',"/","^","~","[","]"],!0,!1),he='"',fe=P('"',!1),tt=function(s){return s.join("")},Se="/",st=P("/",!1),Ks=function(s){return s.join("")},Et=Is(),Ne=function(s){return s},me="+",_e=P("+",!1),it="-",Qe=P("-",!1),rt="!",nt=P("!",!1),Be="{",at=P("{",!1),Pt="}",R=P("}",!1),qe="[",We=P("[",!1),ke="]",Ie=P("]",!1),Ae="^",lt=P("^",!1),W="?",Ot=P("?",!1),we=":",Vt=P(":",!1),Rt="&",ps=P("&",!1),hs="|",ot=P("|",!1),Lt="'",Q=P("'",!1),ze="~",Ce=P("~",!1),ms="*",Nt=P("*",!1),_t=" ",Qt=P(" ",!1),Bt=function(s){return s},k=function(s){return s},ys=function(s){return s==""||s==null?.5:s},qt="0.",Wt=P("0.",!1),Me=/^[0-9]/,Te=Pe([["0","9"]],!1,!1),vs=function(s){return parseFloat("0."+s.join(""))},ct=function(s){return parseInt(s.join(""))},z="TO",De=P("TO",!1),xs=function(s,l){return{term_min:s,term_max:l,inclusive:"both"}},kt=function(s,l){return{term_min:s,term_max:l,inclusive:"none"}},bs=function(s,l){return{term_min:s,term_max:l,inclusive:"left"}},js=function(s,l){return{term_min:s,term_max:l,inclusive:"right"}},ae=function(s){return s},N="OR NOT",ut=P("OR NOT",!1),ye="AND NOT",zt=P("AND NOT",!1),dt="OR",$s=P("OR",!1),ft="AND",He=P("AND",!1),ee="NOT",gt=P("NOT",!1),Ht="||",Fs=P("||",!1),Ut="&&",Ss=P("&&",!1),Ue=pt("whitespace"),ge=/^[ \t\r\n\f]/,Gt=Pe([" ","	","\r",`
`,"\f"],!1,!1),a=0,C=0,Y=[{line:1,column:1}],te=0,Ge=[],y=0,Ye;if("startRule"in V){if(!(V.startRule in I))throw new Error(`Can't start parsing from rule "`+V.startRule+'".');w=I[V.startRule]}function Zs(){return d.substring(C,a)}function Ee(){return ve(C,a)}function Js(s,l){throw l=l!==void 0?l:ve(C,a),Yt([pt(s)],d.substring(C,a),l)}function Xs(s,l){throw l=l!==void 0?l:ve(C,a),ws(s,l)}function P(s,l){return{type:"literal",text:s,ignoreCase:l}}function Pe(s,l,c){return{type:"class",parts:s,inverted:l,ignoreCase:c}}function Is(){return{type:"any"}}function As(){return{type:"end"}}function pt(s){return{type:"other",description:s}}function Ke(s){var l=Y[s],c;if(l)return l;for(c=s-1;!Y[c];)c--;for(l=Y[c],l={line:l.line,column:l.column};c<s;)d.charCodeAt(c)===10?(l.line++,l.column=1):l.column++,c++;return Y[s]=l,l}function ve(s,l){var c=Ke(s),g=Ke(l);return{start:{offset:s,line:c.line,column:c.column},end:{offset:l,line:g.line,column:g.column}}}function x(s){a<te||(a>te&&(te=a,Ge=[]),Ge.push(s))}function ws(s,l){return new m(s,null,null,l)}function Yt(s,l,c){return new m(m.buildMessage(s,l),s,l,c)}function Kt(){var s,l,c,g;for(s=a,l=[],c=M();c!==e;)l.push(c),c=M();if(l!==e){if(c=[],g=re(),g!==e)for(;g!==e;)c.push(g),g=re();else c=e;c!==e?(C=s,l=se(c),s=l):(a=s,s=e)}else a=s,s=e;if(s===e){for(s=a,l=[],c=M();c!==e;)l.push(c),c=M();l!==e&&(C=s,l=ne()),s=l,s===e&&(s=a,l=bt(),l!==e&&(C=s,l=ne()),s=l)}return s}function re(){var s,l,c,g,p,T;if(s=a,l=pe(),l!==e?(c=bt(),c!==e?(C=s,l=J(l),s=l):(a=s,s=e)):(a=s,s=e),s===e){if(s=a,l=pe(),l!==e)if(c=Zt(),c!==e){for(g=[],p=pe();p!==e;)g.push(p),p=pe();if(g!==e){for(p=[],T=re();T!==e;)p.push(T),T=re();p!==e?(C=s,l=oe(l,c,g,p),s=l):(a=s,s=e)}else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e&&(s=a,l=pe(),l!==e?(c=re(),c!==e?(C=s,l=D(l,c),s=l):(a=s,s=e)):(a=s,s=e),s===e))if(s=a,l=Zt(),l!==e){for(c=[],g=pe();g!==e;)c.push(g),g=pe();if(c!==e){for(g=[],p=re();p!==e;)g.push(p),p=re();g!==e?(C=s,l=j(l,c,g),s=l):(a=s,s=e)}else a=s,s=e}else a=s,s=e}return s}function Zt(){var s,l,c,g;if(s=a,l=Cs(),l!==e){for(c=[],g=M();g!==e;)c.push(g),g=M();c!==e?(C=s,l=S(l),s=l):(a=s,s=e)}else a=s,s=e;return s===e&&(s=Jt()),s}function Jt(){var s,l,c,g,p,T,A;if(s=a,d.charCodeAt(a)===40?(l=ce,a++):(l=e,y===0&&x(Ve)),l!==e){for(c=[],g=M();g!==e;)c.push(g),g=M();if(c!==e){if(g=[],p=re(),p!==e)for(;p!==e;)g.push(p),p=re();else g=e;if(g!==e)if(d.charCodeAt(a)===41?(p=Xe,a++):(p=e,y===0&&x(q)),p!==e){for(T=[],A=M();A!==e;)T.push(A),A=M();T!==e?(C=s,l=St(g),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e}else a=s,s=e;return s}function Cs(){var s,l,c;return s=a,l=Ze(),l===e&&(l=null),l!==e?(c=ss(),c!==e?(C=s,l=It(l,c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,l=Ze(),l!==e?(c=Jt(),c!==e?(C=s,l=At(l,c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,l=Ze(),l===e&&(l=null),l!==e?(c=Ms(),c!==e?(C=s,l=et(l,c),s=l):(a=s,s=e)):(a=s,s=e))),s}function Ze(){var s,l,c,g,p;if(s=a,l=Xt(),l!==e)if(Re.test(d.charAt(a))?(c=d.charAt(a),a++):(c=e,y===0&&x(ds)),c!==e){for(g=[],p=M();p!==e;)g.push(p),p=M();g!==e?(C=s,l=ue(l),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;return s}function Ms(){var s,l,c,g,p,T,A;if(s=a,l=xt(),l===e&&(l=null),l!==e)if(c=Ts(),c!==e)if(g=Es(),g===e&&(g=null),g!==e)if(p=ht(),p===e&&(p=null),p!==e){for(T=[],A=M();A!==e;)T.push(A),A=M();T!==e?(C=s,l=$e(l,c,g,p),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;else a=s,s=e;else a=s,s=e;if(s===e){if(s=a,l=xt(),l===e&&(l=null),l!==e)if(c=Ds(),c!==e){for(g=[],p=M();p!==e;)g.push(p),p=M();g!==e?(C=s,l=Le(l,c),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;if(s===e)if(s=a,l=xt(),l===e&&(l=null),l!==e)if(c=Xt(),c!==e)if(g=U(),g===e&&(g=null),g!==e)if(p=ht(),p===e&&(p=null),p!==e){for(T=[],A=M();A!==e;)T.push(A),A=M();T!==e?(C=s,l=fs(l,c,g,p),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;else a=s,s=e;else a=s,s=e}return s}function H(){var s,l,c;return s=a,d.charCodeAt(a)===92?(l=ie,a++):(l=e,y===0&&x(de)),l!==e?(c=Oe(),c!==e?(C=s,l=Fe(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(d.charCodeAt(a)===46?(s=wt,a++):(s=e,y===0&&x(Ct)),s===e&&(_.test(d.charAt(a))?(s=d.charAt(a),a++):(s=e,y===0&&x(Ys)))),s}function le(){var s,l,c;if(s=a,l=[],c=H(),c!==e)for(;c!==e;)l.push(c),c=H();else l=e;return l!==e&&(C=s,l=Mt(l)),s=l,s}function Xt(){var s,l,c;if(s=a,l=[],c=es(),c!==e)for(;c!==e;)l.push(c),c=es();else l=e;return l!==e&&(C=s,l=Tt(l)),s=l,s}function es(){var s,l,c;return s=a,d.charCodeAt(a)===92?(l=ie,a++):(l=e,y===0&&x(de)),l!==e?(c=Oe(),c!==e?(C=s,l=Fe(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(d.charCodeAt(a)===46?(s=wt,a++):(s=e,y===0&&x(Ct)),s===e&&(gs.test(d.charAt(a))?(s=d.charAt(a),a++):(s=e,y===0&&x(Dt)))),s}function Ts(){var s,l,c,g;if(s=a,d.charCodeAt(a)===34?(l=he,a++):(l=e,y===0&&x(fe)),l!==e){for(c=[],g=xe();g!==e;)c.push(g),g=xe();c!==e?(d.charCodeAt(a)===34?(g=he,a++):(g=e,y===0&&x(fe)),g!==e?(C=s,l=tt(c),s=l):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;return s}function Ds(){var s,l,c,g;if(s=a,d.charCodeAt(a)===47?(l=Se,a++):(l=e,y===0&&x(st)),l!==e){if(c=[],g=ts(),g!==e)for(;g!==e;)c.push(g),g=ts();else c=e;c!==e?(d.charCodeAt(a)===47?(g=Se,a++):(g=e,y===0&&x(st)),g!==e?(C=s,l=Ks(c),s=l):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;return s}function xe(){var s,l,c;return s=a,l=a,y++,d.charCodeAt(a)===34?(c=he,a++):(c=e,y===0&&x(fe)),c===e&&(d.charCodeAt(a)===92?(c=ie,a++):(c=e,y===0&&x(de))),y--,c===e?l=void 0:(a=l,l=e),l!==e?(d.length>a?(c=d.charAt(a),a++):(c=e,y===0&&x(Et)),c!==e?(C=s,l=Ne(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,d.charCodeAt(a)===92?(l=ie,a++):(l=e,y===0&&x(de)),l!==e?(c=Oe(),c!==e?(C=s,l=Fe(c),s=l):(a=s,s=e)):(a=s,s=e)),s}function ts(){var s,l,c;return s=a,l=a,y++,d.charCodeAt(a)===47?(c=Se,a++):(c=e,y===0&&x(st)),c===e&&(d.charCodeAt(a)===92?(c=ie,a++):(c=e,y===0&&x(de))),y--,c===e?l=void 0:(a=l,l=e),l!==e?(d.length>a?(c=d.charAt(a),a++):(c=e,y===0&&x(Et)),c!==e?(C=s,l=Ne(c),s=l):(a=s,s=e)):(a=s,s=e),s===e&&(s=a,d.charCodeAt(a)===92?(l=ie,a++):(l=e,y===0&&x(de)),l!==e?(c=Oe(),c!==e?(C=s,l=Fe(c),s=l):(a=s,s=e)):(a=s,s=e)),s}function Oe(){var s;return d.charCodeAt(a)===43?(s=me,a++):(s=e,y===0&&x(_e)),s===e&&(d.charCodeAt(a)===45?(s=it,a++):(s=e,y===0&&x(Qe)),s===e&&(d.charCodeAt(a)===33?(s=rt,a++):(s=e,y===0&&x(nt)),s===e&&(d.charCodeAt(a)===40?(s=ce,a++):(s=e,y===0&&x(Ve)),s===e&&(d.charCodeAt(a)===41?(s=Xe,a++):(s=e,y===0&&x(q)),s===e&&(d.charCodeAt(a)===123?(s=Be,a++):(s=e,y===0&&x(at)),s===e&&(d.charCodeAt(a)===125?(s=Pt,a++):(s=e,y===0&&x(R)),s===e&&(d.charCodeAt(a)===91?(s=qe,a++):(s=e,y===0&&x(We)),s===e&&(d.charCodeAt(a)===93?(s=ke,a++):(s=e,y===0&&x(Ie)),s===e&&(d.charCodeAt(a)===94?(s=Ae,a++):(s=e,y===0&&x(lt)),s===e&&(d.charCodeAt(a)===34?(s=he,a++):(s=e,y===0&&x(fe)),s===e&&(d.charCodeAt(a)===63?(s=W,a++):(s=e,y===0&&x(Ot)),s===e&&(d.charCodeAt(a)===58?(s=we,a++):(s=e,y===0&&x(Vt)),s===e&&(d.charCodeAt(a)===92?(s=ie,a++):(s=e,y===0&&x(de)),s===e&&(d.charCodeAt(a)===38?(s=Rt,a++):(s=e,y===0&&x(ps)),s===e&&(d.charCodeAt(a)===124?(s=hs,a++):(s=e,y===0&&x(ot)),s===e&&(d.charCodeAt(a)===39?(s=Lt,a++):(s=e,y===0&&x(Q)),s===e&&(d.charCodeAt(a)===47?(s=Se,a++):(s=e,y===0&&x(st)),s===e&&(d.charCodeAt(a)===126?(s=ze,a++):(s=e,y===0&&x(Ce)),s===e&&(d.charCodeAt(a)===42?(s=ms,a++):(s=e,y===0&&x(Nt)),s===e&&(d.charCodeAt(a)===32?(s=_t,a++):(s=e,y===0&&x(Qt)))))))))))))))))))))),s}function Es(){var s,l,c;return s=a,d.charCodeAt(a)===126?(l=ze,a++):(l=e,y===0&&x(Ce)),l!==e?(c=vt(),c!==e?(C=s,l=Bt(c),s=l):(a=s,s=e)):(a=s,s=e),s}function ht(){var s,l,c;return s=a,d.charCodeAt(a)===94?(l=Ae,a++):(l=e,y===0&&x(lt)),l!==e?(c=mt(),c!==e?(C=s,l=k(c),s=l):(a=s,s=e)):(a=s,s=e),s}function U(){var s,l,c;return s=a,d.charCodeAt(a)===126?(l=ze,a++):(l=e,y===0&&x(Ce)),l!==e?(c=yt(),c===e&&(c=null),c!==e?(C=s,l=ys(c),s=l):(a=s,s=e)):(a=s,s=e),s}function mt(){var s;return s=yt(),s===e&&(s=vt()),s}function yt(){var s,l,c,g;if(s=a,d.substr(a,2)===qt?(l=qt,a+=2):(l=e,y===0&&x(Wt)),l!==e){if(c=[],Me.test(d.charAt(a))?(g=d.charAt(a),a++):(g=e,y===0&&x(Te)),g!==e)for(;g!==e;)c.push(g),Me.test(d.charAt(a))?(g=d.charAt(a),a++):(g=e,y===0&&x(Te));else c=e;c!==e?(C=s,l=vs(c),s=l):(a=s,s=e)}else a=s,s=e;return s}function vt(){var s,l,c;if(s=a,l=[],Me.test(d.charAt(a))?(c=d.charAt(a),a++):(c=e,y===0&&x(Te)),c!==e)for(;c!==e;)l.push(c),Me.test(d.charAt(a))?(c=d.charAt(a),a++):(c=e,y===0&&x(Te));else l=e;return l!==e&&(C=s,l=ct(l)),s=l,s}function ss(){var s,l,c,g,p,T,A,Z;if(s=a,d.charCodeAt(a)===91?(l=qe,a++):(l=e,y===0&&x(We)),l!==e)if(c=le(),c!==e){for(g=[],p=M();p!==e;)g.push(p),p=M();if(g!==e)if(d.substr(a,2)===z?(p=z,a+=2):(p=e,y===0&&x(De)),p!==e){if(T=[],A=M(),A!==e)for(;A!==e;)T.push(A),A=M();else T=e;T!==e?(A=le(),A!==e?(d.charCodeAt(a)===93?(Z=ke,a++):(Z=e,y===0&&x(Ie)),Z!==e?(C=s,l=xs(c,A),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e){if(s=a,d.charCodeAt(a)===123?(l=Be,a++):(l=e,y===0&&x(at)),l!==e)if(c=le(),c!==e){for(g=[],p=M();p!==e;)g.push(p),p=M();if(g!==e)if(d.substr(a,2)===z?(p=z,a+=2):(p=e,y===0&&x(De)),p!==e){if(T=[],A=M(),A!==e)for(;A!==e;)T.push(A),A=M();else T=e;T!==e?(A=le(),A!==e?(d.charCodeAt(a)===125?(Z=Pt,a++):(Z=e,y===0&&x(R)),Z!==e?(C=s,l=kt(c,A),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e){if(s=a,d.charCodeAt(a)===91?(l=qe,a++):(l=e,y===0&&x(We)),l!==e)if(c=le(),c!==e){for(g=[],p=M();p!==e;)g.push(p),p=M();if(g!==e)if(d.substr(a,2)===z?(p=z,a+=2):(p=e,y===0&&x(De)),p!==e){if(T=[],A=M(),A!==e)for(;A!==e;)T.push(A),A=M();else T=e;T!==e?(A=le(),A!==e?(d.charCodeAt(a)===125?(Z=Pt,a++):(Z=e,y===0&&x(R)),Z!==e?(C=s,l=bs(c,A),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e;if(s===e)if(s=a,d.charCodeAt(a)===123?(l=Be,a++):(l=e,y===0&&x(at)),l!==e)if(c=le(),c!==e){for(g=[],p=M();p!==e;)g.push(p),p=M();if(g!==e)if(d.substr(a,2)===z?(p=z,a+=2):(p=e,y===0&&x(De)),p!==e){if(T=[],A=M(),A!==e)for(;A!==e;)T.push(A),A=M();else T=e;T!==e?(A=le(),A!==e?(d.charCodeAt(a)===93?(Z=ke,a++):(Z=e,y===0&&x(Ie)),Z!==e?(C=s,l=js(c,A),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}else a=s,s=e;else a=s,s=e}else a=s,s=e;else a=s,s=e}}return s}function pe(){var s,l,c,g,p;for(s=a,l=[],c=M();c!==e;)l.push(c),c=M();if(l!==e)if(c=is(),c!==e){if(g=[],p=M(),p!==e)for(;p!==e;)g.push(p),p=M();else g=e;g!==e?(C=s,l=ae(c),s=l):(a=s,s=e)}else a=s,s=e;else a=s,s=e;if(s===e){for(s=a,l=[],c=M();c!==e;)l.push(c),c=M();l!==e?(c=is(),c!==e?(g=bt(),g!==e?(C=s,l=ae(c),s=l):(a=s,s=e)):(a=s,s=e)):(a=s,s=e)}return s}function is(){var s;return d.substr(a,6)===N?(s=N,a+=6):(s=e,y===0&&x(ut)),s===e&&(d.substr(a,7)===ye?(s=ye,a+=7):(s=e,y===0&&x(zt)),s===e&&(d.substr(a,2)===dt?(s=dt,a+=2):(s=e,y===0&&x($s)),s===e&&(d.substr(a,3)===ft?(s=ft,a+=3):(s=e,y===0&&x(He)),s===e&&(d.substr(a,3)===ee?(s=ee,a+=3):(s=e,y===0&&x(gt)),s===e&&(d.substr(a,2)===Ht?(s=Ht,a+=2):(s=e,y===0&&x(Fs)),s===e&&(d.substr(a,2)===Ut?(s=Ut,a+=2):(s=e,y===0&&x(Ss)))))))),s}function xt(){var s,l,c;for(s=a,l=[],c=M();c!==e;)l.push(c),c=M();return l!==e?(c=Ps(),c!==e?(C=s,l=ae(c),s=l):(a=s,s=e)):(a=s,s=e),s}function Ps(){var s;return d.charCodeAt(a)===43?(s=me,a++):(s=e,y===0&&x(_e)),s===e&&(d.charCodeAt(a)===45?(s=it,a++):(s=e,y===0&&x(Qe)),s===e&&(d.charCodeAt(a)===33?(s=rt,a++):(s=e,y===0&&x(nt)))),s}function M(){var s,l;if(y++,s=[],ge.test(d.charAt(a))?(l=d.charAt(a),a++):(l=e,y===0&&x(Gt)),l!==e)for(;l!==e;)s.push(l),ge.test(d.charAt(a))?(l=d.charAt(a),a++):(l=e,y===0&&x(Gt));else s=e;return y--,s===e&&(l=e,y===0&&x(Ue)),s}function bt(){var s,l;return s=a,y++,d.length>a?(l=d.charAt(a),a++):(l=e,y===0&&x(Et)),y--,l===e?s=void 0:(a=s,s=e),s}if(Ye=w(),Ye!==e&&a===d.length)return Ye;throw Ye!==e&&a<d.length&&x(As()),Yt(Ge,te<d.length?d.charAt(te):null,te<d.length?ve(te,te+1):ve(te,te))}je.exports={SyntaxError:m,parse:F}},20559:je=>{"use strict";var B="<implicit>";je.exports=function m(F){if(!F)return"";var d="";return F.start!=null&&(d+=(F.parenthesized?"(":"")+F.start+" "),F.field&&F.field!==B&&(d+=F.field+":"),F.left&&(F.parenthesized&&!F.start&&(d+="("),d+=m(F.left),F.parenthesized&&!F.right&&(d+=")")),F.operator&&(F.left&&(d+=" "),F.operator!==B&&(d+=F.operator)),F.right&&(F.operator&&F.operator!==B&&(d+=" "),d+=m(F.right),F.parenthesized&&(d+=")")),(F.term||F.term===""&&F.quoted)&&(F.prefix&&(d+=F.prefix),F.quoted?(d+='"',d+=F.term,d+='"'):F.regex?(d+="/",d+=F.term,d+="/"):d+=F.term,F.proximity!=null&&(d+="~"+F.proximity),F.boost!=null&&(d+="^"+F.boost)),F.term_min&&(F.inclusive==="both"||F.inclusive==="left"?d+="[":d+="{",d+=F.term_min,d+=" TO ",d+=F.term_max,F.inclusive==="both"||F.inclusive==="right"?d+="]":d+="}"),F.similarity&&(d+="~",F.similarity!==.5&&(d+=F.similarity)),d}}}]);

//# sourceMappingURL=8747.30cfd9cb8d82101a2b9a.js.map