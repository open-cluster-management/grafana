"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[1036],{31084:(x,M,e)=>{e.d(M,{Y:()=>d});var a=e(74848),D=e(96540),i=e(41053),l=e(10096),E=e(31678),O=e(37425),A=e(85927);const d=({teamId:o,roleOptions:n,disabled:u,roles:m,onApplyRoles:g,pendingRoles:v,apply:I=!1,maxWidth:K,width:R,isLoading:S})=>{const[{loading:L,value:f=m||[]},T]=(0,i.A)(async()=>{try{if(m)return m;if(I&&v?.length)return v;if(l.TP.hasPermission(E.AccessControlAction.ActionTeamsRolesList)&&o>0)return await(0,A.xN)(o)}catch(y){console.error("Error loading options",y)}return[]},[o,v,m]);(0,D.useEffect)(()=>{T()},[T]);const W=async y=>{I?g&&g(y):(await(0,A.G3)(y,o),await T())},C=l.TP.hasPermission(E.AccessControlAction.ActionTeamsRolesAdd)&&l.TP.hasPermission(E.AccessControlAction.ActionTeamsRolesRemove);return(0,a.jsx)(O.n,{apply:I,onRolesChange:W,roleOptions:n,appliedRoles:f,isLoading:L||S,disabled:u,basicRoleDisabled:!0,canUpdateRoles:C,maxWidth:K,width:R})}},76323:(x,M,e)=>{e.d(M,{J:()=>O});var a=e(74848),D=e(32196),i=e(96540),l=e(14110),E=e(40845);const O=({text:d="PRO",className:o,experimentId:n,eventVariant:u="",...m})=>{const g=(0,E.of)(A);return(0,i.useEffect)(()=>{n&&(0,l.Xp)(n,"test",u)},[n,u]),(0,a.jsx)("span",{className:(0,D.cx)(g.badge,o),...m,children:d})},A=d=>({badge:(0,D.css)`
      margin-left: ${d.spacing(1.25)};
      border-radius: ${d.shape.borderRadius(5)};
      background-color: ${d.colors.success.main};
      padding: ${d.spacing(.25,.75)};
      color: white; // use the same color for both themes
      font-weight: ${d.typography.fontWeightMedium};
      font-size: ${d.typography.pxToRem(10)};
    `})},35538:(x,M,e)=>{e.d(M,{pL:()=>D,z5:()=>l});var a=e(32264);const D=/^[a-zA-Z0-9.!#$%&'*+\/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;function i(){const E=a.$.licenseInfo?.trialExpiry;return!!(E&&E>0)}const l=()=>i()&&a.$.featureToggles.featureHighlights},52576:(x,M,e)=>{e.r(M),e.d(M,{TeamList:()=>t,default:()=>z});var a=e(74848),D=e(32196),i=e(96540),l=e(70255),E=e(71468),O=e(40845),A=e(12942),d=e(72109),o=e(67061),n=e(55852),u=e(91605),m=e(69529),g=e(14186),v=e(67647),I=e(48840),K=e(19384),R=e(69444),S=e(85927),L=e(8484),f=e(16233),T=e(31678),W=e(31084),C=e(33667);const y=new Array(3).fill(null).map((_,U)=>({id:U,memberCount:0,name:"",orgId:0,permission:0})),t=({teams:_,query:U,noTeams:N,hasFetched:h,loadTeams:B,deleteTeam:Y,changeQuery:H,totalPages:X,page:F,rolesLoading:Q,changePage:w,changeSort:k})=>{const[J,q]=(0,i.useState)([]),$=(0,O.of)(b);(0,i.useEffect)(()=>{B(!0)},[B]),(0,i.useEffect)(()=>{f.TP.licensedAccessControlEnabled()&&f.TP.hasPermission(T.AccessControlAction.ActionRolesList)&&(0,S.RL)().then(c=>q(c))},[]);const G=f.TP.hasPermission(T.AccessControlAction.ActionTeamsCreate),V=s(),ee=(0,i.useMemo)(()=>[{id:"avatarUrl",header:"",disableGrow:!0,cell:({cell:{value:c}})=>h?c&&(0,a.jsx)(A.e,{src:c,alt:"User avatar"}):(0,a.jsx)(l.A,{containerClassName:$.blockSkeleton,width:24,height:24,circle:!0})},{id:"name",header:"Name",cell:({cell:{value:c},row:{original:p}})=>h?f.TP.hasPermissionInMetadata(T.AccessControlAction.ActionTeamsRead,p)?(0,a.jsx)(d.Y,{color:"primary",inline:!1,href:`/org/teams/edit/${p.id}`,title:"Edit team",children:c}):c:(0,a.jsx)(l.A,{width:100}),sortType:"string"},{id:"email",header:"Email",cell:({cell:{value:c}})=>h?c:(0,a.jsx)(l.A,{width:60}),sortType:"string"},{id:"memberCount",header:"Members",disableGrow:!0,cell:({cell:{value:c}})=>h?c:(0,a.jsx)(l.A,{width:40}),sortType:"number"},...V?[{id:"role",header:"Role",cell:({cell:{value:c},row:{original:p}})=>h?f.TP.hasPermissionInMetadata(T.AccessControlAction.ActionTeamsRolesList,p)&&(0,a.jsx)(W.Y,{teamId:p.id,roles:p.roles||[],isLoading:Q,roleOptions:J,width:40}):(0,a.jsx)(l.A,{width:320,height:32,containerClassName:$.blockSkeleton})}]:[],{id:"actions",header:"",disableGrow:!0,cell:({row:{original:c}})=>{if(!h)return(0,a.jsxs)(o.B,{direction:"row",justifyContent:"flex-end",alignItems:"center",children:[(0,a.jsx)(l.A,{containerClassName:$.blockSkeleton,width:16,height:16}),(0,a.jsx)(l.A,{containerClassName:$.blockSkeleton,width:22,height:24})]});const p=f.TP.hasPermissionInMetadata(T.AccessControlAction.ActionTeamsRead,c),Z=f.TP.hasPermissionInMetadata(T.AccessControlAction.ActionTeamsDelete,c);return(0,a.jsxs)(o.B,{direction:"row",justifyContent:"flex-end",gap:2,children:[p&&(0,a.jsx)(n.z9,{href:`org/teams/edit/${c.id}`,"aria-label":`Edit team ${c.name}`,icon:"pen",size:"sm",variant:"secondary",tooltip:"Edit team"}),(0,a.jsx)(u.e,{"aria-label":`Delete team ${c.name}`,size:"sm",disabled:!Z,onConfirm:()=>Y(c.id)})]})}}],[V,h,Q,J,Y,$]);return(0,a.jsx)(R.Y,{navId:"teams",actions:N?void 0:(0,a.jsx)(n.z9,{href:G?"org/teams/new":"#",disabled:!G,children:"New Team"}),children:(0,a.jsx)(R.Y.Contents,{children:N?(0,a.jsx)(m.p,{variant:"call-to-action",button:(0,a.jsx)(n.z9,{disabled:!G,href:"org/teams/new",icon:"users-alt",size:"lg",children:(0,a.jsx)(L.x6,{i18nKey:"teams.empty-state.button-title",children:"New team"})}),message:(0,L.t)("teams.empty-state.title","You haven't created any teams yet"),children:(0,a.jsxs)(L.x6,{i18nKey:"teams.empty-state.pro-tip",children:["Assign folder and dashboard permissions to teams instead of users to ease administration."," ",(0,a.jsx)(d.Y,{external:!0,href:"https://grafana.com/docs/grafana/latest/administration/team-management",children:"Learn more"})]})}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"page-action-bar",children:(0,a.jsx)(g.I,{grow:!0,children:(0,a.jsx)(v.Z,{placeholder:"Search teams",value:U,onChange:H})})}),h&&_.length===0?(0,a.jsx)(m.p,{variant:"not-found",message:(0,L.t)("teams.empty-state.message","No teams found")}):(0,a.jsxs)(o.B,{direction:"column",gap:2,children:[(0,a.jsx)(I.j,{columns:ee,data:h?_:y,getRowId:c=>String(c.id),fetchData:k}),(0,a.jsx)(o.B,{justifyContent:"flex-end",children:(0,a.jsx)(K.d,{hideWhenSinglePage:!0,currentPage:F,numberOfPages:X,onNavigate:w})})]})]})})})};function s(){return f.TP.licensedAccessControlEnabled()&&f.TP.hasPermission(T.AccessControlAction.ActionTeamsRolesList)&&f.TP.hasPermission(T.AccessControlAction.ActionRolesList)}function r(_){return{teams:_.teams.teams,query:_.teams.query,perPage:_.teams.perPage,page:_.teams.page,noTeams:_.teams.noTeams,totalPages:_.teams.totalPages,hasFetched:_.teams.hasFetched,rolesLoading:_.teams.rolesLoading}}const P={loadTeams:C.Bu,deleteTeam:C.To,changePage:C.yd,changeQuery:C.nM,changeSort:C.Vk},z=(0,E.connect)(r,P)(t),b=_=>({blockSkeleton:(0,D.css)({lineHeight:1,display:"flex"})})},33667:(x,M,e)=>{e.d(M,{Bu:()=>n,It:()=>W,To:()=>g,Vk:()=>K,aK:()=>T,eo:()=>m,n7:()=>f,nC:()=>C,nM:()=>v,yd:()=>I});var a=e(2543),D=e.n(a),i=e(17172),l=e(82467),E=e(10096),O=e(80714),A=e(31678),d=e(78319),o=e(34655);function n(t=!1){return async(s,r)=>{const{query:P,page:j,perPage:z,sort:b}=r().teams;if(!E.TP.hasPermission(A.AccessControlAction.ActionTeamsRead)){s((0,o.Q9)({teams:[],totalCount:0,page:1,perPage:z,noTeams:!0}));return}const _=await(0,i.AI)().get("/api/teams/search",(0,O.F)({query:P,page:j,perpage:z,sort:b}));let U=!1;if(t&&(U=_.teams.length===0),E.TP.licensedAccessControlEnabled()&&E.TP.hasPermission(A.AccessControlAction.ActionTeamsRolesList)){s((0,o.dJ)());const N=_?.teams.map(B=>B.id),h=await(0,i.AI)().post("/api/access-control/teams/roles/search",{teamIds:N});_.teams.forEach(B=>{B.roles=h?h[B.id]||[]:[]}),s((0,o.jE)())}s((0,o.Q9)({noTeams:U,..._}))}}const u=(0,a.debounce)(t=>t(n()),500);function m(t){return async s=>{const r=await(0,i.AI)().get(`/api/teams/${t}`,(0,O.F)());s((0,o.$T)(r)),s((0,l.Vz)((0,d.R)(r)))}}function g(t){return async s=>{await(0,i.AI)().delete(`/api/teams/${t}`),await E.TP.fetchUserPermissions(),s(n())}}function v(t){return async s=>{s((0,o.L5)(t)),u(s)}}function I(t){return async s=>{s((0,o.EC)(t)),s(n())}}function K({sortBy:t}){const s=t.length?`${t[0].id}-${t[0].desc?"desc":"asc"}`:void 0;return async r=>{r((0,o.$u)(s)),r(n())}}function R(){return async(t,s)=>{const r=s().team.team,P=await getBackendSrv().get(`/api/teams/${r.id}/members`);t(teamMembersLoaded(P))}}function S(t){return async(s,r)=>{const P=r().team.team;await getBackendSrv().post(`/api/teams/${P.id}/members`,{userId:t}),s(R())}}function L(t){return async(s,r)=>{const P=r().team.team;await getBackendSrv().delete(`/api/teams/${P.id}/members/${t}`),s(R())}}function f(t,s){return async(r,P)=>{const j=P().team.team;await(0,i.AI)().put(`/api/teams/${j.id}`,{name:t,email:s}),r(m(j.id))}}function T(){return async(t,s)=>{const r=s().team.team,P=await(0,i.AI)().get(`/api/teams/${r.id}/groups`);t((0,o.tC)(P))}}function W(t){return async(s,r)=>{const P=r().team.team;await(0,i.AI)().post(`/api/teams/${P.id}/groups`,{groupId:t}),s(T())}}function C(t){return async(s,r)=>{const P=r().team.team;await(0,i.AI)().delete(`/api/teams/${P.id}/groups?groupId=${encodeURIComponent(t)}`),s(T())}}function y(t){return async s=>{await getBackendSrv().put(`/api/teams/${t.teamId}/members/${t.userId}`,{permission:t.permission}),s(R())}}},78319:(x,M,e)=>{e.d(M,{R:()=>d,X:()=>o});var a=e(33378),D=e(76323),i=e(2913),l=e(16233),E=e(35538),O=e(31678);const A={avatarUrl:"public/img/user_profile.png",id:1,name:"Loading",email:"loading",memberCount:0,permission:O.TeamPermissionLevel.Member,accessControl:{isEditor:!1},orgId:0,updated:""};function d(n){const u={img:n.avatarUrl,id:"team-"+n.id,subTitle:"Manage members and settings",url:"",text:n.name,children:[{active:!1,icon:"sliders-v-alt",id:`team-settings-${n.id}`,text:"Settings",url:`org/teams/edit/${n.id}/settings`}]};(n===A||l.TP.hasPermissionInMetadata(O.AccessControlAction.ActionTeamsPermissionsRead,n))&&u.children.unshift({active:!1,icon:"users-alt",id:`team-members-${n.id}`,text:"Members",url:`org/teams/edit/${n.id}/members`});const m={active:!1,icon:"sync",id:`team-groupsync-${n.id}`,text:"External group sync",url:`org/teams/edit/${n.id}/groupsync`},g=n===A;return(0,E.z5)()&&(m.tabSuffix=()=>(0,D.J)({experimentId:g?"":"feature-highlights-team-sync-badge",eventVariant:"trial"})),(0,a.a)("teamsync")?(g||l.TP.hasPermissionInMetadata(O.AccessControlAction.ActionTeamsPermissionsRead,n))&&u.children.push(m):i.Ay.featureToggles.featureHighlights&&u.children.push({...m,tabSuffix:()=>(0,D.J)({experimentId:g?"":"feature-highlights-team-sync-badge"})}),u}function o(n){const u=d(A);let m;for(const g of u.children)if(g.id.indexOf(n)>0){g.active=!0,m=g;break}return{main:u,node:m}}}}]);

//# sourceMappingURL=TeamList.14e4798636222a6cadd8.js.map