"use strict";(self.webpackChunkgrafana=self.webpackChunkgrafana||[]).push([[2550],{23390:(Ea,C,s)=>{s.r(C),s.d(C,{default:()=>Pa});var a=s(74848),p=s(32196),j=s(96540),O=s(71468),W=s(26272),D=s(39070),y=s(13544),I=s(14110),K=s(32264),Y=s(72109),E=s(37270),h=s(88575),Q=s(60029),u=s(10354),m=s(55852),X=s(21744),S=s(67061),Z=s(62930),R=s(40845),w=s(3911),k=s(28138),U=s(72235),G=s(69444),l=s(8484),q=s(97007),_=s(72724),aa=s(39601),ta=s(90613),$=s(17408),N=s(11230),b=s(88264),A=s(49785),sa=s(26657),ea=s(85242),oa=s(51612),P=s(72635),ra=s(17172),na=s(71500);const da=e=>{let t;try{t=JSON.parse(e)}catch{return(0,P.t)("dashboard.validation.invalid-json","Not valid JSON")}if(t&&t.hasOwnProperty("tags"))if(Array.isArray(t.tags)){if(t.tags.some(r=>typeof r!="string"))return(0,P.t)("dashboard.validation.tags-expected-strings","tags expected array of strings")}else return(0,P.t)("dashboard.validation.tags-expected-array","tags expected array");return!0},ia=e=>{const t=/(^\d+$)|dashboards\/(\d+)/.exec(e);return t&&(t[1]||t[2])?!0:(0,P.t)("dashboard.validation.invalid-dashboard-id","Could not find a valid Grafana.com ID")},la=(e,t)=>na.P.validateNewDashboardName(t,e).then(()=>!0).catch(i=>{if(i.type==="EXISTING")return i.message}),B=e=>(0,ra.AI)().get(`/api/dashboards/uid/${e}`).then(t=>`Dashboard named '${t?.dashboard.title}' in folder '${t?.meta.folderTitle}' has the same UID`).catch(t=>(t.isHandled=!0,!0));var ca=s(86474);function z({inputs:e,label:t,description:i,folderName:r}){const o=(0,R.of)(ha);return e?.length?(0,a.jsx)("div",{className:o.spacer,children:(0,a.jsx)(h.D,{label:t,description:i,children:(0,a.jsx)(a.Fragment,{children:e.map((n,x)=>{const f=`elements[${x}]`,v=n.state===b.J7.New?{...n.model,meta:{...n.model.meta,folderName:r??"Dashboards"}}:{...n.model};return(0,a.jsx)("div",{className:o.item,children:(0,a.jsx)(ca.E,{libraryPanel:v,onClick:()=>{}})},f)})})})}):null}function ha(e){return{spacer:(0,p.css)`
      margin-bottom: ${e.spacing(2)};
    `,item:(0,p.css)`
      margin-bottom: ${e.spacing(1)};
    `}}const ma=({register:e,errors:t,control:i,getValues:r,uidReset:o,inputs:n,initialFolderUid:x,onUidReset:f,onCancel:v,onSubmit:L,watch:T})=>{const[F,Ta]=(0,j.useState)(!1),Fa=T("dataSources"),H=T("folder");(0,j.useEffect)(()=>{F&&(t.title||t.uid)&&L(r())},[t,r,F,L]);const Ua=n?.libraryPanels?.filter(d=>d.state===b.J7.New)??[],Ja=n?.libraryPanels?.filter(d=>d.state===b.J7.Exists)??[];return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)($.s,{children:"Options"}),(0,a.jsx)(h.D,{label:"Name",invalid:!!t.title,error:t.title&&t.title.message,children:(0,a.jsx)(u.p,{...e("title",{required:"Name is required",validate:async d=>await la(d,r().folder.uid)}),type:"text","data-testid":y.Tp.components.ImportDashboardForm.name})}),(0,a.jsx)(h.D,{label:"Folder",children:(0,a.jsx)(A.xI,{render:({field:{ref:d,...c}})=>(0,a.jsx)(ea.sR,{...c,enableCreateNew:!0,initialFolderUid:x}),name:"folder",control:i})}),(0,a.jsx)(h.D,{label:"Unique identifier (UID)",description:`The unique identifier (UID) of a dashboard can be used for uniquely identify a dashboard between multiple Grafana installs.
                The UID allows having consistent URLs for accessing dashboards so changing the title of a dashboard will not break any
                bookmarked links to that dashboard.`,invalid:!!t.uid,error:t.uid&&t.uid.message,children:(0,a.jsx)(a.Fragment,{children:o?(0,a.jsx)(u.p,{...e("uid",{required:!0,validate:async d=>await B(d)})}):(0,a.jsx)(u.p,{disabled:!0,...e("uid",{validate:async d=>await B(d)}),addonAfter:!o&&(0,a.jsx)(m.$n,{onClick:f,children:"Change uid"})})})}),n.dataSources&&n.dataSources.map((d,c)=>{if(d.pluginId===sa.dR.type)return null;const g=`dataSources.${c}`,Ca=Fa??[];return(0,a.jsx)(h.D,{label:d.label,description:d.description,invalid:t.dataSources&&!!t.dataSources[c],error:t.dataSources&&t.dataSources[c]&&"A data source is required",children:(0,a.jsx)(A.xI,{name:g,render:({field:{ref:Ra,...Oa}})=>(0,a.jsx)(oa.s,{...Oa,noDefault:!0,placeholder:d.info,pluginId:d.pluginId,current:Ca[c]?.uid}),control:i,rules:{required:!0}})},g)}),n.constants&&n.constants.map((d,c)=>{const g=`constants.${c}`;return(0,a.jsx)(h.D,{label:d.label,error:t.constants&&t.constants[c]&&`${d.label} needs a value`,invalid:t.constants&&!!t.constants[c],children:(0,a.jsx)(u.p,{...e(g,{required:!0}),defaultValue:d.value})},g)}),(0,a.jsx)(z,{inputs:Ua,label:"New library panels",description:"List of new library panels that will get imported.",folderName:H.title}),(0,a.jsx)(z,{inputs:Ja,label:"Existing library panels",description:"List of existing library panels. These panels are not affected by the import.",folderName:H.title}),(0,a.jsxs)(S.B,{children:[(0,a.jsx)(m.$n,{type:"submit","data-testid":y.Tp.components.ImportDashboardForm.submit,variant:pa(t),onClick:()=>{Ta(!0)},children:ua(t)}),(0,a.jsx)(m.$n,{type:"reset",variant:"secondary",onClick:v,children:"Cancel"})]})]})};function pa(e){return e&&(e.title||e.uid)?"destructive":"primary"}function ua(e){return e&&(e.title||e.uid)?"Import (Overwrite)":"Import"}const ba="dashboard_import_imported",xa=e=>{const t=aa.Ny.getSearchObject();return{dashboard:e.importDashboard.dashboard,meta:e.importDashboard.meta,source:e.importDashboard.source,inputs:e.importDashboard.inputs,folder:t.folderUid?{uid:String(t.folderUid)}:{uid:""}}},fa={clearLoadedDashboard:N.FG,importDashboard:N.Q9},va=(0,O.connect)(xa,fa);class ga extends j.PureComponent{constructor(){super(...arguments),this.state={uidReset:!1},this.onSubmit=t=>{(0,I.rR)(ba),this.props.importDashboard(t)},this.onCancel=()=>{this.props.clearLoadedDashboard()},this.onUidReset=()=>{this.setState({uidReset:!0})}}render(){const{dashboard:t,inputs:i,meta:r,source:o,folder:n}=this.props,{uidReset:x}=this.state;return(0,a.jsxs)(a.Fragment,{children:[o===b.qx.Gcom&&(0,a.jsxs)(ta.a,{marginBottom:3,children:[(0,a.jsx)("div",{children:(0,a.jsxs)($.s,{children:["Importing dashboard from"," ",(0,a.jsx)("a",{href:`https://grafana.com/dashboards/${t.gnetId}`,className:"external-link",target:"_blank",rel:"noreferrer",children:"Grafana.com"})]})}),(0,a.jsx)("table",{className:"filter-table form-inline",children:(0,a.jsxs)("tbody",{children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:"Published by"}),(0,a.jsx)("td",{children:r.orgName})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{children:"Updated on"}),(0,a.jsx)("td",{children:(0,_.LE)(r.updatedAt)})]})]})})]}),(0,a.jsx)(U.l,{onSubmit:this.onSubmit,defaultValues:{...t,constants:[],dataSources:[],elements:[],folder:n},validateOnMount:!0,validateFieldsOnMount:["title","uid"],validateOn:"onChange",children:({register:f,errors:v,control:L,watch:T,getValues:F})=>(0,a.jsx)(ma,{register:f,errors:v,control:L,getValues:F,uidReset:x,inputs:i,onCancel:this.onCancel,onUidReset:this.onUidReset,onSubmit:this.onSubmit,watch:T,initialFolderUid:n.uid})})]})}}const V=va(ga);V.displayName="ImportDashboardOverview";const J="dashboard_import_loaded",ja=`{
    "title": "Example - Repeating Dictionary variables",
    "uid": "_0HnEoN4z",
    "panels": [...]
    ...
}
`,Da=e=>({loadingState:e.importDashboard.state}),ya={fetchGcomDashboard:N.rw,importDashboardJson:N.iP,cleanUpAction:q.N},Ia=(0,O.connect)(Da,ya);class Sa extends j.PureComponent{constructor(t){super(t),this.fileListRenderer=(r,o)=>null,this.onFileUpload=r=>{(0,I.rR)(J,{import_source:"json_uploaded"});try{this.props.importDashboardJson(JSON.parse(String(r)))}catch(o){o instanceof Error&&k.A.emit(W.r1.alertError,["Import failed","JSON -> JS Serialization failed: "+o.message]);return}},this.getDashboardFromJson=r=>{(0,I.rR)(J,{import_source:"json_pasted"}),this.props.importDashboardJson(JSON.parse(r.dashboardJson))},this.getGcomDashboard=r=>{(0,I.rR)(J,{import_source:"gcom"});let o;const n=/(^\d+$)|dashboards\/(\d+)/.exec(r.gcomDashboard);n&&n[1]?o=n[1]:n&&n[2]&&(o=n[2]),o&&this.props.fetchGcomDashboard(o)},this.pageNav={text:"Import dashboard",subTitle:"Import dashboard from file or Grafana.com"};const{gcomDashboardId:i}=this.props.queryParams;if(i){this.getGcomDashboard({gcomDashboard:i});return}}componentWillUnmount(){this.props.cleanUpAction({cleanupAction:t=>t.importDashboard=b.V9})}renderImportForm(){const t=La(this.props.theme),i=()=>(0,a.jsx)(Y.Y,{variant:"bodySmall",href:"https://grafana.com/grafana/dashboards/",external:!0,children:"grafana.com/dashboards"});return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:t.option,children:(0,a.jsx)(E.gH,{options:{multiple:!1,accept:[".json",".txt"]},readAs:"readAsText",fileListRenderer:this.fileListRenderer,onLoad:this.onFileUpload,children:(0,a.jsx)(E.wI,{primaryText:(0,l.t)("dashboard-import.file-dropzone.primary-text","Upload dashboard JSON file"),secondaryText:(0,l.t)("dashboard-import.file-dropzone.secondary-text","Drag and drop here or click to browse")})})}),(0,a.jsx)("div",{className:t.option,children:(0,a.jsx)(U.l,{onSubmit:this.getGcomDashboard,defaultValues:{gcomDashboard:""},children:({register:r,errors:o})=>(0,a.jsx)(h.D,{label:(0,a.jsx)(Q.J,{className:t.labelWithLink,htmlFor:"url-input",children:(0,a.jsx)("span",{children:(0,a.jsxs)(l.x6,{i18nKey:"dashboard-import.gcom-field.label",children:["Find and import dashboards for common applications at ",(0,a.jsx)(i,{})]})})}),invalid:!!o.gcomDashboard,error:o.gcomDashboard&&o.gcomDashboard.message,children:(0,a.jsx)(u.p,{id:"url-input",placeholder:(0,l.t)("dashboard-import.gcom-field.placeholder","Grafana.com dashboard URL or ID"),type:"text",...r("gcomDashboard",{required:(0,l.t)("dashboard-import.gcom-field.validation-required","A Grafana dashboard URL or ID is required"),validate:ia}),addonAfter:(0,a.jsx)(m.$n,{type:"submit",children:(0,a.jsx)(l.x6,{i18nKey:"dashboard-import.gcom-field.load-button",children:"Load"})})})})})}),(0,a.jsx)("div",{className:t.option,children:(0,a.jsx)(U.l,{onSubmit:this.getDashboardFromJson,defaultValues:{dashboardJson:""},children:({register:r,errors:o})=>(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(h.D,{label:(0,l.t)("dashboard-import.json-field.label","Import via dashboard JSON model"),invalid:!!o.dashboardJson,error:o.dashboardJson&&o.dashboardJson.message,children:(0,a.jsx)(X.f,{...r("dashboardJson",{required:(0,l.t)("dashboard-import.json-field.validation-required","Need a dashboard JSON model"),validate:da}),"data-testid":y.Tp.components.DashboardImportPage.textarea,id:"dashboard-json-textarea",rows:10,placeholder:ja})}),(0,a.jsxs)(S.B,{children:[(0,a.jsx)(m.$n,{type:"submit","data-testid":y.Tp.components.DashboardImportPage.submit,children:(0,a.jsx)(l.x6,{i18nKey:"dashboard-import.form-actions.load",children:"Load"})}),(0,a.jsx)(m.z9,{variant:"secondary",href:`${K.$.appSubUrl}/dashboards`,children:(0,a.jsx)(l.x6,{i18nKey:"dashboard-import.form-actions.cancel",children:"Cancel"})})]})]})})})]})}render(){const{loadingState:t}=this.props;return(0,a.jsx)(G.Y,{navId:"dashboards/browse",pageNav:this.pageNav,children:(0,a.jsxs)(G.Y.Contents,{children:[t===D.Gu.Loading&&(0,a.jsx)(S.B,{direction:"column",justifyContent:"center",children:(0,a.jsx)(S.B,{justifyContent:"center",children:(0,a.jsx)(Z.y,{size:"xxl"})})}),[D.Gu.Error,D.Gu.NotStarted].includes(t)&&this.renderImportForm(),t===D.Gu.Done&&(0,a.jsx)(V,{})]})})}}const Na=(0,R.cV)(Sa),M=Ia(Na);M.displayName="DashboardImport";const Pa=M,La=(0,w.N)(e=>({option:(0,p.css)`
      margin-bottom: ${e.spacing(4)};
      max-width: 600px;
    `,labelWithLink:(0,p.css)`
      max-width: 100%;
    `,linkWithinLabel:(0,p.css)`
      font-size: inherit;
    `}))}}]);

//# sourceMappingURL=DashboardImport.b010d4acde1f3accf10d.js.map